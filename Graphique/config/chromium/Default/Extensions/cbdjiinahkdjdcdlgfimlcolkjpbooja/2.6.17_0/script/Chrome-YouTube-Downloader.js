chrome.extension.sendRequest({method:"completerequest"},function(e){function t(e){return document.getElementById(e)}function f(n,r){if(e.nstyle=="true"&&t("watch7-user-header")){t("watch7-user-header").innerHTML+='<div id="watch-actions-center-new"><iframe name="iframe"></iframe><span class="yt-uix-button-group"><button id="download" class="start yt-uix-button yt-uix-tooltip yt-uix-button-subscribe-branded yt-uix-button-default" data-tooltip-text="'+i[0]+'" data-tooltip-timer="625" title="" data-tooltip="'+i[0]+'"><span class="yt-uix-button-content">'+r+'</span></button><button id="menu" class="end yt-uix-tooltip yt-uix-button yt-uix-button-subscribe-branded yt-uix-button-empty yt-uix-button-default" onclick=";return false;" data-tooltip-text="'+i[2]+'" data-tooltip-timer="625" title="" data-tooltip="'+i[2]+'" data-button-listener="16" data-content-id="yt-uix-tooltip2-content"><span class="yt-uix-button-content"><img class="yt-uix-button-arrow"></span><ul id="stylelist" class="yt-uix-button-menu hid">'+a+n+"</ul></button></span></div>";console.log("CHYD - OK - Set new style")}if(e.cstyle=="true"&&t("watch7-user-header")){t("watch7-user-header").innerHTML+='<div id="watch-actions-center-clasic"><iframe name="iframe"></iframe><button id="download" class="yt-uix-button yt-uix-tooltip yt-uix-button-subscribe-branded yt-uix-button-default" onclick=";return false;" data-tooltip-text="'+i[0]+'" data-tooltip-timer="625" title="" data-tooltip="'+i[0]+'" data-button-listener="16" data-content-id="yt-uix-tooltip2-content"><span class="yt-uix-button-content">'+i[1]+'</span><img class="yt-uix-button-arrow" style="margin-right:8px;"><ul id="stylelist" class="yt-uix-button-menu hid">'+a+n+"</ul></button></div>";console.log("CHYD - OK - Set clasic style")}}function l(){var n=null;if((n=document.getElementById("movie_player"))&&n.tagName=="EMBED"){n=n.getAttribute("flashvars");n=unescape((n.match(/url_encoded_fmt_stream_map=(.*?)&/)||n.match(/url_encoded_fmt_stream_map=(.*?)$/))[1])}else{var r=document.getElementsByTagName("script");for(var s=0,o=r.length;s<o;s++){if(n=r[s].innerHTML.match(/"url_encoded_fmt_stream_map": "(.*?)"/)){n=n[1].replace(/\\u([0-9]+)/g,function(e,t){return decodeURIComponent("%"+parseFloat(t))})}else{n=null}}}var u="";if(t("eow-title")){u=encodeURIComponent(t("eow-title").innerText.replace(/[\\~#%*{}\/:<>?|"]/g,"_").replace(/&/g,"and"));console.log("CHYD - OK - Parse video title: "+u)}else if(t("watch-headline-title")){u=encodeURIComponent(t("watch-headline-title").innerText.replace(/[\\~#%&*{}\/:<>?|"]/g,"_").replace(/&/g,"and"))}else{u="Unknown title";console.log("CHYD - WARNING! - Unknown video title")}var a="";if(e.username=="true"&&t("watch7-user-header")){if(t("watch7-user-header").getElementsByTagName("a")[1].innerText){a=t("watch7-user-header").getElementsByTagName("a")[1].innerText+" - ";console.log("CHYD - OK - Parse username: "+t("watch7-user-header").getElementsByTagName("a")[1].innerText)}else if(e.username=="false"){a=""}else{a="Unknown username - ";console.log("CHYD - WARNING! Parsing username FAILED!")}}var l="";var c="";var h="";var p="";var d="";var v="";var m="";if(e.quality=="true"){l=" [H.263 240p]";c=" [H.264 360p]";h=" [H.264 480p]";p=" [H.264 520p]";d=" [H.264 720p]";v=" [H.264 1080p]";m=" [H.264 1536p]"}var g=window.location.href.split(/v=/)[1].split("&")[0];console.log("CHYD - OK - This video ID: "+g);var y=window.location.href.split("?")[0]+"?v="+g;console.log("CHYD - OK - This video URL: "+y);console.log("CHYD - OK - Getting to fmt_url_map");var b=new Array;b=n.split(",");var w=new String;var E=new String;var S=new Boolean;S=false;console.log("CHYD - OK - Parsing video links start");for(s=0;s<b.length;s++){var x=parseInt((b[s].match(/itag=([0-9]*)&/)||b[s].match(/itag=([0-9]*)$/))[1]);var T=(b[s].match(/sig=(.*?)&/)||b[s].match(/sig=(.*?)$/))[1];b[s]=unescape((b[s].match(/url=(.*?)&/)||b[s].match(/url=(.*?)$/))[1])+"&signature="+T;var N=new Array;N=x;console.log(N);if(N=="5"){w+='<a target="iframe" href="'+b[s]+"&title="+a+u+l+'"><span class="yt-uix-button-menu-item" id="v240p">FLV (240p)</span></a>'}if(N=="18"){w+='<a target="iframe" href="'+b[s]+"&title="+a+u+c+'"><span class="yt-uix-button-menu-item" id="v360p">MP4 (360p)</span></a>'}if(N=="43"){w+='<a target="iframe" href="'+b[s]+"&title="+a+u+'"><span class="yt-uix-button-menu-item" id="wm360p">WebM (360p)</span></a>'}if(N=="35"){w+='<a target="iframe" href="'+b[s]+"&title="+a+u+h+'"><span class="yt-uix-button-menu-item" id="v480p">FLV (480p)</span></a>'}if(N=="44"){w+='<a target="iframe" href="'+b[s]+"&title="+a+u+'"><span class="yt-uix-button-menu-item" id="wm480p">WebM (480p)</span></a>'}if(N=="22"){w+='<a target="iframe" href="'+b[s]+"&title="+a+u+d+'"><span class="yt-uix-button-menu-item" id="v720p">MP4 HD (720p)</span></a>'}if(N=="45"){w+='<a target="iframe" href="'+b[s]+"&title="+a+u+'"><span class="yt-uix-button-menu-item" id="wm720p">WebM HD (720p)</span></a>'}if(N=="37"){w+='<a target="iframe" href="'+b[s]+"&title="+a+u+v+'"><span class="yt-uix-button-menu-item" id="v1080p">MP4 HD (1080p)</span></a>'}if(N=="38"){w+='<a target="iframe" href="'+b[s]+"&title="+a+u+m+'"><span class="yt-uix-button-menu-item"  id="v2k">MP4 HD (2K)</span></a>'}}console.log("CHYD - OK - fmt id : "+x);console.log("CHYD - OK - Parsing video links end");for(s=0;s<b.length;s++){var x=parseInt((b[s].match(/itag=([0-9]*)&/)||b[s].match(/itag=([0-9]*)$/))[1]);var N=new Array;N=x;b[s]=decodeURIComponent(b[s]);var C="";if(e.quality=="true"&&N=="38"&&e.uduhd=="true"){C=" [H.264 4k]"}else if(e.quality=="true"&&N=="37"&&e.udfhd=="true"){C=" [H.264 1080p]"}else if(e.quality=="true"&&N=="22"&&e.udhd=="true"){C=" [H.264 720p]"}else if(e.quality=="true"&&N=="35"&&e.udhq=="true"){C=" [H.264 480p]"}else if(e.quality=="true"&&N=="18"&&e.udmq=="true"){C=" [H.264 240p~360p]"}else if(e.quality=="true"&&N=="5"&&e.udlq=="true"){C=" [H.263 240p]"}if(N=="38"&&e.uduhd=="true"||N=="37"&&e.udfhd=="true"||N=="22"&&e.udhd=="true"||N=="35"&&e.udhq=="true"||N=="18"&&e.udmq=="true"||N=="5"&&e.udlq=="true"){E+='<a target="iframe" href="'+b[s]+"&title="+a+u+C+'">'+i[1]+"</a>";break}}if(S!=undefined){w+='<a href="http://www.flvto.com/?url='+y+'" target="_blank"><span class="yt-uix-button-menu-item" id="ytmp3">MP3 (Flvto)</span></a>'}if(S!=undefined){w+='<a href="http://www.video2mp3.net/?url='+y+'&hq=1" target="_blank"><span class="yt-uix-button-menu-item" id="v2mp3">MP3 (Video2mp3)</span></a>'}f(w,E)}function c(){if(e.uhd=="false"&&t("v2k"))t("v2k").style.display="none";if(e.fhd=="false"&&t("v1080p"))t("v1080p").style.display="none";if(e.hd=="false"&&t("v720p"))t("v720p").style.display="none";if(e.hq=="false"&&t("v480p"))t("v480p").style.display="none";if(e.mq=="false"&&t("v360p"))t("v360p").style.display="none";if(e.lq=="false"&&t("v240p"))t("v240p").style.display="none";if(e.ytmp3=="false"&&t("ytmp3"))t("ytmp3").style.display="none";if(e.v2mp3=="false"&&t("v2mp3"))t("v2mp3").style.display="none";if(e.webm=="false"&&t("wm360p")){if(t("wm360p"))t("wm360p").style.display="none";if(t("wm480p"))t("wm480p").style.display="none";if(t("wm720p"))t("wm720p").style.display="none"}}function h(){l();c()}console.log("CHYD - OK - Runing");if(document.getElementsByTagName("html").item(0).lang&&document.getElementsByTagName("body").item(0).className){var n=document.getElementsByTagName("html").item(0).lang;var r=document.getElementsByTagName("body").item(0).className;var i=Array("Download this video!","Download","Download specific format");if(n=="cs"){i=Array("Stáhnout video!","Stáhnout","Stáhnout konkrétní formát")}if(n=="de"){i=Array("Dieses video herunterladen!","Download","Download bestimmten format")}if(n=="en"){i=Array("Download this video!","Download","Download specific format")}if(n=="es"){i=Array("Descargar este vídeo!","Descargar","Descargar formato específico")}if(n=="sk"){i=Array("Stiahnut toto video!","Stiahnut","Stiahnut konkrétny formát")}if(n=="it"){i=Array("Scarica il video!","Download","Scarica formato specifico")}if(n=="pl"){i=Array("Pobierz wideo!","Pobierz","Pobierz konkretnym formacie")}if(n=="ru"){i=Array("Скачать это видео!","Скачать","Скачать определенный формат")}if(n=="hr"){i=Array("Preuzmi ovaj video!","Download","Preuzimanje specificnom formatu")}if(n=="fr"){i=Array("Télécharger cette vidéo!","Télécharger","Télécharger format spécifique")}if(n=="ar"){i=Array("!تنزيل هذا الفيديو","تنزيل","تنزيل صيغة محددة")}if(n=="hu"){i=Array("Letöltés ezt a videót!","Letöltés","Letöltés meghatározott formátumban")}}var s=chrome.extension.getURL("images/options.png");var o=chrome.extension.getURL("html/options.html");var u=chrome.extension.getURL("images/arrow.png");var a='<div id="styleul" class="yt-uix-tooltip" data-tooltip-text="'+chrome.i18n.getMessage("settingspagetitle")+'"><a href="'+o+'" target="_blank"><img src="'+s+'" /></a></div>';h();console.log("CHYD - OK - End script")})