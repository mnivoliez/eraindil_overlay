function $(e){return document.getElementById(e)}function runScript(){chrome.extension.sendRequest({method:"completerequest"},function(e){function a(t,n){if(e.nstyle=="true"&&$("watch7-user-header")){$("watch7-user-header").innerHTML+='<div id="watch-actions-center-new"><iframe name="iframe"></iframe><span class="yt-uix-button-group"><button id="download" class="start yt-uix-button yt-uix-tooltip yt-uix-button-subscribe-branded yt-uix-button-default" data-tooltip-text="'+r[0]+'" data-tooltip-timer="625" title="" data-tooltip="'+r[0]+'"><span class="yt-uix-button-content">'+n+'</span></button><button id="menu" class="end yt-uix-tooltip yt-uix-button yt-uix-button-subscribe-branded yt-uix-button-empty yt-uix-button-default" onclick=";return false;" data-tooltip-text="'+r[2]+'" data-tooltip-timer="625" title="" data-tooltip="'+r[2]+'" data-button-listener="16" data-content-id="yt-uix-tooltip2-content"><span class="yt-uix-button-content"><img class="yt-uix-button-arrow"></span><ul id="stylelist" class="yt-uix-button-menu hid">'+u+t+"</ul></button></span></div>";console.log("CHYD - OK - Set new style")}if(e.cstyle=="true"&&$("watch7-user-header")){$("watch7-user-header").innerHTML+='<div id="watch-actions-center-clasic"><iframe name="iframe"></iframe><button id="download" class="yt-uix-button yt-uix-tooltip yt-uix-button-subscribe-branded yt-uix-button-default" onclick=";return false;" data-tooltip-text="'+r[0]+'" data-tooltip-timer="625" title="" data-tooltip="'+r[0]+'" data-button-listener="16" data-content-id="yt-uix-tooltip2-content"><span class="yt-uix-button-content">'+r[1]+'</span><img class="yt-uix-button-arrow" style="margin-right:8px;"><ul id="stylelist" class="yt-uix-button-menu hid">'+u+t+"</ul></button></div>";console.log("CHYD - OK - Set clasic style")}}function f(){if($("movie_player")&&$("movie_player").tagName=="EMBED"){console.log('CHYD - OK - Parsing from element "movie_player"');var t=$("movie_player").getAttribute("flashvars");if(t.match(/url_encoded_fmt_stream_map=(.*?)&/)){t=unescape(t.match(/url_encoded_fmt_stream_map=(.*?)&/))}else if(t.match(/url_encoded_fmt_stream_map=(.*?)$/)[1]){t=unescape(t.match(/url_encoded_fmt_stream_map=(.*?)$/)[1])}}else{console.log("CHYD - OK - Parsing from script");var n=document.getElementsByTagName("script");for(var i=0,s=n.length;i<s;i++){if(t=n[i].innerHTML.match(/"url_encoded_fmt_stream_map": "(.*?)"/)){t=t[1].replace(/\\u([0-9]+)/g,function(e,t){return decodeURIComponent("%"+parseFloat(t))})}else{t=null;console.log('CHYD - WARNING! - Unknown "fmt_url_map"')}}}var o="";if($("eow-title")){o=$("eow-title").innerText.replace(/[\\~#%&*{}\/<>?|"]/g,"_").replace(/&/g,"and");console.log("CHYD - OK - Parse video title: "+o);o=encodeURIComponent(o)}else if($("watch-headline-title")){o=encodeURIComponent($("watch-headline-title").innerText.replace(/[\\~#%&*{}\/<>?|"]/g,"_").replace(/&/g,"and"))}else{o="Unknown title";console.log("CHYD - WARNING! - Unknown video title")}var u="";if(e.username=="true"&&$("watch7-user-header")){if($("watch7-user-header").getElementsByTagName("a")[1].innerText){u=$("watch7-user-header").getElementsByTagName("a")[1].innerText+" - ";console.log("CHYD - OK - Parse username: "+$("watch7-user-header").getElementsByTagName("a")[1].innerText)}else if(e.username=="false"){u=""}else{u="Unknown username - ";console.log("CHYD - WARNING! Parsing username FAILED!")}}var f="";var l="";var c="";var h="";var p="";var d="";var v="";if(e.quality=="true"){f=" [H.263 240p]";l=" [H.264 360p]";c=" [H.264 480p]";h=" [H.264 520p]";p=" [H.264 720p]";d=" [H.264 1080p]";v=" [H.264 1536p]"}var m=window.location.href.split(/v=/)[1].split("&")[0];console.log("CHYD - OK - This video ID: "+m);var g=window.location.href.split("?")[0]+"?v="+m;console.log("CHYD - OK - This video URL: "+g);console.log("CHYD - OK - Getting to fmt_url_map");var y=new Array;y=t.split(",");var b=0,w=0,E=0,S=0,x=0,T=0,N=0,C=0,k=0;var L=new String;var A=new String;console.log("CHYD - OK - Parsing video links start");for(i=0;i<y.length;i++){var O=parseInt((y[i].match(/itag=([0-9]*)&/)||y[i].match(/itag=([0-9]*)$/))[1]);var M=null;if(y[i].match(/sig=(.*?)&/)){M=y[i].match(/sig=(.*?)&/)[1]}else if(y[i].match(/&s=(.*?)&/)){M=y[i].match(/&s=(.*?)&/)[1]}else{M="";console.log("CHYD - WARNING! Parsing signature FAILED!")}y[i]=unescape((y[i].match(/url=(.*?)&/)||y[i].match(/url=(.*?)$/))[1])+"&signature="+M;var _=new Array;_=O;if(_=="5"&&e.lq=="true"&&b==0){L+='<a target="iframe" href="'+y[i]+"&title="+u+o+f+'"><span class="yt-uix-button-menu-item" id="v240p">FLV (240p)</span></a>';b++}else{null}if(_=="18"&&e.mq=="true"&&w==0){L+='<a target="iframe" href="'+y[i]+"&title="+u+o+l+'"><span class="yt-uix-button-menu-item" id="v360p">MP4 (360p)</span></a>';w++}else{null}if(_=="43"&&e.webm=="true"&&E==0){L+='<a target="iframe" href="'+y[i]+"&title="+u+o+'"><span class="yt-uix-button-menu-item" id="wm360p">WebM (360p)</span></a>';E++}else{null}if(_=="35"&&e.hq=="true"&&S==0){L+='<a target="iframe" href="'+y[i]+"&title="+u+o+c+'"><span class="yt-uix-button-menu-item" id="v480p">FLV (480p)</span></a>';S++}else{null}if(_=="44"&&e.webm=="true"&&x==0){L+='<a target="iframe" href="'+y[i]+"&title="+u+o+'"><span class="yt-uix-button-menu-item" id="wm480p">WebM (480p)</span></a>';x++}else{null}if(_=="22"&&e.hd=="true"&&T==0){L+='<a target="iframe" href="'+y[i]+"&title="+u+o+p+'"><span class="yt-uix-button-menu-item" id="v720p">MP4 HD (720p)</span></a>';T++}else{null}if(_=="45"&&e.webm=="true"&&N==0){L+='<a target="iframe" href="'+y[i]+"&title="+u+o+'"><span class="yt-uix-button-menu-item" id="wm720p">WebM HD (720p)</span></a>';N++}else{null}if(_=="37"&&e.fhd=="true"&&C==0){L+='<a target="iframe" href="'+y[i]+"&title="+u+o+d+'"><span class="yt-uix-button-menu-item" id="v1080p">MP4 HD (1080p)</span></a>';C++}else{null}if(_=="38"&&e.uhd=="true"&&k==0){L+='<a target="iframe" href="'+y[i]+"&title="+u+o+v+'"><span class="yt-uix-button-menu-item"  id="v2k">MP4 HD (2K)</span></a>';k++}else{null}}console.log("CHYD - OK - Parsing video links end");for(i=0;i<y.length;i++){var O=parseInt((y[i].match(/itag=([0-9]*)&/)||y[i].match(/itag=([0-9]*)$/))[1]);var _=new Array;_=O;y[i]=decodeURIComponent(y[i]);var D="";if(e.quality=="true"&&_=="38"&&e.uduhd=="true"){D=" [H.264 4k]"}else if(e.quality=="true"&&_=="37"&&e.udfhd=="true"){D=" [H.264 1080p]"}else if(e.quality=="true"&&_=="22"&&e.udhd=="true"){D=" [H.264 720p]"}else if(e.quality=="true"&&_=="35"&&e.udhq=="true"){D=" [H.264 480p]"}else if(e.quality=="true"&&_=="18"&&e.udmq=="true"){D=" [H.264 240p~360p]"}else if(e.quality=="true"&&_=="5"&&e.udlq=="true"){D=" [H.263 240p]"}if(_=="38"&&e.uduhd=="true"||_=="37"&&e.udfhd=="true"||_=="22"&&e.udhd=="true"||_=="35"&&e.udhq=="true"||_=="18"&&e.udmq=="true"||_=="5"&&e.udlq=="true"){A+='<a target="iframe" href="'+y[i]+"&title="+u+o+D+'">'+r[1]+"</a>";break}}if(e.ytmp3=="true"){L+='<a href="http://www.flvto.com/?url='+g+'" target="_blank"><span class="yt-uix-button-menu-item" id="ytmp3">MP3 (Flvto)</span></a>'}else{null}if(e.v2mp3=="true"){L+='<a href="http://www.video2mp3.net/?url='+g+'&hq=1" target="_blank"><span class="yt-uix-button-menu-item" id="v2mp3">MP3 (Video2mp3)</span></a>'}else{null}a(L,A)}console.log("CHYD - OK - Runing");if(document.getElementsByTagName("html").item(0).lang&&document.getElementsByTagName("body").item(0).className){var t=document.getElementsByTagName("html").item(0).lang;var n=document.getElementsByTagName("body").item(0).className;var r=Array("Download this video!","Download","Download specific format");if(t=="cs"){r=Array("Stáhnout video!","Stáhnout","Stáhnout konkrétní formát")}if(t=="de"){r=Array("Dieses video herunterladen!","Download","Download bestimmten format")}if(t=="en"){r=Array("Download this video!","Download","Download specific format")}if(t=="es"){r=Array("Descargar este vídeo!","Descargar","Descargar formato específico")}if(t=="sk"){r=Array("Stiahnut toto video!","Stiahnut","Stiahnut konkrétny formát")}if(t=="it"){r=Array("Scarica il video!","Download","Scarica formato specifico")}if(t=="pl"){r=Array("Pobierz wideo!","Pobierz","Pobierz konkretnym formacie")}if(t=="ru"){r=Array("Скачать это видео!","Скачать","Скачать определенный формат")}if(t=="hr"){r=Array("Preuzmi ovaj video!","Download","Preuzimanje specificnom formatu")}if(t=="fr"){r=Array("Télécharger cette vidéo!","Télécharger","Télécharger format spécifique")}if(t=="ar"){r=Array("!تنزيل هذا الفيديو","تنزيل","تنزيل صيغة محددة")}if(t=="hu"){r=Array("Letöltés ezt a videót!","Letöltés","Letöltés meghatározott formátumban")}}var i=chrome.extension.getURL("images/options.png");var s=chrome.extension.getURL("html/options.html");var o=chrome.extension.getURL("images/arrow.png");var u='<div id="styleul" class="yt-uix-tooltip" data-tooltip-text="'+chrome.i18n.getMessage("settingspagetitle")+'"><a href="'+s+'" target="_blank"><img src="'+i+'" /></a></div>';f();console.log("CHYD - OK - End script")})}document.addEventListener("webkitTransitionEnd",function(e){if(e.propertyName==="width"&&e.target.id==="progress"){if($("download")){null}else{runScript()}}},false);runScript()