
if(typeof(discography)=="undefined"){var discography={isInitModele:false,loadComplete:false,last_album_type:'',last_role:0,format:"big",start:0,nb:{big:10,small:15},total:0,art_id:0,initModele:function(){try{if(discography.isInitModele){return true;}
discography.$model_album=$('#naboo_discography_default_album').clone();discography.$model_album_small=$('#naboo_cover_default').clone();discography.$model_disk=$('#naboo_discography_album_default_disk').clone();discography.$model_track=$('#naboo_discography_album_default_track').clone();discography.$model_type=$('#modele_type').clone();discography.isInitModele=true;return true;}catch(e){console.log(e.message,e.stack);}},initWithoutDraw:function(type,art_id,last_album_type,loadComplete,total){try{discography.loadComplete=loadComplete;discography.type=type;discography.art_id=art_id;discography.start=0;discography.total=total;discography.last_album_type=last_album_type,discography.initModele();discography.flagTabLoaded();discography.activeScroll();return true;}catch(e){console.log(e.message,e.stack);}},getList:function(type,art_id,start,preloadedData){try{discography.initModele();discography.art_id=art_id;discography.start=start;discography.type=type;if(start==0){if(discography.format=='small'){$('#naboo_discography_default_album').remove();}
discography.loadComplete=false;discography.last_album_type='';discography.last_role=0;discography.total=0;}
if(typeof(preloadedData)=='undefined'){var params={art_id:art_id,start:start,nb:discography.nb[discography.format]};params.array_default=['ALB_ID','ALB_PICTURE','ALB_TITLE','PHYSICAL_RELEASE_DATE','TYPE','PRODUCER_LINE','SONGS','ARTISTS','ROLE_ID'];if(discography.format=="small"){params.array_default=['ALB_ID','ALB_PICTURE','ALB_TITLE'];}
api.call('album_getDiscography',params,discography.getListCallback);}else{discography.getListCallback({results:preloadedData,error:[]});}
return true;}catch(e){console.log(e.message,e.stack);}},getListCallback:function(request){try{discography.displayCatalogMessage();discography.flagTabLoaded();if(request.results.data!=null&&request.results.count!=null&&request.results.count>0){var display_line=$('<p></p>');var datagrid_list=[];for(var album_item in request.results.data){album_type_name='';if(request.results.data[album_item].TYPE!=null&&request.results.data[album_item].TYPE!=discography.last_album_type&&discography.last_role==0){switch(parseInt(request.results.data[album_item].TYPE)){case 0:album_type_name='Singles';break;case 1:album_type_name='Albums';break;case 2:album_type_name='Bundles';break;case 3:album_type_name='EPs';break;}
discography.last_album_type=request.results.data[album_item].TYPE;}
if(typeof(request.results.data[album_item].ROLE_ID)!='undefined'&&request.results.data[album_item].ROLE_ID!=discography.last_role&&discography.last_role==0){album_type_name=trad.music.appears_on;discography.last_role=request.results.data[album_item].ROLE_ID;}
if(discography.format=='big'&&album_type_name!=''){display_line.append(discography.createBlockType(album_type_name));}
if(discography.format=='big'){display_line.append(discography.createBlockBig(request.results.data[album_item]));}else{display_line.append(discography.createBlockSmall(request.results.data[album_item]));}}
$('#tab_discography_content .naboo_discography_list').append(display_line.children());if(discography.format=='small'){$('.naboo_discography_list').addClass('small');}else{$('.naboo_discography_list').removeClass('small');}
$("#tab_discography_content .naboo_discography_album_buy").mouseenter(function(e){hovercard.init($(this));}).mouseleave(function(){hovercard.remove();});}else{$('#tab_discography_content .display_mode').remove();if($('#tab_discography_content .naboo_empty').length==0){$('#tab_discography_content > .wrapper').append('<div class="naboo_empty">'+trad.music.naboo_album_none+'</div>');}}
discography.total=request.results.total;discography.loadComplete=(request.results.total<=parseInt(discography.start+discography.nb[discography.format]));discography.activeScroll();if(discography.format!='big'){$('#tab_discography_content .naboo_discography_list').css('margin','-10px -20px');$('#tab_discography_content .naboo_discography_list').coverPane({'cover_size':200,'padding':20,'label_size':30});}else{$('#tab_discography_content .naboo_discography_list').css({'height':'','margin':'0px'});}
naboo.afterLoad(false);Events.trigger(Events.discography.displayed,{id:discography.art_id});return true;}catch(e){console.log(e.message,e.stack);}},activeScroll:function(){try{infinite_scroll.disable();if(!discography.loadComplete){Events.subscribeOnce(Events.layout.infiniteScroll,function(){if(discography.total>discography.start){discography.getList(discography.type,discography.art_id,discography.start+discography.nb[discography.format]);}else{console.log("nein");}});infinite_scroll.active($('#tab_discography_content'));}}catch(e){console.log(e.message,e.stack);}},flagTabLoaded:function(){try{if(discography.type=='artist'){if(typeof(artist)!='undefined'&&typeof(artist.tabs_loaded)!='undefined'&&artist.tabs_loaded!=null){artist.tabs_loaded['discography_'+discography.art_id]=true;}}else if(discography.type=='album'){if(typeof(album)!='undefined'&&typeof(album.tabs_loaded)!='undefined'&&album.tabs_loaded!=null){album.tabs_loaded['discography_'+discography.art_id]=true;}}}catch(e){console.log(e.message,e.stack);}},switchModele:function(format){try{if(format=='big'){$('.naboo_discography_list').coverPane_destroy();}
$('#tab_discography_content .naboo_discography_list').empty();discography.format=format;discography.start=0;discography.getList(discography.type,discography.art_id,discography.start);return true;}catch(e){console.log(e);}},createBlockType:function(name){try{$item=discography.$model_type.clone().html(name).show();return"<div class='clear'></div>"+util.getOuterHTML($item);}catch(e){console.log(e);}},createBlockSmall:function(data){try{$item=discography.$model_album_small.clone();$item.attr('id','naboo_discography_album_'+data.ALB_ID).show();$('.img_main',$item).attr('src',SETTING_DOMAIN_IMG+'/cover/'+data.ALB_PICTURE+'/200x200-000000-80-0-0.jpg');$('.cover a',$item).attr('onClick','loadBox(\'album/'+data.ALB_ID+'\'); return false');$('.label dt',$item).attr('onClick','loadBox(\'album/'+data.ALB_ID+'\'); return false;');$('.label dt',$item).html(data.ALB_TITLE);return util.getOuterHTML($item);}catch(e){console.log(e);}},createBlockBig:function(data){try{currentArtName="";$item=discography.$model_album.clone();if(typeof(data.DEFAULT_ALBUM)!='undefined'){return $item;}
$item.attr('id','naboo_discography_album_'+data.ALB_ID).show();if(data.ALB_TITLE!=null&&data.ALB_TITLE.slice(-6,-5)=='('&&data.ALB_TITLE.slice(-1)==')'){rewriting_alb_title_without_date=data.ALB_TITLE.slice(0,-7)}else{rewriting_alb_title_without_date=data.ALB_TITLE;}
$('.naboo_discography_album_title',$item).html('<a href="/'+SETTING_LANG+'/album/'+data.ALB_ID+'" onclick="loadBox(\'album/'+data.ALB_ID+'\'); return false;">'+data.ALB_TITLE+'</a>');$('.naboo_discography_album_options .naboo_discography_album_listen a',$item).attr("data-value",data.ALB_ID);if(data.PHYSICAL_RELEASE_DATE!=null){releaseDate=new Date(data.PHYSICAL_RELEASE_DATE);if((releaseDate.getTime()/1000)+(1296000)>SERVER_TIMESTAMP){$('.icn_new',$item).css('display','block');}}
$('.naboo_discography_album_image a',$item).attr({'href':'javascript:void(0)','onclick':'loadBox(\'album/'+data.ALB_ID+'\'); return false;'});$('.img_main',$item).attr('src',SETTING_DOMAIN_IMG+'/cover/'+data.ALB_PICTURE+'/120x120-000000-80-0-0.jpg');$('.naboo_album_discography_favorite > a',$item).attr('id','naboo_album_discography_favorite_'+data.ALB_ID);discography.setBuyButton(data.ALB_ID,$('.naboo_discography_album_buy',$item));$('.naboo_discography_album_share > a',$item).attr('onClick','sharebox.load(1, '+data.ALB_ID+'); return false;');$('.label dt',$item).text(data.PRODUCER_LINE);if(data.PHYSICAL_RELEASE_DATE!=null&&data.PHYSICAL_RELEASE_DATE!='0000-00-00'){tmp_physical_date=formatDate(data.PHYSICAL_RELEASE_DATE);$('.label dd',$item).text(tmp_physical_date);}
var cds=[];var disk_number=0;var seven_tracks={data:[],count:0,total:0};if(data.SONGS!=null&&data.SONGS.count!=null&&data.SONGS.count>0){for(track_item in data.SONGS.data){var track=data.SONGS.data[track_item];var disk_number=parseInt(track.DISK_NUMBER)-1;var track_number=parseInt(track.TRACK_NUMBER)-1;if(typeof(cds[disk_number])=='undefined'){cds[disk_number]=[];}
if(typeof(cds[disk_number][track_number])=='undefined'||right.checkSongAvailable(track)==right.READABLE){cds[disk_number][track_number]=track;currentArtName=track.ART_NAME;currentUrlRewritting=track.URL_REWRITING;}}
disk_number=cds.length;if(disk_number>1){for(disk in cds){seven_tracks.data=$.merge(seven_tracks.data,cds[disk]);}}else{seven_tracks.data=cds[0]}
seven_tracks.data=seven_tracks.data.splice(0,20);seven_tracks.count=seven_tracks.total=seven_tracks.data.length;}
var mainArtistHash={};for(var artists in data.ARTISTS){if(data.ARTISTS[artists].ROLE_ID==0){mainArtistHash[data.ARTISTS[artists].ART_ID]=true;}}
$('.naboo_discography_album_tracks',$item).attr('id','naboo_discography_album_tracks_'+data.ALB_ID);$('#naboo_discography_album_tracks_'+data.ALB_ID,$item).createDatagrid({type:'discography_album',songs:seven_tracks,id:data.ALB_ID,scrollInfinite:false,main_artist_hash:mainArtistHash,disk_number:disk_number});if(data.SONGS.total>20){$('.naboo_discography_album_tracks_all',$item).html('<a href="javascript:void(0)" onclick="loadBox(\'album/'+data.ALB_ID+'\'); return false;">'+trad.music.naboo_album_all_tracks+' ('+data.SONGS.total+' '+trad.music.naboo_album_all_tracks_songs+')</a>');}
favorite.display($('.naboo_album_discography_favorite > a',$item),{type:'album',ALB_ID:data.ALB_ID,ALB_TITLE:rewriting_alb_title_without_date,ART_NAME:currentArtName});return $item;}catch(e){console.log(e.message,e.stack);}},play:function(id){try{dzPlayer.playAlbum(id,0,true,{TYPE:'artist_discography',ID:id});return true;}catch(e){console.log(e.message,e.stack);}},setBuyButton:function(id,div){try{if(typeof(CUSTO)!='undefined'&&typeof(CUSTO.store_platform)!='undefined'&&CUSTO.store_platform=='none'){div.attr('onClick','').hide();}else if(typeof(STORE_PLATEFORM)!='undefined'&&STORE_PLATEFORM.DEEZER!=null&&getObjectSize(STORE_PLATEFORM)==1){div.attr('onClick',"discography.openStore("+id+", 'album'); return false;").show();if(typeof(USER)!='undefined'&&typeof(USER.USER_ID)!='undefined'&&USER.USER_ID>0){div.attr('data-hovercard','/ajax/hovercard/page.php?card=buy&alb_id='+id).mouseenter(function(e){hovercard.init($(this));}).mouseleave(function(){hovercard.remove();});}}else{div.attr('data-hovercard','/ajax/hovercard/page.php?card=buy&alb_id='+id).show().mouseenter(function(e){hovercard.init($(this));}).mouseleave(function(){hovercard.remove();});}
return true;}catch(e){console.log(e);}},openStore:function(id,type){try{hovercard.remove();loadFacebox('store/index.php?product_type='+type+'&product_id='+id);return true;}catch(e){console.log(e);}},displayCatalogMessage:function(div){try{if(www.getCurrentPageType()=='artist'){if(typeof(artist.data.DATA.DATA)!='undefined'&&artist.data.DATA.DATA.DISABLE_CATALOG){$('#naboo_discography_disable_catalog').show();return true;}}
$('#naboo_discography_disable_catalog').hide();return false;}catch(e){console.log(e);}}}};
if(typeof(star)=="undefined"){var star={defaultNote:0,selectedNote:0,type:"",elementId:0,init:function(type,id,note,user_rating){try{if(typeof(note)=="undefined"||isNaN(note))return false;if(typeof(type)=="undefined")return false;if(typeof(user_rating)=="undefined")user_rating=0;star.defaultNote=parseInt(note);if(star.defaultNote<0)star.defaultNote=0;if(star.defaultNote>5)star.defaultNote=5;star.displayValue(star.defaultNote,false);star.type=type;star.elementId=id;if(typeof(USER.USER_ID)!='undefined'&&USER.USER_ID>0){$('#naboo_vote_stars').unbind('mousemove',star.onMouseMouse).unbind('mouseout',star.onMouseOut).unbind('mouseup',star.onMouseClick).unbind('mouseover',star.onMouseOver);$("#naboo_vote_stars").bind('mouseover',star.onMouseOver);}else{$('#naboo_vote_stars').attr('onClick',"modal.open('/"+SETTING_LANG+"/login.php')");}
if(user_rating>0){$('#naboo_vote_result').html('('+trad.general.your_rating+' : '+user_rating+'/5)');}}catch(e){console.log(e);}},displayValue:function(note,withComment){try{$('#naboo_vote_stars').removeClass();$('#naboo_vote_stars').addClass("stars");$('#naboo_vote_stars').addClass("stars_"+note);$('#naboo_vote_stars').addClass("sprite_naboo");var comment='';if(withComment){star.selectedNote=note;if(note==1)comment=trad.music.naboo_rating_1;else if(note==2)comment=trad.music.naboo_rating_2;else if(note==3)comment=trad.music.naboo_rating_3;else if(note==4)comment=trad.music.naboo_rating_4;else if(note==5)comment=trad.music.naboo_rating_5;}
if(OFFLINE)comment=trad.offline.vote
$('#naboo_vote_comment').html(comment);}catch(e){console.log(e);}},onMouseOver:function(){try{$('#naboo_vote_stars').unbind('mouseover',star.onMouseOver);$("#naboo_vote_stars").bind('mousemove',star.onMouseMove).bind('mouseout',star.onMouseOut).bind('mouseup',star.onMouseClick);}catch(e){console.log(e);}},onMouseMove:function(e){try{starSize=$('#naboo_vote_stars').width()/5;mousePosition=e.pageX-$('#naboo_vote_stars').offset().left;star.displayValue(Math.max(1,Math.ceil(mousePosition/starSize)),true);}catch(e){console.log(e);}},onMouseOut:function(){try{$('#naboo_vote_stars').unbind('mousemove',star.onMouseMouse).unbind('mouseout',star.onMouseOut).unbind('mouseup',star.onMouseClick);$('#naboo_vote_stars').bind('mouseover',star.onMouseOver);star.displayValue(star.defaultNote,false);}catch(e){console.log(e);}},onMouseClick:function(){try{if(!OFFLINE){switch(star.type){case"playlist":var params={playlist_id:star.elementId,value:star.selectedNote};api.call('playlist_rate',params,star.afterVote);break;case"album":var params={alb_id:star.elementId,value:star.selectedNote};api.call('album_rate',params,star.afterVote);break;default:console.log("no action for star.type = "+star.type);break;}}}catch(e){console.log(e);}},afterVote:function(request){try{if(request.error.length==0){star.defaultNote=Math.round(parseInt(request.results.RATING)/parseInt(request.results.NB_RATE));star.onMouseOut();$('#naboo_vote_stars').unbind('mouseover',star.onMouseOver);$('#naboo_vote_stars').css('cursor','auto');$('#naboo_vote_result').html('('+trad.general.your_rating+' : '+star.selectedNote+'/5)');}}catch(e){console.log(e);}}}};
if(typeof(fan)=="undefined"){var fan={$model:'',type:'',element_id:0,nb:10,start:0,loadComplete:false,getList:function(type,element_id,start){try{if(typeof(start)=='undefined'||start==null)start=0;fan.type=type;fan.start=start;fan.element_id=element_id;params={};params.start=fan.start;params.nb=fan.nb;params.country_name=true;switch(type){case'playlist':method_name='playlist_getFans';params.playlist_id=element_id;break;case'artist':method_name='artist_getFans';params.art_id=element_id;break;}
if(typeof(method_name)=='undefined'||method_name==null){return false;}
api.call(encodeURIComponent(method_name),params,fan.getListCallback);return true;}catch(e){console.log(e);}},getListCallback:function(request){try{if(request==false||request==null){return false;}
if(fan.type=='artist'){if(typeof(artist)!='undefined'&&typeof(artist.tabs_loaded)!='undefined'&&artist.tabs_loaded!=null){artist.tabs_loaded['fan_'+fan.element_id]=true;}}else if(fan.type=='playlist'){if(typeof(playlist)!='undefined'&&typeof(playlist.tabs_loaded)!='undefined'&&album.tabs_loaded!=null){playlist.tabs_loaded['fan_'+fan.element_id]=true;}}
if(request.error.length==0){if(request.results==null){return false;}
if(request.results.data!=null&&request.results.count!=null&&request.results.count>0){var display_lines=[];if(fan.$model==''){fan.$model=$('#naboo_default_fan');}
for(fan_item in request.results.data){display_lines.push(fan.createBlockFan(request.results.data[fan_item]));}
if(display_lines.length>0){$('#tab_fan_content .naboo_fan_list').append(display_lines.join(''));}}else{$('#naboo_fan_empty').show();$('#tab_fan_content > .naboo_fan_list').hide();}}
naboo.afterLoad();fan.loadComplete=!(request.results.data!=null&&request.results.total!=null&&request.results.total>parseInt(fan.start+fan.nb));fan.activeScroll();return true;}catch(e){console.log(e);}},createBlockFan:function(item){$new_link=fan.$model.clone();$new_link.attr('id','naboo_fan_'+item.USER_ID).show();if(item.BLOG_NAME!=null&&item.USER_PICTURE!=null){user_picture='<a href="javascript:void(0)" onclick="loadBox(\'profile/'+item.USER_ID+'\'); return false;"><img src="'+SETTING_DOMAIN_IMG+'/user/'+item.USER_PICTURE+'/85x85-000000-80-0-0.jpg" style="width:85px;height:85px;" /></a>';}else{user_picture='';}
$('.naboo_fan_picture',$new_link).html(user_picture);if(item.BLOG_NAME!=null){user_name='<a href="javascript:void(0)" onclick="loadBox(\'profile/'+item.USER_ID+'\'); return false;">'+ucfirst(item.BLOG_NAME)+'</a>';}else{user_name='';}
$('.naboo_fan_username',$new_link).html(user_name);infos=new Array();if(item.BIRTHDAY!=null&&item.BIRTHDAY!='0000-00-00'){infos.push(return_age(item.BIRTHDAY)+" "+trad.general.years);}
if(item.SEX!=null){infos.push((item.SEX=="M")?trad.general.man:trad.general.woman);}
if(item.COUNTRY_NAME!=null){infos.push(item.COUNTRY_NAME);}else if(item.COUNTRY!=null){infos.push(item.COUNTRY);}
$('.naboo_fan_infos',$new_link).html(infos.join(" | "));if(item.ONLINE!=null){if(item.ONLINE.STATUS!=null){if(item.ONLINE.SONG!=null){$('.naboo_fan_listen',$new_link).click(function(){loadBox('artist/'+item.ONLINE.SONG.ART_ID);return false;}).show();$('.naboo_fan_listen strong',$new_link).text(item.ONLINE.SONG.SNG_TITLE);$('.naboo_fan_listen span',$new_link).text(item.ONLINE.SONG.ART_NAME);}}}
if(item.DESCRIPTION!=null){$('.naboo_fan_description',$new_link).text(truncateTxt(item.DESCRIPTION,110));}
$('.naboo_fan_links li .link_fiche',$new_link).attr('onClick','loadBox(\'profile/'+item.USER_ID+'\'); return false;');if(item.USER_ID!=null){if(userData.isFavorite('friend',item.USER_ID)){user.setUnFollowState($('.link_invite',$new_link),item.USER_ID,{DISPLAY_NAME:addslashes(ucfirst(item.BLOG_NAME)),USER_PICTURE:item.USER_PICTURE});}else{user.setFollowState($('.link_invite',$new_link),item.USER_ID,{DISPLAY_NAME:addslashes(ucfirst(item.BLOG_NAME)),USER_PICTURE:item.USER_PICTURE});}}
return util.getOuterHTML($new_link);},activeScroll:function(){try{infinite_scroll.disable();if(!fan.loadComplete){Events.subscribeOnce(Events.layout.infiniteScroll,function(){fan.getList(fan.type,fan.element_id,fan.start+fan.nb);});infinite_scroll.active($('#tab_fan_content'));}}catch(e){console.log(e.message,e.stack);}},liveFan:function(){}}};
if(typeof(related)=="undefined"){var related={type:'',art_id:0,start:0,nb:15,loadComplete:false,getList:function(type,art_id,start){try{if(typeof(start)=='undefined'||start==null)start=0;related.type=type;related.art_id=art_id;related.start=start;var params={art_id:related.art_id,start:related.start,nb:related.nb};api.call('artist_getRelated',params,related.getListCallback);return true;}catch(e){console.log(e);}},getListCallback:function(request){try{if(request==false||request==null)return false;if(related.type=='artist'){if((typeof(artist)!='undefined')&&(typeof(artist.tabs_loaded)!='undefined')&&(artist.tabs_loaded!=null)){artist.tabs_loaded['related_'+related.art_id]=true;}}else if(related.type=='album'){if((typeof(album)!='undefined')&&(typeof(album.tabs_loaded)!='undefined')&&(album.tabs_loaded!=null)){album.tabs_loaded['related_'+related.art_id]=true;}}
if(request.results.data!=null&&request.results.count!=null&&request.results.count>0){if(typeof(related.$modele_related)=="undefined"){related.$modele_related=$('#naboo_default_related').clone();related.$modele_related.hide();}
$('#naboo_default_related').remove();display_line=[];var j=0;for(artist_item in request.results.data){var currentData=request.results.data[artist_item];$new_link=related.$modele_related.clone();$new_link.attr('id','naboo_related_'+currentData.LST_ART_ID).show();art_name='';if(currentData.ART_NAME!=null&&currentData.URL_REWRITING!=null){art_name='<a href="/'+SETTING_LANG+'/artist/'+currentData.ART_ID+'" onclick="loadBox(\'artist/'+currentData.ART_ID+'\'); return false;">'+currentData.ART_NAME+'</a>';}
$('.naboo_related_name',$new_link).html(art_name);art_picture='';if(currentData.ART_PICTURE!=null){art_picture=currentData.ART_PICTURE;}
$('.naboo_related_picture a',$new_link).attr('onclick','loadBox(\'artist/'+currentData.ART_ID+'\'); return false');$('.img_main',$new_link).attr('src',(SETTING_DOMAIN_IMG+'/artist/'+art_picture+'/85x85-000000-80-0-0.jpg'));var art_nb_album=0;var txt_album='';if(parseInt(art_nb_album)==1){var txt_album=trad.music.naboo_album;}else if(parseInt(art_nb_album)>0){var txt_album=trad.music.naboo_albums;}
if(txt_album==''){$('.naboo_related_infos',$new_link).hide();}else{if(currentData.NB_FAN!=null&&parseInt(request.results.data[artist_item].NB_FAN)>0){txt_album=txt_album+' | ';}
$('.naboo_related_infos',$new_link).html(art_nb_album+' '+txt_album);}
var art_nb_fan='';if(currentData.NB_FAN!=null){art_nb_fan=currentData.NB_FAN;}
var txt_fan='';if(parseInt(art_nb_fan)==1){txt_fan=trad.music.naboo_fan;}else if(parseInt(art_nb_fan)>0){txt_fan=trad.music.naboo_fans;}
if(txt_fan==''){$('.naboo_related_fans',$new_link).hide();}else{$('.naboo_related_fans',$new_link).html(breakUpThousands(art_nb_fan)+' '+txt_fan);}
if(currentData.SMARTRADIO!=null){if(currentData.SMARTRADIO=="1"){$('.naboo_related_link_smart',$new_link).show();$('.naboo_related_link_smart > a',$new_link).attr('onClick','loadBox(\'radio/artist-'+currentData.LST_ART_ID+'\'); return false;');}}
favorite.display($('.naboo_related_artist > a',$new_link),{type:'artist',ART_ID:currentData.LST_ART_ID,ART_NAME:currentData.ART_NAME,URL_REWRITING:currentData.URL_REWRITING,SMARTRADIO:currentData.SMARTRADIO});$('.card',$new_link).attr({'onClick':'sharebox.load(2, '+currentData.LST_ART_ID+'); return false;'});display_line[j]=util.getOuterHTML($new_link);j++;}
$('#tab_related_content .naboo_related_list').append(display_line.join(''));$(".card").mouseenter(function(e){hovercard.init($(this));}).mouseleave(function(){hovercard.remove();});}else{$('#tab_related_content .naboo_related_list').hide();$('#naboo_related_empty').show();}
naboo.afterLoad();related.loadComplete=(request.results.total<=parseInt(related.start+related.nb));related.activeScroll();return true;}catch(e){console.log(e.message,e.stack);}},activeScroll:function(){try{infinite_scroll.disable();if(!related.loadComplete){Events.subscribeOnce(Events.layout.infiniteScroll,function(){related.getList(related.type,related.art_id,related.start+related.nb);});infinite_scroll.active($('#tab_related_content'));}}catch(e){console.log(e.message,e.stack);}}}};
if(typeof(favoritebox)=="undefined"){var favoritebox={obj_type:null,$thumbnail_model:null,$thumbnail_container:null,$scroll_area:null,tags:[],cache:[],init:function(type,tags){try{var allowed_types=['artist','album'];if($.inArray(type,allowed_types)===-1){return false;}
if(tags.length===0){return false;}
$('#modal-close').attr('onclick','favoritebox.close(); return false;');favoritebox.$thumbnail_model=$("#thumbnail_model").clone();$("#thumbnail_model").remove()
favoritebox.$thumbnail_container=$("#modal_favoritebox .thumbnails");favoritebox.$scroll_area=$('#modal_favoritebox .nav-content');favoritebox.obj_type=type;favoritebox.tags=tags;favoritebox.cache=[];favoritebox.$scroll_area.tinyscrollbar();var $current_tab=$('#modal_favoritebox .favoritebox_tab.selected');favoritebox.displayTab($current_tab);Events.unsubscribe(Events.user.addFavorite,favoritebox.reload);Events.subscribe(Events.user.addFavorite,favoritebox.reload);Events.unsubscribe(Events.user.deleteFavorite,favoritebox.reload);Events.subscribe(Events.user.deleteFavorite,favoritebox.reload);return true;}catch(e){console.log(e.message,e.stack);}},displayTab:function($tab){try{if(typeof($tab)==='undefined'||typeof($tab.length)==='undefined'||$tab.length===0){return false;}
$tab.siblings().removeClass('selected');$tab.addClass('selected');var tag_id=parseInt($tab.attr('data-id'),10);var api_param={'date':str_replace(CURRENT_DATE,'-',''),'start':0,'end':10,'tag_id':tag_id};if(favoritebox.obj_type==='artist'){if(typeof(favoritebox.cache[tag_id])!=='undefined'){favoritebox.displayTabCallback(favoritebox.cache[tag_id],tag_id);}else{api.call('charts_getArtist',api_param,favoritebox.displayTabCallback,tag_id);}}else{if(typeof(favoritebox.cache[tag_id])!=='undefined'){favoritebox.displayTabCallback(favoritebox.cache[tag_id],tag_id);}else{api.call('charts_getAlbum',api_param,favoritebox.displayTabCallback,tag_id);}}
return true;}catch(e){console.log(e.message,e.stack);}},displayTabCallback:function(obj,tag_id){try{favoritebox.cache[tag_id]=obj;var display_line=[];var data=obj.results.data;var nb=data.length;var i;for(i=0;i<nb;i++){display_line[i]=favoritebox.drawThumbnail(data[i]);}
favoritebox.$scroll_area.tinyscrollbar();favoritebox.$thumbnail_container.html(display_line.join(''));setTimeout(function(){favoritebox.$scroll_area.tinyscrollbar();},500);return true;}catch(e){console.log(e.message,e.stack);}},drawThumbnail:function(data){try{var $item=favoritebox.$thumbnail_model.clone().show();var line_str='';if(favoritebox.obj_type==='artist'){$item.attr('id','favoritebox_artist_'+data.ART_ID);$('img',$item).attr('src',SETTING_DOMAIN_IMG+"/artist/"+data.ART_PICTURE+"/190x190-000000-80-0-0.jpg");$('a',$item).attr({'href':'/'+SETTING_LANG+'/artist/'+data.ART_ID,'onclick':"loadBox('artist/"+data.ART_ID+"'); return false;"});$('.title > a',$item).text(data.ART_NAME);$('.label',$item).text(trad.music.favorite_add_artist);favorite.display($('.btn',$item),{'type':'artist','ART_ID':data.ART_ID,'ART_NAME':data.ART_NAME,'URL_REWRITING':data.URL_REWRITING,'SMARTRADIO':((data.SMARTRADIO)?'1':'0')});}else{$item.attr('id','favoritebox_album_'+data.ART_ID);$('img',$item).attr('src',SETTING_DOMAIN_IMG+"/cover/"+data.ALB_PICTURE+"/190x190-000000-80-0-0.jpg");$('a',$item).attr({'href':'/'+SETTING_LANG+'/album/'+data.ALB_ID,'onclick':"loadBox('album/"+data.ALB_ID+"'); return false;"});$('.title > a',$item).text(data.ALB_TITLE);$('.label',$item).text(trad.music.favorite_add_to_my_music);favorite.display($('.btn',$item),{'type':'album','ALB_ID':data.ALB_ID,'ALB_TITLE':data.ALB_TITLE,'ART_NAME':data.ART_NAME,'URL_REWRITING':data.URL_REWRITING});}
line_str=util.getOuterHTML($item);return line_str;}catch(e){console.log(e.message,e.stack);}},reload:function(){favoritebox.$scroll_area.tinyscrollbar_update(Math.abs($('.tinyscroll_overview',favoritebox.$scroll_area).position().top));return true;},close:function(){try{modal.close();Events.trigger(Events.favoritebox.close,{'type':favoritebox.obj_type});return true;}catch(e){console.log(e);}}}};
if(typeof(review)=="undefined"){var review={type:0,element_id:0,start:0,nb:15,loadComplete:false,$list:null,initWithoutDraw:function(type,element_id,start,loadComplete){try{review.loadComplete=loadComplete;review.type=type;review.element_id=element_id;review.start=0;review.$list=$('#tab_review_content > .review > .list');review.$modele_review=$('.comment',review.$list).first();review.flagTabLoaded();review.activeScroll();calculeTime();return true;}catch(e){console.log(e.message,e.stack);}},getList:function(type,element_id,start,preloadedData){try{if(typeof(start)=='undefined'||start==null){start=0;}
review.loadComplete=false;review.type=type;review.element_id=element_id;review.start=start;if(typeof(preloadedData)=='undefined'){var params={type:review.getTypeId(review.type),element_id:element_id,start:start,nb:review.nb};api.call('comment_getList',params,review.getListCallback);}else{review.getListCallback({results:preloadedData,error:[]});}
return true;}catch(e){console.log(e.message,e.stack);}},getListCallback:function(request){try{if(typeof(review.$list)=='udefined'||review.$list==null||review.start==0){review.$list=$('#tab_review_content > .review > .list');}
var $first_comment;if(request==false||request==null){$first_comment=$('.comment',review.$list).first();if(!$first_comment.attr('data-id')){review.$modele_review=$first_comment.clone();$first_comment.remove();}
return false;}
review.flagTabLoaded();if(typeof(USER.USER_ID)!=='undefined'&&USER.USER_ID>0&&typeof(USER.BLOG_NAME)!=='undefined'&&USER.BLOG_NAME!==null&&typeof(USER.USER_PICTURE)!=='undefined'&&USER.USER_PICTURE!==null){$('#naboo_comment_new').show();$('#naboo_comment_new_not_logged').hide();}else{$('#naboo_comment_new').hide();$('#naboo_comment_new_not_logged').show();}
if(typeof(review.$modele_review)==="undefined"){review.$modele_review=$('.comment',review.$list).first();}
if(request.error.length==0){if(request.results==null)return false;if(request.results.data!=null&&request.results.count!=null&&request.results.count>0){var display_line=[];var j=0;for(var comment_item in request.results.data){display_line[j]=review.createBlockComment(request.results.data[comment_item]);j++;}
review.$list.append(display_line.join(''));if(USER.USER_ID==0){$('.like',review.$list).attr('onClick',"modal.open('/"+SETTING_LANG+"/login.php')");$('.dislike',review.$list).attr('onClick',"modal.open('/"+SETTING_LANG+"/login.php')");}else{$('.like',review.$list).attr('title',trad.music.naboo_review_flag_ok).tipsy({gravity:'s',space:10});$('.dislike',review.$list).attr('title',trad.music.naboo_review_flag_ko).tipsy({gravity:'s',space:10});}}}
$first_comment=$('.comment',review.$list).first();if(!$first_comment.attr('data-id')){review.$modele_review=$first_comment.clone();$first_comment.remove();}
review.loadComplete=(request.results.total<=parseInt(review.start+review.nb,10));review.activeScroll();naboo.afterLoad();calculeTime();return true;}catch(e){console.log(e.message,e.stack);}},activeScroll:function(){try{infinite_scroll.disable();if(!review.loadComplete){Events.subscribeOnce(Events.layout.infiniteScroll,function(){review.getList(review.type,review.element_id,review.start+review.nb);});infinite_scroll.active($('#tab_review_content'));}}catch(e){console.log(e.message,e.stack);}},flagTabLoaded:function(){try{if(review.type=='artist'){if(typeof(artist)!='undefined'&&typeof(artist.tabs_loaded)!='undefined'&&artist.tabs_loaded!=null){artist.tabs_loaded['review_'+review.element_id]=true;}}else if(review.type=='album'){if(typeof(album)!='undefined'&&typeof(album.tabs_loaded)!='undefined'&&album.tabs_loaded!=null){album.tabs_loaded['review_'+review.element_id]=true;}}else if(review.type=='playlist'){if(typeof(playlist)!='undefined'&&typeof(playlist.tabs_loaded)!='undefined'&&album.tabs_loaded!=null){playlist.tabs_loaded['review_'+review.element_id]=true;}}}catch(e){console.log(e.message,e.stack);}},createBlockComment:function(item,position){try{if(getObjectSize(item)===0){return'';}
if(typeof(review.$modele_review)=="undefined"){review.$modele_review=$('.comment',review.$list).first();}
var $new_link=review.$modele_review.clone();$new_link.attr({'id':'naboo_comment_'+item.COMMENT_ID,'data-id':item.COMMENT_ID});$('.thumbnail a',$new_link).attr({'href':'/profile/'+item.USER_ID});$('.thumbnail img',$new_link).attr({'src':SETTING_DOMAIN_IMG+'/user/'+item.USER_PICTURE+'/34x34-000000-80-0-0.jpg'});if(item.BLOG_NAME!=null){var author='<a class="link-primary evt-click" href="/profile/'+item.USER_ID+'">'+ucfirst(item.BLOG_NAME)+'</a>';$('.author',$new_link).html(sprintf(trad.music.naboo_review_author,author));}
if(item.DATE!=null){var comment_date=toTimestamp(item.DATE.substr(0,4),item.DATE.substr(5,2),item.DATE.substr(8,2),item.DATE.substr(11,2),item.DATE.substr(14,2),item.DATE.substr(17,2));$('.time',$new_link).attr({'data-timestamp':comment_date});}
if(item.COMMENT!=null){$('.text',$new_link).text(item.COMMENT);}
if(item.COMMENT_ID!=null){if(item.USER_ID!=USER.USER_ID){$('.like',$new_link).attr('id','like_'+item.COMMENT_ID).show();$('.dislike',$new_link).attr('id','dislike_'+item.COMMENT_ID).show();$('.delete',$new_link).hide();if(typeof(USER.USER_ID)!=='undefined'&&USER.USER_ID>0){$('#like_'+item.COMMENT_ID,$new_link).attr('onClick','review.ranking(\'like\', \''+item.COMMENT_ID+'\'); return false;');$('#dislike_'+item.COMMENT_ID,$new_link).attr('onClick','review.ranking(\'dislike\', \''+item.COMMENT_ID+'\'); return false;');if(item.USER_VOTE!="0"){review.alreadyRank($new_link,item.COMMENT_ID,item.USER_VOTE);}}else{$('#like_'+item.COMMENT_ID,$new_link).attr('onClick','return false;');$('#dislike_'+item.COMMENT_ID,$new_link).attr('onClick','return false;');}}else{$('.like',$new_link).hide();$('.dislike',$new_link).hide();$('.delete',$new_link).show();}}
var playlist_owner=false;if(typeof(review.type)!='undefined'&&review.type=='playlist'&&$("#naboo_playlist_head_infos").length>0){var owner_user_id=$("#naboo_playlist_head_infos").attr("data-user-id");if(owner_user_id==USER.USER_ID){playlist_owner=true;}}
if(item.USER_ID!=USER.USER_ID&&playlist_owner==false){$('.abuse',$new_link).attr('onClick','review.flag($(this), $(this).closest(\'.comment\').attr(\'data-id\')); return false;');}else{$('.abuse',$new_link).hide();}
if(item.USER_ID==USER.USER_ID||playlist_owner==true){$('.delete',$new_link).attr('onClick','review.deleteComment($(this), $(this).closest(\'.comment\').attr(\'data-id\'), '+playlist_owner+'); return false;').show();if(playlist_owner==true&&item.USER_ID!=USER.USER_ID){$('.delete',$new_link).html('<span class="icon icon-trash-grey"></span> '+trad.music.naboo_owner_delete_review);}}else{$('.delete',$new_link).hide();}
if(position!='first'){$new_link.show();}
var line_str=util.getOuterHTML($new_link);return line_str;}catch(e){console.log(e);}},limitComment:function(min,characters){try{var $btn_submit=$('#btn-submit-comment');$("#naboo_comment_new .nb").html(characters);$btn_submit.removeAttr('onclick');if($("#naboo_comment_new #new_comment").val().length>characters){$("#naboo_comment_new #new_comment").val($("#naboo_comment_new #new_comment").val().substr(0,characters));}
var remaining=characters-$("#naboo_comment_new #new_comment").val().length;$("#naboo_comment_new .nb").html(remaining);if(remaining>characters-min){if($('#new_comment_error').length==0){$btn_submit.attr('onClick','$(\'<div id="new_comment_error" class="alert alert-error">'+trad.music.naboo_review_size+'</div>\').insertBefore(\'textarea#new_comment\');review.limitComment(\''+min+'\',\''+characters+'\'); return false;');}else{$btn_submit.attr('onClick','review.limitComment(\''+min+'\',\''+characters+'\'); return false;');}}else{if($('#new_comment_error').length!=0){$('#new_comment_error').remove();}
$btn_submit.attr('onClick','review.postComment(); review.limitComment(\''+min+'\',\''+characters+'\'); return false;');}
return true;}catch(e){console.log(e);}},ranking:function(type,comment_id){try{if(type==false||type==null||typeof(type)=='undefined')return false;if(comment_id==false||comment_id==null||typeof(comment_id)=='undefined')return false;if(typeof(USER.USER_ID)=='undefined'||USER.USER_ID==null||USER.USER_ID<=0)return false;var rank;if(type=='like'){rank='1';}else if(type=='dislike'){rank='-1';}
var params={type:review.getTypeId(review.type),element_id:encodeURIComponent(review.element_id),comment_id:encodeURIComponent(comment_id),rank:rank};api.call('comment_rank',params,review.rankingCallBack,{comment_id:comment_id,rank:rank});return true;}catch(e){console.log(e);}},rankingCallBack:function(request,callbackParameter){try{if(request.error.length==0){review.alreadyRank($('#naboo_comment_'+callbackParameter.comment_id),callbackParameter.comment_id,callbackParameter.rank);}
return true;}catch(e){console.log(e);}},alreadyRank:function(div,element_id,rank){try{if((rank==false)||(rank==null)||(typeof(rank)=='undefined'))return false;if((element_id==false)||(element_id==null)||(typeof(element_id)=='undefined'))return false;if(rank=='1'){$('#like_'+element_id,div).addClass('selected');}else if(rank=='-1'){$('#dislike_'+element_id,div).addClass('selected');}
return true;}catch(e){console.log(e);}},postComment:function(){try{var comment_txt=$.trim($("#new_comment").val());if(comment_txt==''){return false;}
var params={comment:comment_txt,element_id:review.element_id,type:review.getTypeId(review.type),lang:SETTING_LANG};api.call('comment_add',params,review.postCommentCallback);facebook.graphAction('comment',{'type':review.type,'url':('http://www.deezer.com'+$.address.value()),'comment':comment_txt});return true;}catch(e){console.log(e);}},postCommentCallback:function(request){try{if(request.error.length==0){var insertDate=new Date();var new_comment={};new_comment.BLOG_NAME=USER.BLOG_NAME;new_comment.USER_PICTURE=USER.USER_PICTURE;new_comment.COMMENT_ID=request.results;new_comment.USER_ID=USER.USER_ID;new_comment.SETTING_LANG=SETTING_LANG;new_comment.DATE=insertDate.getFullYear()+"-"+pad(insertDate.getMonth()+1,2)+"-"+pad(insertDate.getDate(),2)+" "+pad(insertDate.getHours(),2)+":"+pad(insertDate.getMinutes(),2)+":"+pad(insertDate.getSeconds(),2);new_comment.COMMENT=$("#new_comment").val();review.$list=$('#tab_review_content > .review > .list');var $comment=$(review.createBlockComment(new_comment,"first"));review.$list.prepend($comment);$('#naboo_comment_'+new_comment.COMMENT_ID).fadeIn();$('#naboo_comment_'+new_comment.COMMENT_ID+'.like').attr('title',trad.music.naboo_review_flag_ok).tipsy({gravity:'s'});$('#naboo_comment_'+new_comment.COMMENT_ID+'.dislike').attr('title',trad.music.naboo_review_flag_ko).tipsy({gravity:'s'});if(USER.USER_ID==0){$('#naboo_comment_'+new_comment.COMMENT_ID+'.like').attr('onClick',"modal.open('/"+SETTING_LANG+"/login.php')");$('#naboo_comment_'+new_comment.COMMENT_ID+'.dislike').attr('onClick',"modal.open('/"+SETTING_LANG+"/login.php')");}
calculeTime();$("#new_comment").val("");var $nb=$("#naboo_comment_new .nb");$nb.html($nb.attr('data-max'));}
return true;}catch(e){console.log(e);}},liveComment:function(data){try{var insertDate=new Date();var new_comment={};new_comment.USER_ID=data.USER_ID;new_comment.BLOG_NAME=data.USER_NAME;new_comment.USER_PICTURE=data.USER_PICTURE;new_comment.COMMENT_ID=data.COMMENT_ID;new_comment.COMMENT=data.COMMENT;new_comment.DATE=insertDate.getFullYear()+"-"+pad(insertDate.getMonth()+1,2)+"-"+pad(insertDate.getDate(),2)+" "+pad(insertDate.getHours(),2)+":"+pad(insertDate.getMinutes(),2)+":"+pad(insertDate.getSeconds(),2);if(new_comment.USER_ID!=USER.USER_ID){review.$list=$('#tab_review_content > .review > .list');var $comment=$(review.createBlockComment(new_comment,"first"));review.$list.prepend($comment);$('#naboo_comment_'+new_comment.COMMENT_ID).fadeIn();if(USER.USER_ID==0){$('#naboo_comment_'+new_comment.COMMENT_ID+'.like').attr('onClick',"modal.open('/"+SETTING_LANG+"/login.php')");$('#naboo_comment_'+new_comment.COMMENT_ID+'.dislike').attr('onClick',"modal.open('/"+SETTING_LANG+"/login.php')");}
calculeTime();}
return true;}catch(e){console.log(e);}},flag:function(btn,comment_id){try{if(comment_id==''||typeof(comment_id)=='undefined'){return false;}
var params={comment_id:comment_id,type:review.getTypeId(review.type)};api.call('comment_flag',params,review.flagCallback,{btn:btn});$(btn).attr("onClick","return false;");return true;}catch(e){console.log(e);}},flagCallback:function(request,callbackParameter){try{if(request.error.length==0){$(callbackParameter.btn).html(trad.music.naboo_review_flag);}else{$(callbackParameter.btn).html("");}
return true;}catch(e){console.log(e);}},deleteComment:function(btn,comment_id,owner){try{if(typeof(owner)=='undefined'||owner==null){owner=false;}
if(confirm(trad.music.naboo_review_confirm)){var params={comment_id:comment_id,type:review.getTypeId(review.type),element_id:review.element_id,owner:owner};api.call('comment_delete',params,review.deleteCommentCallback,{btn:btn});}
return true;}catch(e){console.log(e);}},deleteCommentCallback:function(request,callbackParameter){try{if(request.error.length==0){$(callbackParameter.btn).parents('.comment').remove();}else{$(callbackParameter.btn).hide();}
return true;}catch(e){console.log(e);}},getTypeId:function(type){try{var id=0;switch(type){case'artist':id=1;break;case'album':id=2;break;case'user':id=3;break;case'playlist':id=4;break;case'radio':id=5;break;case'video':id=6;break;}
return id;}catch(e){console.log(e);}},facebook_share:function($element){try{var share_enabled=false;if(!$element.hasClass('active')){$element.addClass('active');share_enabled=true;}else{$element.removeClass('active');share_enabled=false;}
if(USER.FB_USER_ID==0){facebook.login();}else{if(share_enabled&&!facebook.isPublishActions){facebook.login('publish_actions');}
Events.trigger(Events.user.settingChange,{facebook:{share_comment:share_enabled}});}
return true;}catch(e){console.log(e);}},twitter_share:function($element){try{var share_enabled=false;if(!$element.hasClass('active')){$element.addClass('active');share_enabled=true;}else{$element.removeClass('active');share_enabled=false;}
if(typeof(USER.TWITTER.TOKEN)=='undefined'){actual_box+='#review';twitter.link();}else{Events.trigger(Events.user.settingChange,{twitter:{share_comment:share_enabled}});}
return true;}catch(e){console.log(e);}}};};
if(typeof(replace)=="undefined"){var replace={sng_id:0,div:'',playlist_id:0,songs_list:[],current_selected_id:0,init:function(sng_id,playlist_id,songs,div){try{replace.sng_id=sng_id;replace.playlist_id=playlist_id;replace.songs_list=songs;replace.div=div;window.setTimeout(function(){$('#hovercard_content_tracks').tinyscrollbar();},100);return true;}catch(e){console.log(e);}},replaceTrack:function(){try{if(replace.current_selected_id==0)return false;if(typeof(replace.sng_id)=="undefined")return false;if(typeof(replace.playlist_id)=="undefined")return false;var params={new_sng_id:replace.current_selected_id,old_sng_id:replace.sng_id};params.playlist_id=replace.playlist_id;api.call('playlist_recoverSong',params,replace.replaceTrackCallback);return true;}catch(e){console.log(e);}},replaceTrackCallback:function(request){try{if(request.results==true){datagrid.action($('#'+replace.div),['onReplaced',replace.sng_id,replace.getNewSongInfo(replace.current_selected_id)]);hovercard.remove();}else{console.log('replace KO');}
return true;}catch(e){console.log(e);}},deleteTrack:function(){try{if(confirm(trad.music.naboo_replace_confirm)){if(typeof(replace.sng_id)=="undefined")return false;if(typeof(replace.playlist_id)=="undefined")return false;var params={playlist_id:replace.playlist_id,songs:[[replace.sng_id,0]]};api.call('playlist_deleteSongs',params,replace.deleteTrackCallback);}
return true;}catch(e){console.log(e);}},deleteTrackCallback:function(request){try{if(request.results==true){datagrid.action($('#'+replace.div),['onRemoved',request,{sng_list:[[replace.sng_id,0]]}]);hovercard.remove();}else{console.log('delete KO');}
return true;}catch(e){console.log(e);}},getNewSongInfo:function(sngId){try{if(replace.songs_list==0)return false;for(t=0;t<replace.songs_list.length;t++){if(replace.songs_list[t].SNG_ID==sngId){return replace.songs_list[t];}}
return true;}catch(e){console.log(e);}},play:function(sngId){try{dzPlayer.playTracks([replace.getNewSongInfo(sngId)],0);return true;}catch(e){console.log(e);}},selectTrack:function($line){try{replace.current_selected_id=$line.attr('data-id');$line.parents('dl').parent().children('dl').removeClass('selected');$line.parents('dl').addClass('selected');$('#hovercard_replace_button').show();return true;}catch(e){console.log(e);}}}};
if(typeof(video_list)=="undefined"){var video_list={start:0,nb:100,art_id:0,type:0,getList:function(type,art_id,start){try{if(typeof(start)=='undefined'||start==null)start=0;video_list.art_id=art_id;video_list.type=type;video_list.start=start;var params={art_id:video_list.art_id,start:video_list.start,nb:video_list.nb,lang:SETTING_LANG};api.call('video_getItemsByArtist',params,video_list.getListCallback);return true;}catch(e){console.log(e);}},getListCallback:function(request){try{if(request==false||request==null)return false;if(request.results==null||request.error.length>0)return false;if(video_list.type=='artist'){if(typeof(artist)!='undefined'&&typeof(artist.tabs_loaded)!='undefined'&&artist.tabs_loaded!=null){artist.tabs_loaded['video_'+video_list.art_id]=true;}}
if(request.results.data!=null&&request.results.count!=null&&request.results.count>0){if(typeof($modele_video)=="undefined"){$modele_video=$('#naboo_default_video');}
display_line=[];var j=0;for(video_item in request.results.data){$new_link=$modele_video.clone();$new_link.attr('id','naboo_video_'+request.results.data[video_item].VIDEO_ID).show();if(request.results.data[video_item].TITLE!=null){$('.naboo_video_title dt',$new_link).html('<a href="/'+SETTING_LANG+'/video/'+request.results.data[video_item].VIDEO_ID+'" onclick="loadBox(\'video/'+request.results.data[video_item].VIDEO_ID+'\'); return false;">'+request.results.data[video_item].TITLE+'</a>');}
if(request.results.data[video_item].THUMBNAIL!=null){$('.naboo_video_picture a',$new_link).attr({'href':'/'+SETTING_LANG+'/video/'+request.results.data[video_item].VIDEO_ID,'onclick':"loadBox(\'video/"+request.results.data[video_item].VIDEO_ID+"\'); return false;"});$('.naboo_video_picture .img_main',$new_link).attr('src',request.results.data[video_item].THUMBNAIL);}
display_line[j]=util.getOuterHTML($new_link);j++;}
$('#tab_video_content .naboo_video_list').html(display_line.join(''));}else{$('#tab_video_content').html(trad.music.naboo_video_none);}
naboo.afterLoad();return true;}catch(e){console.log(e.message,e.stack);}}}};
if(typeof(followbox)=="undefined"){var followbox={initFollowFacebox:function(type,id,selfFollowingNumber){try{followbox.$followIdFacebox=id;followbox.$followTypeFacebox=type;followbox.$followSelfNumber=selfFollowingNumber;followbox.$followFacebox=$('#modal_following');followbox.$followUserFacebox=$('#tpl_followers').clone().removeAttr('id');followbox.$followContenerFacebox=$('.followers',followbox.$followFacebox);followbox.$followScrollFacebox=$('.wrapper-scroll',followbox.$followFacebox);$('#tpl_followers').remove();if(www.getCurrentPageType()=='profile'){Events.unsubscribe(Events.user.deleteFavorite,profile.toogleFollowingMessage);Events.subscribe(Events.user.deleteFavorite,profile.toogleFollowingMessage);Events.unsubscribe(Events.user.addFavorite,profile.toogleFollowingMessage);Events.subscribe(Events.user.addFavorite,profile.toogleFollowingMessage);}}catch(e){console.log(e.message,e.stack);}},drawFollowFacebox:function(start,nb,results){try{followbox.startFollowFacebox=start;followbox.stateFollowFacebox="ok";var friends_list=[];for(var f=0;f<results.count;f++){friends_list[f]=followbox.appendFollowFacebox(results.data[f]);}
if(friends_list.length>0){followbox.$followContenerFacebox.append(friends_list.join(''));if(start==0){setTimeout(function(){followbox.$followScrollFacebox.bind('jsp-scroll-y',function(event,position){if(position=='bottom'&&(followbox.startFollowFacebox+nb)<=results.total&&followbox.stateFollowFacebox=="ok"){followbox.stateFollowFacebox="loading";followbox.loadFollowFacebox(followbox.startFollowFacebox+nb,nb);}}).tinyscrollbar({extremePosition:true});},200);}else{followbox.$followScrollFacebox.tinyscrollbar_update('relative');}}}catch(e){console.log(e.message,e.stack);}},loadFollowFacebox:function(start,nb){try{var params={'start':start,'nb':nb}
if(followbox.$followTypeFacebox=='follower'){method='friend.getFollower';params.user_id=followbox.$followIdFacebox;}else if(followbox.$followTypeFacebox=='following'){method='friend.getFollowing';params.user_id=followbox.$followIdFacebox;}else if(followbox.$followTypeFacebox=='artist'){method='artist.getFans';params.art_id=followbox.$followIdFacebox;}
api.call(method,params,function(request){followbox.startFollowFacebox+=nb;followbox.drawFollowFacebox(start,nb,request.results);});}catch(e){console.log(e.message,e.stack);}},appendFollowFacebox:function(user_data){try{$item=followbox.$followUserFacebox.clone();$item.attr('data-id',user_data.USER_ID);$('.thumbnail img',$item).attr('src',SETTING_DOMAIN_IMG+'/user/'+user_data.USER_PICTURE+'/80x80-000000-80-0-0.jpg');$('.infos a',$item).text((typeof(user_data.DISPLAY_NAME)=='undefined')?user_data.BLOG_NAME:user_data.DISPLAY_NAME);if(userData.isFavorite('friend',user_data.USER_ID)){user.setUnFollowState($('.button-follow',$item),user_data.USER_ID,user_data);$('.button-message',$item).attr('id','follow_users_send_message_'+user_data.USER_ID).show();}else{user.setFollowState($('.button-follow',$item),user_data.USER_ID,user_data);$('.button-message',$item).attr('id','follow_users_send_message_'+user_data.USER_ID).hide();}
if(user_data.USER_ID==USER.USER_ID){$('.infos a',$item).hide();}
return util.getOuterHTML($item);}catch(e){console.log(e.message,e.stack);}}}};
if(typeof(advertising)=="undefined"){var advertising={call:function(element_type,element_id,element_data){try{if(typeof(USER)!='undefined'&&USER.OPTIONS.ads_display===false){return false;}
if(dateToTimestamp(USER.INSCRIPTION_DATE)+(86400)>SERVER_TIMESTAMP){USER.OPTIONS.ads_display=false;$('body').removeClass('dz_ads');return false;}
if(typeof(element_id)=='undefined'){element_id=0;}
if(typeof(element_data)=='undefined'){element_data='';}
ord=parseInt(Math.random()*10000000000000000);switch(element_type){case'collection':ads.callAds('15829/115056/6955/M/'+ord+'/element_type=home;element_id='+element_id);break;case'home':ads.callAds('15829/115056/6955/M/'+ord+'/element_type=home;element_id='+element_id);ads.callAds('15829/115056/6952/S/'+ord+'/element_type=home;element_id='+element_id);break;case'artist':ads.callAds('15829/115069/6955/M/'+ord+'/element_type=artist;element_id='+element_id+';element_style=');ads.callAds('15829/115069/6952/S/'+ord+'/element_type=artist;element_id='+element_id+';element_style=');break;case'artist_extend':ads.callAds('15829/115069/6952/S/'+ord+'/element_type=artist;element_id='+element_id+';element_style=');break;case'album':ads.callAds('15829/115066/6955/M/'+ord+'/element_type=album;element_id='+element_id+';element_style=');break;case'playlist':ads.callAds('15829/115067/6955/M/'+ord+'/element_type=playlist;element_id='+element_id+';element_style=');break;case'search':ads.callAds('15829/115072/6955/M/'+ord+'/element_type=result;element_id='+element_id+';element_style='+element_data);ads.callAds('15829/115072/6952/S/'+ord+'/element_type=result;element_id='+element_id+';element_style='+element_data);break;case'search_noresult':ads.callAds('15829/115072/6955/M/'+ord+'/element_type=result;element_id='+element_id+';element_style='+element_data);break;case'video':ads.callAds('15829/115077/6955/M/'+ord+'/element_type=video;element_id='+element_id+';element_style=');break;case'profile':ads.callAds('15829/115081/6955/M/'+ord+'/element_type=playlist;element_id='+element_id+';element_style=');break;case'tops':ads.callAds('15829/274126/6955/M/'+ord+'/element_type=playlist;element_id='+element_id+';element_style=');break;case'recommendations':ads.callAds('15829/274132/6955/M/'+ord+'/');ads.callAds('15829/274132/6943/S/'+ord+'/');break;case'picks':ads.callAds('15829/114873/6952/M/'+ord+'/music_style='+element_id+';');ads.callAds('15829/114873/6943/S/'+ord+'/music_style='+element_id+';');ads.callAds('15829/114873/6955/S/'+ord+'/music_style='+element_id+';');ads.callAds('15829/114873/6960/S/'+ord+'/music_style='+element_id+';');ads.callAds('15829/114873/19632/S/'+ord+'/');break;case'loved':ads.callAds('15829/274137/6955/M/'+ord+'/element_type=loved;element_id='+element_id+';element_style=');break;}
return true;}catch(e){console.log(e);}}};};
if(typeof(track)=="undefined"){var track={display_buy:false,display_subscribe:false,id:0,display:function(page,seo_data){path=page.split('/');if(path[0]!='track'||typeof(path[1])=='undefined'||path[1]==null||path[1]==''){return false;}
track.id=path[1];if(typeof(seo_data)!='undefined'){track.displayCallback(seo_data);}else{var params={sng_id:encodeURIComponent(track.id)};api.call('deezer_pageTrack',params,track.displayCallback,null,'major_pages');}},displayCallback:function(request){try{if(request==false||request==null){return false;}
if(typeof(request.results)!='undefined'&&typeof(request.error)!='undefined'){request=request.results;}
if(request.DATA==null){return false;}
user_offer_id=0;if(typeof(OFFER_ID)!='undefined'&&OFFER_ID!=null&&OFFER_ID>0){user_offer_id=OFFER_ID;}
template.load('naboo/track',$('#naboo_content'));$('#naboo_track_play').attr({href:'/track/'+track.id,onClick:'dzPlayer.playTracksId(['+track.id+'], 0, true, {TYPE:\'track_page\', ID:'+track.id+'}); return false;'});if(request.DATA.SNG_TITLE!=null){$('#naboo_track_title > a').attr('href','/track/'+track.id).text(request.DATA.SNG_TITLE);}
var mainArtistName=[];var mainArtistHash={};if(typeof(request.DATA.ARTISTS)!='undefined'&&request.DATA.ARTISTS.length>0){var length=request.DATA.ARTISTS.length;var art_name=$('#naboo_track_song > a').clone().removeAttr('id');$('#naboo_track_song > a').remove();var art_list=$('<p></p>');for(var a in request.DATA.ARTISTS){if(request.DATA.ARTISTS[a].ROLE_ID==0){mainArtistName.push(request.DATA.ARTISTS[a].ART_NAME);mainArtistHash[request.DATA.ARTISTS[a].ART_ID]=true;$item=art_name.clone();$item.attr('href','/artist/'+request.DATA.ARTISTS[a].ART_ID).attr('onclick','loadBox(\'artist/'+request.DATA.ARTISTS[a].ART_ID+'\'); return false;').text(request.DATA.ARTISTS[a].ART_NAME);art_list.append($item);}}
$('#naboo_track_song').prepend(art_list.children());}
else if(request.DATA.ART_ID!=null&&request.DATA.ART_NAME!=null){mainArtistName.push(request.DATA.ART_NAME);$('#naboo_track_song > a').attr('href','/artist/'+request.DATA.ART_ID).attr('onclick','loadBox(\'artist/'+request.DATA.ART_ID+'\'); return false;').text(request.DATA.ART_NAME);}
if(request.DATA.DURATION!=null){var duration=secToMin(request.DATA.DURATION);$('#naboo_track_song').append(duration);}
if(typeof(request.DATA.SNG_CONTRIBUTORS)!='undefined'){var contributor_name=$('#naboo_track_contributor_modele').clone().removeAttr('id');$('#naboo_track_contributor_modele').remove();var compo_list=$('<p></p>');for(var a in request.DATA.SNG_CONTRIBUTORS){$item=contributor_name.clone();if(a=='composer'){$item.text(trad.music['naboo_datagrid_contributor_composer']+' '+request.DATA.SNG_CONTRIBUTORS[a].join(' - '));}else if(a=='main_artist'&&request.DATA.SNG_CONTRIBUTORS[a].join()!=mainArtistName.join()){$item.text(trad.music['naboo_album_main_artist']+' '+request.DATA.SNG_CONTRIBUTORS[a].join(' - '));}else if(a=='misc'&&request.DATA.SNG_CONTRIBUTORS[a].join()!=mainArtistName.join()){$item.text(trad.music['naboo_datagrid_contributor_misc']+' '+request.DATA.SNG_CONTRIBUTORS[a].join(' - '));}else if(a=='author'&&request.DATA.SNG_CONTRIBUTORS[a].join()!=mainArtistName.join()){$item.text(trad.music['naboo_datagrid_contributor_author']+' '+request.DATA.SNG_CONTRIBUTORS[a].join(' - '));}else{continue;}
compo_list.append($item);}
$('#naboo_track_song').append(compo_list.children());}
if(typeof(request.ISRC)!='undefined'&&countObject(request.ISRC)>0){track.drawAlbumList(request.ISRC);}else{$('#naboo_album_cover_modele').remove();$('#related_content_top').remove();}
track.setShareAndDownload(track.id);if(track.display_buy){setTimeout(function(){loadFacebox('store/index.php?product_type=track&product_id='+track.id);},1500);}
if(track.display_subscribe){setTimeout(function(){loadPayment({'id':user_offer_id});},1500);}
naboo.afterLoad(true);}catch(e){console.log(e);}},drawAlbumList:function(isrc){var length=isrc.data.length;if(length==1){var top=trad.music['naboo_track_album'];}else{var top=sprintf(trad.music['naboo_track_album_list'],length);}
$('#related_content_top').text(top);var $block_cover=$('#naboo_album_cover_modele').clone().removeAttr('id');$('#naboo_album_cover_modele').remove();var album_list=$('<p></p>');for(var a in isrc.data){alb=isrc.data[a];$cover=$block_cover.clone();$('.cover a',$cover).attr({href:'/album/'+alb.ALB_ID,onClick:'loadBox(\'album/'+alb.ALB_ID+'\'); return false;'});$('.img_main',$cover).attr('src',SETTING_DOMAIN_IMG+'/cover/'+alb.ALB_PICTURE+'/120x120-000000-80-0-'+IMAGE_VERSION+'.jpg')
$('.label dl dt a',$cover).attr({href:'/album/'+alb.ALB_ID,onClick:'loadBox(\'album/'+alb.ALB_ID+'\'); return false;'}).text(alb.ALB_TITLE);$('.label dl dd a',$cover).attr({href:'/artist/'+alb.ART_ID,onClick:'loadBox(\'artist/'+alb.ART_ID+'\'); return false;'}).text(alb.ART_NAME);album_list.append($cover);}
$('#tab_related_content > ul').append(album_list.children());return true;},setShareAndDownload:function(id){try{if(typeof(CUSTO)!='undefined'&&typeof(CUSTO.store_platform)!='undefined'&&CUSTO.store_platform=='none'){$("#naboo_track_download").attr({'onClick':'','data-hovercard':''}).click(function(e){}).hide();}else if(typeof(STORE_PLATEFORM)!='undefined'&&STORE_PLATEFORM.DEEZER!=null&&getObjectSize(STORE_PLATEFORM)==1){$("#naboo_track_download").attr({'data-hovercard':'/ajax/hovercard/page.php?card=buy&sng_id='+id,'onClick':'track.openStore('+id+'); return false;'}).mouseenter(function(e){hovercard.init($(this),0);}).mouseleave(function(){hovercard.remove();});}else{if(typeof(STORE_PLATEFORM)!='undefined'&&getObjectSize(STORE_PLATEFORM)>0){$("#naboo_track_download").attr('data-hovercard','/ajax/hovercard/page.php?card=buy&sng_id='+id).click(function(e){hovercard.init($(this),0);}).mouseleave(function(){hovercard.remove();});}else{$("#naboo_track_download").attr({'onClick':'','data-hovercard':''}).click(function(e){}).hide();}}
$("#naboo_track_share a").attr('onClick','sharebox.load(0, '+id+'); return false;');return true;}catch(e){console.log(e);}},openStore:function(id){try{hovercard.remove();loadFacebox('store/index.php?product_type=track&product_id='+id);return true;}catch(e){console.log(e);}}}};
if(typeof(album)=="undefined"){var album={favorites:[],tabs_loaded:{},id:0,current_alb_id:0,current_art_id:0,current_start_discography:0,current_start_discography_mosaic:0,trackList:[],data:{},subquery:'',replayNeed:0,retryCountEmpty:0,retryCountUnavailable:0,usedIdForLoadedTabs:{'discography':'current_art_id','related':'current_art_id','review':'current_alb_id','chronicles':'current_alb_id',},display:function(page,seo_data){try{var path=page.split('?');if(typeof(path[1])!='undefined'&&path[1].length>0){album.subquery=hex2bin(path[1]);}
path=path[0].split('/');if(path[0]!='album'||typeof(path[1])=='undefined'||path[1]==null||path[1]==''){return false;}
album.id=path[1];album.tabs_loaded={};album.current_alb_id=album.id;Events.unsubscribeAll('TABS');Events.addEvent('TABS',Events.tabs.open,album.selectTab);if(typeof(seo_data)!='undefined'){album.displayCallback(seo_data);}else{var params={alb_id:encodeURIComponent(album.id),lang:encodeURIComponent(SETTING_LANG),tab:0};api.call('deezer_pageAlbum',params,album.displayCallback,null,'major_pages');}
menu.selectItem('album',album.id);Events.unsubscribe(Events.album.checkReplace,album.replaceUnavailable);Events.subscribe(Events.album.checkReplace,album.replaceUnavailable);Events.unsubscribe(Events.album.noReplaceNeed,album.noReplaceNeed);Events.subscribe(Events.album.noReplaceNeed,album.noReplaceNeed);Events.ready(Events.user.userReady,function(){Events.unsubscribe(Events.user.addFavorite,album.changeFavoriteStatus);Events.subscribe(Events.user.addFavorite,album.changeFavoriteStatus);Events.unsubscribe(Events.user.deleteFavorite,album.changeFavoriteStatus);Events.subscribe(Events.user.deleteFavorite,album.changeFavoriteStatus);});return true;}catch(e){console.log(e);}},displayCallback:function(request){try{if(request==false||request==null){return false;}
if(typeof(request.results)!='undefined'&&typeof(request.error)!='undefined'){request=request.results;}
if(request.DATA==null){return false;}
template.load('naboo/album',$('#naboo_content'));album.replayNeed=0;album.data=request;album.current_art_id=request.DATA.ART_ID;album.current_start_discography=0;if(request.DATA.ALB_TITLE!=null){$('#naboo_album_title').text(request.DATA.ALB_TITLE);}
if(request.DATA.ALB_PICTURE!=null){if(OFFLINE){filesystem.readImage(request.DATA.ALB_PICTURE,'200x200-000000-80-0-0.jpg',$('#naboo_album_image'));}else{$('#naboo_album_image').attr('src',SETTING_DOMAIN_IMG+'/cover/'+request.DATA.ALB_PICTURE+'/200x200-000000-80-0-0.jpg');}
$('#naboo_album_image_large').attr({'href':SETTING_DOMAIN_IMG+'/cover/'+request.DATA.ALB_PICTURE+'/500x500-000000-80-0-0.jpg','onClick':'if(!OFFLINE) {$(\'body\').append(\'<div onclick=\"$($(this)).remove(); return false;\" style=\"z-index:10000; background:rgba(0,0,0,0.6); position:fixed; top:0; left:0; width:100%; height:100%;\"><div style=\"width:500px; height:500px; margin:150px auto 0 auto;\"><img src=\"'+SETTING_DOMAIN_IMG+'/cover/'+request.DATA.ALB_PICTURE+'/500x500-000000-80-0-0.jpg\" /></div>\');} return false;'}).show();}
var mainArtistName=[];var mainArtistHash={};if(typeof(request.DATA.ARTISTS)!='undefined'&&request.DATA.ARTISTS.length>0){var art_name=$('#naboo_album_artist_modele').clone().removeAttr('id');$('#naboo_album_artist_modele').remove();var art_list=$('<p></p>')
for(var a=0;a<request.DATA.ARTISTS.length;a++){if(request.DATA.ARTISTS[a].ROLE_ID==0||request.DATA.ARTISTS[a].ROLE_ID==5){$item=art_name.clone();$item.attr({'href':'/artist/'+request.DATA.ARTISTS[a].ART_ID,'data-id':request.DATA.ARTISTS[a].ART_ID}).text(request.DATA.ARTISTS[a].ART_NAME);mainArtistName.push(request.DATA.ARTISTS[a].ART_NAME);mainArtistHash[request.DATA.ARTISTS[a].ART_ID]=true;if(a>0){art_list.append($('<span>, </span>'));}
art_list.append($item);}}
$('#naboo_album_artist').prepend(art_list.children());}else{mainArtistName.push(request.DATA.ART_NAME);$('#naboo_album_artist_modele').text(request.DATA.ART_NAME).attr({'href':'/artist/'+request.DATA.ART_ID,'data-id':request.DATA.ART_ID});}
if(typeof(request.DATA.ALB_CONTRIBUTORS)!='undefined'){var contributor_name=$('#naboo_album_contributor_modele').clone().removeAttr('id');$('#naboo_album_contributor_modele').remove();var compo_list=$('<p></p>')
for(var a in request.DATA.ALB_CONTRIBUTORS){$item=contributor_name.clone();if(a=='composer'){$item.text(trad.music['naboo_album_'+a]+' '+request.DATA.ALB_CONTRIBUTORS[a].join(' - '));}else if(a=='main_artist'&&request.DATA.ALB_CONTRIBUTORS[a].join()!=mainArtistName.join()){$item.text(trad.music['naboo_album_'+a]+' '+request.DATA.ALB_CONTRIBUTORS[a].join(' - '));}else{continue;}
compo_list.append($item);}
$('#naboo_album_artist').append(compo_list.children());}
if(request.DATA.DIGITAL_RELEASE_DATE!=null){releaseDate=new Date(request.DATA.DIGITAL_RELEASE_DATE);if((releaseDate.getTime()/1000)+(15*86400)>SERVER_TIMESTAMP){$('#flagNewAlbum').show();}else{$('#flagNewAlbum').hide();}}else{$('#flagNewAlbum').hide();}
if(request.DATA.PHYSICAL_RELEASE_DATE!=null&&request.DATA.PHYSICAL_RELEASE_DATE!='0000-00-00'){tmp_physical_date=formatDate(request.DATA.PHYSICAL_RELEASE_DATE);$('#naboo_album_head_style').text(' | '+tmp_physical_date);}
if((request.DATA.LABEL_NAME!=null)){if(request.DATA.PHYSICAL_RELEASE_DATE!=null&&request.DATA.PHYSICAL_RELEASE_DATE!='0000-00-00'){$('#naboo_album_head .naboo_album_label dl dt').text(request.DATA.PHYSICAL_RELEASE_DATE.substr(0,4)+' | '+request.DATA.LABEL_NAME);}else{$('#naboo_album_head .naboo_album_label dl dt').text(request.DATA.LABEL_NAME);}}
var cds=[];var disk_number=0;var all_tracks={data:[],count:0,total:0};var duration=0;if(request.SONGS!=null&&request.SONGS.count!=null&&request.SONGS.count>0){for(track_item in request.SONGS.data){var track=request.SONGS.data[track_item];var disk_number=parseInt(track.DISK_NUMBER)-1;var track_number=parseInt(track.TRACK_NUMBER)-1;if(typeof(cds[disk_number])=='undefined'){cds[disk_number]=[];}
if(typeof(cds[disk_number][track_number])=='undefined'||right.checkSongAvailable(track)==right.READABLE){cds[disk_number][track_number]=track;duration+=parseInt(track.DURATION);}}
disk_number=cds.length;if(disk_number>1){for(disk in cds){all_tracks.data=$.merge(all_tracks.data,cds[disk]);}
all_tracks.count=all_tracks.total=all_tracks.data.length;}else{var all_tracks={data:cds[0],count:cds[0].length,total:cds[0].length}}
Events.trigger(Events.album.noReplaceNeed,{id:parseInt(request.DATA.ALB_ID),type:'empty'});}else{Events.trigger(Events.album.checkReplace,{id:parseInt(request.DATA.ALB_ID),type:'empty'});}
$('#naboo_album_duration > span > span').text(getTotalDuration(duration));$('#naboo_album_tracks').createDatagrid({type:'album',id:request.DATA.ALB_ID,songs:all_tracks,disk_number:disk_number,art_id:request.DATA.ART_ID,scrollInfinite:false,main_artist_hash:mainArtistHash,offline_data:{alb_name:request.DATA.ALB_TITLE,alb_artist:request.DATA.ART_NAME,alb_rewriting:request.DATA.URL_REWRITING,alb_picture:request.DATA.ALB_PICTURE}});split_subquery=album.subquery.split('=');if(split_subquery[0]!=null&&split_subquery[0]=='chronicle'&&split_subquery[1]!=null){loadTab('chronicles',split_subquery[1]);}
if(!OFFLINE){if(request.DATA.ALB_TITLE!=null){favorite.display($('#naboo_album_favorite_link'),{ALB_ID:album.id,type:'album',ALB_TITLE:request.DATA.ALB_TITLE,ART_NAME:request.DATA.ART_NAME});}
if(typeof(request.CHRONICLES)!='undefined'){if(request.CHRONICLES.count!=null&&request.CHRONICLES.count>0){$('#tab_chronicles_link').show();$('#naboo_album_chronic').show();if(request.CHRONICLES.count==1&&request.CHRONICLES.data[0].RESUME!=null&&request.CHRONICLES.data[0].RESUME!=''){if(request.CHRONICLES.data[0].SOURCE!=null){var chronicle_data=request.CHRONICLES.data[0];var logo_chronicle=SETTING_STATIC+'/img/review/big/'+chronicle_data.LOGO_BIG;var name_chronicle=chronicle_data.PARTNER_NAME;var resume_chronicle=chronicle_data.RESUME;var id_chronicle=chronicle_data.SOURCE;$('#naboo_album_chronic_content_result .naboo_album_chronic_content_logo').html('<a href="javascript:void(0)" onclick="loadTab(\'chronicles\', \''+id_chronicle+'\'); return false;"><img src="'+logo_chronicle+'" alt="'+name_chronicle+'" /></a>');$('#naboo_album_chronic_content_result .naboo_album_chronic_content_text').html(resume_chronicle+'... <a href="javascript:void(0)" onclick="loadTab(\'chronicles\', \''+id_chronicle+'\'); return false;">'+trad.music.naboo_display_chronicle+'</a>');$('#naboo_album_chronic_content_result').show();$('#naboo_album_chronic_content_select').hide();}}else if(request.CHRONICLES.count>1){shuffle(request.CHRONICLES.data);nb_chronicles=0;for(chronicle_item in request.CHRONICLES.data){if(nb_chronicles>=4){break;}
var chronicle_data=request.CHRONICLES.data[chronicle_item];var logo_chronicle=SETTING_STATIC+'/img/review/big/'+chronicle_data.LOGO_BIG;var name_chronicle=chronicle_data.PARTNER_NAME;var resume_chronicle=chronicle_data.RESUME;var id_chronicle=chronicle_data.SOURCE;$('#naboo_album_chronic_content_select .naboo_album_chronic_content_list').append('<li><a href="javascript:void(0)" onclick="loadTab(\'chronicles\', \''+id_chronicle+'\'); return false;"><img src="'+logo_chronicle+'" alt="'+name_chronicle+'" /></a></li>');nb_chronicles++;}
$('#naboo_album_chronic_content_select').show();$('#naboo_album_chronic_content_result').hide();}}else{$('#naboo_album_chronic').hide();$('#tab_chronicles_link').hide();}}else{$('#naboo_album_chronic').hide();$('#tab_chronicles_link').hide();}
loadTab('review',request.COMMENTS);advertising.call('album',album.id);album.setShareAndDownload(album.id);$video_list_modele=$('#naboo_album_video_list').children().clone().show();$video_list=$('#naboo_album_video_list').empty();if(typeof(request.VIDEOS.data)!='undefined'&&request.VIDEOS.data.length>0){for(var v=0;v<request.VIDEOS.data.length;v++){$item=$video_list_modele.clone();$('.naboo_video_picture .img_main',$item).attr('src',request.VIDEOS.data[v].THUMBNAIL);$('.naboo_video_picture a',$item).attr('href','/video/'+request.VIDEOS.data[v].VIDEO_ID);$('.naboo_video_title a',$item).attr('href','/video/'+request.VIDEOS.data[v].VIDEO_ID).text(request.VIDEOS.data[v].TITLE);$video_list.append($item);}}else{$video_list.parent().hide();}}else{$("#naboo_album_second").empty();$('#naboo_album_head .naboo_head_buttons_options').empty();}
naboo.afterLoad(true);live.deleteChannel(live.lastFeed);window.clearTimeout(live.timeoutConnect);live.lastFeed='-1_0_ALBUMFEED_'+album.id;live.timeoutConnect=window.setTimeout(function(){live.addChannel(live.lastFeed);},3000);Events.trigger(Events.album.displayed,{id:album.id});return true;}catch(e){console.log(e.message,e.stack);}},selectTab:function(evt,params){try{infinite_scroll.disable();if(album.tabs_loaded[params.tab_id+'_'+album[album.usedIdForLoadedTabs[params.tab_id]]]==true){if(typeof(window[params.tab_id].activeScroll)=='function'){window[params.tab_id].activeScroll(params.options);}
return true;}
showLoading();if(params.tab_id=='discography'){discography.getList('album',album.current_art_id,0);}else if(params.tab_id=='review'){review.getList('album',album.current_alb_id,0,params.options);}else if(params.tab_id=='related'){related.getList('album',album.current_art_id,0);}else if(params.tab_id=='chronicles'){chronicles.displayChronicle(album.current_alb_id,params.options);}
return true;}catch(e){console.log(e.message,e.stack);}},changeFavoriteStatus:function(evt,params){try{if(params.type=='album'&&params.ALB_ID==album.current_alb_id){favorite.display($('#naboo_album_favorite_link'),{ALB_ID:album.current_alb_id,type:'album',ALB_TITLE:album.data.DATA.ALB_TITLE,ART_NAME:album.data.DATA.ART_NAME});}}catch(e){console.log(e.message,e.stack);}},setShareAndDownload:function(id){try{if(typeof(CUSTO)!='undefined'&&typeof(CUSTO.store_platform)!='undefined'&&CUSTO.store_platform=='none'){$("#naboo_album_download").attr({'onClick':'','data-hovercard':''}).click(function(e){}).hide();}else if((typeof(STORE_PLATEFORM)!='undefined')&&(STORE_PLATEFORM.DEEZER!=null)&&(getObjectSize(STORE_PLATEFORM)==1)){$("#naboo_album_download").attr('onClick','album.openStore(); return false;');if(typeof(USER)!='undefined'&&typeof(USER.USER_ID)!='undefined'&&USER.USER_ID>0){$("#naboo_album_download").attr('data-hovercard','/ajax/hovercard/page.php?card=buy&alb_id='+id).mouseenter(function(e){hovercard.init($(this));}).mouseleave(function(){hovercard.remove();});}}else{if(typeof(STORE_PLATEFORM)!='undefined'&&getObjectSize(STORE_PLATEFORM)>0){$("#naboo_album_download").attr('data-hovercard','/ajax/hovercard/page.php?card=buy&alb_id='+id).click(function(e){hovercard.init($(this),0);}).mouseleave(function(){hovercard.remove();});}else{$("#naboo_album_download").attr({'onClick':'','data-hovercard':''}).click(function(e){}).hide();}}
$("#naboo_album_share a").attr('onClick','sharebox.load(1, '+id+'); return false;');return true;}catch(e){console.log(e);}},openStore:function(sng_id){try{if(typeof(sng_id)=='undefined'){hovercard.remove();loadFacebox('store/index.php?product_type=album&product_id='+$('#naboo_album_tracks').getData('id'));}else{loadFacebox('store/index.php?product_type=track&product_id='+sng_id);}}catch(e){console.log(e);}},replaceUnavailable:function(evt,data){try{if(countObject(data)==2){if(data.type=='empty'){album.retryCountEmpty++;}else if(data.type=='unavailable'){album.retryCountUnavailable++;}
if(album.retryCountEmpty<2&&album.retryCountUnavailable<2){api.call('album.getAlternative',{alb_id:data.id,array_default:['ALB_ID']},function(request){if(request.error.length==0&&typeof(request.results.ALB_ID)!='undefined'){loadBox('album/'+request.results.ALB_ID);}});}else{album.retryCountEmpty=0;album.retryCountUnavailable=0;album.replayNeed=0;}}}catch(e){console.log(e.message,e.stack);}},noReplaceNeed:function(evt,data){try{if(countObject(data)==2){if(data.type=='empty'){album.replayNeed++;}else if(data.type=='unavailable'){album.replayNeed++;}
if(album.replayNeed==2){album.retryCountEmpty=0;album.retryCountUnavailable=0;album.replayNeed=0;}}}catch(e){console.log(e.message,e.stack);}}}};
if(typeof artist=='undefined'){var artist={tabs_loaded:{},current_start_discography:0,current_start_discography_mosaic:0,data:[],id:0,displayExtended:false,init:function(results){try{artist.data=results;artist.id=results.DATA.ART_ID;artist.displayExtended=(typeof(artist.data.DATA.DATA)!='undefined'&&typeof(artist.data.DATA.DATA.ART_BANNER)!='undefined'&&artist.data.DATA.DATA.ART_BANNER!='');artist.tabs_loaded={};if(artist.displayExtended){$('#naboo_artist_cover_classic').remove();$('#naboo_artist_cover_extended').show();$('#naboo_artist_head').addClass('artist_cover-extended');}else{$('#naboo_artist_cover_classic').show();$('#naboo_artist_cover_extended').remove();$('#naboo_artist_head').addClass('artist_cover-classic');}
artist.current_start_discography=0;if(artist.displayExtended){advertising.call('artist_extend',artist.id);}else{advertising.call('artist',artist.id);}
favorite.display($('#naboo_artist_favorite_link'),{type:'artist',ART_ID:artist.id,ART_NAME:artist.data.DATA.ART_NAME,SMARTRADIO:((artist.data.SMARTRADIO)?'1':'0')});artist.setShare(artist.id);artist.drawBiographyContent(artist);if(!(typeof(artist.data.TOTAL_VIDEOS)!='undefined'&&parseInt(artist.data.TOTAL_VIDEOS)>0)){$('#tab_video_link').hide();}
if(!(typeof(artist.data.BIO)!='undefined'&&typeof(artist.data.BIO.BIO)!='undefined')){$('#tab_biography_link').hide();}
artist.tabsLink=$('#naboo_tab > li > a');artist.tabsContent=$('#naboo_artist_second > div:gt(0)');artist.modelePlaylist=$('#naboo_artist_modele_playlist').clone().removeAttr('id');$('#naboo_artist_modele_playlist').remove();artist.contentPlaylist=$('#naboo_artist_selected_playlist');artist.modeleFan=$('#naboo_artist_modele_fan').clone().removeAttr('id');$('#naboo_artist_modele_fan').remove();artist.contentFan=$('#follower-user');artist.contentSocialNetworkSmall=$('#naboo_artist_social_small');artist.contentSocialNetworkBig=$('#naboo_artist_social_big');if(typeof(artist.data.TOP)!='undefined'&&artist.data.TOP.count>0){$('#naboo_artist_top_titre').createDatagrid({type:'artist_top',songs:artist.data.TOP,id:artist.id,scrollInfinite:false});}else{$('#naboo_artist_top_titre').parent().remove();}
if(typeof(artist.data.EXCLUSIVE_TRACKS)!='undefined'&&artist.data.EXCLUSIVE_TRACKS.count>0){var exclu=trad.music.naboo_track_exclusive;if(artist.data.EXCLUSIVE_TRACKS.count>1){exclu=trad.music.naboo_track_exclusives;}
$('#naboo_artist_exclusive_track h3').text(exclu);$('#naboo_artist_exclu').createDatagrid({type:'artist_exclu',songs:artist.data.EXCLUSIVE_TRACKS,id:artist.id,scrollInfinite:false});}else{$('#naboo_artist_exclu').parent().remove();}
if(typeof(artist.data.SELECTED_PLAYLIST)=='undefined'||artist.data.SELECTED_PLAYLIST.count==0){$('#naboo_artist_selected_playlist').remove();}else{var playlist=trad.music.naboo_playlist_selected;if(artist.data.SELECTED_PLAYLIST.count>1){playlist=trad.music.naboo_playlists_selected;}
$('#naboo_artist_selected_playlist h3').text(playlist);}
if($('#naboo_artist_head').width()<=770){artist.adjustContent();}
Events.unsubscribe(Events.layout.adsBackground,artist.adjustContent);Events.subscribe(Events.layout.adsBackground,artist.adjustContent);Events.ready(Events.user.userReady,function(){Events.unsubscribe(Events.user.addFavorite,artist.changeFavoriteStatus);Events.subscribe(Events.user.addFavorite,artist.changeFavoriteStatus);Events.unsubscribe(Events.user.deleteFavorite,artist.changeFavoriteStatus);Events.subscribe(Events.user.deleteFavorite,artist.changeFavoriteStatus);});Events.unsubscribeAll('TABS');Events.addEvent('TABS',Events.tabs.open,artist.selectTab);var address=$.address.value();var parts=address.split('#');if(typeof(parts[1])!=='undefined'){var tab=parts[1];var allowed_tabs=['discography','related','review','video','biography'];if($.inArray(tab,allowed_tabs)!==-1){loadTab(tab);}}}catch(e){console.log(e.message,e.stack);}},changeFavoriteStatus:function(evt,params){try{if(params.type=='artist'&&params.ART_ID==artist.id){favorite.display($('#naboo_artist_favorite_link'),{type:'artist',ART_ID:artist.id,ART_NAME:artist.data.DATA.ART_NAME,SMARTRADIO:((artist.data.SMARTRADIO)?'1':'0')});}}catch(e){console.log(e.message,e.stack);}},adjustContent:function(){try{if(artist.displayExtended){artist.contentPlaylist.hide();}}catch(e){console.log(e.message,e.stack);}},display:function(page,seo_data){try{paths=page.split('/');artist.id=0;if(typeof(paths[1])!='undefined'&&paths[1]!=null&&paths[1]!=''){artist.id=paths[1];}
artist.tabs_loaded={};if(typeof(seo_data)!='undefined'){artist.drawHeader(seo_data);}else{var params={art_id:artist.id,lang:SETTING_LANG,start:0,nb:10};api.call('deezer_pageArtist',params,artist.drawHeader,'major_pages');}
return true;}catch(e){console.log(e);}},drawHeader:function(request){try{if(request==false||request==null){return false;}
if(typeof(request.results)!='undefined'&&typeof(request.error)!='undefined'){request=request.results;}
if(request.DATA==null){return false;}
template.load('naboo/artist',$('#naboo_content'));artist.init(request);loadTab('discography',artist.data.ALBUMS);if(typeof(artist.data.DATA.ART_NAME)!='undefined'){$('#naboo_artist_name').text(artist.data.DATA.ART_NAME);}
var art_banner=typeof(artist.data.DATA.DATA)!='undefined'&&typeof(artist.data.DATA.DATA.ART_BANNER)!='undefined'&&artist.data.DATA.DATA.ART_BANNER!=''&&artist.data.DATA.DATA.ART_BANNER!=null?artist.data.DATA.DATA.ART_BANNER:'';var art_banner_align=typeof(artist.data.DATA.DATA)!='undefined'&&typeof(artist.data.DATA.DATA.ART_BANNER_ALIGN)!='undefined'&&artist.data.DATA.DATA.ART_BANNER_ALIGN!=''?artist.data.DATA.DATA.ART_BANNER_ALIGN:'center';var art_banner_bgcolor=typeof(artist.data.DATA.DATA)!='undefined'&&typeof(artist.data.DATA.DATA.ART_BANNER_BGCOLOR)!='undefined'&&artist.data.DATA.DATA.ART_BANNER_BGCOLOR!=''?artist.data.DATA.DATA.ART_BANNER_BGCOLOR:'#000';var imagePath=artist.data.DATA.ART_PICTURE+'/200x200-000000-80-0-0.jpg';if(art_banner!=''){imagePath=art_banner+'/230x1800-000000-80-0-0.jpg';$('#naboo_artist_image').addClass('position-'+art_banner_align);$('#naboo_artist_image').css({'backgroundColor':art_banner_bgcolor,'backgroundImage':'url(\''+SETTING_DOMAIN_IMG+'/artist/'+imagePath+'\')'});}else{$('#naboo_artist_image').attr('src',SETTING_DOMAIN_IMG+'/artist/'+imagePath);}
$('#naboo_artist_head_smartradio > a').attr('onClick','loadBox(\'radio/artist-'+artist.id+'\'); return false;');$('#naboo_artist_head_smartradio').css('display','inline-block');if(typeof(artist.data.SMARTRADIO)=='undefined'||artist.data.SMARTRADIO=="0"){$('#naboo_artist_head_smartradio').css('display','none');}
if(typeof(artist.data.BIO)!='undefined'&&typeof(artist.data.BIO.RESUME)!='undefined'&&typeof(artist.data.BIO.BIO)!='undefined'){var $bio_premium=$('#naboo_artist_biography_resume_premium');var $bio_free=$('#naboo_artist_biography_resume');if(typeof(USER)!=='undefined'&&USER.OPTIONS.ads_display===false){$bio_free.hide();if(artist.data.BIO.RESUME!=null){$('span',$bio_premium).text(artist.data.BIO.RESUME+'... ');$('a',$bio_premium).attr('onClick',"loadTab(\'biography\'); return false;").text(trad.music.naboo_artist_all_bio);$bio_premium.show();}else{$bio_premium.hide();}}else{$bio_premium.hide();var bio=artist.data.BIO.RESUME;if(artist.data.BIO.RESUME!=null){if(!artist.displayExtended){bio=bio.substr(0,bio.length/2);}
$('span',$bio_free).text(bio+'... ');$('a',$bio_free).attr('onClick',"loadTab(\'biography\'); return false;");$bio_free.show();}else{$bio_free.hide();}}
artist.drawBiographyContent(artist);}else{$('#naboo_artist_biography_resume').css('display','none');$('#naboo_artist_biography_resume_premium').css('display','none');}
if(typeof(artist.data.SELECTED_PLAYLIST)!='undefined'&&artist.data.SELECTED_PLAYLIST.count>0){artist.drawPlaylist(artist.data.SELECTED_PLAYLIST);}
if(typeof(artist.data.FANS)!='undefined'&&artist.data.FANS.count>0){artist.drawFan(artist.data.FANS);}
if(typeof(artist.data.DATA.STATUS)!='undefined'&&artist.data.DATA.STATUS.status!=''){$('#naboo_artist_status').show().children('.artist_status').children('p').text(artist.data.DATA.STATUS.status);$('#naboo_artist_status > span').attr('data-timestamp',artist.data.DATA.STATUS.date);}else{$('#naboo_artist_status').hide();}
artist.drawSocialNetwork();naboo.afterLoad(true);live.deleteChannel(live.lastFeed);window.clearTimeout(live.timeoutConnect);live.lastFeed='-1_0_ARTISTFEED_'+artist.id;live.timeoutConnect=window.setTimeout(function(){live.addChannel(live.lastFeed);},3000);Events.trigger(Events.artist.displayed,{id:artist.id});return true;}catch(e){console.log(e.message,e.stack);}},drawBiographyContent:function(artist){try{if(typeof(artist.data.BIO)!='undefined'){$('#tab_biography_content .naboo_artist_biography_content_photo img').attr('src',SETTING_DOMAIN_IMG+'/artist/'+artist.data.DATA.ART_PICTURE+'/200x200-000000-80-0-0.jpg');if(typeof(artist.data.BIO.RESUME_FULL)!='undefined'){$('#tab_biography_content .naboo_artist_biography_content_message').html('<b>'+artist.data.BIO.RESUME_FULL+'</b><br/>'+artist.data.BIO.BIO);}else{$('#tab_biography_content .naboo_artist_biography_content_message').html(artist.data.BIO.BIO);}}}catch(e){console.log(e.message,e.stack);}},drawPlaylist:function(data){try{if(data.total==0){return true;}
display_line=$('<p></p>');for(var i in data.data){display_line.append(artist.appendPlaylist(data.data[i]));}
$('div:eq(0)',artist.contentPlaylist).prepend(display_line.children());}catch(e){console.log(e.message,e.stack);}},appendPlaylist:function(playlist){try{$item=artist.modelePlaylist.clone().show();$('.cover > a',$item).attr({'href':'/playlist/'+playlist.PLAYLIST_ID,'data-playlist-id':playlist.PLAYLIST_ID});$('.cover > a > img:eq(1)',$item).attr('src',SETTING_DOMAIN_IMG+'/'+playlist.PICTURE_TYPE+'/'+playlist.PLAYLIST_PICTURE+'/134x134-000000-80-0-0.jpg');$('.label a',$item).attr({'href':'/playlist/'+playlist.PLAYLIST_ID,'data-playlist-id':playlist.PLAYLIST_ID}).text(playlist.TITLE);return $item;}catch(e){console.log(e.message,e.stack);}},drawFan:function(data){try{if(data.total==0){return true;}
if(USER.OPTIONS.ads_display){var art_nb_fan=parseInt(artist.data.DATA.NB_FAN);var txt_fan=(art_nb_fan>1)?trad.music.naboo_fans:trad.music.naboo_fan;if(isNaN(art_nb_fan)||art_nb_fan==0){$('a:eq(0)',artist.contentSocialNetworkSmall).hide();}else{$('a:eq(0)',artist.contentSocialNetworkSmall).show().html('<span>'+breakUpThousands(art_nb_fan)+'</span> '+txt_fan+' | ');}
artist.contentFan.hide();return false;}
display_line=$('<p></p>');for(var i in data.data){display_line.append(artist.appendFan(data.data[i]));}
$('ul',artist.contentFan).append(display_line.children());$('strong',artist.contentFan).text(breakUpThousands(artist.data.DATA.NB_FAN)+' '+((parseInt(artist.data.DATA.NB_FAN)>1)?trad.music.naboo_fans:trad.music.naboo_fan));}catch(e){console.log(e.message,e.stack);}},appendFan:function(fan){try{$item=artist.modeleFan.clone().show();$('a',$item).attr({'href':'/profile/'+fan.USER_ID,'data-user-name':fan.BLOG_NAME,'data-user-id':fan.USER_ID});$('a > img',$item).attr('src',SETTING_DOMAIN_IMG+'/user/'+fan.USER_PICTURE+'/30x30-000000-80-0-0.jpg');return $item;}catch(e){console.log(e.message,e.stack);}},drawSocialNetwork:function(){try{var currentView=artist.contentSocialNetworkSmall;if(!USER.OPTIONS.ads_display){currentView=artist.contentSocialNetworkBig}
if(typeof(artist.data.DATA.FACEBOOK)!='undefined'&&artist.data.DATA.FACEBOOK.substr(0,4)=='http'){$('a.fb',currentView).show().attr('href',artist.data.DATA.FACEBOOK);$('span',artist.contentSocialNetworkSmall).show();}else{$('a.fb',currentView).hide();}
if(typeof(artist.data.DATA.TWITTER)!='undefined'&&artist.data.DATA.TWITTER.substr(0,4)=='http'){$('a.tw',currentView).show().attr('href',artist.data.DATA.TWITTER);$('span',artist.contentSocialNetworkSmall).show();}else{$('a.tw',currentView).hide();}}catch(e){console.log(e.message,e.stack);}},selectTab:function(evt,params){try{infinite_scroll.disable();if(artist.tabs_loaded[params.tab_id+'_'+artist.id]===true){if(typeof(window[params.tab_id].activeScroll)=='function'){window[params.tab_id].activeScroll(params.options);}
return true;}
showLoading();if(params.tab_id=='discography'){discography.getList('artist',artist.id,0,params.options);}else if(params.tab_id=='review'){review.getList('artist',artist.id,0);}else if(params.tab_id=='related'){related.getList('artist',artist.id,0);}else if(params.tab_id=='video'){video_list.getList('artist',artist.id,0);}else if(params.tab_id=='biography'){hideLoading();}
return true;}catch(e){console.log(e.message,e.stack);}},setShare:function(id){try{$("#naboo_artist_head_share a").attr('onClick','sharebox.load(2, '+id+'); return false;');return true;}catch(e){console.log(e);}}};};
if(typeof(app)=="undefined"){var app={actual_page:null,last_page:null,base_page:null,loaded:false,iframe:null,url_id:null,alias:null,sendRequest:function(user_id_to,app_id,message){console.log("MESSAGE",message);api.call('application.sendRequest',{user_ids_to:[user_id_to],app_id:app_id,message:message},function(request){if(typeof(request.error.length)!='undefined'&&request.error.length===0){$.facebox.close(true);}
$.facebox.close(false);});},displayLogin:function(page){try{var page_splitted=page.split('?');var request={};if(page_splitted.length>=2){var search=page_splitted[1];search=search.split("&");for(var i=0;i<search.length;i++){var param=search[i].split('=');if(param.length==2){request[param[0]]=param[1];}}}
if(typeof(request.app_id)=='undefined'){throw'error';}
api.call('application_getPublicData',{app_id:request.app_id},function(response){if(!$.isEmptyObject(response.error)){app.redirect_appstudio();return false;}
var appli=response.results;template.load('app/login',$('#naboo_content'));$('#app_picture').attr('src',SETTING_DOMAIN_IMG+'/misc/'+appli.APP_PICTURE+'/120x120-000000-80-0-0.jpg');$("#app_name").text(appli.NAME);$("#h2_app_name").text(appli.NAME);$("#app_description").text(appli.DESCRIPTION);var redirect_link='app/'+appli.APP_ID;if(typeof(request.redirect_link)!='undefined'){redirect_link=decodeURIComponent(request.redirect_link);}
redirect_link=encodeURIComponent(redirect_link);$("#btn_login").click(function(){modal.open('/'+SETTING_LANG+'/login.php?redirect_type=page&redirect_link='+redirect_link);}).attr('onclick','');$("#btn_register").click(function(){modal.open('/'+SETTING_LANG+'/register.php?redirect_type=page&redirect_link='+redirect_link);}).attr('onclick','');naboo.afterLoad(true);});return true;}catch(e){app.redirect_appstudio();return false;}},redirect_appstudio:function(){window.setTimeout(function(){loadBox('appstudio');},300);},display:function(page){var page_splitted=page.split('?');var path=page_splitted[0].split('/');var app_id=path[1];if(app_id=='login'){app.displayLogin(page);return true;}
var deep_url=path.slice(2).join('/');if(page_splitted.length>1){var search=page_splitted[1];search=search.split("&");for(var i=0;i<search.length;i++){var param=search[i].split('=');if(param.length==2&&param[0]=='dzq'){deep_url+="?"+hex2bin(param[1]);break;}}}
api.call('application_getPublicData',{app_id:app_id},function(request){if(!$.isEmptyObject(request.error)){app.launchError();return false;}
var application=request.results;if(app_id==application.INAPP_ALIAS){app.url_id=application.INAPP_ALIAS;}else{app.url_id=app_id;}
app.launch({app_data:application,deep_link:deep_url});});},filterDzParams:function(query_string){var filter=['dzpage','dzlang','dzcountry','dzhash'];var qs=query_string.split('&');query_string=[];for(var i=0;i<qs.length;i++){var filter_this=false;for(var j=0;j<filter.length;j++){if(qs[i].substr(0,filter[j].length+1)==filter[j]+'='){filter_this=true;break;}}
if(filter_this){continue;}
query_string.push(qs[i]);}
return query_string.join('&');},setPage:function(page){if(typeof(page)=='object'&&typeof(page.href)!='undefined'){if(typeof(page.pathname)!='undefined'){var dzq="";if(page.search!==''){dzq=page.search.substr(1);dzq=app.filterDzParams(dzq);if(dzq!==''){dzq="?dzq="+bin2hex(dzq);}}
var a=document.createElement('a');a.href=app.app_data.INAPP_URL_WEB;page.pathname=ltrim(page.pathname,'/');var new_page_link;if(app.loadPageMode=='ajax'){new_page_link='/'+page.pathname;}else{var origin=app.app_data.INAPP_URL_WEB.split(a.host)[0]+a.host+'/'+page.pathname;new_page_link='/'+origin.substr(app.app_data.INAPP_URL_WEB.length);}
new_page_link+=dzq;app.actual_page=new_page_link;var actual_page=trim($.address.value(),'/ ');new_page_link=trim(new_page_link,"/");var address='app/'+app.url_id+'/'+new_page_link;if(actual_page!=address){$.address.value(address);}}
return;}},loadPageMode:'basic',loadPage:function(page){if(!app.loaded){return false;}
if(app.actual_page!="/"+page){app.actual_page="/"+page;var loadPage=app.actual_page;if(app.actual_page.indexOf('?')!=-1){var url=app.actual_page.split('?');var qs=url[1].split('&');var dzq=null;for(var i=0;i<qs.length;i++){if(qs[i].substr(0,4)=='dzq='){dzq=qs[i].substr(4);break;}}
if(dzq!==null){loadPage=url[0]+'?'+hex2bin(dzq);}}
if(app.loadPageMode=='ajax'){DZ.communication.callAppMethod("DZ.navigation.pageChanged",{evt:'PAGE_CHANGED',val:loadPage});}else{app.loadIframe(loadPage);}}},clear:function(evt,page){page=page.split('/');if(page.length>1&&page[0]=='app'&&page[1]==app.url_id){return false;}
DZ.clearDeezer();if(app.iframe!==null){app.iframe.attr('id','dzapp_old').attr('name','dzapp_old').remove();}
dzPlayer.setApp({id:0,type:''});playercontrol.setBlindTestMode(false);app.current_height=0;app.app_id=0;app.alias=null;app.name="";app.channel_url='';app.url_id=null;app.launch_options={};app.actual_page=null;app.loadPageMode='basic';app.last_page=null;app.base_page=null;app.loaded=false;},app_id:0,userDataLoaded:function(){if(!userData.isFavorite('application',app.app_id)){if(typeof(USER)!='undefined'&&typeof(USER.SETTING)!='undefined'){app.addToFav.show();}}},launch_options:{},launch:function(options){var the_app_id=options.app_data.APP_ID;var newNotifs=notifications.list_unread;var to_remove=[];for(var key in newNotifs){var notif=newNotifs[key];if(typeof(notif.ACTION)!='undefined'&&notif.ACTION=="APPLICATION_NOTIFICATION"&&typeof(notif.APP_ID)!='undefined'){if(notif.APP_ID==the_app_id){to_remove.push(key);}}}
notifications.read(to_remove);var application=options.app_data;if(USER.USER_ID===0&&application.NEED_LOGIN){naboo.afterLoad(true);var base_href=(options.app_data.INAPP_ALIAS===''?options.app_data.APP_ID:options.app_data.INAPP_ALIAS);var link=document.createElement('a');link.href="/app/"+base_href+decodeURIComponent(options.deep_link);var dzq=link.search.substr(1);dzq=app.filterDzParams(dzq);if(dzq!==''){dzq="?dzq="+bin2hex(dzq);}
link=encodeURIComponent(link.pathname.substr(1)+dzq);window.setTimeout(function(){loadBox('app/login?app_id='+options.app_data.APP_ID+"&redirect_link="+link);},300);return false;}
Events.subscribeOnce(Events.navigation.page_changed,app.clear);app.app_data=options.app_data;options={app_id:options.app_data.APP_ID,alias:options.app_data.INAPP_ALIAS,channel_url:options.app_data.INAPP_CHANNEL_URL,name:options.app_data.NAME,deep_link:typeof(options.deep_link)=='undefined'?null:options.deep_link};if(options.deep_link===null){delete options.deep_link;}
if(typeof(DZ)!='undefined'){DZ.inapploadedCount=0;}
if(naboo.set_via_seo!==true){return false;}
if(typeof(options.deep_link)!='undefined'){options.deep_link=decodeURIComponent(options.deep_link);}
if(typeof(options.deep_link)=='undefined'||options.deep_link=='/'){options.deep_link='';}
if(options.deep_link!==''){var deep_link=options.deep_link.split('?');if(deep_link.length>1){deep_link[1]=app.filterDzParams(deep_link[1]);options.deep_link=deep_link.join('?');}}
app.launch_options=options;app.app_id=options.app_id;app.alias=options.alias;app.channel_url=options.channel_url;app.name=options.name;app.base_page='app/'+options.app_id+options.deep_link;app.actual_page=options.deep_link;getScripts(ressources.dz,function(){app.loadDom();app.loadDZ();app.loadIframe(options.deep_link);});Events.ready(Events.menu.loaded,function(){menu.setCurrentApplication({APP_ID:app.app_id,NAME:app.name,APP_PICTURE_16x16:app.app_data.APP_PICTURE_16x16,INAPP_ALIAS:app.app_data.INAPP_ALIAS});menu.selectItem('application',app.app_id);});naboo.afterLoad(true);app.loaded=true;return true;},launchError:function(from_seo){if(typeof(from_seo)!='boolean'){from_seo=false;}
window.setTimeout(function(){loadBox('appstudio');},300);if(!from_seo){template.load('naboo/app',$('#naboo_content'));}
$("#app_error").show();naboo.afterLoad(true);},loadDZ:function(){if(ENV=='DEV'){DZ.SETTING_HOST_SITE=SETTING_HOST_SITE;DZ.SETTING_HOST_CONNECT=SETTING_HOST_CONNECT;DZ.SETTING_HOST_API=SETTING_HOST_API;DZ.DEBUG=true;}
if(ENV=='PREPROD'){DZ._override_pp();}
DZ.init({appId:app.app_id,channelUrl:app.channel_url,inapp:true});},loadDom:function(){var naboo=$("#naboo_content");naboo.html('');naboo.append('<div id="dz-root"></div>');var draggable=$('<div id="inapp_draggable_element"></div>');naboo.append(draggable);app.addToFav=$('<span class="inapp_add_favorite">+</span>');$("#inapp_draggable_element").draggable({helper:function(){return'<div class="inapp_draggable_helper">music draggable !</div>';},appendTo:'body',refreshPositions:true,cursorAt:{top:0,left:0},start:function(event,ui){$('#inapp_draggable_element').attr({'data-value':JSON.stringify([[$("#inapp_draggable_element").attr('data-id'),'0']]),'element-type':'0'});}});var container=$("<div id='inapp_iframe_container'></div>");app.addToFav.hide().click(function(){tracking.track('app_add_favorite',{app_id:app.app_id,source:'plus_btn'});favorite.add({type:'application',APP_ID:app.app_id,NAME:app.name,INAPP_ALIAS:app.app_data.INAPP_ALIAS,APP_PICTURE_16x16:app.app_data.APP_PICTURE_16x16});}).appendTo(container).tipsy({gravity:'e',offset:-30,delayIn:0,delayOut:0}).attr('original-title',trad.general.add_app).tipsy('hide');Events.ready(Events.user.userReady,app.userDataLoaded);Events.addEvent('DZ',Events.user.addFavorite,function(evt,params){if(params.APP_ID==app.app_id){app.addToFav.hide();}});Events.addEvent('DZ',Events.user.deleteFavorite,function(evt,params){if(params.APP_ID==app.app_id){app.addToFav.show();}});container.append("<div id='inapp_iframe_overlay'></div>");naboo.append(container);return true;},onResize:function(evt,args){app.setSize(0,true);},nbIframes:0,loadIframe:function(deep_link){app.nbIframes++;if(typeof(deep_link)=='undefined'||deep_link===null){deep_link='';}
deep_link=ltrim(deep_link,'/ ');if(deep_link===''&&typeof(DZ)!='undefined'){DZ.inapploadedCount=0;}
var container=$("#inapp_iframe_container");var iframe_url=SETTING_HOST_SITE+'/'+SETTING_LANG+'/app/launcher.php?app_id='+app.app_id+'&inapp_page='+encodeURIComponent(deep_link);var iframe=$("#dzapp"+(app.nbIframes-1));if(iframe.length>0){iframe.remove();}
app.iframe=$('<iframe id="dzapp'+app.nbIframes+'" name="dzapp'+app.nbIframes+'" frameBorder="0" allowTransparency="true" src="'+iframe_url+'" '+' style="width:100%;height:100%;border: 0;"'+'></iframe>');container.append(app.iframe);},current_height:0,setSize:function(height,fromResize){return true;fromResize=typeof(fromResize)=='undefined'?false:true;var documentHeight=$(document.body).outerHeight(true);height=Math.max(documentHeight,height);if(fromResize){height=Math.max(app.current_height,height);}
app.iframe.css('height',height+'px');app.current_height=height;return true;},scrollTop:function(){$(document.body).scrollTop(0);},hideInappOverlay:function(){$("#inapp_iframe_overlay").hide();window.setTimeout(function(){$(document).unbind('mouseup',app.hideInappOverlay);},0);},showInappOverlay:function(){$("#inapp_iframe_overlay").show();$(document).bind('mouseup',app.hideInappOverlay);},startDragElement:function(type,id){$("#inapp_iframe_overlay").show();$(document).bind('mouseup',app.hideInappOverlay);var evt=document.createEvent("MouseEvents");evt.initMouseEvent("mousedown",true,true,window,0,0,0,0,0,false,false,false,false,0,null);var element=document.getElementById('inapp_draggable_element');var data_type=0;switch(type){case'track':data_type=0;break;default:break;}
$(element).attr('data-type',data_type).attr('data-id',id);element.dispatchEvent(evt);}};};
var appstudio={display:function(page){getScripts([[SETTING_STATIC+'/css/appstudio-v'+STATIC_VERSION+'.css','css']],function(){api.call('deezer_pageAppstudio',{},appstudio.displayCallback,{});});},categories:['curators','labels','tools','discovery','games','events'],getCatKey:function(cat_id){if(typeof(appstudio.categories[cat_id])=='undefined'){return"";}
return appstudio.categories[cat_id];},getCatName:function(cat_id){if(typeof(appstudio.categories[cat_id])=='undefined'){return"";}
return appstudio.categories_name[appstudio.categories[cat_id]];},getImgLink:function(md5,size){return SETTING_DOMAIN_IMG+"/misc/"+md5+"/"+size+"-ffffff-90-1-1.jpg";},displayCallback:function(request){if(request===false||request===null){return false;}
if(typeof(request.results)=='undefined'||typeof(request.results.apps)=='undefined'||typeof(request.results.visio)=='undefined'){return false;}
template.load('naboo/appstudio',$('#naboo_content'));var apps_list=[request.results.visio,request.results.apps];var showcase=$('.showcase');var applist=$(".applications .applist_container",showcase);var app_tpl=$(".application",applist).remove();for(var k=0;k<apps_list.length;k++){var apps=apps_list[k];var html_apps=[];for(var i=0;i<apps.length;i++){var $app=app_tpl.clone();var app=apps[i];app.LINK=(app.INAPP_ALIAS===''?app.APP_ID:app.INAPP_ALIAS);var app_img;if(k===0){app_img=appstudio.getImgLink(app.APP_PICTURE_950x320,'160x475');}else{app_img=appstudio.getImgLink(app.APP_PICTURE_220x140,'140x220');}
var cat_name=appstudio.getCatKey(app.CATEGORY);$app.addClass(cat_name).find('.meta_name').html(appstudio.getCatName(app.CATEGORY));$app.find('.app_name').html(app.NAME);$app.find('.app_description .tinyscroll_overview').html(app.DESCRIPTION);$app.find('.app_img img').attr('src',app_img);var links=[];var meta_links=[];if(app.INAPP_STATUS=='2'){links.push('<li><a href="'+SETTING_HOST_SITE+'/app/'+app.LINK+'" target="_blank" onclick="tracking.track(\'appstudio_app_click\', {app_id:'+app.APP_ID+', app_name:\''+escape(app.NAME)+'\', type:\'inapp\', source:\'btn\', category:\''+cat_name+'\'}); appstudio.goToApp(\''+app.LINK+'\', '+(app.NEED_LOGIN?'true':'false')+');return false;">'+appstudio_trad.app_deezer+'</a></li>');meta_links.push('<a href="'+SETTING_HOST_SITE+'/app/'+app.LINK+'" target="_blank" onclick="tracking.track(\'appstudio_app_click\', {app_id:'+app.APP_ID+', app_name:\''+escape(app.NAME)+'\', type:\'inapp\', source:\'icon\', category:\''+cat_name+'\'});appstudio.goToApp(\''+app.LINK+'\', '+(app.NEED_LOGIN?'true':'false')+');return false;"><span class="icn_deezer"></span></a>');}else{if(app.SITE_URL!==''){links.push('<li><a href="'+app.SITE_URL+'" onclick="tracking.track(\'appstudio_app_click\', {app_id:'+app.APP_ID+', app_name:\''+escape(app.NAME)+'\', type:\'web\', source:\'btn\', category:\''+cat_name+'\'});" target="_blank">Web</a></li>');meta_links.push('<a href="'+app.SITE_URL+'" onclick="tracking.track(\'appstudio_app_click\', {app_id:'+app.APP_ID+', app_name:\''+escape(app.NAME)+'\', type:\'web\', source:\'icon\', category:\''+cat_name+'\'});" target="_blank"><span class="icn_web"></span></a>');}
if(app.APP_STORE_URL!==''){links.push('<li><a href="'+app.APP_STORE_URL+'" onclick="tracking.track(\'appstudio_app_click\', {app_id:'+app.APP_ID+', app_name:\''+escape(app.NAME)+'\', type:\'ios\', source:\'btn\', category:\''+cat_name+'\'});" target="_blank">iOS</a></li>');meta_links.push('<a href="'+app.APP_STORE_URL+'" onclick="tracking.track(\'appstudio_app_click\', {app_id:'+app.APP_ID+', app_name:\''+escape(app.NAME)+'\', type:\'ios\', source:\'icon\', category:\''+cat_name+'\'});" target="_blank"><span class="icn_ios"></span></a>');}
if(app.GOOGLE_PLAY_URL!==''){links.push('<li><a href="'+app.GOOGLE_PLAY_URL+'" onclick="tracking.track(\'appstudio_app_click\', {app_id:'+app.APP_ID+', app_name:\''+escape(app.NAME)+'\', type:\'android\', source:\'btn\', category:\''+cat_name+'\'});" target="_blank">Android Market</a></li>');meta_links.push('<a href="'+app.GOOGLE_PLAY_URL+'" onclick="tracking.track(\'appstudio_app_click\', {app_id:'+app.APP_ID+', app_name:\''+escape(app.NAME)+'\', type:\'android\', source:\'icon\', category:\''+cat_name+'\'});" target="_blank"><span class="icn_android_market"></span></a>');}}
$app.find('.button-container .block_available-links ul').append(links.join(''));$app.find('.meta_links').append(meta_links.join(''));html_apps.push($app.get(0).outerHTML);}
$(applist.get(k)).html(html_apps.join(''));}
naboo.afterLoad(true);appstudio.init();Events.ready(Events.menu.loaded,function(){menu.selectItem('appstudio',0);});},init:function(){appstudio.initApps();appstudio.initCategories();},goToApp:function(app_id,need_login){if(USER.USER_ID===0&&need_login){modal.open('/'+SETTING_LANG+'/login.php');return false;}
loadBox("app/"+app_id);},resizeTinyscrollbars_timeout:null,resizeTinyscrollbars:function(){if(appstudio.resizeTinyscrollbars_timeout!==null){window.clearTimeout(appstudio.resizeTinyscrollbars_timeout);appstudio.resizeTinyscrollbars_timeout=null;}
appstudio.resizeTinyscrollbars_timeout=window.setTimeout(function(){$(".app_description").each(function(){$(this).tinyscrollbar_update('relative');});},500);},initApps:function(){$('.app_description').each(function(){$(this).tinyscrollbar({extremePreventDefault:false});});$('.applist_container').each(function(i){if(i===0){$(this).coverPane({'max_line':1,'ratio':0.35,'cover_size':475,'padding':25,'between':20,'label_size':100,'onresize':function(){appstudio.resizeTinyscrollbars();}});}else{$(this).coverPane({'ratio':0.63,'cover_size':220,'padding':25,'between':20,'label_size':140,'onresize':function(){appstudio.resizeTinyscrollbars();}});}});$(".application .app_img").hover(function(){},function(){$(this).find('.block_available-links').hide();});$('.button-container').each(function(){var available_links=$(this).find('.block_available-links li');if(available_links.length==1){var button=$(this).find('.btn');button.find('.icon-arrow-filter-down').remove();button.css({'padding-right':'13px','text-align':'center'});button.click(function(){var link=available_links.find('a');var result_click=link.get(0).onclick();if(result_click!==false){window.open(link.attr('href'));}});}else{$(this).find('.btn').click(function(){$(this).parent().find('.block_available-links').slideToggle('fast');});}});$(".icn_deezer").tipsy({gravity:'e',fallback:appstudio_trad.available_inapp});$(".icn_web").tipsy({gravity:'e',fallback:appstudio_trad.available_web});$(".icn_ios").tipsy({gravity:'e',fallback:appstudio_trad.available_ios});$(".icn_android_market").tipsy({gravity:'e',fallback:appstudio_trad.available_android});},initCategories:function(){$(".app_cat_menu .menu_item").each(function(){$(this).click(function(){var id_cat=$(this).attr('id-cat');var app_list=$("#apps_container");if(id_cat=='all'){$(".app_cat_menu .menu_item").removeClass("app_disabled");$(".application",app_list).removeClass('app_disabled');return true;}
$(".app_cat_menu .menu_item").addClass("app_disabled");$(this).removeClass("app_disabled");$(".application",app_list).addClass('app_disabled');$(".application."+id_cat,app_list).removeClass('app_disabled');});});},openAppDetails:function(app_id){loadFacebox('/lightbox/app.php?app_id='+app_id);},actual_width:0,nb_apps:0,apps_container:null,big_apps:[],events_subscribed:false,subscribeEvents:function(){if(appstudio.events_subscribed){return false;}
appstudio.events_subscribed=true;Events.subscribe(Events.layout.resize,appstudio.redrawApps);},initCovers:function(){try{appstudio.actual_width=0;appstudio.nb_apps=0;appstudio.big_apps=[];appstudio.apps_container=$("#apps_container");appstudio.prepareListApp();appstudio.redrawApps();appstudio.subscribeEvents();}catch(e){console.log(e,e.stack);}},prepareListApp:function(){appstudio.apps_container.find('.application').each(function(i){var $this=$(this);if($this.is('.app_big')){var big_app={position_original:i,position:i,element:$this};appstudio.big_apps.push(big_app);}
appstudio.nb_apps=i+1;});},getNbAppsAfter:function(i){if(i>=appstudio.big_apps.length){return 0;}
var app=appstudio.big_apps[i];var nb_app_after=(appstudio.nb_apps-app.position-1);if(i+1<appstudio.big_apps.length){nb_app_after=appstudio.big_apps[i+1].position_original-app.position-1;}
return nb_app_after;},getNbAppsBefore:function(i){if(i>=appstudio.big_apps.length){return 0;}
var pos_before=0;if(i>0){pos_before=appstudio.big_apps[i-1].position+1;}
var pos=appstudio.big_apps[i].position;var nb_app_before=pos-pos_before;return nb_app_before;},redrawApps:function(){var container_width=appstudio.apps_container.width();var app_width=222;var app_margin=18;var app_cols=Math.floor((container_width+app_margin)/(app_width+app_margin));var new_width=app_cols*(app_width+app_margin)-app_margin;if(new_width==appstudio.actual_width){return false;}
appstudio.actual_width=new_width;for(var i=0;i<appstudio.big_apps.length;i++){appstudio.big_apps[i].position=appstudio.big_apps[i].position_original;var app=appstudio.big_apps[i];var nb_app_before=appstudio.getNbAppsBefore(i);var nb_app_after=appstudio.getNbAppsAfter(i);if(i%2==1){app.element.css({'float':'right'});}
if(i>0){nb_app_needed=((app_cols-2)*2);if(nb_app_before==nb_app_needed){continue;}else{if(nb_app_before<nb_app_needed){var decal=nb_app_needed-nb_app_before;console.log(i,'DECAL',decal,nb_app_needed,nb_app_before,nb_app_after);if(decal>=nb_app_after){app.position=app.position-nb_app_before;nb_app_after=appstudio.getNbAppsAfter(i);if(app_cols>4&&nb_app_after<(app_cols-4)*2){app.element.css({'float':'left'});}
continue;}
app.position=app.position+decal;nb_app_after=appstudio.getNbAppsAfter(i);console.log(i,'THE TESt',nb_app_after,((app_cols-2)*2));if(app_cols<=4&&nb_app_after<(app_cols-2)*2){app.element.css({'float':'left'});}
nb_app_before=0;}else{nb_app_before=nb_app_before-nb_app_needed;}}}
var lines=Math.ceil(nb_app_before/app_cols);var nb_app_needed=lines*app_cols-nb_app_before;if(nb_app_needed>(app_cols/2)){app.position=app.position-(app_cols-nb_app_needed);}else{app.position=app.position+nb_app_needed;}}
appstudio.apps_container.find('.application.app_big').remove();for(i=0;i<appstudio.big_apps.length;i++){var list_app=appstudio.apps_container.find('.application');var position=Math.min(appstudio.big_apps[i].position-1,list_app.length-1);console.log("INSERT AFTER",appstudio.big_apps[i].position,list_app.get(position));appstudio.big_apps[i].element.insertAfter($(list_app.get(position)));}
$(".applications",appstudio.apps_container).css({width:new_width+"px"});$(".applist_container",appstudio.apps_container).css({width:(new_width+app_margin)+"px"});$(".fluid_container").css({width:new_width+"px"});}};;
if(typeof folder=="undefined"){var folder={elements:[],current_element:0,init_data:{},folder_id:0,SONGS_MIN:40,display:function(page,template_js,folder_elements){try{var path=page.split('?');path=path[0].split('/');if(path[0]!='folder'||typeof(path[1])=='undefined'||path[1]==null||path[1]==''){return false;}
var folder_id=path[1];if(typeof(template_js)=='undefined'){template_js=true;}
folder.folder_id=folder_id;if(template_js){template.load('naboo/folder',$('#naboo_content'));name=folder.getFolderName(folder_id);$('#naboo_folder_title').text(name);$('#naboo_folder_action').attr("data-value",folder_id);advertising.call('folder',folder_id);}else{folder.elements=folder_elements;}
if(folder.elements.length>0){folder.init_data={count:0,total:0,data:[]};folder.current_element=0;folder.loadElementTracks(folder.displayCallback);}else{hideLoading();$('#naboo_folder_tracks').createDatagrid({type:'folder',id:folder.folder_id,songs:{total:0},externalLoadingDataClass:'folder'});}
menu.selectItem('folder',folder_id);return true;}catch(e){console.log(e);}},loadElementTracks:function(callBackFunction){try{if(folder.elements.length>=folder.current_element+1){element=folder.elements[folder.current_element];switch(element.TYPE){case"1":case"2":var params={playlist_id:encodeURIComponent(element.ELEMENT_ID),start:0,nb:1000,lang:encodeURIComponent(SETTING_LANG)};api.call('playlist_getSongs',params,callBackFunction);break;case"3":var params={alb_id:encodeURIComponent(element.ELEMENT_ID),start:0,nb:500,lang:encodeURIComponent(SETTING_LANG)};api.call('song_getListByAlbum',params,callBackFunction);break;}}
return true;}catch(e){console.log(e);}},displayCallback:function(request){try{if(request.error.length==0){folder.current_element++;folder.init_data.count+=request.results.count;$.merge(folder.init_data.data,request.results.data);if(folder.init_data.count<folder.SONGS_MIN&&!folder.isAllElementLoaded()){folder.loadElementTracks(folder.displayCallback);}else{if(folder.isAllElementLoaded()){folder.init_data.total=folder.init_data.count;}else{folder.init_data.total=100000;}
$('#naboo_folder_tracks').createDatagrid({type:'folder',id:folder.folder_id,songs:folder.init_data,externalLoadingDataClass:'folder'});hideLoading();}}
return true;}catch(e){console.log(e);}},isAllElementLoaded:function(){try{return(folder.current_element>=folder.elements.length);}catch(e){console.log(e);}},getFolderName:function(id){try{for(i=0;i<userData.data['FOLDERS'].total;i++){if(userData.data['FOLDERS'].data[i].FOLDER_ID==id){if(menu.getCountFolderElement(id)<userData.data['FOLDERS'].data[i].ELEMENTS.length){userData.data['FOLDERS'].data[i].ELEMENTS=menu.getDataElementInsideFoler(id);}
folder.elements=userData.data['FOLDERS'].data[i].ELEMENTS;return userData.data['FOLDERS'].data[i].NAME;}}
return"";}catch(e){console.log(e);}},editFolder:function(){try{folder_id=$('#naboo_folder_action').attr('data-value');$inputName=$('<input id="naboo_folder_title_input" class="naboo_folder_input_edit" type="text" name="" value="" maxlength="200" />');$inputName.attr({value:$.trim($("#naboo_folder_title").text()),name:$.trim($("#naboo_folder_title").text())});$("#naboo_folder_title").html($inputName);$("#naboo_folder_action").hide();$("#naboo_folder_edit_button").show();return true;}catch(e){console.log(e);}},editSubmit:function(){try{folder_id=encodeURIComponent($('#naboo_folder_action').attr('data-value'));name=$("#naboo_folder_title_input").val();if(name!=$("#naboo_folder_title_input").attr("name")){var params={folder_id:folder_id,name:name};api.call('music_updateFolder',params,folder.editSubmitCallback,{folder_id:folder_id});}
return true;}catch(e){console.log(e);}},editSubmitCallback:function(request,callbackParameters){try{if(request.error.length==0){Events.trigger(Events.folder.update,{folder_id:callbackParameters.folder_id,title:$("#naboo_folder_title_input").val()});folder.editCancel(true);}else{folder.editCancel(false);}
return true;}catch(e){console.log(e);}},editCancel:function(isAfterSave){try{$("#naboo_folder_title").text((isAfterSave)?$("#naboo_folder_title_input").val():$("#naboo_folder_title_input").attr('name'));$("#naboo_folder_action").show();$("#naboo_folder_edit_button").hide();return true;}catch(e){console.log(e);}},deleteFolder:function(){try{folder_id=encodeURIComponent($('#naboo_folder_action').attr('data-value'));Events.trigger(Events.folder.remove,{element_id:folder_id});return true;}catch(e){console.log(e);}}}};
if(typeof(menu)=="undefined"){var menu={loaded:false,user_menu_loaded:false,last_item_selected:$(''),sidebar_width:220,sidebar_width_default:220,folderStatus:{},openPlaylistInterval:{},NEW_PLAYLIST_ELEMENT:6,NEW_FOLDER_ELEMENT:5,FOLDER_ELEMENT:4,ALBUM_ELEMENT:3,PLAYLIST_FAV_ELEMENT:2,PLAYLIST_ELEMENT_CREATED:7,PLAYLIST_ELEMENT:1,APPLICATION_ELEMENT:8,load:function(){try{if(menu.loaded===true){if(!menu.isActiveSidebar()){menu.enableSidebar();}
return true;}
if(menu.loaded!=true){menu.loaded=true;menu.$naboo=$('#naboo');menu.$naboo_content=$('#naboo_content');menu.$naboo_menu=$('#naboo_menu');menu.$naboo_menu_loading=$('#naboo_menu_loading');menu.$naboo_menu_list_content=$('#naboo_menu_list_music');menu.$naboo_menu_list_content.tinyscrollbar();menu.$naboo_menu_library=$('#naboo_menu_list_library');menu.$naboo_menu_list_app=$('#naboo_menu_list_app .apps_folder');menu.$naboo_menu_create_block=$('#naboo_menu_create_block');menu.$naboo_menu_playlist=$('#naboo_menu_element_playlist').clone().removeClass('template');menu.$naboo_menu_playlist_fav=$('#naboo_menu_element_playlist_fav').clone().removeClass('template');menu.$naboo_menu_application_fav=$('#naboo_menu_element_application').clone().removeClass('template');menu.$naboo_menu_playlist_collab=$('#naboo_menu_element_playlist_collab').clone().removeClass('template');menu.$naboo_menu_album=$('#naboo_menu_element_album').clone().removeClass('template');menu.$naboo_menu_folder=$('#naboo_menu_element_folder').clone().removeClass('template');menu.$naboo_menu_new_playlist=$('#naboo_menu_element_new_playlist').clone().removeClass('template');menu.$naboo_menu_new_folder=$('#naboo_menu_element_new_folder').clone().removeClass('template');$('.template',menu.$naboo_menu_library).remove();$('.template',menu.$naboo_menu_list_app).remove();menu.$naboo_menu_library.attr('element-id','root').add('UL.contextMenu').bind('contextmenu',function(){return false;});menu.$naboo_menu_list_app.attr('element-id','root').add('UL.contextMenu').bind('contextmenu',function(){return false;});menu.$naboo_menu_list_links=$('#naboo_menu_list_links');menu.$naboo_menu_infos=$('#naboo_menu_infos');menu.$naboo_menu_list=$('#naboo_menu_list');menu.$naboo_menu_infos_cover=$('#naboo_menu_infos_cover');if(typeof(USER)=='undefined'||typeof(USER.SETTING)=='undefined'){$("#naboo_menu_list_app").hide();}
if(USER.USER_ID!==null&&USER.USER_ID>0){menu.displayLoadingInterval=setTimeout(function(){menu.$naboo_menu_library.append(menu.$naboo_menu_loading);},500);}
if(typeof(USER)!='undefined'&&USER.OPTIONS.ads_display===false){menu.resizeSidebar(menu.getSidebarWidth(true));}
if(typeof(dzPlayer)!='undefined'&&typeof(dzPlayer.getCover())!='undefined'&&dzPlayer.getCover()!==null){$("#naboo_menu_infos_cover").attr('src',SETTING_DOMAIN_IMG+'/cover/'+dzPlayer.getCover()+'/315x315-000000-80-0-0.jpg');}
if(typeof(dzPlayer)!='undefined'&&typeof(dzPlayer.songTitle)!='undefined'&&dzPlayer.songTitle!==null){$("#naboo_menu_infos_cover_text_track").text(dzPlayer.songTitle);}
if(typeof(dzPlayer)!='undefined'&&typeof(dzPlayer.artistName)!='undefined'&&dzPlayer.artistName!==null){$("#naboo_menu_infos_cover_text_artist").text(dzPlayer.artistName);}
menu.displayCover(true);$('#naboo_menu_create_folder').tipsy({gravity:'s',fallback:trad.music.naboo_menu_create_folder,force_top:true});}
Events.ready(Events.user.userReady,function(){menu.displayUserMenu();});Events.ready(Events.user.dataStoreReady,function(){menu.displayDownload();});menu.adjustUserMenu();return true;}catch(e){console.log(e.message,e.stack);}},displayUserMenu:function(){try{if(menu.user_menu_loaded){return false;}
menu.user_menu_loaded=true;if(dzoffline.AVAILABLE){Events.unsubscribe(Events.offline.elementDownloadStatus,menu.displayDownloadStatus);Events.subscribe(Events.offline.elementDownloadStatus,menu.displayDownloadStatus);}
Events.subscribe(Events.user.addFavorite,menu.addElement);Events.subscribe(Events.user.deleteFavorite,menu.deleteElement);Events.subscribe(Events.playlist.create,menu.addNewElement);Events.subscribe(Events.playlist.update,menu.updatePlaylist);Events.subscribe(Events.playlist.remove,menu.removePlaylist);Events.subscribe(Events.playlist.add,menu.addElement);Events.subscribe(Events.folder.create,menu.addNewElement);Events.subscribe(Events.folder.update,menu.updateFolder);Events.subscribe(Events.folder.remove,menu.removeFolder);Events.subscribe(Events.menu.contextMenu,menu.contextMenuClick);menu.folderStatus=(typeof(USER.SETTING.site.menu_folders)!='undefined')?JSON.parse(USER.SETTING.site.menu_folders):{};$folder=$('<p></p>');var folder;if(getObjectSize(userData.data.FOLDERS)>0&&userData.data.FOLDERS.count>0){for(var i=0;i<userData.data.FOLDERS.count;i++){$folder.append(menu.drawElement(menu.FOLDER_ELEMENT,userData.data.FOLDERS.data[i]));}}
$playlist=$('<p></p>');if(getObjectSize(userData.data.PLAYLISTS)>0&&userData.data.PLAYLISTS.count>0){for(var j=0;j<userData.data.PLAYLISTS.count;j++){if(typeof(userData.data.PLAYLISTS.data[j].TYPE)!='undefined'&&userData.data.PLAYLISTS.data[j].TYPE==4){continue;}
$elt=menu.drawElement(menu.PLAYLIST_ELEMENT,userData.data.PLAYLISTS.data[j]);folder=menu.isInsideFolder(menu.PLAYLIST_ELEMENT,userData.data.PLAYLISTS.data[j].PLAYLIST_ID);if(folder===0){$playlist.append($elt);}else{$folder.children('#naboo_menu_element_folder_'+folder).append($elt);}}}
$application_fav=$('<p></p>');if(getObjectSize(userData.data.FAVORITES_APPLICATIONS)>0&&userData.data.FAVORITES_APPLICATIONS.count>0){for(var k=0;k<userData.data.FAVORITES_APPLICATIONS.count;k++){$elt=menu.drawElement(menu.APPLICATION_ELEMENT,userData.data.FAVORITES_APPLICATIONS.data[k]);$application_fav.append($elt);}}
$playlist_fav=$('<p></p>');if(getObjectSize(userData.data.FAVORITES_PLAYLISTS)>0&&userData.data.FAVORITES_PLAYLISTS.count>0){for(var l=0;l<userData.data.FAVORITES_PLAYLISTS.count;l++){$elt=menu.drawElement(menu.PLAYLIST_FAV_ELEMENT,userData.data.FAVORITES_PLAYLISTS.data[l]);folder=menu.isInsideFolder(menu.PLAYLIST_FAV_ELEMENT,userData.data.FAVORITES_PLAYLISTS.data[l].PLAYLIST_ID);if(folder===0){$playlist_fav.append($elt);}else{$folder.children('#naboo_menu_element_folder_'+folder).append($elt);}}}
$album=$('<p></p>');if(getObjectSize(userData.data.FAVORITES_ALBUMS)>0&&userData.data.FAVORITES_ALBUMS.count>0){for(var m=0;m<userData.data.FAVORITES_ALBUMS.count;m++){$elt=menu.drawElement(menu.ALBUM_ELEMENT,userData.data.FAVORITES_ALBUMS.data[m]);folder=menu.isInsideFolder(menu.ALBUM_ELEMENT,userData.data.FAVORITES_ALBUMS.data[m].ALB_ID);if(folder===0){$album.append($elt);}else{$folder.children('#naboo_menu_element_folder_'+folder).append($elt);}}}
$playlist_child=$playlist.children();menu.$naboo_menu_library.append($playlist_child);$playlistfav_child=$playlist_fav.children();menu.$naboo_menu_library.append($playlistfav_child);$applicationfav_child=$application_fav.children();if(typeof(menu.folderStatus.f_apps)!='undefined'&&menu.folderStatus.f_apps=='close'){menu.$naboo_menu_list_app.parent().removeClass('folder_on').addClass('folder_off');menu.$naboo_menu_list_app.parent().children('.folder').children('span:eq(0)').removeClass('icn_folder_on').addClass('icn_folder_off');menu.$naboo_menu_list_app.parent().children('.folder').children('span:eq(2)').removeClass('icon-arrow-up').addClass('icon-arrow-down');}
menu.$naboo_menu_list_app.append($applicationfav_child);$album_child=$album.children();menu.$naboo_menu_library.append($album_child);$folder_child=$folder.children();menu.$naboo_menu_library.append($folder_child);menu.setDraggable($('.drag_item',menu.$naboo_menu_library));menu.setDroppableFolder($folder_child);menu.setDroppablePlaylist($("a[id^='naboo_menu_element_playlist_']",menu.$naboo_menu_library));menu.setDroppableRoot();$("div[id^='naboo_menu_element_folder_']",menu.$naboo_menu_library).each(function(index){var nbElement=menu.getFolderElement($(this).attr('element-id'));$(this).children('a:first').children('span:eq(1)').text($(this).attr('title')+nbElement);});if(typeof(USER)!='undefined'&&USER.OPTIONS.ads_display===false){menu.resizeSidebar(menu.getSidebarWidth(true));$('#naboo_menu_list').resizable({minWidth:220,maxWidth:315,handles:'e',resize:function(event,ui){if(ui.size.width!=null){menu.resizeSidebar(ui.size.width);}},start:function(event,ui){if(typeof(app)!='undefined'){app.showInappOverlay();}},stop:function(event,ui){if(ui.size.width!=null){menu.resizeSidebar(ui.size.width,true);}},create:function(event,ui){if(typeof(USER)!='undefined'&&USER.OPTIONS.ads_display==false){$('#naboo_menu_list').resizable('option','disabled',false);$('#naboo_menu_list .ui-resizable-e').css('cursor','e-resize');}}});}
menu.displayCover(true);if(dzoffline.AVAILABLE){dzoffline.openData();}
menu.$naboo_menu_loading.remove();clearInterval(menu.displayLoadingInterval);Events.resolve(Events.menu.loaded);Events.subscribe(Events.live.newNotif,function(evt,data){menu.dispatchNotification(data);});Events.subscribe(Events.live.readNotif,function(evt,data){menu.dispatchNotification(data,true);});menu.adjustUserMenu();return true;}catch(e){console.log(e.message,e.stack);}},dispatchNotification:function(data,remove){try{if(typeof(remove)!='boolean'){remove=false;}
switch(data.ACTION){case'APPLICATION_NOTIFICATION':menu.dispatchApplicationNotification(data,remove);break;default:return false;}
if(remove){console.log("HEYY there is a new notif to REMOVE !! ",data);}else{console.log("HEYY there is a new notif !! ",data);}}catch(e){console.log(e.message,e.stack);}},dispatchApplicationNotification:function(data,remove){try{if(typeof(remove)!='boolean'){remove=false;}
if(typeof(data.APP_ID)=='undefined'){return false;}
var $app=$("#naboo_menu_element_applicationfav_"+data.APP_ID);if($app.hasClass('current_application')){return false;}
var $bubble=$('.badge',$app);var nb_notif=parseInt($bubble.text(),10);nb_notif+=(remove?-1:1);$bubble.text(nb_notif);if(nb_notif>0){$bubble.show();}else{$bubble.hide();}}catch(e){console.log(e.message,e.stack);}},displayDownload:function(){try{if(((typeof(STORE_PLATEFORM)!='undefined')&&(STORE_PLATEFORM.DEEZER!==null))&&getObjectSize(userData.dataStore)>0){$("#naboo_menu_downloads").show();}else{$("#naboo_menu_downloads").hide();Events.subscribe(Events.store.buyFinish,function(){$("#naboo_menu_downloads").show();});}}catch(e){console.log(e.message,e.stack);}},scrollInterval:0,autoScroll:function(event,ui){try{var allowMoveToPlaylist=$(ui.helper).data('allow-move-to-playlist');if(allowMoveToPlaylist=='false')return false;if(ui.offset.left<=menu.sidebar_width){var hitZone=26;var pos=ui.offset.top-menu.$naboo_menu_list_content.offset().top;if((menu.$naboo_menu_list_content.height()-pos)<(hitZone*2)){if(menu.scrollInterval===0){menu.scrollInterval=setInterval(function(){if(menu.$naboo_menu_list_content.scrollPosition()+menu.$naboo_menu_list_content.height()>=menu.$naboo_menu_library.parent().height()){clearInterval(menu.scrollInterval);menu.scrollInterval=0;menu.$naboo_menu_list_content.tinyscrollbar_update('bottom');}else{var newPosition=menu.$naboo_menu_list_content.scrollPosition()+hitZone;menu.$naboo_menu_list_content.tinyscrollbar_update((newPosition>menu.$naboo_menu_library.height())?menu.$naboo_menu_library.height():newPosition,false);}},100);}}else if(pos<hitZone){if(menu.scrollInterval===0){menu.scrollInterval=setInterval(function(){if(menu.$naboo_menu_list_content.scrollPosition()>0){var newPosition=menu.$naboo_menu_list_content.scrollPosition()-hitZone;menu.$naboo_menu_list_content.tinyscrollbar_update((newPosition>=0)?newPosition:0,false);}else{clearInterval(menu.scrollInterval);menu.scrollInterval=0;}},100);}}else{clearInterval(menu.scrollInterval);menu.scrollInterval=0;}}else{clearInterval(menu.scrollInterval);menu.scrollInterval=0;}}catch(e){console.log(e.message,e.stack);}},setDraggable:function($item){try{$item.draggable({refreshPositions:true,cursor:"move",cursorAt:{top:14,left:-8},helper:function(event){if($(this).is('.folder')){return false;}
str=truncateTxt($(this).text(),30);return $("<div style=\"position:fixed;z-index:9001;background-color: #000; min-width:100px;overflow:hidden;height:15px;line-height:1.6em;padding:5px;color:#fff;font-size:11px;font-weight:bold;\">"+str+"</div>");},revert:"invalid",drag:menu.autoScroll});}catch(e){console.log(e.message,e.stack);}},setDroppableFolder:function($item){try{if($item.attr('id')=='naboo_menu_element_new_folder')return false;$item.droppable({accept:"a.item_album,a.item_playlist,a.item_playlist-fav, a.item_playlist-collab",hoverClass:"selected",greedy:true,drop:function(event,ui){menu.moveMenuElement($(this),ui.draggable);}});}catch(e){console.log(e.message,e.stack);}},setDroppableRoot:function(){try{menu.$naboo_menu_list_content.droppable({accept:"a.item_album,a.item_playlist,a.item_playlist-fav, a.item_playlist-collab",drop:function(event,ui){menu.moveMenuElement($(this).children('.tinyscroll_viewport').children(),ui.draggable);}});}catch(e){console.log(e.message,e.stack);}},setDroppablePlaylist:function($item){try{$item.droppable({accept:"tr",hoverClass:"selected",tolerance:"pointer",drop:function(event,ui){try{var allowMoveToPlaylist=$(ui.helper).data('allow-move-to-playlist');if(allowMoveToPlaylist=='false')return false;var trackList=$(ui.helper).data('value');if(typeof(trackList)!='object'||trackList.length===0)return false;var params={playlist_id:$(this).attr('element-id'),songs:trackList};api.call('playlist_addSongs',params,menu.onDropCallback,params);}catch(e){console.log(e.message,e.stack);}},over:function(event,ui){try{var allowMoveToPlaylist=$(ui.helper).data('allow-move-to-playlist');if(allowMoveToPlaylist=='false')return false;$(ui.helper).addClass('dropable');}catch(e){console.log(e.message,e.stack);}},out:function(event,ui){try{var allowMoveToPlaylist=$(ui.helper).data('allow-move-to-playlist');if(allowMoveToPlaylist=='false')return false;$(ui.helper).removeClass('dropable');}catch(e){console.log(e.message,e.stack);}}});}catch(e){console.log(e.message,e.stack);}},onDropCallback:function(request,callbackParameter){try{if(request.results===true){notification.display((callbackParameter.songs.length==1)?trad.player.confimAddTrackPlaylist:trad.player.confimAddTracksPlaylist,false,0,2500);dzoffline.elementChanged('playlist',callbackParameter.playlist_id);Events.trigger(Events.playlist.addSong,{playlist_id:callbackParameter.playlist_id});}else if(request.error.ERROR_PLAYLIST_FULL!=null){notification.display(trad.music.naboo_alert_limit_track,false,0,2500);}else if(request.error.ERROR_TRACK_EXISTS!=null){notification.display(trad.musicbox.track_exists,false,0,2500);}}catch(e){console.log(e.message,e.stack);}},moveMenuElement:function($target,$elt){try{if($target.attr('element-id')==$elt.parent().attr('element-id')){return false;}
var params={};var parentDirectoryId=0;if($target.is('.block_folder')){params={folder_id:$target.attr('element-id'),element_id:$elt.attr('element-id'),type:$elt.attr('element-type')};api.call('music_setFolderLink',params);menu.updateUserDataFolder($elt.attr('element-type'),$elt.attr('element-id'),$target.attr('element-id'),($elt.parent().attr('element-id')!='root'));parentDirectoryId=$elt.parent().attr('element-id');$insertElt=$elt.clone();setTimeout(function(){$elt.remove();if(parentDirectoryId!='root')menu.updateFolderCount(parentDirectoryId);menu.updateScrollContent();},1);menu.insertElement($insertElt.attr('element-type'),$insertElt.attr('element-id'),$insertElt);menu.updateFolderCount($target.attr('element-id'));$insertElt.contextMenu({menu:parseInt($insertElt.attr('element-type'),10)});if($elt.is('.selected')){menu.last_item_selected=$insertElt;}}else if($target.attr('element-id')=='root'){params={element_id:$elt.attr('element-id'),type:$elt.attr('element-type')};api.call('music_deleteFolderLink',params);menu.updateUserDataFolder($elt.attr('element-type'),$elt.attr('element-id'),0,($elt.parent().attr('element-id')!='root'));parentDirectoryId=$elt.parent().attr('element-id');$insertElt=$elt.clone();setTimeout(function(){$elt.remove();if(parentDirectoryId!='root')menu.updateFolderCount(parentDirectoryId);menu.updateScrollContent();},1);menu.insertElement($insertElt.attr('element-type'),$insertElt.attr('element-id'),$insertElt);menu.updateFolderCount($target.attr('element-id'));$insertElt.contextMenu({menu:parseInt($insertElt.attr('element-type'),10)});if($elt.is('.selected')){menu.last_item_selected=$insertElt;}}}catch(e){console.log(e.message,e.stack);}},updateUserDataFolder:function(type,element_id,folder_id,remove){try{if(typeof(remove)=='undefined')remove=true;if(getObjectSize(userData.data.FOLDERS)>0){if(remove){for(var i=0;i<userData.data.FOLDERS.count;i++){var data=userData.data.FOLDERS.data[i].ELEMENTS;for(var j=0;j<data.length;j++){if(data[j].ELEMENT_ID==element_id&&data[j].TYPE==type){userData.data.FOLDERS.data[i].ELEMENTS.splice(j,1);i=userData.data.FOLDERS.count;}}}}
if(folder_id>0){for(var k=0;k<userData.data.FOLDERS.count;k++){if(userData.data.FOLDERS.data[k].FOLDER_ID==folder_id){userData.data.FOLDERS.data[k].ELEMENTS.push({ELEMENT_ID:element_id,TYPE:type});}}}}}catch(e){console.log(e.message,e.stack);}},addNewElement:function(evt,renameElementId){try{if(OFFLINE)return false;var type='';switch(evt.namespace){case'PLAYLIST.create':type=menu.PLAYLIST_ELEMENT;$elt=menu.drawElement(menu.NEW_PLAYLIST_ELEMENT);$input=$elt.children('span:eq(1)').children('input');$input.keypress(function(e){switch(e.which){case 13:menu.createNewElement(type,$(this));break;}});$input.blur(function(){menu.createNewElement(type,$(this));});$input.click(function(){if($(this).val()==trad.music.naboo_new_playlist){$(this).val('');}});break;case'FOLDER.create':type=menu.FOLDER_ELEMENT;$elt=menu.drawElement(menu.NEW_FOLDER_ELEMENT);$input=$elt.children('.folder').children('input');$input.keypress(function(e){switch(e.which){case 13:menu.createNewElement(type,$(this));break;}});$input.blur(function(){menu.createNewElement(type,$(this));});$input.click(function(){if($(this).val()==trad.music.naboo_new_folder){$(this).val('');}});break;case'PLAYLIST.rename':type=menu.PLAYLIST_ELEMENT;$item=$('#naboo_menu_element_playlist_'+renameElementId).hide();$elt=menu.drawElement(menu.NEW_PLAYLIST_ELEMENT);$input=$elt.children('span:eq(1)').children('input');$input.val($item.children('span:eq(1)').text());$input.keypress(function(e){switch(e.which){case 13:menu.renamePlaylistAction($(this),renameElementId);break;}});$input.blur(function(){menu.renamePlaylistAction($(this),renameElementId);});$elt.insertAfter($item);$input.select();return false;case'FOLDER.rename':type=menu.FOLDER_ELEMENT;$item=$('#naboo_menu_element_folder_'+renameElementId);$item.children('.folder').hide();$elt=menu.drawElement(menu.NEW_FOLDER_ELEMENT).children('.folder');var editName=$item.attr('title');$input=$elt.children('input');$input.val(editName);$input.attr('data-name',editName);$input.keypress(function(e){switch(e.which){case 13:menu.renameFolderAction($(this),renameElementId);break;}});$input.blur(function(){menu.renameFolderAction($(this),renameElementId);});$item.prepend($elt);$input.select();return false;}
if(type>0){menu.insertElement(type,0,$elt);if(evt.namespace=='PLAYLIST.create'){if(menu.$naboo_menu_list_content.scrollPosition()>$elt.position().top||(menu.$naboo_menu_list_content.scrollPosition()+menu.$naboo_menu_list_content.height()<$elt.position().top))
menu.$naboo_menu_list_content.tinyscrollbar_update($elt.position().top);}else if(evt.namespace=='FOLDER.create'){menu.$naboo_menu_list_content.tinyscrollbar_update('bottom');}
$input.select();}}catch(e){console.log(e.message,e.stack);}},createNewElement:function(type,$elt){try{switch(type){case menu.PLAYLIST_ELEMENT:if($elt.val()!==''&&$elt.val()!=trad.music.naboo_new_playlist)
api.call('playlist_create',{title:$elt.val()},menu.createNewElementCallback,{title:$elt.val(),type:'playlist'});else
$('#naboo_menu_element_new_playlist').remove();break;case menu.FOLDER_ELEMENT:if($elt.val()!==''&&$elt.val()!=trad.music.naboo_new_folder){api.call('music_createFolder',{name:$elt.val()},menu.createNewElementCallback,{title:$elt.val(),type:'folder'});}else{$('#naboo_menu_element_new_folder').remove();menu.$naboo_menu_list_content.tinyscrollbar_update('bottom');}
break;}
$elt.remove();}catch(e){console.log(e.message,e.stack);}},createNewElementCallback:function(request,callbackparam){try{if(request.error.length===0){if(!isNaN(request.results)){if(callbackparam.type=='folder'){menu.addElement(null,{type:callbackparam.type,element_id:request.results,title:callbackparam.title});if(typeof(userData.data.FOLDERS.data)=='undefined'){userData.data.FOLDERS.data=[];userData.data.FOLDERS.total=0;userData.data.FOLDERS.count=0;}
userData.data.FOLDERS.data.push({ELEMENTS:[],FOLDER_ID:request.results,NAME:callbackparam.title});userData.data.FOLDERS.total++;userData.data.FOLDERS.count++;}else if(callbackparam.type=='playlist'){menu.addElement(null,{type:'playlist_new_created',PLAYLIST_ID:request.results,TITLE:callbackparam.title,PARENT_USER_ID:USER.USER_ID});Events.trigger(Events.playlist.created,{id:request.results,title:callbackparam.title});}}}
$('#naboo_menu_element_new_'+callbackparam.type).remove();menu.updateScrollContent();}catch(e){console.log(e.message,e.stack);}},addElement:function(evt,params){try{var type;switch(params.type){case'album':type=menu.ALBUM_ELEMENT;$elt=menu.drawElement(menu.ALBUM_ELEMENT,params);break;case'playlist_new_created':type=menu.PLAYLIST_ELEMENT_CREATED;$elt=menu.drawElement(type,params);break;case'playlist':type=(params.PARENT_USER_ID!=USER.USER_ID)?menu.PLAYLIST_FAV_ELEMENT:menu.PLAYLIST_ELEMENT;$elt=menu.drawElement(type,params);break;case'application':type=menu.APPLICATION_ELEMENT;$elt=menu.drawElement(type,params);break;case'folder':type=menu.FOLDER_ELEMENT;$elt=menu.drawElement(menu.FOLDER_ELEMENT,{FOLDER_ID:params.element_id,NAME:params.title});break;case'playlist_new':type=menu.PLAYLIST_ELEMENT;break;case'folder_new':type=menu.FOLDER_ELEMENT;break;default:return false;}
if(type!=menu.APPLICATION_ELEMENT){menu.insertElement(type,params.element_id,$elt);}else{menu.insertApplication(params.APP_ID,$elt);}
menu.updateScrollContent();return true;}catch(e){console.log(e.message,e.stack);}},deleteElement:function(evt,params){try{var deleteElementParent=[];switch(params.type){case'album':deleteElementParent=$('#naboo_menu_element_album_'+params.ALB_ID).parent();$('#naboo_menu_element_album_'+params.ALB_ID).remove();if(deleteElementParent.attr('element-id')!='root'){menu.updateUserDataFolder(menu.ALBUM_ELEMENT,params.ALB_ID,0,true,true);menu.updateFolderCount(deleteElementParent.attr('element-id'));}
break;case'playlist':var deleteElement=$('#naboo_menu_element_playlistfav_'+params.PLAYLIST_ID);if(deleteElement.length===0){deleteElement=$('#naboo_menu_element_playlist_collab_'+params.PLAYLIST_ID);}
deleteElementParent=deleteElement.parent();deleteElement.remove();if(deleteElementParent.attr('element-id')!='root'){menu.updateUserDataFolder(menu.PLAYLIST_FAV_ELEMENT,params.PLAYLIST_ID,0,true,true);menu.updateFolderCount(deleteElementParent.attr('element-id'));}
break;case'application':$('#naboo_menu_element_applicationfav_'+params.APP_ID).remove();break;}
menu.updateScrollContent();}catch(e){console.log(e.message,e.stack);}},drawElement:function(type,data){try{$elt='';switch(type){case menu.PLAYLIST_ELEMENT:case menu.PLAYLIST_ELEMENT_CREATED:$elt=menu.$naboo_menu_playlist.clone();$elt.attr({'id':'naboo_menu_element_playlist_'+data.PLAYLIST_ID,'element-id':data.PLAYLIST_ID,'title':data.TITLE}).children('span:eq(1)').text(data.TITLE);if(data.STATUS=='2'||data.STATUS=='3')
$elt.children('span:eq(0)').removeClass('icn_playlist').addClass('icn_playlist_col');break;case menu.PLAYLIST_FAV_ELEMENT:if(data.STATUS==2||data.STATUS==3){$elt=menu.$naboo_menu_playlist_collab.clone();$elt.attr({'id':'naboo_menu_element_playlist_collab_'+data.PLAYLIST_ID,'element-id':data.PLAYLIST_ID,'title':data.TITLE}).children('span:eq(1)').html(data.TITLE+' <em>'+trad.general.by+' '+data.PARENT_USERNAME+'</em>');}else{$elt=menu.$naboo_menu_playlist_fav.clone();$elt.attr({'id':'naboo_menu_element_playlistfav_'+data.PLAYLIST_ID,'element-id':data.PLAYLIST_ID,'title':data.TITLE}).children('span:eq(1)').html(data.TITLE+' <em>'+trad.general.by+' '+data.PARENT_USERNAME+'</em>');}
break;case menu.APPLICATION_ELEMENT:$elt=menu.$naboo_menu_application_fav.clone();$elt.attr({'id':'naboo_menu_element_applicationfav_'+data.APP_ID,'element-id':data.APP_ID,'element-alias':data.INAPP_ALIAS,'title':data.NAME}).find('.app_name').html(data.NAME);var img_url="bdadcdc3e96ba108f78a76f50df4351a/16x16-eff0f0-90-1-1.png";if(typeof(data.APP_PICTURE_16x16)!='undefined'&&data.APP_PICTURE_16x16!==''){img_url=data.APP_PICTURE_16x16+"/16x16-eff0f0-90-1-1.jpg";}
$elt.find('.icn img').attr('src',SETTING_DOMAIN_IMG+"/misc/"+img_url);if(typeof(data.CURRENT_APP)!='undefined'){return $elt;}
break;case menu.ALBUM_ELEMENT:$elt=menu.$naboo_menu_album.clone();$elt.attr({'id':'naboo_menu_element_album_'+data.ALB_ID,'element-id':data.ALB_ID,'title':data.ART_NAME+' - '+data.ALB_TITLE}).children('span:eq(1)').text(data.ART_NAME+' - '+data.ALB_TITLE);break;case menu.FOLDER_ELEMENT:$elt=menu.$naboo_menu_folder.clone();$elt.attr({'id':'naboo_menu_element_folder_'+data.FOLDER_ID,'element-id':data.FOLDER_ID,'title':data.NAME}).children('.folder').attr('element-id',data.FOLDER_ID).children('span:eq(1)').text(data.NAME+menu.getFolderElement(data.FOLDER_ID));if(typeof(menu.folderStatus['f_'+data.FOLDER_ID])!='undefined'&&menu.folderStatus['f_'+data.FOLDER_ID]=='close'){$elt.removeClass('folder_on').addClass('folder_off');$elt.children('.folder').children('span:eq(0)').removeClass('icn_folder_on').addClass('icn_folder_off');$elt.children('.folder').children('span:eq(2)').removeClass('icon-arrow-up').addClass('icon-arrow-down');}
break;case menu.NEW_PLAYLIST_ELEMENT:$elt=menu.$naboo_menu_new_playlist.clone();$elt.attr({'id':'naboo_menu_element_new_playlist'});break;case menu.NEW_FOLDER_ELEMENT:$elt=menu.$naboo_menu_new_folder.clone();$elt.attr({'id':'naboo_menu_element_new_folder'});break;}
return $elt.contextMenu({menu:type});}catch(e){console.log(e);}},$current_application:null,getCurrentApplicationId:function(){if(menu.$current_application===null){return 0;}
var app_data=$.data(menu.$current_application,'app_data');return app_data.APP_ID;},removeCurrentApplication:function(){if(menu.$current_application===null){return false;}
menu.$current_application.remove();menu.$current_application=null;},setCurrentApplication:function(app_data){var is_favorite=userData.isFavorite('application',app_data.APP_ID);if(is_favorite||(menu.$current_application!==null&&app_data.APP_ID==menu.$current_application.attr('element-id'))){return false;}
menu.removeCurrentApplication();app_data.CURRENT_APP=true;menu.$current_application=menu.drawElement(menu.APPLICATION_ELEMENT,app_data);menu.$current_application.addClass('current_application');$.data(menu.$current_application,'app_data',app_data);menu.$current_application.find('.app_add_fav').click(function(){var app_data=$.data(menu.$current_application,'app_data');tracking.track('app_add_favorite',{app_id:app_data.app_id,source:'menu_pin'});favorite.add({type:'application',APP_ID:app_data.APP_ID,NAME:app_data.NAME,INAPP_ALIAS:app_data.INAPP_ALIAS,APP_PICTURE_16x16:app_data.APP_PICTURE_16x16});});menu.$naboo_menu_list_app.find('#showcase_link').after(menu.$current_application);return true;},insertApplication:function(id,elt){try{if(id==menu.getCurrentApplicationId()||(typeof(app.app_id)!='undefined'&&id==app.app_id)){menu.removeCurrentApplication();menu.$naboo_menu_list_app.append(elt);menu.selectItem('application',id);}else{menu.$naboo_menu_list_app.append(elt);}}catch(e){console.log(e.message,e.stack);}},insertElement:function(type,id,elt){try{var folder=(id>0)?menu.isInsideFolder(type,id):0;var parent=(folder===0)?menu.$naboo_menu_library:$('#naboo_menu_element_folder_'+folder);var previousElt=menu.getLastElement(parent,type);if(!previousElt){if(menu.FOLDER_ELEMENT==type||parent.attr('element-id')!='root'){parent.append(elt);}else if(parent.attr('element-id')=='root'){previousElt=menu.$naboo_menu_create_block;elt.insertAfter(previousElt);}else{parent.prepend(elt);}}else{if((type==menu.PLAYLIST_ELEMENT&&id===0)||type==menu.PLAYLIST_ELEMENT_CREATED){previousElt=menu.$naboo_menu_create_block;}
elt.insertAfter(previousElt);}
if(type==menu.FOLDER_ELEMENT)menu.setDroppableFolder(elt);if(type==menu.PLAYLIST_ELEMENT||type==menu.PLAYLIST_ELEMENT_CREATED)menu.setDroppablePlaylist(elt);if(type!=menu.FOLDER_ELEMENT)menu.setDraggable(elt);}catch(e){console.log(e.message,e.stack);}},getLastElement:function(parent,type){try{$noFoundPosition=false;var classElement='';if(menu.PLAYLIST_ELEMENT==type){classElement='.item_playlist';}else if(menu.PLAYLIST_FAV_ELEMENT==type){classElement='.item_playlist-fav';}else if(menu.ALBUM_ELEMENT==type){classElement='.item_album';}else if(menu.FOLDER_ELEMENT==type){classElement='.block_folder';}
$foundSameTypeElement=parent.children(classElement+':last');if($foundSameTypeElement.length==1){return $foundSameTypeElement;}else if(type>1){type--;return menu.getLastElement(parent,type);}
return $noFoundPosition;}catch(e){console.log(e.message,e.stack);}},isInsideFolder:function(type,id){try{var foundFolder=0;if(getObjectSize(userData.data.FOLDERS)>0){for(var i=0;i<userData.data.FOLDERS.count;i++){var data=userData.data.FOLDERS.data[i].ELEMENTS;for(var j=0;j<data.length;j++){if(data[j].ELEMENT_ID==id&&data[j].TYPE==type){return userData.data.FOLDERS.data[i].FOLDER_ID;}}}}
return foundFolder;}catch(e){console.log(e);}},openElement:function($line){try{var need_loged_user={'create_playlist':true,'create_folder':true,'personal_song':true,'downloads':true,'collection':true,'recommendations':true,'loved':true};var selectedElement=$line.attr('element-type');if(USER.USER_ID===0&&typeof(need_loged_user[selectedElement])!='undefined'){modal.open('/'+SETTING_LANG+'/login.php');return false;}
if(OFFLINE&&$line.is('.unavailable')){return false;}
if($('#naboo_menu_element_new_playlist').length>0){$('#naboo_menu_element_new_playlist input').blur();}
if($('#naboo_menu_element_new_folder').length>0){$('#naboo_menu_element_new_folder input').blur();}
var url='';switch(selectedElement){case'create_playlist':Events.trigger(Events.playlist.create);return;case'create_folder':Events.trigger(Events.folder.create);return;case"":case"picks":url='picks';tracking.track('menu_edito_click');break;case"personal_song":url='personal_song';tracking.track('menu_mymp3_click');break;case"radio":url="radio/";tracking.track('menu_radios_click');break;case"downloads":url='downloads';break;case menu.PLAYLIST_ELEMENT.toString():case menu.PLAYLIST_FAV_ELEMENT.toString():if(OFFLINE&&typeof(dzoffline.getListSync('playlist',$line.attr('element-id')))=='undefined')return false;url='playlist/'+$line.attr('element-id');break;case menu.ALBUM_ELEMENT.toString():if(OFFLINE&&typeof(dzoffline.getListSync('album',$line.attr('element-id')))=='undefined')return false;url='album/'+$line.attr('element-id');break;case menu.FOLDER_ELEMENT.toString():url='folder/'+$line.attr('element-id');break;case menu.APPLICATION_ELEMENT.toString():var app_alias=$line.attr('element-alias');url='app/'+(app_alias===''?$line.attr('element-id'):app_alias);break;case"tops":url="tops/track";if(www.getCurrentPageType()=='tops'){return false;}
tracking.track('menu_tops_click');break;case"showcase":url="appstudio";if(www.getCurrentPageType()=='appstudio'){return false;}
tracking.track('menu_apps_click');break;case"collection":url=(OFFLINE)?'offline':'collection';tracking.track('menu_collection_click');break;case"recommendations":url="recommendations";tracking.track('menu_reco_click');break;case"loved":url="loved";tracking.track('menu_loved_click');break;default:console.log("Element type undefined");return false;}
if(url!=actual_box||url=='offline'){loadBox(url);}
return false;}catch(e){console.log(e.message,e.stack);}},updatePlaylist:function(evt,params){try{$elt=$('#naboo_menu_element_playlist_'+params.playlist_id);$elt.children('span:eq(1)').text(params.title);if(params.folder_id=='-1'&&$elt.parent().attr('element-id')!='root'){menu.moveMenuElement(menu.$naboo_menu_library,$elt);}else if(params.folder_id!=$elt.parent().attr('element-id')){menu.moveMenuElement($('#naboo_menu_element_folder_'+params.folder_id),$elt);}
if((params.status=='2'||params.status=='3')&&$elt.children('span:eq(0)').is('.icn_playlist'))
$elt.children('span:eq(0)').removeClass('icn_playlist').addClass('icn_playlist_col');else if((params.status=='0'||params.status=='1')&&$elt.children('span:eq(0)').is('.icn_playlist_col'))
$elt.children('span:eq(0)').removeClass('icn_playlist_col').addClass('icn_playlist');}catch(e){console.log(e.message,e.stack);}},removePlaylist:function(evt,params){try{if(params.element_id<=0||params.element_id===PLAYLIST_WELCOME_ID){return false;}
var playlist_title=$('#naboo_menu_element_playlist_'+params.element_id).children('span:eq(1)').text();if(confirm(sprintf(trad.music.naboo_playlist_confirm_delete,playlist_title))){api.call('playlist_delete',{playlist_id:params.element_id},menu.removePlaylistCallback,{playlist_id:params.element_id});}}catch(e){console.log(e.message,e.stack);}},removePlaylistCallback:function(request,callbackParameters){try{if(request.error.length===0){menu.updateUserDataFolder(menu.PLAYLIST_ELEMENT,callbackParameters.playlist_id,0,true);var folder_id=0;if($("#naboo_menu_element_playlist_"+callbackParameters.playlist_id).length==1){folder_id=$("#naboo_menu_element_playlist_"+callbackParameters.playlist_id).parent().attr('element-id');$("#naboo_menu_element_playlist_"+callbackParameters.playlist_id).remove();}
if($("#naboo_menu_element_playlist_collab_"+callbackParameters.playlist_id).length==1){folder_id=$("#naboo_menu_element_playlist_collab_"+callbackParameters.playlist_id).parent().attr('element-id');$("#naboo_menu_element_playlist_collab_"+callbackParameters.playlist_id).remove();}
if(folder_id!='root'){menu.updateFolderCount(folder_id);}
menu.updateScrollContent();if(actual_box=='playlist/'+callbackParameters.playlist_id){loadBox('');}
Events.trigger(Events.playlist.removed,{playlist_id:callbackParameters.playlist_id});}}catch(e){console.log(e.message,e.stack);}},renamePlaylist:function(playlist_id){try{if(playlist_id<=0)return false;menu.addNewElement({namespace:'PLAYLIST.rename'},playlist_id);}catch(e){console.log(e.message,e.stack);}},renamePlaylistAction:function($input,playlist_id){try{if($input.val()==='')return false;$elt=$("#naboo_menu_element_playlist_"+playlist_id);if($elt.children('span:eq(1)').text()!=$input.val())
api.call('playlist_rename',{playlist_id:playlist_id,title:$input.val()},function(request){console.log('rename playlist:',request);});$input.parents('a').remove();$elt.show().children('span:eq(1)').text($input.val());}catch(e){console.log(e.message,e.stack);}},openFolder:function($elt){try{var folder_id=$elt.attr('element-id');if(typeof(menu.folderStatus['f_'+folder_id])!='undefined'&&menu.folderStatus['f_'+folder_id]=='close'){$elt.parent().removeClass('folder_off').addClass('folder_on');$elt.children('span:eq(0)').removeClass('icn_folder_off').addClass('icn_folder_on');$elt.children('span:eq(2)').removeClass('icon-arrow-down').addClass('icon-arrow-up');menu.folderStatus['f_'+folder_id]='open';}else{$elt.parent().removeClass('folder_on').addClass('folder_off');$elt.children('span:eq(0)').removeClass('icn_folder_on').addClass('icn_folder_off');$elt.children('span:eq(2)').removeClass('icon-arrow-up').addClass('icon-arrow-down');menu.folderStatus['f_'+folder_id]='close';}
Events.trigger(Events.user.settingChange,{site:{menu_folders:JSON.stringify(menu.folderStatus)}});menu.updateScrollContent();}catch(e){console.log(e.message,e.stack);}},updateFolder:function(evt,params){try{$elt=$('#naboo_menu_element_folder_'+params.folder_id).children('a:first').children('span:eq(1)').text(params.title+menu.getFolderElement(params.folder_id));for(var i=0;i<userData.data.FOLDERS.total;i++){if(userData.data.FOLDERS.data[i].FOLDER_ID==params.folder_id){userData.data.FOLDERS.data[i].NAME=params.title;}}}catch(e){console.log(e.message,e.stack);}},removeFolder:function(evt,params){try{var folder_title=$('#naboo_menu_element_folder_'+params.element_id).attr('title');if(confirm(sprintf(trad.music.naboo_folder_confirm_delete,folder_title))){api.call('music_deleteFolder',{folder_id:params.element_id},menu.removeFolderCallback,{folder_id:params.element_id});}}catch(e){console.log(e.message,e.stack);}},removeFolderCallback:function(request,callbackParameters){try{if(request.error.length===0){for(var i=0;i<userData.data.FOLDERS.total;i++){if(userData.data.FOLDERS.data[i].FOLDER_ID==callbackParameters.folder_id){userData.data.FOLDERS.data.splice(i,1);userData.data.FOLDERS.total--;userData.data.FOLDERS.count--;}}
$("#naboo_menu_element_folder_"+callbackParameters.folder_id).children().each(function(index){if(index>0){menu.insertElement($(this).attr('element-type'),$(this).attr('element-id'),$(this));}});$("#naboo_menu_element_folder_"+callbackParameters.folder_id).remove();menu.updateScrollContent();loadBox('');}}catch(e){console.log(e.message,e.stack);}},renameFolder:function(folder_id){try{if(folder_id<=0)return false;menu.addNewElement({namespace:'FOLDER.rename'},folder_id);}catch(e){console.log(e.message,e.stack);}},renameFolderAction:function($input,folder_id){try{if($input.val()==='')return false;$elt=$("#naboo_menu_element_folder_"+folder_id);if($input.attr('data-name')!=$input.val())
api.call('music_updateFolder',{folder_id:folder_id,name:$input.val()},function(request,params){$("#naboo_menu_element_folder_"+params.folder_id).attr('title',params.name);},{folder_id:folder_id,name:$input.val()});$input.parents('a').remove();$elt.children('.folder').show();menu.updateFolder(null,{folder_id:folder_id,title:$input.val()});}catch(e){console.log(e.message,e.stack);}},updateFolderCount:function(folder_id,name){try{if(typeof(name)=='undefined'){name=$('#naboo_menu_element_folder_'+folder_id).attr('title');}
$('#naboo_menu_element_folder_'+folder_id).children('.folder').children('span:eq(1)').text(name+menu.getFolderElement(folder_id));return true;}catch(e){console.log(e.message,e.stack);}},getFolderElement:function(folder_id){try{var nbElement=menu.getCountFolderElement(folder_id);if(nbElement>-1)
return' ('+nbElement+')';else
return' (0)';}catch(e){console.log(e.message,e.stack);}},getCountFolderElement:function(folder_id){try{return $('#naboo_menu_element_folder_'+folder_id).children().length-1;}catch(e){console.log(e.message,e.stack);}},getDataElementInsideFoler:function(folder_id){try{var folderContent=[];$('#naboo_menu_element_folder_'+folder_id).children().each(function(index){if(index>0){folderContent.push({ELEMENT_ID:$(this).attr('element-id'),TYPE:$(this).attr('element-type')});}});return folderContent;}catch(e){console.log(e.message,e.stack);}},contextMenuClick:function(evt,params){try{switch(params.action){case"play":if(OFFLINE)return false;if($(params.elt).attr('element-type')==menu.ALBUM_ELEMENT){dzPlayer.playAlbum($(params.elt).attr('element-id'),0,true,{TYPE:'album_page',ID:$(params.elt).attr('element-id')});}else if($(params.elt).attr('element-type')==menu.PLAYLIST_ELEMENT||$(params.elt).attr('element-type')==menu.PLAYLIST_FAV_ELEMENT){dzPlayer.playPlaylist($(params.elt).attr('element-id'),0,true,{TYPE:'playlist_page',ID:$(params.elt).attr('element-id')});}
break;case"open":if($(params.elt).is('.folder'))
menu.openElement($(params.elt).parent());else
menu.openElement($(params.elt));break;case"delete":if(OFFLINE)return false;if($(params.elt).is('.block_folder')){$('#contextMenuFolder').remove();menu.removeFolder(null,{element_id:$(params.elt).attr('element-id')});}else{$('#contextMenuPlaylist').remove();menu.removePlaylist(null,{element_id:$(params.elt).attr('element-id')});}
break;case"edit":if(OFFLINE)return false;if($(params.elt).attr('element-type')==menu.FOLDER_ELEMENT){menu.renameFolder($(params.elt).attr('element-id'));}else if($(params.elt).attr('element-type')==menu.PLAYLIST_ELEMENT){menu.renamePlaylist($(params.elt).attr('element-id'));}
break;case"unlink":type=$(params.elt).attr('element-type');if(type==menu.PLAYLIST_FAV_ELEMENT){favorite.remove($(params.elt),{type:'playlist',PLAYLIST_ID:$(params.elt).attr('element-id')});}else if(type==menu.ALBUM_ELEMENT){favorite.remove($(params.elt),{type:'album',ALB_ID:$(params.elt).attr('element-id')});}else if(type==menu.APPLICATION_ELEMENT){favorite.remove($(params.elt),{type:'application',APP_ID:$(params.elt).attr('element-id')});}
break;}
return true;}catch(e){console.log(e);}},adjustUserMenu:function(){try{if(naboo.displayed!==true){return false;}
if(typeof(menu.$naboo_menu_list)=="undefined"){return false;}
naboo_offset=menu.$naboo.offset();naboo_top=naboo_offset.top;naboo_left=naboo_offset.left;player_height=playercontrol.heightPlayer;if(playercontrol.mix){player_height=221;menu.$naboo_menu.addClass('naboo-menu_tablemix-on');}else{menu.$naboo_menu.removeClass('naboo-menu_tablemix-on');}
h=naboo_top-player_height;menu.menu_top=player_height;menu.updateScrollPan();return true;}catch(e){console.log(e.message,e.stack);}},updateScrollPan:function(_width){try{menu_infos_height=menu.$naboo_menu_infos.height();new_height_menu_list=parseInt(client_height-menu.menu_top-menu_infos_height,10);if(isNaN(new_height_menu_list)){return false;}
menu.$naboo_menu_list_content.height(new_height_menu_list);menu.$naboo_menu_list_content.tinyscrollbar_update('relative');return true;}catch(e){console.log(e);}},updateScrollContent:function(){try{menu.$naboo_menu_list_content.tinyscrollbar_update('relative');return true;}catch(e){console.log(e);}},selectItem:function(type,element_id){try{menu.last_item_selected.removeClass('selected');if(element_id<0){return false;}
switch(type){case'playlist':if($('#naboo_menu_element_playlist_'+element_id).length==1){$div=$('#naboo_menu_element_playlist_'+element_id);}else if($('#naboo_menu_element_playlistfav_'+element_id).length==1){$div=$('#naboo_menu_element_playlistfav_'+element_id);}else if($('#naboo_menu_element_playlist_collab_'+element_id).length==1){$div=$('#naboo_menu_element_playlist_collab_'+element_id);}
break;case'album':$div=$('#naboo_menu_element_album_'+element_id);break;case'application':$div=$('#naboo_menu_element_applicationfav_'+element_id);break;case'appstudio':$div=$('#showcase_link');break;case'folder':$div=$('#naboo_menu_element_folder_'+element_id);break;case'collection':$div=$('#naboo_menu_link_collection');break;case'personal_song':$div=$('#naboo_menu_link_personal');break;case'downloads':$div=$('#naboo_menu_downloads');break;case'picks':$div=$('#naboo_menu_discover_picks');break;case'tops':$div=$('#naboo_menu_discover_tops');break;case'recommendations':$div=$('#naboo_menu_discover_recommendation');break;case'loved':$div=$('#naboo_menu_link_loved');break;default:return false;}
if(typeof($div)!="undefined"&&$div.length==1){$div.addClass('selected');menu.last_item_selected=$div;}
return true;}catch(e){console.log(e);}},displayCover:function(init){try{refreshPane=false;if(typeof(init)!='undefined'&&init!==null&&init===true){if(typeof(USER.SETTING.site)=='undefined'){display_cover=true;}else if(typeof(USER.SETTING.site.menu_display_cover)=='undefined'){display_cover=true;}else if(USER.SETTING.site.menu_display_cover){display_cover=true;}else{display_cover=false;}}else{display_cover=!display_cover;Events.trigger(Events.user.settingChange,{site:{menu_display_cover:display_cover}});refreshPane=true;}
$('#naboo_menu_display_cover').removeClass('menu_bar-slide_on').removeClass('menu_bar-slide_off');$('#naboo_menu_infos').removeClass('expand').removeClass('mini');if(!display_cover){$('#naboo_menu_infos').addClass('mini');$('#naboo_menu_display_cover').addClass('menu_bar-slide_on').attr('title',trad.music.naboo_menu_display_cover_on);}else{$('#naboo_menu_infos').addClass('expand');$('#naboo_menu_display_cover').addClass('menu_bar-slide_off').attr('title',trad.music.naboo_menu_display_cover_off);}
if(refreshPane){menu.updateScrollPan();}
return true;}catch(e){console.log(e);}},resizeSidebar:function(width,cookie){try{if(typeof(cookie)=='undefined'||cookie===null){cookie=false;}
menu.sidebar_width=width;menu.$naboo_menu.width(width);menu.$naboo_menu_list.width(width);menu.$naboo_menu_list_content.width(width);menu.$naboo_menu_infos_cover.css({'width':width,'height':width});menu.$naboo_menu_infos.width(width);if(cookie===true){Events.trigger(Events.user.settingChange,{site:{menu_width:menu.sidebar_width}});}
menu.updateScrollPan(menu.getSidebarWidth());return true;}catch(e){console.log(e);}},getSidebarWidth:function(init){try{if(typeof(init)=='undefined'||init===null)init=false;if(typeof(USER)!='undefined'&&USER.OPTIONS.ads_display===false){if(init===true){if(typeof(USER.SETTING.site)!='undefined'&&typeof(USER.SETTING.site.menu_width)!='undefined'&&USER.SETTING.site.menu_width>0){menu.sidebar_width=USER.SETTING.site.menu_width;}
return menu.sidebar_width;}else{return menu.sidebar_width;}}else{return menu.sidebar_width;}}catch(e){console.log(e);}},disableSidebar:function(){try{if(menu.$naboo_menu_list.is('.ui-resizable')){menu.$naboo_menu_list.resizable("disable");menu.resizeSidebar(menu.sidebar_width_default);}}catch(e){console.log(e);}},enableSidebar:function(){try{if(menu.$naboo_menu_list.is('.ui-resizable')){menu.$naboo_menu_list.resizable("enable");menu.resizeSidebar(menu.getSidebarWidth(true));}}catch(e){console.log(e);}},isActiveSidebar:function(){try{if(menu.$naboo_menu_list.is('.ui-resizable')){return!menu.$naboo_menu_list.resizable("option","disabled");}
return false;}catch(e){console.log(e);}},changeDisplayMenu:function(offline){try{if(offline){$('#naboo_menu_downloads').addClass('unavailable');$('#naboo_menu_link_personal').addClass('unavailable');$('#naboo_menu_link_loved').addClass('unavailable');$('#naboo_menu_list_discover').hide();$('#naboo_menu_list_app').hide();$('#naboo_menu_create_block').hide();$('.drag_item',menu.$naboo_menu_library).addClass('unavailable');$("div.block_folder",menu.$naboo_menu_library).addClass('unavailable');var avatar=$('#img_avatar_mini').attr('src').split('/');filesystem.readImage(avatar[avatar.length-2],avatar[avatar.length-1],$('#img_avatar_mini'));for(var elt in dzoffline.listSync){var type=dzoffline.listSync[elt].TYPE;var id=dzoffline.listSync[elt].ID;if(dzoffline.listSync[elt].STATE==dzoffline.FINISH){if(type=='album'){$('#naboo_menu_element_album_'+id).removeClass('unavailable');}else if(type=='playlist'){if($('#naboo_menu_element_playlist_'+id).length==1)
$('#naboo_menu_element_playlist_'+id).removeClass('unavailable');else if($('#naboo_menu_element_playlist_collab_'+id).length==1)
$('#naboo_menu_element_playlist_collab_'+id).removeClass('unavailable');else if($('#naboo_menu_element_playlistfav_'+id).length==1)
$('#naboo_menu_element_playlistfav_'+id).removeClass('unavailable');}else if(type=='loved'){$('#naboo_menu_link_loved').removeClass('unavailable');}}else{menu.displayDownloadStatus(null,{state:dzoffline.PENDING,type:type,id:id});}}}else{$('#naboo_menu_link_personal').removeClass('unavailable');$('#naboo_menu_downloads').removeClass('unavailable');$('#naboo_menu_link_loved').removeClass('unavailable');$('#naboo_menu_list_discover').show();$('#naboo_menu_list_app').show();$('#naboo_menu_create_block').show();$('.drag_item',menu.$naboo_menu_library).removeClass('unavailable');$("div.block_folder",menu.$naboo_menu_library).removeClass('unavailable');downloader.downloadCover('user',USER.USER_ID);}}catch(e){console.log(e.message,e.stack);}},displayDownloadStatus:function(event,params){try{var icon="";if(params.state==dzoffline.PENDING)icon="dl_waiting";if(params.state==dzoffline.STARTED)icon="dl_loading";if(params.state==dzoffline.DELETE)icon="dl_waiting";if(params.state==dzoffline.FINISH)icon="dl_finished";if(params.state==dzoffline.SYNC_BROKEN)icon="dl_waiting";if(params.state==dzoffline.FINISH_DELETE)icon="";switch(params.type){case"album":if($('#naboo_menu_element_album_'+params.id).length==1){$itemAlbum=$('#naboo_menu_element_album_'+params.id);if(icon!==''){$itemAlbum.children('span:eq(2)').removeClass('none').children().removeClass('dl_loading').removeClass('dl_waiting').removeClass('dl_finished').addClass(icon).show();}else{$itemAlbum.children('span:eq(2)').addClass('none');}
if(OFFLINE&&params.state==dzoffline.FINISH){$itemAlbum.removeClass('unavailable');}else if(OFFLINE&&params.state==dzoffline.FINISH_DELETE){$itemAlbum.addClass('unavailable');}}
break;case"playlist":if($('#naboo_menu_element_playlist_'+params.id).length==1)
$itemPlaylist=$('#naboo_menu_element_playlist_'+params.id);else if($('#naboo_menu_element_playlist_collab_'+params.id).length==1)
$itemPlaylist=$('#naboo_menu_element_playlist_collab_'+params.id);else if($('#naboo_menu_element_playlistfav_'+params.id).length==1)
$itemPlaylist=$('#naboo_menu_element_playlistfav_'+params.id);else
$itemPlaylist='';if($itemPlaylist!==''){if(icon!=='')
$itemPlaylist.children('span:eq(2)').removeClass('none').children().removeClass('dl_loading').removeClass('dl_waiting').removeClass('dl_finished').addClass(icon).show();else
$itemPlaylist.children('span:eq(2)').addClass('none');if(OFFLINE&&params.state==dzoffline.FINISH){$itemPlaylist.removeClass('unavailable');}else if(OFFLINE&&params.state==dzoffline.FINISH_DELETE){$itemPlaylist.addClass('unavailable');}}
break;case"loved":if($('#naboo_menu_link_loved').length==1){$itemLoved=$('#naboo_menu_link_loved');if(icon!==''){$itemLoved.children('span:eq(2)').removeClass('none').children().removeClass('dl_loading').removeClass('dl_waiting').removeClass('dl_finished').addClass(icon).show();}else{$itemLoved.children('span:eq(2)').addClass('none');}
if(OFFLINE&&params.state==dzoffline.FINISH){$itemLoved.removeClass('unavailable');}else if(OFFLINE&&params.state==dzoffline.FINISH_DELETE){$itemLoved.addClass('unavailable');}}
break;}}catch(e){console.log(e.message,e.stack);}},hideUserMenu:function(){try{menu.$naboo_menu.hide();return true;}catch(e){console.log(e.message,e.stack);}}};};
if(typeof(playlist)=="undefined"){var playlist={tabs_loaded:{},style:null,id:0,display:function(page,seo_data){try{var path=page.split('?');path=path[0].split('/');if(path[0]!='playlist'||typeof(path[1])=='undefined'||path[1]==null||path[1]==''){return false;}
playlist.id=path[1];playlist.tabs_loaded={};if(typeof(seo_data)!='undefined'){playlist.displayCallback(seo_data);}else{var params={playlist_id:playlist.id,lang:SETTING_LANG,start:0,nb:40,tags:false};api.call('deezer_pagePlaylist',params,playlist.displayCallback,null,'major_pages');}
Events.ready(Events.menu.loaded,function(){menu.selectItem('playlist',playlist.id);});Events.unsubscribeAll('TABS');Events.addEvent('TABS',Events.tabs.open,playlist.selectTab);return true;}catch(e){console.log(e);}},displayCallback:function(request){try{if(request==false||request==null){return false;}
if(typeof(request.results)!='undefined'&&typeof(request.error)!='undefined'){if(request.error.length>0){loadBox('home');return false;}
request=request.results;}
if(request.DATA==null){return false;}
template.load('naboo/playlist',$('#naboo_content'));if(request.DATA.PLAYLIST_PICTURE!=null&&!OFFLINE){$('#naboo_playlist_image').attr('src',SETTING_DOMAIN_IMG+'/'+request.DATA.PICTURE_TYPE+'/'+request.DATA.PLAYLIST_PICTURE+'/200x200-000000-80-0-'+IMAGE_VERSION+'.jpg');}else if(OFFLINE){filesystem.readImage(dzoffline.listSync['playlist_'+playlist.id].DATA.PLAYLIST_PICTURE,'200x200-000000-80-0-0.jpg',$('#naboo_playlist_image'));}
$("#naboo_playlist_head_infos").attr("data-user-id",request.DATA.PARENT_USER_ID);if(request.DATA.TITLE!=null){$('#naboo_playlist_title').text(ucfirst(request.DATA.TITLE));}
if(request.DATA.PARENT_USERNAME!=null){$("#naboo_playlist_information_creator").html(trad.general.by+" <a class='evt-click' href='/profile/"+request.DATA.PARENT_USER_ID+"'>"+request.DATA.PARENT_USERNAME+"</a>");}
infos='';if(request.DATA.STATUS!=null){$("#naboo_playlist_information_other").attr("data-status",request.DATA.STATUS);if(request.DATA.STATUS==0){infos+=" | "+trad.music.naboo_playlist_public+" | "+trad.music.naboo_playlist_nocollab;}else if(request.DATA.STATUS==1){infos+=" | "+trad.music.naboo_playlist_private+" | "+trad.music.naboo_playlist_nocollab;}else if(request.DATA.STATUS==2){infos+=" | "+trad.music.naboo_playlist_public+" | "+trad.music.naboo_playlist_collab;}else if(request.DATA.STATUS==3){infos+=" | "+trad.music.naboo_playlist_private+" | "+trad.music.naboo_playlist_collab;}}
$("#naboo_playlist_information_other").attr("data-collab-key",request.DATA.COLLAB_KEY).text(infos);if(request.DATA.DESCRIPTION!=null){$('#naboo_playlist_description').text(request.DATA.DESCRIPTION);}
if(request.DATA.DURATION!=null&&request.DATA.NB_SONG!=null){if(request.DATA.DURATION==0&&request.DATA.NB_SONG==0){$('#naboo_playlist_duration_nbsong').attr({'data-duration':'0','data-nbsong':'0'}).text('');}else{$('#naboo_playlist_duration_nbsong').attr({'data-duration':request.DATA.DURATION,'data-nbsong':request.DATA.NB_SONG}).text(request.DATA.NB_SONG+" "+((request.DATA.NB_SONG==1)?trad.music.naboo_track:trad.music.naboo_tracks)+" - "+getTotalDuration(request.DATA.DURATION));}}
if((request.DATA.PARENT_USER_ID!=USER.USER_ID)&&typeof(request.DATA.PARENT_BLOCK)!='undefined'&&request.DATA.PARENT_BLOCK==true){$('#naboo_comment_new').remove();$('#naboo_comment_new_not_logged').remove();}
var playlist_private=(request.DATA.PARENT_USER_ID!=USER.USER_ID&&(request.DATA.STATUS=="1"||request.DATA.STATUS=="3"));if(request.SONGS.count!=null){$('#tab_tracks_content').createDatagrid({type:'playlist',id:playlist.id,playlist_personnal:(request.DATA.PARENT_USER_ID==USER.USER_ID),songs:request.SONGS,playlist_private:playlist_private,checksum:request.DATA.CHECKSUM,offline_data:{playlist_name:request.DATA.TITLE,playlist_creator:request.DATA.PARENT_USERNAME,playlist_checksum:request.DATA.CHECKSUM,playlist_picture:request.DATA.PLAYLIST_PICTURE,playlist_picture_type:request.DATA.PICTURE_TYPE}});}
playlist.tabs_loaded['tracks_'+playlist.id]=true;if(!OFFLINE){if(request.DATA.PARENT_USER_ID==USER.USER_ID){$('#naboo_playlist_action').attr("data-value",playlist.id).show();}else{$('#naboo_playlist_action').hide();}
playlist.setShareAndDownload(playlist.id);advertising.call('playlist',playlist.id);$('#naboo_playlist_favorite').hide();Events.ready(Events.user.userReady,function(){$('#naboo_playlist_favorite').show();if(USER.USER_ID!=null&&request.DATA.PARENT_USER_ID!=USER.USER_ID&&request.DATA.TITLE!=null&&typeof(request.DATA.STATUS)!='undefined'&&(request.DATA.STATUS!=1||userData.isFavorite('playlist',playlist.id))){favorite.display($('#naboo_playlist_favorite_link'),{PLAYLIST_ID:playlist.id,type:'playlist',TITLE:request.DATA.TITLE,PARENT_USERNAME:request.DATA.PARENT_USERNAME,PARENT_USER_ID:request.DATA.PARENT_USER_ID,STATUS:request.DATA.STATUS});}else{$('#naboo_playlist_favorite').hide();}});}else{$('#naboo_playlist_favorite').remove();$('#naboo_playlist_action').remove();$('#naboo_playlist_favorite').remove();$("#naboo_playlist_share").remove();$("#tab_review_link").hide();$("#tab_fan_link").hide();}
naboo.afterLoad(true);live.deleteChannel(live.lastFeed);window.clearTimeout(live.timeoutConnect);live.lastFeed='-1_0_PLAYLISTFEED_'+playlist.id;live.timeoutConnect=window.setTimeout(function(){live.addChannel(live.lastFeed);},3000);return true;}catch(e){console.log(e.message,e.stack);}},selectTab:function(evt,params){try{infinite_scroll.disable();if(playlist.tabs_loaded[params.tab_id+'_'+playlist.id]==true){if(typeof(window[params.tab_id])!='undefined'&&typeof(window[params.tab_id].activeScroll)=='function'){window[params.tab_id].activeScroll(params.options);}else if(params.tab_id=='tracks'){datagrid.action($('#tab_tracks_content'),['activeInfiniteScroll']);}
return true;}
showLoading();if(params.tab_id=='review'){review.getList('playlist',playlist.id,0);}else if(params.tab_id=='fan'){fan.getList('playlist',playlist.id,0);}
return true;}catch(e){console.log(e.message,e.stack);}},edit:function(){try{$('#naboo_playlist_head_infos').attr('id','naboo_playlist_head_infos_edit')
playlist_id=$('#naboo_playlist_action').attr('data-value');playlist_status=$("#naboo_playlist_information_other").attr("data-status");playlist_style=$("#naboo_playlist_information_other").attr("data-style");playlist_collab_key=$("#naboo_playlist_information_other").attr("data-collab-key");description=$("#naboo_playlist_description").text();$inputName=$('<input id="naboo_playlist_title_input" class="naboo_playlist_input_edit" type="text" name="" value="" maxlength="200" />');$inputName.attr({value:trim($("#naboo_playlist_title").text()),name:trim($("#naboo_playlist_title").text())});$("#naboo_playlist_title").html($inputName);if(userData.data['FOLDERS'].total>0){$inputFolder=$('<select id="naboo_playlist_folder_input" class="naboo_playlist_input_edit" data-value="'+playlist.getFolderByPlaylist(playlist_id)+'">'+playlist.displayFolder(playlist_id)+'</select>');$("#naboo_playlist_folder_track").html($inputFolder);}
$inputDescription=$('<input id="naboo_playlist_description_input" class="naboo_playlist_input_edit" type="text" name="" value="" maxlength="200" />');$inputDescription.focus(function(){if($(this).val()==trad.music.naboo_playlist_description_default)$(this).val('')});$inputDescription.blur(function(){if($(this).val()=='')$(this).val(trad.music.naboo_playlist_description_default)});if(description==''){$inputDescription.attr({value:trad.music.naboo_playlist_description_default,name:trim(description)});}else{$inputDescription.attr({value:trim(description),name:trim(description)});}
$("#naboo_playlist_description").html($inputDescription);$("#naboo_playlist_information_other").text('');$inputPrivate=$('<div class="naboo_playlist_check" id="naboo_playlist_check_private"><input id="naboo_playlist_private_input" class="floatl" type="checkbox" name="" value="" '+((playlist_status==1||playlist_status==3)?'checked':'')+'/><span class="label"><label for="naboo_playlist_private_input">'+trad.music.naboo_playlist_private+'</label></span></div>');$("#naboo_playlist_information_other").append($inputPrivate);$("#naboo_playlist_check_private").tipsy({gravity:'nw'}).attr('title',trad.music.naboo_playlist_private_text);$inputCollab=$('<div class="naboo_playlist_check" id="naboo_playlist_check_collab"><input id="naboo_playlist_collab_input" class="floatl" type="checkbox" name="" value="" onchange="playlist.displayCollabPermalink('+playlist_id+', \''+playlist_collab_key+'\')" '+((playlist_status==2||playlist_status==3)?'checked':'')+'/><span class="label"><label for="naboo_playlist_collab_input">'+trad.music.naboo_playlist_collab+'</label></span></div>');$("#naboo_playlist_information_other").append($inputCollab);$("#naboo_playlist_check_collab").tipsy({gravity:'nw'}).attr('title',trad.music.naboo_playlist_collab_text);$("#naboo_playlist_information").append('<span id="naboo_playlist_information_collab_link" style="display:none;"></span>');playlist.displayCollabPermalink(playlist_id,playlist_collab_key);playlist.createUploadButton(playlist_id);$(".ilike_button").hide();$("#naboo_playlist_information_creator").hide();$(".naboo_playlist_head_options").hide();$("#naboo_playlist_action").hide();$("#naboo_playlist_edit_button").show();$('#naboo_playlist_share').hide();$('#naboo_playlist_download').hide();return true;}catch(e){console.log(e);}},editSubmit:function(){try{playlist_id=encodeURIComponent($('#naboo_playlist_action').attr('data-value'));title=$("#naboo_playlist_title_input").val();style_id=-1;description=($("#naboo_playlist_description_input").val()==trad.music.naboo_playlist_description_default)?'':$("#naboo_playlist_description_input").val();folder_id=(userData.data['FOLDERS'].total>0)?encodeURIComponent($("#naboo_playlist_folder_input option:selected").val()):0;if(!$("#naboo_playlist_private_input").is(':checked')&&!$("#naboo_playlist_collab_input").is(':checked')){pl_status=0;}else if($("#naboo_playlist_private_input").is(':checked')&&!$("#naboo_playlist_collab_input").is(':checked')){pl_status=1;}else if(!$("#naboo_playlist_private_input").is(':checked')&&$("#naboo_playlist_collab_input").is(':checked')){pl_status=2;}else if($("#naboo_playlist_private_input").is(':checked')&&$("#naboo_playlist_collab_input").is(':checked')){pl_status=3;}else{pl_status=0;}
api.call('playlist_update',{playlist_id:playlist_id,title:title,description:description,tag_id:style_id,status:pl_status,folder_id:folder_id},playlist.editSubmitCallback,{status:pl_status,playlist_id:playlist_id,style_id:style_id,folder_id:folder_id});}catch(e){console.log(e);}},editSubmitCallback:function(request,params){try{if(request.error.length==0){params.title=$("#naboo_playlist_title_input").val();Events.trigger(Events.playlist.update,params);$("#naboo_playlist_information_other").attr("data-style",params.style_id);$("#naboo_playlist_information_other").attr("data-status",params.status);playlist.editCancel(true);}else{playlist.editCancel(false);}}catch(e){console.log(e);}},editCancel:function(isAfterSave){try{$('#naboo_playlist_head_infos_edit').attr('id','naboo_playlist_head_infos')
if(isAfterSave){playlist.saveNewNameOffline($("#naboo_playlist_title_input").val());}
$("#naboo_playlist_title").text((isAfterSave)?$("#naboo_playlist_title_input").val():$("#naboo_playlist_title_input").attr('name'));if($("#naboo_playlist_description_input").val()==''||$("#naboo_playlist_description_input").val()==trad.music.naboo_playlist_description_default){$("#naboo_playlist_description").text('');}else if(isAfterSave){$("#naboo_playlist_description").text($("#naboo_playlist_description_input").val());}else{$("#naboo_playlist_description").text($("#naboo_playlist_description_input").attr('name'));}
$("#naboo_playlist_folder_track").text("");$("#naboo_playlist_image_upload").text("");$("#naboo_playlist_image_result").text("");infos='';if($("#naboo_playlist_information_other").attr("data-status")==0){infos+=" | "+trad.music.naboo_playlist_public+" | "+trad.music.naboo_playlist_nocollab;}else if($("#naboo_playlist_information_other").attr("data-status")==1){infos+=" | "+trad.music.naboo_playlist_private+" | "+trad.music.naboo_playlist_nocollab;}else if($("#naboo_playlist_information_other").attr("data-status")==2){infos+=" | "+trad.music.naboo_playlist_public+" | "+trad.music.naboo_playlist_collab;}else if($("#naboo_playlist_information_other").attr("data-status")==3){infos+=" | "+trad.music.naboo_playlist_private+" | "+trad.music.naboo_playlist_collab;}
$("#naboo_playlist_information_other").text(infos);$("#naboo_playlist_information_collab_link").remove();$(".ilike_button").show();$("#naboo_playlist_information_creator").show();$(".naboo_playlist_head_options").show();$("#naboo_playlist_action").show();$("#naboo_playlist_edit_button").hide();$('#naboo_playlist_share').css('display','inline-block');if((typeof(STORE_PLATEFORM)!='undefined')&&(STORE_PLATEFORM.DEEZER!=null)&&(getObjectSize(STORE_PLATEFORM)==1)){$('#naboo_playlist_download').css('display','inline-block');}}catch(e){console.log(e);}},createUploadButton:function(playlist_id){try{var so=new SWFObject(SETTING_STATIC+"/swf/picture_uploader-v"+STATIC_VERSION+".swf","playlist_image","120","20","10.0.0","#FFFFFF");so.addVariable("URL_UP",escape(SETTING_HOST_UPLOAD+"/?sid="+SESSION_ID+"&file=myfile&resize=1&directory=playlist&type=picture&id="+playlist_id+"&referer="+SETTING_REFERER_UPLOAD+"&"));so.addVariable("BTN_TEXT",trad.music.naboo_playlist_picture_change);so.addVariable("JSFUNCTION_DELETE","playlist.deletePicture");so.addVariable("JSFUNCTION_UPDATE","playlist.displayPicture");so.addParam("wmode","transparent");so.addParam("allowScriptAccess","always");so.write("naboo_playlist_image_upload");}catch(e){console.log(e);}},displayPicture:function(result){try{if(result!='error'){result=JSON.parse(result);if(result.error.length==0){$("#naboo_playlist_image").attr("src",SETTING_DOMAIN_IMG+"/playlist/"+result.results+"/200x200-000000-80-0-0.jpg");$("#naboo_playlist_image_result").text(trad.music.naboo_playlist_picture_display_ok);playlist.savePictureOffline(result);}else{$("#naboo_playlist_image_result").text(trad.music.naboo_playlist_picture_display_failed);}}else{$("#naboo_playlist_image_result").text(trad.music.naboo_playlist_picture_display_failed);}}catch(e){console.log(e);}},deletePicture:function(){try{if(confirm(trad.music.naboo_playlist_picture_delete_confirm)){playlist_id=$('#naboo_playlist_action').attr('data-value');api.call('playlist_deletePicture',{playlist_id:playlist_id},playlist.deletePictureCallback);}}catch(e){console.log(e);}},deletePictureCallback:function(request){try{if(request.error.length==0){$("#naboo_playlist_image").attr("src",SETTING_DOMAIN_IMG+'/cover//200x200-000000-80-0-0.jpg');playlist.savePictureOffline('');}else{$("#naboo_playlist_image_result").html(trad.music.naboo_playlist_picture_delete_failed);}}catch(e){console.log(e);}},savePictureOffline:function(md5){try{if(dzoffline.AVAILABLE){playlist_id=$('#naboo_playlist_action').attr('data-value');if(dzoffline.isElementSync('playlist',playlist_id)){dzoffline.updateListSync('playlist',playlist_id,{PLAYLIST_PICTURE:md5,PLAYLIST_PICTURE_TYPE:'playlist'});setTimeout(function(){downloader.downloadCover('playlist',{PLAYLIST_PICTURE:md5,PLAYLIST_PICTURE_TYPE:'playlist'});},3000);}}}catch(e){console.log(e);}},saveNewNameOffline:function(title){try{if(dzoffline.AVAILABLE){playlist_id=$('#naboo_playlist_action').attr('data-value');if(dzoffline.isElementSync('playlist',playlist_id)){dzoffline.updateListSync('playlist',playlist_id,{PLAYLIST_NAME:title});}}}catch(e){console.log(e);}},displayCollabPermalink:function(playlist_id,playlist_collab_key){try{if($("#naboo_playlist_collab_input").prop("checked")){input=" <input style='width:100%' type='text' value='"+SETTING_HOST_SITE+"/sharedplaylist-"+playlist_id+"-"+playlist_collab_key+"' readonly='readonly' onclick='this.select(); return false;' />";$("#naboo_playlist_information_collab_link").show();}else{input="";$("#naboo_playlist_information_collab_link").hide();}
$("#naboo_playlist_information_collab_link").html(input);}catch(e){console.log(e);}},deletePlaylist:function(){try{Events.trigger(Events.playlist.remove,{element_id:$('#naboo_playlist_action').attr('data-value')});}catch(e){console.log(e);}},displayFolder:function(id){try{option="<option value='-1'>"+trad.music.naboo_playlist_folder_default+"</option>";for(i=0;i<userData.data['FOLDERS'].total;i++){option+="<option value='"+userData.data['FOLDERS'].data[i].FOLDER_ID+"'";for(j=0;j<userData.data['FOLDERS'].data[i].ELEMENTS.length;j++){if(userData.data['FOLDERS'].data[i].ELEMENTS[j].ELEMENT_ID==id&&userData.data['FOLDERS'].data[i].ELEMENTS[j].TYPE=="1"){option+=" selected";}}
option+=">"+userData.data['FOLDERS'].data[i].NAME+"</option>"}
return option;}catch(e){console.log(e);}},getFolderByPlaylist:function(id){try{folder_id=-1;for(i=0;i<userData.data['FOLDERS'].total;i++){for(j=0;j<userData.data['FOLDERS'].data[i].ELEMENTS.length;j++){if(userData.data['FOLDERS'].data[i].ELEMENTS[j].ELEMENT_ID==id&&userData.data['FOLDERS'].data[i].ELEMENTS[j].TYPE=="1"){folder_id=userData.data['FOLDERS'].data[i].FOLDER_ID;}}}
return folder_id;}catch(e){console.log(e);}},setShareAndDownload:function(id){try{if(typeof(CUSTO)!='undefined'&&typeof(CUSTO.store_platform)!='undefined'&&CUSTO.store_platform=='none'){$("#naboo_playlist_download").css('display','none');$("#naboo_playlist_download").attr('onClick','').attr('data-hovercard','').click(function(e){});}else if((typeof(STORE_PLATEFORM)!='undefined')&&(STORE_PLATEFORM.DEEZER!=null)&&(getObjectSize(STORE_PLATEFORM)==1)){$('#naboo_playlist_download').css('display','inline-block');if(typeof(USER)!='undefined'&&typeof(USER.USER_ID)!='undefined'&&USER.USER_ID>0){$("#naboo_playlist_download").attr('data-hovercard','/ajax/hovercard/page.php?card=buy&playlist_id='+id).mouseenter(function(e){hovercard.init($(this));}).mouseleave(function(){hovercard.remove();});}}else{$('#naboo_playlist_download').css('display','none');}
$("#naboo_playlist_share a").attr('onClick','sharebox.load(3, '+id+'); return false;');return true;}catch(e){console.log(e);}},updateDurationAndNbSongs:function(duration,nb_song){try{$divTotalNbSong=$('#naboo_playlist_duration_nbsong');var newDuration=parseInt($divTotalNbSong.attr('data-duration'))-duration;var newNbSong=parseInt($divTotalNbSong.attr('data-nbsong'))-nb_song;if(newDuration<=0&&newNbSong<=0){$divTotalNbSong.attr('data-duration','0').attr('data-nbsong','0');$divTotalNbSong.text('');}else{$divTotalNbSong.attr('data-duration',newDuration).attr('data-nbsong',newNbSong);$divTotalNbSong.text(newNbSong+" "+((newNbSong==1)?trad.music.naboo_track:trad.music.naboo_tracks)+" - "+getTotalDuration(newDuration));}}catch(e){console.log(e);}},openStore:function(){try{hovercard.remove();loadFacebox('store/index.php?product_type=playlist&product_id='+$('#tab_tracks_content').getData('id'));}catch(e){console.log(e);}}}};
if(typeof(personal_song)=="undefined"){var personal_song={display:function(){try{api.call('personal_song.getList',{start:0,nb:40},personal_song.displayCallback,null,'major_pages');menu.selectItem('personal_song',0);return true;}catch(e){console.log(e);}},displayCallback:function(request){try{if(request==false||request==null)return false;if(request.error.length>0)return false;if(request.results==null)return false;if(request.results.data==null)return false;template.load('naboo/personal_song',$('#naboo_content'));if(request.results.count!=null){$('#naboo_personal_song_tracks').createDatagrid({type:'personal_song',template_js:true,id:0,songs:request.results,removable:true});}
naboo.afterLoad(true);if(Modernizr.draganddrop==true){personal_song.initUpload();}
return true;}catch(e){console.log(e.message,e.stack);}},initUpload:function(){try{if(BrowserDetect.browser=='Explorer'){$('#naboo_personal_song_upload > .qq-upload-button').hide().next().show();}else{if(Modernizr.draganddrop==true){$.event.props.push("dataTransfer");$('#naboo_personal_song_upload').bind({dragleave:function(evt){personal_song.doNothing(evt,'leave')},dragenter:function(evt){personal_song.doNothing(evt,'enter')},"dragexit dragover":personal_song.doNothing,drop:personal_song.drop});}else{$('#naboo_personal_song_upload_text').hide();}
$('#naboo_personal_song_upload_btn').change(function(fic){personal_song.drop({dataTransfer:{files:fic.currentTarget.files}});});}
return true;}catch(e){console.log(e);}},drop:function(evt){try{$('#naboo_personal_song_upload').removeClass('qq-upload-drop-area-active');if(countObject(evt)>1){personal_song.doNothing(evt);}
var files=evt.dataTransfer.files;if(files.length>0){var listUpload=new Array();for(var i in files){if(typeof(files[i].type)=='undefined'){continue;}
if(typeof(files[i].name)=='undefined'||files[i].name==''){alert(trad.music.naboo_personal_songs_filename_error);continue;}
if(files[i].type=='audio/mp3'||files[i].type=='audio/mpeg'){if(files[i].size<=62914560){listUpload.push(files[i]);personal_song.uploadStart(files[i]);}else{var message=trad.music.naboo_personal_songs_max_size_error
message=message.split('{file}').join(files[i].name);alert(message);}}else{var message=trad.music.naboo_personal_songs_type_error
message=message.split('{file}').join(files[i].name);alert(message);}}
if(listUpload.length>0){personal_song.runUpload(listUpload.reverse());}}}catch(e){console.log(e.message,e.stack);}},runUpload:function(list){try{if(list.length>0){var fic=list[0];xhr=jQuery.ajaxSettings.xhr();if(xhr.upload){xhr.upload.addEventListener('progress',function(e){personal_song.uploadProgress(e,fic);},false);}
var fd=new FormData;fd.append('file',fic);var fileName=encodeURIComponent(fic.name.substr(0,fic.name.length-4));$.ajax({url:(SETTING_HOST_UPLOAD+"/?sid="+SESSION_ID+"&resize=1&directory=&type=audio&referer="+SETTING_REFERER_UPLOAD+"&file="+fileName+"&"),type:'POST',data:fd,xhr:function(){return xhr;},processData:false,contentType:false,complete:function(data){personal_song.uploadComplete(data,fic,list);}});}}catch(e){console.log(e.message,e.stack);}},doNothing:function(evt,action){try{if(typeof(action)!='undefined'){if(action=='leave'){$('#naboo_personal_song_upload').removeClass('qq-upload-drop-area-active');}
if(action=='enter'){$('#naboo_personal_song_upload').addClass('qq-upload-drop-area-active');}}
evt.stopPropagation();evt.preventDefault();}catch(e){console.log(e.message,e.stack);}},uploadProgress:function(evt,fic){try{var id_tmp=fic.size;if(evt.lengthComputable){var percentLoaded=Math.round((evt.loaded/evt.total)*100);if(percentLoaded<=100){datagrid.action($('#naboo_personal_song_tracks'),['updateUploadFile',fic.size,fic.name,percentLoaded]);}}}catch(e){console.log(e.message,e.stack);}},uploadComplete:function(data,fic,listUpload){try{datagrid.action($('#naboo_personal_song_tracks'),['finishUploadFile',fic.size,fic.name,JSON.parse(data.responseText)]);if(listUpload.length>1){listUpload.splice(0,1);personal_song.runUpload(listUpload);}}catch(e){console.log(e.message,e.stack);}},uploadStart:function(fic){try{datagrid.action($('#naboo_personal_song_tracks'),['insertUploadFile',fic.size,fic.name]);}catch(e){console.log(e.message,e.stack);}}}};
if(typeof(search)=="undefined"){var search={cache:new Object(),cache_history:new Array(),display:function(page){try{var path=page.split('?');path=path[0].split('/');if(path[0]!='search'||typeof(path[1])=='undefined'||path[1]==null||path[1]==''){return false;}
var search_query=path[1];search_query=decodeURIComponent(search_query);callback_parameters=new Object();callback_parameters['search_query']=search_query;api.call('deezer_pageSearch',{query:search_query,filter:'all',start:0,nb:40,suggest:1,artist_suggest:1,top_tracks:1},search.displayCallback,callback_parameters,'major_pages');return true;}catch(e){console.log(e);}},displayCallback:function(request,callback_parameters){try{if(request==false||request==null)return false;if(request.error.length>0)return false;if(request.results==null)return false;if(request.results.TRACK==null)return false;if(request.results.ARTIST==null)return false;if(request.results.ALBUM==null)return false;if(callback_parameters['search_query']!=null){search_query=callback_parameters['search_query'];}
var tpl='search';if(request.results.TRACK.count!=null&&request.results.TRACK.count==0&&request.results.ARTIST.count!=null&&request.results.ARTIST.count==0&&request.results.ALBUM.count!=null&&request.results.ALBUM.count==0){tpl='noresult';}
template.load('naboo/'+tpl,$('#naboo_content'));if(tpl=='noresult'){return search.displayCallbackNoResult(request);}
var naboo_search_tracks=$('#naboo_search_tracks');if(request.results.TRACK.count!=null&&request.results.TRACK.count>0){naboo_search_tracks.show();$('#naboo_search_tracks').createDatagrid({type:'search',id:search_query,songs:request.results.TRACK});}else{naboo_search_tracks.hide();var naboo_search_head=$('#naboo_search_head');naboo_search_head.height($('#naboo_content').height());naboo_search_head.addClass('empty');}
$("#naboo_search_query").html(sprintf(trad.search.label_title,request.results.QUERY));var naboo_search_artist=$('#naboo_search_artist');if(request.results.ARTIST.total>0){naboo_search_artist.show();$("span",naboo_search_artist).html("("+request.results.ARTIST.total+")");$("> strong",naboo_search_artist).append(" : ");display_line=new Array();for(j=0;j<request.results.ARTIST.count;j++){display_line[j]="<a class='link-gray card' href='/artist/"+request.results.ARTIST.data[j].ART_ID+"' data-hovercard='/ajax/hovercard/page.php?card=artist&art_id="+urlRewriting(request.results.ARTIST.data[j].ART_ID)+"' onclick=\"loadBox('artist/"+(request.results.ARTIST.data[j].ART_ID)+"'); return false;\">"+request.results.ARTIST.data[j].ART_NAME+"</a> &bull; ";}
if(request.results.ARTIST.total>j){display_line[j]=' '+trad.music.naboo_search_and+' '+(request.results.ARTIST.total-j)+' '+trad.music.naboo_search_more;}
naboo_search_artist.append(display_line.join(''));$('.card',naboo_search_artist).mouseenter(function(e){hovercard.init($(this));}).mouseleave(function(){hovercard.remove();});}else{naboo_search_artist.hide();}
var naboo_search_album=$('#naboo_search_album');if(request.results.ALBUM.total>0){naboo_search_album.show();$("span",naboo_search_album).html("("+request.results.ALBUM.total+")");$("> strong",naboo_search_album).append(" : ");display_line=new Array();for(var j=0;j<request.results.ALBUM.count;j++){display_line[j]="<a class='link-gray card' href='/album/"+request.results.ALBUM.data[j].ALB_ID+"' data-hovercard='/ajax/hovercard/page.php?card=album&alb_id="+urlRewriting(request.results.ALBUM.data[j].ALB_ID)+"' onclick=\"loadBox('album/"+request.results.ALBUM.data[j].ALB_ID+"'); return false;\">"+request.results.ALBUM.data[j].ALB_TITLE+"</a> "+trad.music.naboo_search_by+" "+"<a class='link-gray-light card' href='/artist/"+request.results.ALBUM.data[j].ART_ID+"' data-hovercard='/ajax/hovercard/page.php?card=artist&art_id="+urlRewriting(request.results.ALBUM.data[j].ART_ID)+"' onclick=\"loadBox('artist/"+request.results.ALBUM.data[j].ART_ID+"'); return false;\">"+request.results.ALBUM.data[j].ART_NAME+"</a> &bull; "}
if(request.results.ALBUM.total>j){display_line[j]=' '+trad.music.naboo_search_and+' '+(request.results.ALBUM.total-j)+' '+trad.music.naboo_search_more;}
naboo_search_album.append(display_line.join(''));$('.card',naboo_search_album).mouseenter(function(e){hovercard.init($(this));}).mouseleave(function(){hovercard.remove();});}else{naboo_search_album.hide();}
if(typeof(USER)!='undefined'&&USER.OPTIONS.ads_display==false){$("#ads_adsense").hide();if(request.results.ALBUM.total==0&&request.results.ARTIST.total==0){$("#naboo_search_head").css({"min-height":"0","height":"auto"});}else{$("#naboo_search_head").css({"height":"","min-height":"0"});}}else{$("#ads_adsense").show();$("#naboo_search_head").css({"height":"","min-height":"0"});}
tracking.track('search_results',{'query':search_query,'total_result':request.results.TRACK.count});advertising.call('search','all',search_query);naboo.afterLoad(true);return true;}catch(e){console.log(e);}},displayCallbackNoResult:function(request){try{$(".noresult_suggest > i").text(sprintf(trad.search.label_noresult_suggest,request.results.QUERY));var suggest=request.results.SUGGESTION;if(suggest!==false&&typeof(suggest)=="string"){var link_suggest=$('#naboo_search_didyoumean a');link_suggest.attr('href','javascript:void(0)');link_suggest.attr('onclick','loadBox("search/'+escape(suggest)+'"); return false;');link_suggest.text(suggest);$('#naboo_search_didyoumean').show();}else{$('#naboo_search_didyoumean').hide();}
search.$modele_top_track=$('#modele_track_suggest').clone().removeAttr('id');;$('#modele_track_suggest').remove();search.drawTrackSuggest(request.results.TOP_TRACK);tracking.track('search_results',{'query':search_query,'total_result':request.results.TRACK.count});advertising.call('search_noresult','all',search_query);naboo.afterLoad(true);return true;}catch(e){console.log(e);}},drawTrackSuggest:function(top_track){try{var nb=top_track.results.data.length;var display_line=$('<p></p>');for(var i=0;i<nb;i++){var data=top_track.results.data[i];var $item=search.$modele_top_track.clone().show();$('.cover a',$item).attr({'href':SETTING_LANG+'/track/'+data.SNG_ID,'onclick':'dzPlayer.playTracksId(['+data.SNG_ID+']); return false;'});$('.img_main',$item).attr('src',SETTING_DOMAIN_IMG+'/cover/'+data.ALB_PICTURE+'/120x120-000000-80-0-0.jpg');$('dl dt a',$item).text(data.SNG_TITLE).attr('onclick','dzPlayer.playTracksId(['+data.SNG_ID+']); return false;');$('dl dd a',$item).text(data.ART_NAME).attr('onclick','loadBox("artist/'+data.ART_ID+'"); return false;');display_line.append($item);}
$('#noresult .noresult_top ul').append(display_line.children());return true;}catch(e){console.log(e);}}}};
if(typeof(video)=="undefined"){var video={display:function(page){try{var path=page.split('?');path=path[0].split('/');if(path[0]!='video'||typeof(path[1])=='undefined'||path[1]==null||path[1]==''){return false;}
var video_id=path[1];callback_parameters=new Object();callback_parameters['video_id']=video_id;var params={video_id:encodeURIComponent(video_id),lang:SETTING_LANG};api.call('deezer_pageVideo',params,video.displayCallback,callback_parameters,'major_pages');return true;}catch(e){console.log(e);}},displayCallback:function(request,callback_parameters){try{if(request==false||request==null){return false;}
if(request.error.length>0){loadBox('home');return false;}
if(request.results==null)return false;if(request.results.DATA==null)return false;if(request.results.VIDEO==null)return false;if(callback_parameters['video_id']!=null)video_id=callback_parameters['video_id'];template.load('naboo/video',$('#naboo_content'));console.log('video.getPlayerCode(',request.results.VIDEO.DATA.PLAYER,',',request.results.VIDEO.DATA.PLAYER_ID,')');var code=video.getPlayerCode(request.results.VIDEO.DATA.PLAYER,request.results.VIDEO.DATA.PLAYER_ID);$("#naboo_video_player").html(code);if(dzPlayer.playerLoaded){playercontrol.doAction('pause');}
facebook.graphAction('video',{'element_id':video_id});tracking.track('video_view',{"provider":request.results.VIDEO.DATA.PLAYER,"id":request.results.VIDEO.DATA.PLAYER_ID,"name":request.results.DATA.ART_NAME+" - "+request.results.DATA.SNG_TITLE});review.getList('video',video_id,0,15);naboo.afterLoad(true);live.deleteChannel(live.lastFeed);window.clearTimeout(live.timeoutConnect);live.lastFeed="-1_0_VIDEOFEED_"+video_id;live.timeoutConnect=window.setTimeout(function(){live.addChannel(live.lastFeed);},3000);advertising.call('video',video_id);return true;}catch(e){console.log(e);}},getPlayerCode:function(type,id){if(typeof(DZPS)!='undefined'&&DZPS===true){var width=900;var height=450;var canalplus_config='deezer_nopub';}else{var width=700;var height=350;var canalplus_config='deezer_pub';}
$('#naboo_video_player').css('height',height);if(type=='YT'){return'<iframe width="'+width+'" height="'+height+'" src="http://www.youtube.com/embed/'+id+'" frameborder="0" allowfullscreen></iframe>';}else if(type=='DM'){$('#naboo_video_player').height(450);return'<script type="text/javascript"> video.loadDmPlayer("'+id+'"); </script>';}else if(type=='AC'){return'<iframe id="Alloclips" src="http://'+SETTING_HOST+'/'+SETTING_LANG+'/video/alloclips/'+id+'/'+width+'/'+height+'" width="'+width+'" height="'+height+'" scrolling="no" frameborder="0"></iframe>';}else if(type=='CP'){var noPub=((typeof(DZPS)!='undefined')&&(DZPS===true));if(COBRANDING=='orange'&&noPub){canalplus_config='deezer_nopub';}else if(COBRANDING=='orange'&&!noPub){canalplus_config='deezer_orange';}else if(COBRANDING=='none'&&noPub){canalplus_config='deezer_nopub';}else if(COBRANDING=='none'&&!noPub){canalplus_config='deezer_pub';}
return'<object type="application/x-shockwave-flash" width="'+width+'" height="'+height+'" id="canal'+id+'" name="canal'+id+'" data="http://player.canalplus.fr/embed/flash/player.swf"><param name="movie" value="http://player.canalplus.fr/embed/flash/player.swf"><param name="flashvars" value="param='+canalplus_config+'&videoId='+id+'"><param name="allowScriptAccess" value="always"/><param name="wmode" value="transparent"/><param name="allowFullScreen" value="true"/><embed width="'+width+'" height="'+height+'" src="http://player.canalplus.fr/embed/flash/player.swf" id="canal'+id+'" name="canal'+id+'" flashVars="param='+canalplus_config+'&videoId='+id+'" allowscriptaccess="always" allowfullscreen="true" wmode="transparent"><noembed>Veuillez installer Flash Player pour lire la vidéo</noembed></embed></object>';}
return false;},loadDmPlayer:function(id){try{$("#naboo_video_player").html('<div id="dm_player"></div>');window.dmAsyncInit=function()
{var player=DM.player("dm_player",{video:id,width:"600",height:"450",params:{enableApi:1,affiliationDisabled:1}});var $player=$(player);player.addEventListener("apiready",function(e){player.addEventListener("play",function(e){if(dzPlayer.playerLoaded){playercontrol.doAction('pause');}});var onDzPlayerPlay=function(){try{if($player.is(':visible')){player.pause();}else{Events.subscribe(Events.player.play,onDzPlayerPlay);Events.subscribe(Events.player.resume,onDzPlayerResume);}}catch(e){console.log(e);}};var onDzPlayerResume=function(){try{if($player.is(':visible')){player.pause();}else{Events.subscribe(Events.player.play,onDzPlayerPlay);Events.subscribe(Events.player.resume,onDzPlayerResume);}}catch(e){console.log(e);}};Events.subscribe(Events.player.play,onDzPlayerPlay);Events.subscribe(Events.player.resume,onDzPlayerResume);player.play();});};(function(){var e=document.createElement('script');e.async=true;e.src=document.location.protocol+'//api.dmcdn.net/all.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(e,s);}());}catch(e){console.log(e);}}}};
﻿if(jQuery)(function(){$.fn.contextMenuSrcElement="";$.extend($.fn,{contextMenu:function(o){if(o.inSpeed==undefined)o.inSpeed=150;if(o.outSpeed==undefined)o.outSpeed=75;if(o.inSpeed==0)o.inSpeed=-1;if(o.outSpeed==0)o.outSpeed=-1;$(this).each(function(){var el=$(this);var offset=$(el).offset();$('#'+o.menu).addClass('contextMenu');$(this).mousedown(function(e){var evt=e;$(this).mouseup(function(e){$(this).unbind('mouseup');if(evt.button==2){if($.fn.contextMenuSrcElement!=""){$(".contextMenu").hide();$.fn.contextMenuSrcElement.removeClass("selected");}
$.fn.contextMenuSrcElement=$(this);switch(o.menu){case 1:case 7:var menu_div='contextMenuPlaylist';var menu=$('<ul id="contextMenuPlaylist" class="contextMenu"><li class="play'+((OFFLINE)?' unavailable':'')+'"><a href="#play">'+trad.general.play+'</a></li><li class="open"><a href="#open">'+trad.general.open+'</a></li><li class="edit'+((OFFLINE)?' unavailable':'')+'"><a href="#edit">'+trad.general.rename+'</a></li><li class="delete'+((OFFLINE)?' unavailable':'')+'"><a href="#delete">'+trad.general.delete_item+'</a></li></ul>');break;case 8:var menu_div='contextMenuApplication';var menu=$('<ul id="contextMenuApplication" class="contextMenu"><li class="open"><a href="#open">'+trad.general.open+'</a></li><li class="unlink'+((OFFLINE)?' unavailable':'')+'"><a href="#unlink">'+trad.general.remove_app+'</a></li></ul>');break;case 2:var menu_div='contextMenuPlaylistFavorite';var menu=$('<ul id="contextMenuPlaylistFavorite" class="contextMenu"><li class="play'+((OFFLINE)?' unavailable':'')+'"><a href="#play">'+trad.general.play+'</a></li><li class="open"><a href="#open">'+trad.general.open+'</a></li><li class="unlink'+((OFFLINE)?' unavailable':'')+'"><a href="#unlink">'+trad.music.favorite_remove_to_my_music+'</a></li></ul>');if($(this).attr('data-status')==1){$('.play',menu).remove();}
break;case 3:var menu_div='contextMenuAlbum';var menu=$('<ul id="contextMenuAlbum" class="contextMenu"><li class="play'+((OFFLINE)?' unavailable':'')+'"><a href="#play">'+trad.general.play+'</a></li><li class="open"><a href="#open">'+trad.general.open+'</a></li><li class="unlink'+((OFFLINE)?' unavailable':'')+'"><a href="#unlink">'+trad.music.favorite_remove_to_my_music+'</a></li></ul>');break;case 4:var menu_div='contextMenuFolder';var menu=$('<ul id="contextMenuFolder" class="contextMenu"></li><li class="open"><a href="#open">'+trad.general.open+'</a><li class="edit'+((OFFLINE)?' unavailable':'')+'"><a href="#edit">'+trad.general.rename+'</a></li><li class="delete'+((OFFLINE)?' unavailable':'')+'"><a href="#delete">'+trad.general.delete_item+'</a></li></ul>');break;}
$("body").append(menu);$.fn.contextMenuSrcElement.addClass("selected");if($(el).hasClass('disabled'))return false;var d={},x,y;if(self.innerHeight){d.pageYOffset=self.pageYOffset;d.pageXOffset=self.pageXOffset;d.innerHeight=self.innerHeight;d.innerWidth=self.innerWidth;}else if(document.documentElement&&document.documentElement.clientHeight){d.pageYOffset=document.documentElement.scrollTop;d.pageXOffset=document.documentElement.scrollLeft;d.innerHeight=document.documentElement.clientHeight;d.innerWidth=document.documentElement.clientWidth;}else if(document.body){d.pageYOffset=document.body.scrollTop;d.pageXOffset=document.body.scrollLeft;d.innerHeight=document.body.clientHeight;d.innerWidth=document.body.clientWidth;}
(e.pageX)?x=e.pageX:x=e.clientX+d.scrollLeft;(e.pageY)?y=e.pageY:y=e.clientY+d.scrollTop;x+=1;y+=1;if((y+$('#'+menu_div).height()+30)>$(window).height()){y=y-$('#'+menu_div).height();}
$(document).unbind('click');$(menu).css({top:y,left:x}).fadeIn(o.inSpeed);$(menu).find('A').unbind('click');$(menu).find('LI:not(.disabled) A').click(function(){$(document).unbind('click').unbind('keypress');$.fn.contextMenuSrcElement.removeClass("selected");var link=$(this).attr('href');var action=link.substr(link.lastIndexOf('#')+1,link.length)
Events.trigger(Events.menu.contextMenu,{action:action,elt:$.fn.contextMenuSrcElement,x:x-offset.left,y:y-offset.top,docX:x,docY:y});$(menu).fadeOut(o.outSpeed).remove();return false;});setTimeout(function(){$(document).click(function(){$.fn.contextMenuSrcElement.removeClass("selected");$(document).unbind('click').unbind('keypress');$(menu).fadeOut(o.outSpeed).remove();return false;});},0);e.stopPropagation();}});});if(BrowserDetect.browser=='Firefox'||BrowserDetect.browser=='Mozilla'){$('#'+o.menu).each(function(){$(this).css({'MozUserSelect':'none'});});}else if(BrowserDetect.browser=='Explorer'){$('#'+o.menu).each(function(){$(this).bind('selectstart.disableTextSelect',function(){return false;});});}else{$('#'+o.menu).each(function(){$(this).bind('mousedown.disableTextSelect',function(){return false;});});}});return $(this);},disableContextMenuItems:function(o){if(o==undefined){$(this).find('LI').addClass('disabled');return($(this));}
$(this).each(function(){if(o!=undefined){var d=o.split(',');for(var i=0;i<d.length;i++){$(this).find('A[href="'+d[i]+'"]').parent().addClass('disabled');}}});return($(this));},enableContextMenuItems:function(o){if(o==undefined){$(this).find('LI.disabled').removeClass('disabled');return($(this));}
$(this).each(function(){if(o!=undefined){var d=o.split(',');for(var i=0;i<d.length;i++){$(this).find('A[href="'+d[i]+'"]').parent().removeClass('disabled');}}});return($(this));},disableContextMenu:function(){$(this).each(function(){$(this).addClass('disabled');});return($(this));},enableContextMenu:function(){$(this).each(function(){$(this).removeClass('disabled');});return($(this));},destroyContextMenu:function(){$(this).each(function(){$(this).unbind('mousedown').unbind('mouseup');});return($(this));}});})(jQuery);;
if(typeof(offline)=="undefined"){var offline={$item_album:"",$item_playlist:"",$playlist_list:"",$album_list:"",$playlist_title:"",$album_title:"",backupOnlineTrackList:[],display:function(){try{template.load('naboo/offline',$('#naboo_content'));$('#naboo_home_offline').show();hideLoading();naboo.afterLoad(true);offline.$album_title=$('#naboo_offline_album_title');offline.$album_list=$('#naboo_offline_album_list');offline.$playlist_title=$('#naboo_offline_playlist_title');offline.$playlist_list=$('#naboo_offline_playlist_list');offline.$loved_title=$('#naboo_offline_loved_title');offline.$loved_list=$('#naboo_offline_loved_list');offline.$item_album=offline.$album_list.children('li');offline.$item_playlist=offline.$playlist_list.children('li');offline.$item_loved=offline.$loved_list.children('li');offline.$album_list.children('li').remove();offline.$playlist_list.children('li').remove();offline.$loved_list.children('li').remove();offline.displayElement();return true;}catch(e){console.log(e.message,e.stack);}},displayElement:function(){try{if(!dzoffline.LOADED)return false;var playlist_total=0;var album_total=0;var loved_total=0;var playerFirstContent=false;for(var e in dzoffline.listSync){if(dzoffline.listSync[e].STATE==dzoffline.FINISH){switch(dzoffline.listSync[e].TYPE){case'album':if(typeof(dzoffline.listSync[e].DATA)=='object'){var albData=dzoffline.listSync[e].DATA;$syncAlbum=offline.$item_album.clone();$('.naboo_offline_title > a:eq(0) > strong',$syncAlbum).text(truncateTxt(albData.ALB_NAME,18));$('.naboo_offline_title > a:eq(1)',$syncAlbum).text(truncateTxt(albData.ART_NAME,20));filesystem.readImage(albData.ALB_PICTURE,'200x200-000000-80-0-0.jpg',$('.naboo_offline_picture > a > img',$syncAlbum));$syncAlbum.attr("onClick",'loadBox(\'album/'+dzoffline.listSync[e].ID+'\');');offline.$album_list.append($syncAlbum);if(!offline.playerFirstContent){offline.setPlayerFirstContent('album',dzoffline.listSync[e].ID);offline.playerFirstContent=true;}
album_total++;}
break;case'playlist':if(typeof(dzoffline.listSync[e].DATA)=='object'){var plData=dzoffline.listSync[e].DATA;$syncPlaylist=offline.$item_playlist.clone();$('.naboo_offline_title > a:eq(0) > strong',$syncPlaylist).text(truncateTxt(plData.PLAYLIST_NAME,18));$('.naboo_offline_title > a:eq(1)',$syncPlaylist).text('');filesystem.readImage(plData.PLAYLIST_PICTURE,'200x200-000000-80-0-0.jpg',$('.naboo_offline_picture > a > img',$syncPlaylist));$syncPlaylist.attr("onClick",'loadBox(\'playlist/'+dzoffline.listSync[e].ID+'\');');offline.$playlist_list.append($syncPlaylist);if(!offline.playerFirstContent){offline.setPlayerFirstContent('playlist',dzoffline.listSync[e].ID);offline.playerFirstContent=true;}
playlist_total++;}
break;case'loved':if(typeof(dzoffline.listSync[e].DATA)=='object'){var plData=dzoffline.listSync[e].DATA;$syncLoved=offline.$item_loved.clone();$('.naboo_offline_title > a:eq(1)',$syncLoved).text('');filesystem.readImage(plData.PLAYLIST_PICTURE,'200x200-000000-80-0-0.jpg',$('.naboo_offline_picture > a > img',$syncLoved));$syncLoved.attr("onClick",'loadBox(\'loved\');');offline.$loved_list.append($syncLoved);offline.$loved_title.show();offline.$loved_list.show();if(!offline.playerFirstContent){offline.setPlayerFirstContent('loved',dzoffline.listSync[e].ID);offline.playerFirstContent=true;}
loved_total++;}
break;}}}
if(album_total>0){if(album_total==1)
offline.$album_title.text(trad.music.naboo_album.toUpperCase()+' ('+album_total+')');else
offline.$album_title.text(trad.music.naboo_albums.toUpperCase()+' ('+album_total+')');offline.$album_title.show();offline.$album_list.show();}
if(playlist_total>0){if(playlist_total==1)
offline.$playlist_title.text(trad.music.naboo_playlist.toUpperCase()+' ('+playlist_total+')');else
offline.$playlist_title.text(trad.music.naboo_playlists.toUpperCase()+' ('+playlist_total+')');offline.$playlist_title.show();offline.$playlist_list.show();}
if(album_total==0&&playlist_total==0&&loved_total==0){$('#naboo_home_offline_empty').show();offline.backupOnlineTrackList=dzPlayer._trackList;dzPlayer.setEmptyPlayer();}
return true;}catch(e){console.log(e.message,e.stack);}},setPlayerFirstContent:function(type,id){try{if(type=='album'){api.call('deezer_pageAlbum',{alb_id:id},offline.callbackPlayerFirstContent,{type:type});}else if(type=='playlist'){api.call('deezer_pagePlaylist',{playlist_id:id,start:0,nb:40},offline.callbackPlayerFirstContent,{type:type});}
return true;}catch(e){console.log(e.message,e.stack);}},callbackPlayerFirstContent:function(request,callbackRequest){try{if(typeof(request.results.SONGS)!='undefined'&&request.results.SONGS.data.length>0){dzPlayer.playTracks(request.results.SONGS.data,0,false);}else{dzPlayer.setEmptyPlayer();}
return true;}catch(e){console.log(e.message,e.stack);}}}};
if(typeof(downloads)=="undefined"){var downloads={display:function(){try{api.call('store_getList',{start:0,nb:40,order:7},downloads.displayCallback,null,'major_pages');menu.selectItem('downloads',0);return true;}catch(e){console.log(e);}},displayCallback:function(request){try{template.load('naboo/downloads',$('#naboo_content'));$('#naboo_downloads_tracks').createDatagrid({type:'downloads',template_js:true,id:0,songs:request.results});if((typeof(COBRANDING)!='undefined')&&(COBRANDING=='orange')){$('#naboo_playlist_orange_migration').show();}
naboo.afterLoad(true);return true;}catch(e){console.log(e);}}}};
if(typeof(profile)=="undefined"){var profile={init:function(user_id){profile.user_id=user_id;profile.$modele_activity=$('#modele_activity');profile.$modele_follower=$('#modele_follower');profile.$modele_playlist=$('#modele_playlist');profile.$modele_album=$('#modele_album').remove();profile.$modele_artist=$('#modele_artist');profile.$favorites_artists=$('#favorites-artists');profile.$favorites_artists_empty=$('#favorites-artists-empty');profile.$favorites_albums=$('#favorites-albums');profile.$favorites_albums_empty=$('#favorites-albums-empty');profile.$favorites_playlists=$('#favorites-playlists');profile.$favorites_playlists_empty=$('#favorites-playlists-empty');profile.$top_charts=$('#top_charts');profile.$top_title_user_empty=$('#top-title-user-empty');profile.$activity_content=$('.activity-content');profile.$activity_empty=$('#activity-empty');Events.unsubscribe(Events.playlist.created,profile.drawNewPlaylist);Events.unsubscribe(Events.playlist.removed,profile.removePlaylist)
Events.unsubscribe(Events.user.addFavorite,profile.drawNewFavorite);Events.unsubscribe(Events.user.deleteFavorite,profile.removeFavorite);Events.subscribe(Events.user.addFavorite,profile.drawNewFavorite);Events.subscribe(Events.user.deleteFavorite,profile.removeFavorite);if(profile.user_id==USER.USER_ID){Events.subscribe(Events.playlist.created,profile.drawNewPlaylist);Events.subscribe(Events.playlist.removed,profile.removePlaylist);}
advertising.call('profile',user_id);return true;},display:function(page,seo_data){try{var path=page.split('?');path=path[0].split('/');if(path[0]!='profile'||typeof(path[1])=='undefined'||path[1]==null||path[1]==''){return false;}
var user_id=path[1];profile.user_id=user_id;if(typeof(seo_data)!='undefined'){profile.displayCallback(seo_data);}else{api.call('deezer_pageProfile',{'user_id':user_id},profile.displayCallback);}
return true;}catch(e){console.log(e);}},displayCallback:function(request){try{if(request==false||request==null){return false;}
if(typeof(request.results)!='undefined'&&typeof(request.error)!='undefined'){request=request.results;}
if(request.DATA==null){return false;}
if(request.DATA.SOCIAL||profile.user_id==USER.USER_ID){template.load('naboo/profile',$('#naboo_content'));}
else{template.load('naboo/profile_private',$('#naboo_content'));}
profile.init(profile.user_id);if(typeof(request.DATA.ACTIVATION)=='undefined'||request.DATA.ACTIVATION==2){$('#description-user h2').text(trad.user.check_username_unavailable);$('#description-user .user-public').hide();$('#feed-user').hide();$('#favorites-user').hide();naboo.afterLoad(true);return false;}
profile.drawHeader(request.DATA);profile.drawBlock(request.HAS_BLOCKED);profile.checkMessagesRestriction(request);profile.drawFollow(request.FOLLOW);if(request.DATA.SOCIAL||profile.user_id==USER.USER_ID){profile.drawActivities(request.ACTIVITIES);profile.drawFollower(request.FOLLOWER);profile.drawFollowing(request.FOLLOWING);profile.drawTop(request.TOP_TRACKS)
profile.drawPlaylist(0,2);profile.drawAlbum(0,10);profile.drawArtist(0,30);}
naboo.afterLoad(true);live.deleteChannel(live.lastFeed);window.clearTimeout(live.timeoutConnect);live.lastFeed='-1_0_USERFEED_'+profile.user_id;live.timeoutConnect=window.setTimeout(function(){live.addChannel(live.lastFeed);},3000);return true;}catch(e){console.log(e.message,e.stack);}},drawHeader:function(data){profile.data=data;profile.display_name=data.DISPLAY_NAME;$('#description-user h2').text(data.DISPLAY_NAME);$('#description-user > span#user-country').text(data.COUNTRY);$('#avatar-user .img_main').attr('src',SETTING_DOMAIN_IMG+'/user/'+data.USER_PICTURE+'/122x122-000000-80-0-0.jpg');if(data.ONLINE!==false&&(data.SOCIAL||profile.user_id==USER.USER_ID)){if(typeof(data.ONLINE.SONG)!='undefined'&&data.ONLINE.SONG!=null&&typeof(data.ONLINE.SONG.SNG_ID)!='undefined'){$('#user-nowplaying > a').text(data.ONLINE.SONG.SNG_TITLE).attr({'href':'/track/'+data.ONLINE.SONG.SNG_ID,'onClick':'dzPlayer.playTracksId(['+data.ONLINE.SONG.SNG_ID+'], 0); return false;'});$('#user-nowplaying > span > a').text(data.ONLINE.SONG.ART_NAME).attr({'href':'/artist/'+data.ONLINE.SONG.ART_ID,'onClick':'loadBox("artist/'+data.ONLINE.SONG.ART_ID+'"); return false;'});$('#user-nowplaying').css('visibility','visible');}}else{$('#user-nowplaying').css('visibility','hidden');}
return true;},drawTop:function(data){if(typeof(data)!='object'||data.total==0){profile.$top_charts.hide();profile.$top_title_user_empty.show();return true;}
profile.$top_title_user_empty.hide();profile.$top_charts.createDatagrid({type:'toptrack_profile',songs:data,id:profile.user_id,scrollInfinite:false}).show();return true;},drawFollow:function(data){if(data!==false){$('#btn_follow').show();user.setUnFollowState($('#btn_follow'),profile.user_id,profile.data);}else{if(profile.user_id==USER.USER_ID){$('#btn_follow').hide();return true;}
$('#btn_follow').show();user.setFollowState($('#btn_follow'),profile.user_id,profile.data);}
return true;},drawBlock:function(data){if(profile.user_id!=USER.USER_ID&&USER.USER_ID!=0){if(data!==false){$('#btn_block').show();user.setUnBlockState($('#btn_block'),profile.user_id,profile.data);}else{$('#btn_block').show();user.setBlockState($('#btn_block'),profile.user_id,profile.data);}}else{$('#btn_block').hide();}
return true;},drawActivities:function(data){if(data.total==0){profile.$activity_content.hide();profile.$activity_empty.show();return true;}
profile.$activity_empty.hide();display_line=$('<p></p>');for(i in data.data){display_line.append(profile.appendActivity(data.data[i]));}
profile.$activity_content.html(display_line.children()).show();calculeTime();},appendActivity:function(data){$item=profile.$modele_activity.clone().attr('id',null).show();var ico='';if(data.ACTION=="ARTIST_FAN"){ico='icn_star_fav-16';title=data.ART_NAME;title_click='loadBox("artist/'+data.ART_ID+'"); return false;';sub_title='';sub_title_click='';}
if(data.ACTION=="ALBUM_FAN"){ico='icn_star_fav-16';title=data.ALB_TITLE;title_click='loadBox("album/'+data.ALB_ID+'"); return false;';sub_title=data.ART_NAME;sub_title_click='loadBox("artist/'+data.ART_ID+'"); return false;';}
if(data.ACTION=='PLAYLIST_CREATION'){ico='icn_playlist_grey-white-16';title=data.PLAYLIST_TITLE;title_click='loadBox("playlist/'+data.PLAYLIST_ID+'"); return false;';sub_title='';sub_title_click='';}
if(ico==''){return false;}
$('.icn_16',$item).addClass(ico);$('.activity-info > a',$item).html(util.getOuterHTML($('.activity-info > a span',$item))+title).attr('onClick',title_click);$('.activity-info > span a',$item).html(sub_title).attr('onClick',sub_title_click);;$('.timestamp',$item).attr('data-timestamp',data.DATE);return $item;},drawFollower:function(data){if(data.total>0){$('#follower-user strong').text(data.total);}
display_line=[];for(i in data.data){display_line[i]=profile.appendFollow(data.data[i]);}
$('#follower-user ul').append(display_line.join(''));return true;},drawFollowing:function(data){if(data.total>0){$('#following-user strong').text(data.total);}
display_line=[];for(i in data.data){display_line[i]=profile.appendFollow(data.data[i]);}
$('#following-user ul').append(display_line.join(''));return true;},appendFollow:function(user){$item=profile.$modele_follower.clone().attr('id',null).show();$('a',$item).attr({'href':'/profile/'+user.USER_ID,'onClick':'loadBox("profile/'+user.USER_ID+'"); return false;','onmouseover':"$(this).tipsy({trigger: 'manual', gravity: 's', fallback:('"+addslashes(user.DISPLAY_NAME)+"')}).tipsy('show');",'onmouseout':"$(this).tipsy('hide');"});$('img',$item).attr('src',SETTING_DOMAIN_IMG+'/user/'+user.USER_PICTURE+'/25x25-000000-80-0-0.jpg');return util.getOuterHTML($item);},changeFollowingDisplay:function(evt,data){try{if(profile.user_id==USER.USER_ID){var current_nb=$('#following-user > strong').text();if(!isNaN(parseInt(current_nb))){if(evt.namespace=='USER.addFavorite'){$('#following-user > strong').text(parseInt(current_nb)+1);}else if(evt.namespace=='USER.deleteFavorite'){$('#following-user > strong').text(parseInt(current_nb)-1);}}}
if(data.USER_ID==profile.user_id){if(evt.namespace=='USER.addFavorite'){$('#btn_message').attr('onClick',"modal.open('lightbox/instant_messenger.php?friend_id="+profile.user_id+"'); return false;").show();}else if(evt.namespace=='USER.deleteFavorite'){$('#btn_message').attr("onClick",'void(0); return false;').hide();}}}catch(e){console.log(e);}},drawPlaylist:function(start,nb){var method='playlist.getListPublic';if(profile.user_id==USER.USER_ID){method='playlist.getList';}
$('#favorites-playlists .more-favorites').unbind('click').removeAttr('onclick').click(function(){return false;});api.call(method,{'array_default':['PLAYLIST_ID','TYPE','TITLE','PICTURE_TYPE','PLAYLIST_PICTURE','NB_SONG','PARENT_USER_ID','DURATION','SONGS'],'user_id':profile.user_id,'start':start,'nb':nb},function(request){var total=parseInt(request.results.total,10);var count=parseInt(request.results.count,10);var data=[];if(typeof(profile.data.NB_PLAYLISTS_LOVED_TRACKS)==='undefined'){profile.data.NB_PLAYLISTS_LOVED_TRACKS=0;}
for(var i=0;i<request.results.count;i++){var item=request.results.data[i];if(typeof(item.TYPE)!='undefined'&&item.TYPE==4){count--;profile.data.NB_PLAYLISTS_LOVED_TRACKS++;}else{data.push(item);}}
request.results.count=count;request.results.data=data;profile.drawPlaylistBloc(request.results.total);if(request.results.total==0){return true;}
if((request.results.count===0)&&((start+nb)<=request.results.total)){profile.drawPlaylist((start+nb),nb);return true;}
var display_line=$('<p></p>');for(i in request.results.data){var item=request.results.data[i];if($('[data-id='+item.PLAYLIST_ID+']',$('#favorites-playlists-list')).length==0){display_line.append(profile.appendPlaylist(item));}}
$('#favorites-playlists-list').append(display_line.children());if((request.results.total)<=(start+nb)){profile.drawPlaylistBloc($('#favorites-playlists-list').children(':visible').length);$('#favorites-playlists .more-favorites').hide();}else{$('#favorites-playlists .more-favorites').attr('onClick','profile.drawPlaylist('+(start+nb)+', 10); return false;');}});return true;},drawNewPlaylist:function(evt,params){var newPlaylistData={PLAYLIST_ID:params.id,TITLE:params.title,PLAYLIST_PICTURE:'',PICTURE_TYPE:'cover',SONGS:{data:[],total:0,count:0},NB_SONG:0};$('#favorites-playlists-list').append(profile.appendPlaylist(newPlaylistData));profile.drawPlaylistBloc();return true;},removePlaylist:function(evt,params){$item_delete=$('#profil_playlist_'+params.playlist_id);if($item_delete.length>0){$item_delete.remove();profile.drawPlaylistBloc();}
return true;},appendPlaylist:function(playlist){$item=profile.$modele_playlist.clone().attr('id','profil_playlist_'+playlist.PLAYLIST_ID).show().attr('data-id',playlist.PLAYLIST_ID);$('.img_main',$item).attr('src',SETTING_DOMAIN_IMG+'/'+playlist.PICTURE_TYPE+'/'+playlist.PLAYLIST_PICTURE+'/122x122-000000-80-0-0.jpg');$('a',$item).eq(0).attr({'onClick':'dzPlayer.playPlaylist('+playlist.PLAYLIST_ID+'); return false;','href':'/'+SETTING_LANG+'/playlist/'+playlist.PLAYLIST_ID});$('h3 a',$item).text(ucfirst(playlist.TITLE)).attr({'onClick':'loadBox("playlist/'+playlist.PLAYLIST_ID+'"); return false;','href':'/playlist/'+playlist.PLAYLIST_ID});$('.favorite-playlist-info > span',$item).text((playlist.NB_SONG<=1)?sprintf(trad.profile.nb_track,playlist.NB_SONG):sprintf(trad.profile.nb_tracks,playlist.NB_SONG));if(profile.user_id!=USER.USER_ID){favorite.display($('.add_fav',$item),{PLAYLIST_ID:parseInt(playlist.PLAYLIST_ID),type:'playlist',TITLE:addslashes(playlist.TITLE),PARENT_USERNAME:addslashes(profile.data.DISPLAY_NAME),PARENT_USER_ID:parseInt(playlist.PARENT_USER_ID)});}else{$('.add_fav',$item).css('display','none');}
playlist.SONGS.data=playlist.SONGS.data.slice(0,4);playlist.SONGS.count=playlist.SONGS.data.length;if(playlist.SONGS.total>0){$('.datagrid_profil_playlist',$item).createDatagrid({type:'playlist_profile',songs:playlist.SONGS,id:playlist.PLAYLIST_ID,scrollInfinite:false});}
return $item;},drawPlaylistBloc:function(nb){if(typeof(nb)=='undefined'){nb=$('#favorites-playlists-list').children().length-1;if(typeof(profile.data.NB_PLAYLISTS_LOVED_TRACKS)==='number'){nb=nb-profile.data.NB_PLAYLISTS_LOVED_TRACKS;}}
if(nb>0){profile.$favorites_playlists.show();profile.$favorites_playlists_empty.hide();$('#favorites-playlists h2').html(util.getOuterHTML($('#favorites-playlists h2 span'))+((nb<=1)?sprintf(trad.profile.total_playlist,nb):sprintf(trad.profile.total_playlists,nb)));if(nb>2){profile.$favorites_playlists.children('a').show();}}else{profile.$favorites_playlists.hide();profile.$favorites_playlists_empty.show();if(profile.user_id==USER.USER_ID){$('strong',profile.$favorites_playlists_empty).text(trad.profile.empty_playlist_myself);$('.btn',profile.$favorites_playlists_empty).show();}else{$('strong',profile.$favorites_playlists_empty).text(sprintf(trad.profile.empty_playlist,profile.data.DISPLAY_NAME));$('.btn',profile.$favorites_playlists_empty).hide();}}
return true;},drawAlbum:function(start,nb){$('#favorites-albums .more-favorites').unbind('click').removeAttr('onclick').click(function(){return false;});api.call('album.getFavorites',{'user_id':profile.user_id,'start':start,'nb':nb},function(request){profile.drawAlbumBloc(request.results.total);if(request.results.total==0){return true;}
display_line=[];for(i in request.results.data){display_line[i]=profile.appendAlbum(request.results.data[i]);}
$('#favorites-albums-list').append(display_line.join(''));$('#favorites-albums-list').coverPane({'cover_size':120,'padding':0,'between':0,'label_size':24});if(request.results.total<=(start+nb)){$('#favorites-albums .more-favorites').hide();}else{$('#favorites-albums .more-favorites').attr('onClick','profile.drawAlbum('+(start+nb)+', 30); return false;');}});return true;},appendAlbum:function(album){$item=profile.$modele_album.clone().attr('id','profil_album_'+album.ALB_ID).show();$('.label dt a',$item).attr({'onClick':'loadBox("album/'+album.ALB_ID+'"); return false;','href':'/album/'+album.ALB_ID}).text(album.ALB_TITLE);$('.label dd a',$item).attr({'onClick':'loadBox("artist/'+album.ART_ID+'"); return false;','href':'/artist/'+album.ART_ID}).text(album.ART_NAME);$('a',$item).eq(0).attr({'onClick':'dzPlayer.playAlbum('+album.ALB_ID+', 0, true, {TYPE:"profile_album", ID:'+album.ALB_ID+'}); return false;','href':'/album/'+album.ALB_ID});$('.img_main',$item).attr('src',SETTING_DOMAIN_IMG+'/cover/'+album.ALB_PICTURE+'/122x122-000000-80-0-0.jpg');return util.getOuterHTML($item);},drawAlbumBloc:function(nb){if(typeof(nb)=='undefined'){nb=$('#favorites-albums-list').children().length-1;}
if(nb>0){profile.$favorites_albums.show();profile.$favorites_albums_empty.hide();$('#favorites-albums h2').html(util.getOuterHTML($('#favorites-albums h2 span'))+((nb<=1)?sprintf(trad.profile.total_album,nb):sprintf(trad.profile.total_albums,nb)));if(nb>2){profile.$favorites_albums.children('a').show();}}else{profile.$favorites_albums.hide();profile.$favorites_albums_empty.show();if(profile.user_id==USER.USER_ID){$('strong',profile.$favorites_albums_empty).text(trad.profile.empty_album_myself);$('.btn',profile.$favorites_albums_empty).show();}else{$('strong',profile.$favorites_albums_empty).text(sprintf(trad.profile.empty_album,profile.data.DISPLAY_NAME));$('.btn',profile.$favorites_albums_empty).hide();}}
return true;},drawNewAlbum:function(params){if(profile.user_id==USER.USER_ID){params.ALB_PICTURE='';$('#favorites-albums-list').append(profile.appendAlbum(params));profile.drawAlbumBloc();}
return true;},removeAlbum:function(params){if(profile.user_id==USER.USER_ID){$item_delete=$('#profil_album_'+params.ALB_ID);if($item_delete.length>0){$item_delete.remove();profile.drawAlbumBloc();}}
return true;},drawArtist:function(start,nb){api.call('artist.getFavorites',{'user_id':profile.user_id,'start':start,'nb':nb},function(request){profile.drawArtistBloc(request.results.total);if(request.results.total==0){return true;}
display_line=[];for(i in request.results.data){display_line[i]=profile.appendArtist(request.results.data[i]);}
$('#favorites-artists-list').append(display_line.join(''));});return true;},drawArtistBloc:function(nb){if(typeof(nb)=='undefined'){nb=$('#favorites-artists-list').children().length-1;}
if(nb>0){profile.$favorites_artists.show();profile.$favorites_artists_empty.hide();$('#favorites-artists h2').html(util.getOuterHTML($('#favorites-artists h2 span'))+((nb<=1)?sprintf(trad.profile.total_artist,nb):sprintf(trad.profile.total_artists,nb)));}else{profile.$favorites_artists.hide();profile.$favorites_artists_empty.show();if(profile.user_id==USER.USER_ID){$('strong',profile.$favorites_artists_empty).text(trad.profile.empty_artist_myself);$('.btn',profile.$favorites_artists_empty).show();}else{$('strong',profile.$favorites_artists_empty).text(sprintf(trad.profile.empty_artist,profile.data.DISPLAY_NAME));$('.btn',profile.$favorites_artists_empty).hide();}}
return true;},appendArtist:function(artist){$item=profile.$modele_artist.clone().attr('id','profil_artist_'+artist.ART_ID).show();$('a',$item).attr({'onClick':'loadBox("artist/'+artist.ART_ID+'"); return false;','href':'/artist/'+artist.ART_ID}).text(artist.ART_NAME);return util.getOuterHTML($item);},drawNewArtist:function(params){if(profile.user_id==USER.USER_ID){$('#favorites-artists-list').append(profile.appendArtist(params));profile.drawArtistBloc();}
return true;},removeArtist:function(params){if(profile.user_id==USER.USER_ID){$item_delete=$('#profil_artist_'+params.ART_ID);if($item_delete.length>0){$item_delete.remove();profile.drawArtistBloc();}}
return true;},drawNewFavorite:function(evt,params){if(params.type=='album'){profile.drawNewAlbum(params);}else if(params.type=='artist'){profile.drawNewArtist(params);}else if(params.type=='friend'){profile.changeFollowingDisplay(evt,params);}},removeFavorite:function(evt,params){if(params.type=='album'){profile.removeAlbum(params);}else if(params.type=='artist'){profile.removeArtist(params);}else if(params.type=='friend'){profile.changeFollowingDisplay(evt,params);}},checkMessagesRestriction:function(data){try{if(typeof(data.IS_BLOCKED)!='boolean'||typeof(data.FOLLOW)=='undefined'){return false;}
if(data.IS_BLOCKED==true||data.FOLLOW==false||profile.user_id==USER.USER_ID){$('#btn_message').attr("onClick",'void(0); return false;').hide();}else if(data.IS_BLOCKED==false){$('#btn_message').attr('onClick',"modal.open('lightbox/instant_messenger.php?friend_id="+profile.user_id+"'); return false;").show();}
return true;}catch(e){console.log(e.message,e.stack);}},toogleFollowingMessage:function(evt,data){try{if(data.type=='friend'){if(evt.namespace=='USER.addFavorite'){$('#follow_users_send_message_'+data.USER_ID).show();profile.$followSelfNumber++;}else if(evt.namespace=='USER.deleteFavorite'){$('#follow_users_send_message_'+data.USER_ID).hide();profile.$followSelfNumber--;}
if(profile.$followIdFacebox==USER.USER_ID&&profile.$followTypeFacebox=='following'){$('#follow_user_title').text(sprintf(trad.profile.following_self_title,profile.$followSelfNumber));}}}catch(e){console.log(e.message,e.stack);}}}};
if(typeof(recommendations)=="undefined"){var recommendations={init:function(){try{recommendations.$modelePlaylist=$('#naboo_recommendation_modele_playlist').clone().removeAttr('id');$('#naboo_recommendation_modele_playlist').remove();recommendations.$contentPlaylist=$('#naboo_recommendation_content_playlist');recommendations.$modeleAlbumRelease=$('#naboo_recommendation_modele_album_release').clone().removeAttr('id');$('#naboo_recommendation_modele_album_release').remove();recommendations.$contentAlbumRelease=$('#naboo_recommendation_content_album_release');recommendations.$modeleMessage=$('#naboo_recommendation_modele_message').clone().removeAttr('id');$('#naboo_recommendation_modele_message').remove();recommendations.$contentMessage=$('#naboo_recommendation_content_message');recommendations.$modeleTopFriend=$('#naboo_recommendation_modele_top_friend').clone().removeAttr('id');$('#naboo_recommendation_modele_top_friend').remove();recommendations.$contentTopFriend=$('#naboo_recommendation_content_top_friend');recommendations.$modeleAlbumSuggest=$('#recommendation_album_suggest_modele').clone().removeAttr('id');$('#recommendation_album_suggest_modele').remove();recommendations.$contentAlbumsSuggest=$('#recommendation_albums_suggest');recommendations.$modeleConcert=$('#recommendation_concert_modele').clone().removeAttr('id');$('#recommendation_concert_modele').remove();recommendations.$contentConcert=$('#recommendation_concert');Events.unsubscribe(Events.layout.adsBackground,recommendations.adjustContent);Events.subscribe(Events.layout.adsBackground,recommendations.adjustContent);recommendations.initGeoloc();return true;}catch(e){console.log(e.message,e.stack);}},display:function(){try{api.call('deezer_pageReco',{'USER_ID':USER.USER_ID,'COUNTRY':COUNTRY},recommendations.displayCallback,{},'major_pages');return true;}catch(e){console.log(e.message,e.stack);}},displayCallback:function(request){try{if(typeof(request)=='undefined'||request===false||typeof(request.results)=='undefined'){return false;}
recommendations.data=request.results;template.load('naboo/recommendations',$('#naboo_content'));recommendations.init();recommendations.displayPlaylist(recommendations.data.PLAYLIST);recommendations.displayAlbumRelease(recommendations.data.ALBUMS_LATEST);recommendations.displayAlbumsSuggest(recommendations.data.ALBUMS_SUGGEST);recommendations.displayMessage(recommendations.data.MESSAGE);recommendations.displayTopFriend(recommendations.data.TOP_FRIEND);naboo.afterLoad(true);recommendations.getEvents();menu.selectItem('recommendations',0);advertising.call('recommendations','');naboo.afterLoad(true);return true;}catch(e){console.log(e.message,e.stack);}},displayPlaylist:function(data){try{if(typeof(data)=='undefined'||typeof(data.data)=='undefined'||typeof(data.count)=='undefined'||data.count===0){recommendations.$contentPlaylist.hide();$('#naboo_recommendation_content_playlist_empty').show();return false;}
var display_line=$('<p></p>');for(var i in data.data){display_line.append(recommendations.drawPlaylist(data.data[i]));}
$('ul',recommendations.$contentPlaylist).append(display_line.children()).coverPane({'cover_size':180,'padding':0,'between':20,'label_size':48,'max_line':1});return true;}catch(e){console.log(e.message,e.stack);}},drawPlaylist:function(playlist){try{var $item=recommendations.$modelePlaylist.clone().show();$('.img_main',$item).attr('src',SETTING_DOMAIN_IMG+'/'+playlist.PICTURE_TYPE+'/'+playlist.PLAYLIST_PICTURE+'/180x180-000000-80-0-0.jpg');$('.cover > a',$item).attr({'onClick':"tracking.track('reco_playlist_play'); dzPlayer.playPlaylist("+playlist.PLAYLIST_ID+", 0, true, {TYPE : 'recommendations_playlist', ID : "+playlist.PLAYLIST_ID+"}); return false;",'href':'/'+SETTING_LANG+'/playlist/'+playlist.PLAYLIST_ID});$('dl dt a',$item).text(playlist.TITLE).attr({'onClick':"loadBox('playlist/"+playlist.PLAYLIST_ID+"'); return false;",'href':'/'+SETTING_LANG+'/playlist/'+playlist.PLAYLIST_ID});$('dd a',$item).attr({'onClick':"loadBox('profile/"+playlist.USER_ID+"'); return false;",'href':'/'+SETTING_LANG+'/profile/'+playlist.USER_ID});$('dd img',$item).attr('src',SETTING_DOMAIN_IMG+'/user/'+playlist.USER_PICTURE+'/20x20-000000-80-0-0.jpg');$('dd .blog_name',$item).text(playlist.BLOG_NAME);return $item;}catch(e){console.log(e.message,e.stack);}},displayAlbumRelease:function(data){try{if(typeof(data)=='undefined'){return false;}
if(typeof(data.data)=='undefined'||typeof(data.count)=='undefined'||data.count===0){recommendations.$contentAlbumRelease.addClass('empty');$('#recommendation_albums_latest_empty').show();if(typeof(userData.data.FAVORITES_ARTISTS)!='undefined'&&userData.data.FAVORITES_ARTISTS.count===0){$('#recommendation_albums_latest_empty .without_favorites').show();}else{$('#recommendation_albums_latest_empty .with_favorites').show();}
return false;}
var display_line=$('<p></p>');for(var i in data.data){display_line.append(recommendations.drawAlbumRelease(data.data[i]));}
$('ul',recommendations.$contentAlbumRelease).append(display_line.children()).coverPane({'cover_size':180,'padding':0,'between':20,'label_size':48,'max_line':1});return true;}catch(e){console.log(e.message,e.stack);}},drawAlbumRelease:function(album){try{var $item=recommendations.$modeleAlbumRelease.clone().show();$('.cover > a',$item).attr('data-id',album.ALB_ID).click(function(){tracking.track("reco_release_play");});$('.cover > a > .img_main',$item).attr('src',SETTING_DOMAIN_IMG+'/cover/'+album.ALB_PICTURE+'/180x180-000000-80-0-0.jpg');$('.label > dl > dt > a',$item).text(album.ALB_TITLE);$('.label > dl > dt > a',$item).attr({'data-id':album.ALB_ID,'href':'/'+SETTING_LANG+'/album/'+album.ALB_ID});$('.label > dl > dd:eq(0) > a',$item).text(album.ART_NAME);$('.label > dl > dd:eq(0) > a',$item).attr({'data-id':album.ART_ID,'href':'/'+SETTING_LANG+'/artist/'+album.ART_ID});$('.label > dl > .release',$item).text(trad.music.naboo_release_date+' '+formatDate(album.PHYSICAL_RELEASE_DATE));return $item;}catch(e){console.log(e.message,e.stack);}},adjustContent:function(){try{if(www.getCurrentPageType()=='recommendations'){if(!$('#naboo_recommendation_content_playlist_empty').is(':visible')){$('ul',recommendations.$contentPlaylist).coverPane_update();}
if(!$('#recommendation_albums_latest_empty').is(':visible')){$('ul',recommendations.$contentAlbumRelease).coverPane_update();}}
return false;}catch(e){console.log(e.message,e.stack);}},displayMessage:function(data){try{if(typeof(data)=='undefined'||data.count===0){recommendations.$contentMessage.addClass('empty');return false;}
var display_line=$('<p></p>');for(var i in data.data){display_line.append(recommendations.drawMessage(data.data[i],i));}
recommendations.$contentMessage.empty().append(display_line.children());return true;}catch(e){console.log(e.message,e.stack);}},drawMessage:function(message,index){try{var $item=recommendations.$modeleMessage.clone().show();$item.attr('id','naboo_recommendation_message_'+message.SHARE_ID);$('.naboo_recommendation_message_picture',$item).attr('src',SETTING_DOMAIN_IMG+'/user/'+message.USER_PICTURE+'/70x70-000000-80-0-0.jpg');$('.naboo_recommendation_message_author',$item).text(message.BLOG_NAME).attr('onclick',"loadBox('profile/"+message.USER_ID+"'); return false;");switch(message.TYPE){case'0':$('.naboo_recommendation_message_subject',$item).text(message.SNG_TITLE+' - '+message.ART_NAME).attr('onclick','dzPlayer.playTracksId(['+message.SNG_ID+'], 0, true, {TYPE:"recommendations_friend_share_track", ID:'+message.SNG_ID+'}); return false;');break;case'1':$('.naboo_recommendation_message_subject',$item).text(message.ALB_TITLE+' - '+message.ART_NAME).attr('onclick','dzPlayer.playAlbum('+message.ALB_ID+', 0, true, {TYPE:"recommendations_friend_share_album", ID:'+message.ALB_ID+'}); return false;');break;case'2':$('.naboo_recommendation_message_subject',$item).text(message.ART_NAME).attr('onclick','loadBox("artist/'+message.ART_ID+'"); return false;');break;case'3':$('.naboo_recommendation_message_subject',$item).text(message.TITLE).attr('onclick','dzPlayer.playPlaylist('+message.PLAYLIST_ID+', 0, true, {TYPE:"recommendations_friend_share_playlist", ID:'+message.PLAYLIST_ID+'}); return false;');break;case'4':$('.naboo_recommendation_message_subject',$item).text(message.TITLE).attr('onclick',"loadBox('radio/radio-"+message.RADIO_ID+"'); return false;");$('.naboo_recommendation_message_type',$item).text(trad.music.naboo_share_radio_reco);break;case'6':$('.naboo_recommendation_message_subject',$item).text(message.ART_NAME).attr('onclick',"loadBox('radio/artist-"+message.ART_ID+"'); return false;");$('.naboo_recommendation_message_type',$item).text(trad.music.naboo_share_radio_reco);break;}
$('.naboo_recommendation_message_text',$item).text(message.MESSAGE);$('.naboo_recommendation_message_hide',$item).attr('onclick','recommendations.hideMessage('+message.SHARE_ID+'); return false;');if(index>2){$item.hide();}
return $item;}catch(e){console.log(e.message,e.stack);}},hideMessage:function(share_id){try{api.call('share_hide',{share_id:share_id},recommendations.hideMessageCallback,{'share_id':share_id});return true;}catch(e){console.log(e.message,e.stack);}},hideMessageCallback:function(request,callback_parameters){try{if(typeof(request)=='undefined'||request===false){return false;}
if(typeof(callback_parameters.share_id)=='undefined'){return false;}
var share_id=callback_parameters.share_id;$('#naboo_recommendation_message_'+share_id).remove();$('#naboo_recommendation_content_message > p:hidden').first().show();if($('#naboo_recommendation_content_message > p:visible').length>=3){recommendations.$contentMessage.parent().addClass('full');}else{recommendations.$contentMessage.parent().removeClass('full');}
return true;}catch(e){console.log(e);}},displayTopFriend:function(data){try{if(typeof(data)=='undefined'||typeof(data.data)=='undefined'||typeof(data.count)=='undefined'||data.count===0){recommendations.$contentTopFriend.hide();$('#naboo_recommendation_content_top_friend_empty').show();if(USER.FB_USER_ID===0){$('#fb_btn_without_fb').show();}else{$('#fb_btn_with_fb').show();}}
var display_line=$('<p></p>');for(var i in data.data){if(right.checkSongAvailable(data.data[i])!=right.READABLE){continue;}
display_line.append(recommendations.drawTopFriend(data.data[i],i));}
recommendations.$contentTopFriend.append(display_line.children());return true;}catch(e){console.log(e.message,e.stack);}},drawTopFriend:function(song,index){try{var $item=recommendations.$modeleTopFriend.clone().show();$item.attr({'data-position':index,'id':'naboo_top_friend_id_'+song.SNG_ID});$('.track-ranking',$item).text(parseInt(index,10)+1);$('.naboo_top_friend_title',$item).text(song.SNG_TITLE).attr({'onclick':'tracking.track("reco_top_friends_play"); recommendations.playTopFriend($(this), "all"); return false;','href':'/'+SETTING_LANG+'/track/'+song.SNG_ID});$('.naboo_top_friend_artist',$item).text(song.ART_NAME).attr({'onclick':"loadBox('artist/"+song.ART_ID+"'); return false;",'href':'/'+SETTING_LANG+'/artist/'+song.ART_ID});$('.track-play',$item).attr('onclick','tracking.track("reco_top_friends_play"); recommendations.playTopFriend($(this), "all"); return false;');return $item;}catch(e){console.log(e.message,e.stack);}},playTopFriend:function($item,type){try{var position=$item.parents('div').attr('data-position');if(typeof(recommendations.data.TOP_FRIEND.data[position])!='undefined'){if(type=='all'){dzPlayer.playTracks(recommendations.data.TOP_FRIEND.data,position,{TYPE:'recommendations_friend_top'});}else if(type=='one'){dzPlayer.playTracks([recommendations.data.TOP_FRIEND.data[position]],0,{TYPE:'recommendations_friend_top'});}}
return true;}catch(e){console.log(e.message,e.stack);}},displayAlbumsSuggest:function(data){try{if(typeof(data)=='undefined'||typeof(data.data)=='undefined'||typeof(data.count)=='undefined'||data.count===0){$('#recommendation_albums_suggest_empty').show();return false;}
var display_line=$('<p></p>');for(var i in data.data){display_line.append(recommendations.drawAlbumSuggest(i,data.data[i]));}
$('ul',recommendations.$contentAlbumsSuggest).append(display_line.children()).coverPane({'cover_size':180,'padding':0,'between':20,'label_size':100,'max_line':2});return true;}catch(e){console.log(e.message,e.stack);}},drawAlbumSuggest:function(index,data){try{var $item=recommendations.$modeleAlbumSuggest.clone().show();var similar_buffer=[];$('.cover > a',$item).attr({'onclick':'tracking.track("reco_lastfm_play"); dzPlayer.playAlbum('+data.ALB_ID+', 0, true, {TYPE : "recommendations_album", ID:'+data.ALB_ID+'}); return false;','href':'/'+SETTING_LANG+'/album/'+data.ALB_ID});$('.img_main',$item).attr({'src':SETTING_DOMAIN_IMG+'/cover/'+data.ALB_PICTURE+'/180x180-000000-80-0-0.jpg','alt':data.ALB_TITLE});$('dt a',$item).text(data.ALB_TITLE).attr({'onclick':"loadBox('album/"+data.ALB_ID+"'); return false;",'href':'/'+SETTING_LANG+'/album/'+data.ALB_ID});$('dd.mb_10 a',$item).text(data.ART_NAME).attr({'onclick':"loadBox('artist/"+data.ART_ID+"'); return false;",'href':'/'+SETTING_LANG+'/artist/'+data.ART_ID});var nb_similar=data.RELATED_ARTISTS.length;if(nb_similar>0){for(var i=0;i<nb_similar;i++){var similar=data.RELATED_ARTISTS[i];similar_buffer.push('<a href="/'+SETTING_LANG+'/artist/'+similar.ART_ID+'" onclick="tracking.track(\'reco_lastfm_similar_artist_click\', {id:'+similar.ART_ID+', name:\''+addslashes(similar.ART_NAME)+'\'}); loadBox(\'artist/'+similar.ART_ID+'\'); return false;">'+similar.ART_NAME+'</a>');}
$('.similar_list',$item).empty().append(similar_buffer.join(', '));}else{$('.similar_title',$item).hide();$('.similar_list',$item).hide();}
return $item;}catch(e){console.log(e.message,e.stack);}},getEvents:function(position){try{var params={'USER_ID':USER.USER_ID,'LIMIT':50};if(typeof(position)!='undefined'&&typeof(position.city)!='undefined'&&typeof(position.lat)!='undefined'&&typeof(position.lon)!='undefined'){params.CITY=position.city;params.LAT=position.lat;params.LON=position.lon;}else if(typeof(USER.SETTING.location)!='undefined'){if(typeof(USER.SETTING.location.city)!='undefined'&&typeof(USER.SETTING.location.lat)!='undefined'&&typeof(USER.SETTING.location.lon)!='undefined'){params.CITY=USER.SETTING.location.city;params.LAT=USER.SETTING.location.lat;params.LON=USER.SETTING.location.lon;}}
showLoading();api.call('songkick_getEvents',params,recommendations.getEventsCallback,{},'major_pages');return true;}catch(e){console.log(e.message,e.stack);}},getEventsCallback:function(request){try{Events.resolve('recommendations.songkick');if(typeof(request)=='undefined'||request===false||typeof(request.results)=='undefined'||request.error.length>0){return false;}
var data=request.results;recommendations.data.CITY=data.location.city;recommendations.displayConcert(data);return true;}catch(e){console.log(e.message,e.stack);}},displayConcert:function(data){try{if(typeof(data.events)=='undefined'||typeof(data.events.length)=='undefined'||data.events.length===0){recommendations.$contentConcert.hide();$('#recommendation_concert_empty').show();$('#recommendation_concert_empty a').click(function(){$(document.body).one('click','#favoritebox #btn_cancel a',function(){if(userData.data.FAVORITES_ARTISTS.count>0){recommendations.getEvents();}});});if(typeof(userData.data.FAVORITES_ARTISTS)!='undefined'&&userData.data.FAVORITES_ARTISTS.count===0){$('#recommendation_concert_empty .without_favorites').show();}else{$('#recommendation_concert_empty .with_favorites').show();}
hideLoading();return false;}
var events=data.events;var platform=data.platform;var display_line=$('<p></p>');for(var i in events){display_line.append(recommendations.drawConcert(events[i],platform));}
$('ul',recommendations.$contentConcert).empty().append(display_line.children());recommendations.$contentConcert.tinyscrollbar();if(typeof(platform.SONGKICK)!=='undefined'){$('#concerts_picto').show();}
if(typeof(recommendations.data.CITY)=='string'){$('#concerts_headline_city').text('('+recommendations.data.CITY+')');$('#concerts_city').val(recommendations.data.CITY);}
hideLoading();return true;}catch(e){console.log(e.message,e.stack);}},drawConcert:function(concert,platform){try{var $item=recommendations.$modeleConcert.clone().show();var months=new Array('',trad.date.jan,trad.date.feb,trad.date.mar,trad.date.apr,trad.date.may,trad.date.jun,trad.date.jul,trad.date.aug,trad.date.sep,trad.date.oct,trad.date.nov,trad.date.dec);$('img',$item).attr('src',SETTING_DOMAIN_IMG+'/artist/'+concert.ART_PICTURE+'/40x40-000000-80-0-0.jpg');$('.concert-info strong a',$item).attr({'href':concert.ART_URL,'target':'_blank','onclick':'tracking.track(\'ontour_click\', {art_id : '+concert.ART_ID+', type :\'reco\'});'});$('.art_name',$item).text(concert.ART_NAME);$('.place',$item).text(concert.PLACE);$('.month',$item).text(months[parseInt(concert.DATE_MONTH,10)]);$('.day',$item).text(concert.DATE_DAY);$('.concert-info > a',$item).attr({'target':'_blank'});if(typeof(platform.SONGKICK)!=='undefined'){$('.concert-info > a',$item).attr({'href':concert.PLACE_URL});}else{$('.concert-info > a',$item).attr({'href':concert.ART_URL});}
return $item;}catch(e){console.log(e.message,e.stack);}},initGeoloc:function(){var loadGoogleMaps=(function($){var now=$.now(),promise;return function(version,apiKey,language){if(promise){return promise;}
var deferred=$.Deferred();var resolve=function(){deferred.resolve(window.google&&google.maps?google.maps:false);};var callbackName="loadGoogleMaps_"+(now++);var params=$.extend({'sensor':false},apiKey?{"key":apiKey}:{},language?{"language":language}:{});if(window.google&&google.maps){resolve();}else if(window.google&&google.load){google.load("maps",version||3,{"other_params":$.param(params),"callback":resolve});}else{params=$.extend(params,{'v':version||3,'callback':callbackName});window[callbackName]=function(){resolve();setTimeout(function(){try{delete window[callbackName];}catch(e){}},20);};$.ajax({dataType:'script',data:params,url:'http://maps.google.com/maps/api/js'});}
promise=deferred.promise();return promise;};}(jQuery));loadGoogleMaps(3).done(function(){var $input_city=$('#concerts_city');var $edit_btn=$('#concerts_headline_edit');var $validate_btn=$('#concerts_headline_validate');var $cancel_btn=$('#concerts_headline_cancel');var $label_city=$('#concerts_headline_label');var $display_city=$('#concerts_headline_city');var geocoder=new google.maps.Geocoder();var getLatLng=function(address,callback){geocoder.geocode({'address':address,'region':COUNTRY},function(results,status){if(status==google.maps.GeocoderStatus.OK){var lat=results[0].geometry.location.lat();var lon=results[0].geometry.location.lng();var city;var nb_components=results[0].address_components.length;for(var i=0;i<nb_components;i++){if(typeof(city)!='undefined'){break;}
var component=results[0].address_components[i];var nb_types=component.types.length;for(var j=0;j<nb_types;j++){if(component.types[j]=='locality'){city=component.long_name;break;}}}
if(typeof(city)=='undefined'){city=address;}
callback({'city':city,'lat':lat,'lon':lon});}else{console.log('Geocode error : ',status);}});};$input_city.keyup(function(e){if(e.keyCode==13){$validate_btn.trigger('click');}else if(e.keyCode==27){$input_city.hide();$validate_btn.hide();$label_city.show();$display_city.show();$edit_btn.show();}});$validate_btn.click(function(e){e.preventDefault();e.stopPropagation();var address=$input_city.val();getLatLng(address,function(position){$input_city.hide();$validate_btn.hide();$label_city.show();$display_city.show();$edit_btn.show();var new_address=address.toUpperCase();var old_address=typeof(recommendations.data.CITY)=='string'?recommendations.data.CITY.toUpperCase():'';if(new_address!=old_address){$display_city.text('('+address+')');recommendations.getEvents(position);}});});$edit_btn.click(function(e){e.preventDefault();e.stopPropagation();$label_city.hide();$display_city.hide();$input_city.show().focus();$(this).hide();$validate_btn.show();}).show();});}};};
if(typeof(picks)=="undefined"){var picks={init:function(all_data){try{picks.data=all_data;menu.selectItem('picks',0);picks.$contentTagButton=$('#naboo_edito_tag_button');picks.$contentTagButton.bind('mousedown',picks.openTagsList);picks.$contentTagButton.bind("mouseup",picks.clickBox);picks.$modeleTag=$('#naboo_block_modele_tag').clone().removeAttr('id');$('#naboo_block_modele_tag').remove();picks.$contentTag=$('#naboo_block_tag');picks.$modeleAlbum=$('#naboo_block_modele_album').clone().removeAttr('id');$('#naboo_block_modele_album').remove();picks.$contentAlbum=$('#naboo_block_edito_album');picks.$modelePlaylist=$('#naboo_block_modele_playlist').clone().removeAttr('id');$('#naboo_block_modele_playlist').remove();picks.$contentPlaylist=$('#naboo_block_playlist');picks.$modeleSmartRadio=$('#naboo_block_modele_smartradio').clone().removeAttr('id');$('#naboo_block_modele_smartradio').remove();picks.$contentSmartRadio=$('#naboo_block_smartradio');picks.$modeleRadio=$('#naboo_block_modele_radio').clone().removeAttr('id');$('#naboo_block_modele_radio').remove();picks.$contentRadio=$('#naboo_block_radio');picks.$modeleTopTrack=$('#naboo_block_modele_top_track').clone().removeAttr('id');$('#naboo_block_modele_top_track').remove();picks.$contentTopTrack=$('#naboo_block_top_titre');picks.$modeleFacebookMain=$('#naboo_block_modele_facebook_main').clone().removeAttr('id');$('#naboo_block_modele_facebook_main').remove();picks.$modeleFacebookVideo=$('#naboo_block_modele_facebook_video').clone().removeAttr('id');$('#naboo_block_modele_facebook_video').remove();picks.$modeleFacebookPhoto=$('#naboo_block_modele_facebook_photo').clone().removeAttr('id');$('#naboo_block_modele_facebook_photo').remove();picks.$modeleFacebookDeezer=$('#naboo_block_modele_facebook_deezer').clone().removeAttr('id');$('#naboo_block_modele_facebook_deezer').remove();picks.$modeleFacebookLink=$('#naboo_block_modele_facebook_link').clone().removeAttr('id');$('#naboo_block_modele_facebook_link').remove();picks.$contentFacebook=$('#naboo_block_facebook');picks.$modelePartner=$('#naboo_block_modele_partner').clone().removeAttr('id');$('#naboo_block_modele_partner').remove();picks.$contentPartner=$('#naboo_block_partner');if(picks.data.PARTNERS.total==0){$('#picks_block_partner').hide();}
if(USER.OPTIONS.ads_display){picks.$contentFacebook.height(290);}
if(getObjectSize(picks.data.AUTO_PROMO_HABILLAGE)>0){if(www.allowAutoPromo(picks.data.AUTO_PROMO_HABILLAGE)){ads.displayAutopromo(picks.data.AUTO_PROMO_HABILLAGE);}}
Events.ready(Events.user.userReady,function(){picks.displaySuggestButton();});Events.unsubscribe(Events.playlist.created,picks.displaySuggestButton);Events.subscribe(Events.playlist.created,picks.displaySuggestButton);Events.unsubscribe(Events.playlist.removed,picks.displaySuggestButton);Events.subscribe(Events.playlist.removed,picks.displaySuggestButton);picks.$contentTagTitle=$('#naboo_edito_tag_title');picks.drawVisio(picks.data.VISIO.data);advertising.call('picks',picks.data.ALBUM_SELECTED_TAG);}catch(e){console.log(e.message,e.stack);}},display:function(){try{var tag=0;if(USER.USER_ID>0){if(typeof(USER.SETTING)!='undefined'&&typeof(USER.SETTING.site)!='undefined'&&typeof(USER.SETTING.site.edito_tag)!='undefined'){tag=USER.SETTING.site.edito_tag;}}
api.call('deezer_pageNewEdito',{'type':'all','tag_id':tag},picks.displayCallback);}catch(e){console.log(e.message,e.stack);}},displayCallback:function(request){try{if(request==false||request==null){return false;}
if(request.results==null){return false;}
template.load('naboo/picks',$('#naboo_content'));picks.init(request.results);picks.drawTags(request.results.TAGS,request.results.ALBUM_SELECTED_TAG);picks.drawAlbums(request.results.ALBUM);picks.drawPlaylists(request.results.PLAYLIST);picks.drawSmartRadios(request.results.SMART_RADIO);picks.drawRadios(request.results.RADIO);picks.drawTopTracks(request.results.TOP_TRACK);picks.drawPartner(request.results.PARTNERS);picks.drawFacebookFeed(request.results.FACEBOOK_FEED);naboo.afterLoad(true);return true;}catch(e){console.log(e.message,e.stack);}},displaySuggestButton:function(){try{if(typeof(userData.data['PLAYLISTS'])=='undefined'){return false;}
if(getObjectSize(userData.data['PLAYLISTS'].data)==0){$('#naboo_playlist_suggest').hide();}else{$('#naboo_playlist_suggest').show();}}catch(e){console.log(e.message,e.stack);}},drawVisio:function(data){try{visio.add($('#visio_content'),data);}catch(e){console.log(e.message,e.stack);}},drawTags:function(data,currentTag){try{if(typeof(data)=='undefined'||data.total==0){return true;}
display_line=$('<p></p>');for(var i in data.data){display_line.append(picks.appendTag(data.data[i]));}
picks.$contentTag.append(display_line.children());picks.$contentTagTitle.text(picks.getTagName(currentTag));}catch(e){console.log(e.message,e.stack);}},appendTag:function(tag){try{$item=picks.$modeleTag.clone().show();$('a',$item).attr('data-id',tag.TAG_ID).attr('data-name',tag.NAME).text(tag.NAME);return $item;}catch(e){console.log(e.message,e.stack);}},refreshTag:function(id){try{if(isNaN(parseInt(id))){return false;}
picks.closeTagsList();picks.$contentTagTitle.text(picks.getTagName(id));if(USER.USER_ID>0){if(typeof(USER.SETTING.site.edito_tag)=='undefined'||parseInt(USER.SETTING.site.edito_tag)!=parseInt(id)){Events.trigger(Events.user.settingChange,{site:{edito_tag:parseInt(id)}});}}
api.call('deezer_pageNewEdito',{'type':'album',tag_id:id},function(request){picks.$contentAlbum.empty();picks.drawAlbums(request.results.ALBUM);});advertising.call('picks',id);}catch(e){console.log(e.message,e.stack);}},getTagName:function(id){try{for(var i in picks.data.TAGS.data){if(picks.data.TAGS.data[i].TAG_ID==id){return picks.data.TAGS.data[i].NAME;}}
return'';}catch(e){console.log(e.message,e.stack);}},openTagsList:function(){try{if(!picks.$contentTag.is(':visible')){picks.$contentTag.slideToggle('fast');picks.$contentTag.bind("mouseup",picks.clickBox);$('body').bind("mouseup",picks.clickBody);}else{picks.closeTagsList();}}catch(e){console.log(e.message,e.stack);}},closeTagsList:function(){try{if(picks.$contentTag.is(':visible')){picks.$contentTag.slideToggle('fast');picks.$contentTag.unbind("mouseup",picks.clickBox);$('body').unbind("mouseup",picks.clickBody);}}catch(e){console.log(e.message,e.stack);}},clickBox:function(){return false;},clickBody:function(){try{picks.closeTagsList();}catch(e){console.log(e.message);}},drawAlbums:function(data){try{if(data.total==0){return true;}
display_line=$('<p></p>');for(var i in data.data){display_line.append(picks.appendAlbum(data.data[i]));}
picks.$contentAlbum.append(display_line.children());}catch(e){console.log(e.message,e.stack);}},appendAlbum:function(album){try{$item=picks.$modeleAlbum.clone().show();$('div > .cover > a',$item).attr({'href':'/'+SETTING_LANG+'/album/'+album.ALB_ID,'data-id':album.ALB_ID}).attr('data-title',album.ALB_TITLE);$('div > .cover > a > img:eq(1)',$item).attr('src',SETTING_DOMAIN_IMG+'/cover/'+album.ALB_PICTURE+'/120x120-000000-80-0-0.jpg');$('div > .label > dl > .album > a',$item).attr({'href':'/'+SETTING_LANG+'/album/'+album.ALB_ID,'data-url':album.ALB_ID}).text(album.ALB_TITLE);$('div > .label > dl > .artist > a',$item).attr({'href':'/'+SETTING_LANG+'/artist/'+album.ART_ID,'data-url':album.ART_ID}).text(album.ART_NAME);if(typeof(album.STATE)!='undefined'){switch(parseInt(album.STATE)){case 1:$('.ribbon_fav',$item).show();break;case 2:$('.ribbon_edito-select',$item).show();break;}}
return $item;}catch(e){console.log(e.message,e.stack);}},drawPlaylists:function(data){try{if(data.total==0){return true;}
display_line=$('<p></p>');for(var i in data.data){var isFirst=(i==0);var isLast=(i==data.count-1);display_line.append(picks.appendPlaylist(data.data[i],isFirst,isLast));}
picks.$contentPlaylist.append(display_line.children());}catch(e){console.log(e.message,e.stack);}},appendPlaylist:function(playlist,isFirst,isLast){try{$item=picks.$modelePlaylist.clone().show();if(isFirst){$item.addClass('first');}
if(isLast){$item.addClass('last');}
$item.attr('data-id',playlist.PLAYLIST_ID).attr('data-title',playlist.TITLE);$('.cover > a',$item).attr('href','/'+SETTING_LANG+'/playlist/'+playlist.PLAYLIST_ID);$('.cover > a > .img_main',$item).attr('src',SETTING_DOMAIN_IMG+'/'+playlist.PICTURE_TYPE+'/'+playlist.PLAYLIST_PICTURE+'/125x125-000000-80-0-0.jpg');$('.label > dl > .fsi',$item).text(playlist.COMMENT);$('.label > dl > dt > a',$item).attr('href','/'+SETTING_LANG+'/playlist/'+playlist.PLAYLIST_ID).text(playlist.TITLE);$('.label > dl > dd:eq(0) > a',$item).attr({'data-id':playlist.PARENT_USER_ID,'href':'/'+SETTING_LANG+'/profile/'+playlist.PARENT_USER_ID}).text(playlist.BLOG_NAME);return $item;}catch(e){console.log(e.message,e.stack);}},openSuggest:function(){try{if(USER.USER_ID>0){modal.open('lightbox/playlist_suggest.php');}else{modal.open('login.php');}}catch(e){console.log(e.message,e.stack);}},drawSmartRadios:function(data){try{if(data.total==0){return true;}
display_line=$('<p></p>');for(var i in data.data){display_line.append(picks.appendSmartRadio(data.data[i]));}
picks.$contentSmartRadio.append(display_line.children());}catch(e){console.log(e.message,e.stack);}},appendSmartRadio:function(smartradio){try{$item=picks.$modeleSmartRadio.clone().show();$('a:eq(0) > .img_main',$item).attr('src',SETTING_DOMAIN_IMG+'/artist/'+smartradio.ART_PICTURE+'/150x100-000000-80-0-0.jpg');$('a',$item).attr({'data-id':smartradio.ART_ID,'href':'/'+SETTING_LANG+'/radio/artist-'+smartradio.ART_ID,'data-name':smartradio.ART_NAME});$('a:eq(1)',$item).attr('href','/'+SETTING_LANG+'/radio/artist-'+smartradio.ART_ID).text(smartradio.ART_NAME);return $item;}catch(e){console.log(e.message,e.stack);}},drawRadios:function(data){try{if(data.total==0){return true;}
display_line=$('<p></p>');for(var i in data.data){display_line.append(picks.appendRadio(data.data[i]));}
picks.$contentRadio.append(display_line.children());}catch(e){console.log(e.message,e.stack);}},appendRadio:function(radio){try{$item=picks.$modeleRadio.clone().show();$('a:eq(0) > .img_main',$item).attr('src',SETTING_DOMAIN_IMG+'/misc/'+radio.RADIO_PICTURE+'/100x100-000000-80-0-0.jpg');$('a',$item).attr({'data-id':radio.RADIO_ID,'data-title':radio.TITLE,'href':'/'+SETTING_LANG+'/radio/radio-'+radio.RADIO_ID});$('a:eq(1)',$item).attr('href','/'+SETTING_LANG+'/radio/radio-'+radio.RADIO_ID).text(radio.TITLE);return $item;}catch(e){console.log(e.message,e.stack);}},drawTopTracks:function(data){try{if(data.total==0){return true;}
display_line=$('<p></p>');var position=0;for(var i in data.data){var item=data.data[i];if((USER.OPTIONS.ads_display&&i==5)||i==10){break;}
if(right.checkSongAvailable(item)!=right.READABLE&&typeof(item.FALLBACK)=='undefined'){continue;}
display_line.append(picks.appendTopTrack(item,position));position++;}
picks.$contentTopTrack.append(display_line.children());}catch(e){console.log(e.message,e.stack);}},appendTopTrack:function(track,position){try{$item=picks.$modeleTopTrack.clone().show();$item.attr('data-id',track.SNG_ID).attr('data-name',track.SNG_TITLE).attr('data-rank',(position+1));$('dl > dt > a',$item).attr('href','/'+SETTING_LANG+'/track/'+track.SNG_ID).text(track.SNG_TITLE);$('dl > .top-ranking',$item).text(position+1);$('dl > .artist > a',$item).attr({'data-id':track.ART_ID,'href':'/'+SETTING_LANG+'/artist/'+track.ART_ID}).text(track.ART_NAME);var variation='icn_egal-16';if(track.VARIATION>0){variation='icn_up-16';}else if(track.VARIATION<0){variation='icn_down-16';}
$('dl > .top-status > span',$item).addClass(variation);return $item;}catch(e){console.log(e.message,e.stack);}},playTopTrack:function($item){try{var sng_id=$item.parents('li').attr('data-id');for(var t in picks.data.TOP_TRACK.data){if(picks.data.TOP_TRACK.data[t].SNG_ID==sng_id){dzPlayer.playTracks(picks.data.TOP_TRACK.data,t,true,{TYPE:'selection_top',ID:sng_id});break;}}}catch(e){console.log(e.message,e.stack);}},drawPartner:function(data){try{if(data.total==0){return true;}
if(HAS_FESTIVALS==true){$('#picks_block_partner .see_all_partners').show();}
display_line=$('<p></p>');for(var i in data.data){display_line.append(picks.appendPartner(data.data[i],data.count));}
picks.$contentPartner.append(display_line.children());}catch(e){console.log(e.message,e.stack);}},appendPartner:function(partner,nb){try{$item=picks.$modelePartner.clone().show();$('a',$item).attr('href',partner.LINK).attr('data-id',partner.PARTENARIAT_ID).attr('data-title',partner.TITLE).attr('data-linktype',partner.LINKTYPE);var img=SETTING_DOMAIN_IMG+'/misc/'+partner.IMG_SMALL+'/100x200-000000-80-0-0.jpg';var img_width=200;if(nb==1){img_width=410;img=SETTING_DOMAIN_IMG+'/misc/'+partner.IMG_BIG+'/100x410-000000-80-0-0.jpg';}
$('a > img',$item).attr({'src':img,'width':img_width,'alt':partner.TITLE});return $item;}catch(e){console.log(e.message,e.stack);}},clickPartner:function($item){try{var linktype=$item.attr('data-linktype');var link=$item.attr('href');switch(linktype){case'L':loadBox(link);break;case'S':window.location=link;break;case'B':default:window.open(link);break;}}catch(e){console.log(e.message,e.stack);}},drawFacebookFeed:function(data){try{if(data.total==0){return true;}
display_line=$('<p></p>');for(var i in data.data){display_line.append(picks.appendFacebookFeed(data.data[i]));}
$('.tinyscroll_viewport > .tinyscroll_overview',picks.$contentFacebook).append(display_line.children());picks.$contentFacebook.tinyscrollbar();}catch(e){console.log(e.message,e.stack);}},appendFacebookFeed:function(facebookItem){try{$item=picks.$modeleFacebookMain.clone().show();$('span:eq(0)',$item).html(facebookItem.MESSAGE);$('img',$item).attr('src',facebookItem.ICON);$('span:eq(1) > span',$item).attr('data-timestamp',facebookItem.DATE).text(timestampToDate(facebookItem.DATE));switch(facebookItem.TYPE){case'video':$item_sub=picks.$modeleFacebookVideo.clone().show();$('a',$item_sub).attr({'href':facebookItem.OBJECT.LINK,'target':'_blank'})
$('a > img',$item_sub).attr('src',facebookItem.OBJECT.PICTURE);$('div > a',$item_sub).attr({'href':facebookItem.OBJECT.LINK,'target':'_blank'}).text(facebookItem.OBJECT.TITLE);$('div > div',$item_sub).text(facebookItem.OBJECT.CAPTION);break;case'photo':$item_sub=picks.$modeleFacebookPhoto.clone().show();$('a',$item_sub).attr({'href':facebookItem.OBJECT.LINK,'target':'_blank'})
$('a > img',$item_sub).attr('src',facebookItem.OBJECT.PICTURE);$('div > a',$item_sub).attr({'href':facebookItem.OBJECT.LINK,'target':'_blank'}).text(facebookItem.OBJECT.TITLE);break;case'deezer':$item_sub=picks.$modeleFacebookDeezer.clone().show();$('img',$item_sub).attr('src',facebookItem.OBJECT.PICTURE);$('div:eq(0)',$item_sub).html(facebookItem.OBJECT.TITLE+'<br/>'+facebookItem.OBJECT.DESCRIPTION);break;case'link':$item_sub=picks.$modeleFacebookLink.clone().show();$('a',$item_sub).attr({'href':facebookItem.OBJECT.LINK,'target':'_blank'})
$('a >img',$item_sub).attr('src',facebookItem.OBJECT.PICTURE);$('div:eq(0) > a',$item_sub).attr({'href':facebookItem.OBJECT.LINK,'target':'_blank'}).text(facebookItem.OBJECT.TITLE);$('div:eq(0) > div',$item_sub).html(facebookItem.OBJECT.DESCRIPTION);break;default:$item_sub=$();break;}
$item_sub.insertAfter($('span:eq(0)',$item));$item=$(str_replace(util.getOuterHTML($item),':INSERT_BLOCK',''));return $item;}catch(e){console.log(e.message,e.stack);}}}};
if(typeof(tops)=="undefined"){var tops={initialized:false,initializing:false,tweaked:false,rendered:false,resizeData:{client_width:null,client_height:null,item_size:200,container_width:null,container_height:null},pagination:{start:0,nb:25,max:100},filters:{tag:0,type:'track'},elements:{$container:null,$area_filters:null,$filters_types:null,$filters_tags:null,$items_listing:null,$items_container:null,$items_template:null},cache:{},tags:[],tracklist:[],area_filters_state:'closed',url:'tops',loading:false,init:function(){try{if(tops.initialized===true||tops.initializing===true){return;}
menu.selectItem('tops',0);tops.initializing=true;tops.cache={};tops.elements.$container=$('#naboo_tops');tops.elements.$area_filters=$('#naboo_tops_filters');tops.elements.$filters_types=$('#naboo_tops_filters_type');tops.elements.$filters_tags=$('#naboo_tops_filters_tag');tops.elements.$items_container=$('#naboo_tops_container');tops.elements.$items_listing=$('#naboo_tops_listing');tops.elements.$items_template=$('#top_charts_item_template');tops.pagination={start:0,nb:25,max:100};tops.filters={tag:0,type:'track'};tops.resizeData.item_size=250;tops.resizeData.client_width=getClientWidth();tops.resizeData.client_height=getClientHeight();var ready_callback=function(){if(tops.tags.length>0){tops.buildMenu(tops.tags);}
var login_logout_callback=function(){tops.initialized=false;tops.initializing=false;};Events.ready(Events.user.loaded,function(){login_logout_callback();});Events.subscribe(Events.layout.infiniteScroll,tops.loadNextItems);infinite_scroll.active(tops.elements.$container);tops.initialized=true;tops.initializing=false;Events.resolve('tops');advertising.call('tops','');};$(document).ready(function(){$.when(tops.elements.$items_listing.coverPane({'cover_size':tops.resizeData.item_size,'padding':15,'label_size':0})).then(tops.elements.$items_listing.coverPane_update());if(typeof(USER.USER_ID)!=='undefined'&&USER.USER_ID>0){Events.ready(Events.menu.loaded,ready_callback);}else{ready_callback();}
var mouseover_callback=function(){tops.area_filters_state='opened';}
var mouseout_callback=function(){tops.area_filters_state='closed';}
var mouseover_handler=function(e){e.stopPropagation();if(tops.area_filters_state==='closed'){tops.area_filters_state='opening';tops.elements.$filters_tags.slideDown(350,mouseover_callback);}};var mouseout_handler=function(e){e.stopPropagation();var relatedTarget=$(e.relatedTarget);var is_mouseout=(relatedTarget.parents('#naboo_tops_filters').length===0&&relatedTarget.hasClass('area_filters')===false);if((tops.area_filters_state==='opened'||tops.area_filters_state==='opening')&&is_mouseout===true){tops.area_filters_state='closing';tops.elements.$filters_tags.slideUp(350,mouseout_callback);}};tops.elements.$area_filters.on('mouseover',mouseover_handler);tops.elements.$area_filters.on('mouseout',mouseout_handler);Events.subscribeOnce(Events.layout.adsBackground,function(){if(www.getCurrentPageType()=='tops'){tops.elements.$items_listing.coverPane_update();}});});}catch(e){console.log(e.message,e.stack);}},getContainerWidth:function(){try{return $('#naboo_content').width();}catch(e){console.log(e.message,e.stack);}},getContainerHeight:function(){try{return tops.elements.$container.height();}catch(e){console.log(e.message,e.stack);}},display:function(page){try{var path=page.split('?');path=path[0].split('/');if(path[0]!='tops'){return false;}
if($('#naboo_tops').length==0){tops.initialized=false;tops.initializing=false;tops.tweaked=false;template.load('naboo/tops',$('#naboo_content'));}
tops.init();var type=tops.filters.type;var tag=tops.filters.tag;if(typeof(path[1])!='undefined'){if(path[1]in{track:true,album:true,artist:true}){type=path[1];}}
if(typeof(path[2])!='undefined'){if(path[2]!=''){var buffer=path[2].split('-');var last=buffer[(buffer.length-1)];if(typeof(last)!='undefined'&&last!=''&&!isNaN(last)){tag=parseInt(last);}}else{tag=0;}}
tops.load(tag,type,{start:0,nb:tops.pagination.nb});naboo.afterLoad(true);return true;}catch(e){console.log(e.message,e.stack);}},buildMenu:function(tags){try{var $list=$('ul',tops.elements.$filters_tags);if($('li',$list).length==1){var nb_tags=tags.length;for(var i=0;i<nb_tags;i++){var tag=tags[i];var link=$('<a></a>');$(link).attr({'href':'javascript:void(0);','data-tag':tag.TAG_ID,'onclick':"tops.load("+tag.TAG_ID+", tops.filters.type, {'start':0, 'nb':tops.pagination.nb}); tracking.track('tops_genre_click', {id:"+tag.TAG_ID+", genre:'"+addslashes(tag.NAME)+"'}); return false;"});$(link).addClass('tag_'+tag.TAG_ID);$(link).text(tag.NAME);var li=$('<li></li>');$(li).append($(link));$list.append($(li));}
$('li a',$list).removeClass('selected').first().addClass('selected');}
tops.tags=tags;}catch(e){console.log(e.message,e.stack);}},load:function(tag,type,pagination,empty_container){try{if(tops.loading==true){return false;}
tops.loading=true;tops.init();hideLoading();var $filters_types=tops.elements.$filters_types;var $filters_tags=tops.elements.$filters_tags;$('ul li a',$filters_types).removeClass('selected');$('ul li a',$filters_tags).removeClass('selected');tag=parseInt(tag);$('#cat_selected').text($('.tag_'+tag).text());if((typeof(type)=='undefined')||(type!='track'&&type!='album'&&type!='artist')){type='track';}
var $type,$tag;switch(type){case'track':$type=$('#filter_type_track').addClass('selected');$tag=$('ul li a.tag_'+tag,$filters_tags).addClass('selected');break;case'album':$type=$('#filter_type_album').addClass('selected');$tag=$('ul li a.tag_'+tag,$filters_tags).addClass('selected');break;case'artist':$type=$('#filter_type_artist').addClass('selected');$tag=$('ul li a.tag_'+tag,$filters_tags).addClass('selected');break;}
if(typeof(pagination)=='undefined'){pagination=$.extend({},tops.pagination);}else{pagination=$.extend(tops.pagination,pagination);}
if(typeof(empty_container)!='boolean'){if(tag!=tops.filters.tag||type!=tops.filters.type){empty_container=true;}else{empty_container=false;}}
tops.filters.tag=tag;tops.filters.type=type;var url='tops/'+type.toLowerCase();if(tag!=0){url+='/'+(rewriting($tag.text().replace(' / ','-')).toLowerCase())+'-'+tag;}
if(tops.rendered&&tops.url!=url){$.address.value(url);}
var cache_key=type+'_'+tag;var start=pagination.start;if(typeof(tops.cache[cache_key])!='undefined'&&typeof(tops.cache[cache_key][start])!='undefined'){tops.render(tops.cache[cache_key][start],empty_container);return true;}
var input={'TYPE':type,'COUNTRY':(COUNTRY||'FR'),'TAG_ID':tag,'START':pagination.start,'NB':pagination.nb,'INCLUDE_TAGS':true};if(pagination.start==0){advertising.call('tops');}
api.call('deezer_pageTops',input,tops.loadCallback,{'empty_container':empty_container});return true;}catch(e){console.log(e.message,e.stack);}},loadCallback:function(request,callback_params){try{hideLoading();if(request==false||request==null||request.results==null||request.results.ITEMS==null||typeof(request.results.ITEMS.count)!='number'||request.results.ITEMS.count==0){tops.loading=false;if(tops.pagination.start==0){$('.top_charts_item',tops.elements.$items_container).remove();}
return false;}
var cache_key=tops.filters.type+'_'+tops.filters.tag;if(typeof(tops.cache[cache_key])=='undefined'){tops.cache[cache_key]=[];}
tops.cache[cache_key][tops.pagination.start]=request.results.ITEMS.data;if(typeof(request.results.TAGS)!='undefined'&&request.results.TAGS.count>0){tops.buildMenu(request.results.TAGS.data);}
var empty_container=callback_params.empty_container||false;tops.render(tops.cache[cache_key][tops.pagination.start],empty_container);return true;}catch(e){console.log(e.message,e.stack);}},render:function(data,empty_container){try{tops.init();if(typeof(empty_container)!='boolean'){empty_container=false;}
var size=tops.resizeData;var offset;var $items_container=tops.elements.$items_container;if(empty_container==true){offset=0;$('.top_charts_item',$items_container).remove();}else{offset=$('.top_charts_item',$items_container).length;}
var $items_template=tops.elements.$items_template;var $buffer=$('<ul></ul>');var $tag=$('.selected',tops.elements.$filters_tags);var tag_id=$tag.attr('data-tag');var tag_name=addslashes($tag.text());var count=data.length;for(var i=0;i<count;i++){var item=data[i];var index=(i+1+offset);var position=(index<10)?'0'+index:index;var $item=$items_template.clone().attr({'id':'','class':'top_charts_item block_cover'});var available,play_onclick,title,picture,href;switch(tops.filters.type){case'track':available=(right.checkSongAvailable(item)==right.READABLE||typeof(item.FALLBACK)!='undefined');play_onclick='tops._play($(this).parent()); tracking.track("tops_play_click", {type:"track", rank:'+index+', genre_id:'+tag_id+', genre_name:"'+tag_name+'", id:'+item.SNG_ID+', name:"'+addslashes(item.SNG_TITLE)+'"}); return false;';title=item.SNG_TITLE;picture=SETTING_DOMAIN_IMG+'/cover/'+item.ALB_PICTURE+'/250x250-000000-80-0-0.jpg';href='/'+SETTING_LANG+'/track/'+item.SNG_ID;break;case'album':available=true;play_onclick='dzPlayer.playAlbum('+item.ALB_ID+', 0, true, {TYPE:"tops_album", ID:'+item.ALB_ID+'}); tracking.track("tops_play_click", {type:"album", rank:'+index+', genre_id:'+tag_id+', genre_name:"'+tag_name+'", id:'+item.ALB_ID+', name:"'+addslashes(item.ALB_TITLE)+'"}); return false;';title=item.ALB_TITLE;picture=SETTING_DOMAIN_IMG+'/cover/'+item.ALB_PICTURE+'/250x250-000000-80-0-0.jpg';href='/'+SETTING_LANG+'/album/'+item.ALB_ID;break;case'artist':available=true;play_onclick='loadBox("artist/'+item.ART_ID+'"); return false;';title=item.ART_NAME;picture=SETTING_DOMAIN_IMG+'/artist/'+item.ART_PICTURE+'/250x250-000000-80-0-0.jpg';href='/'+SETTING_LANG+'/artist/'+item.ART_ID;break;}
$('.cover',$item).attr('data-index',(index-1));$('.img_main',$item).attr('src',picture);if(available===true){$('.cover a',$item).attr({'href':href,'onclick':play_onclick});}else{$('.cover a',$item).attr('href','javascript:void(0);').css('cursor','default').find('.big_play').remove();}
$('.number',$item).text(position);if($('.number',$item).text().length>=3){$('.info-tops',$item).addClass('hundred');}
var variation='egal';if(typeof(item.VARIATION)!='undefined'){var _variation=parseInt(item.VARIATION);if(_variation>0){variation='up';}else if(_variation<0){variation='down';}}
$('.variation',$item).addClass(variation);if(tops.filters.type!='artist'){$('.top_charts_item_title',$item).text(title);$('.top_charts_item_title',$item).attr({'onclick':"loadBox('album/"+item.ALB_ID+"'); return false;",'href':'/'+SETTING_LANG+'/album/'+item.ALB_ID});}
$('.top_charts_item_artist',$item).text(item.ART_NAME).attr({'onclick':"loadBox('artist/"+item.ART_ID+"'); return false;",'href':'/'+SETTING_LANG+'/artist/'+item.ART_ID});$buffer.append($item.show());}
$items_container.append($buffer.children());tops.elements.$items_listing.coverPane_update();switch(tops.filters.type){case'track':$items_container.removeClass('list-albums_charts').removeClass('list-artists_charts').addClass('list-tracks_charts');break;case'album':$items_container.removeClass('list-tracks_charts').removeClass('list-artists_charts').addClass('list-albums_charts');break;case'artist':$items_container.removeClass('list-albums_charts').removeClass('list-tracks_charts').addClass('list-artists_charts');break;}
hideLoading();if($items_container.children().length){tops.rendered=true;}
tops.loading=false;tops.tweaking();if(tops.filters.type=='track'){tops.updateTrackList({filters:tops.filters});}
infinite_scroll.disable();Events.unsubscribe(Events.layout.infiniteScroll,tops.loadNextItems);Events.subscribe(Events.layout.infiniteScroll,tops.loadNextItems);infinite_scroll.active(tops.elements.$container);Events.trigger(Events.tops.displayed,{type:tops.filters.type,tag:tag_id});}catch(e){console.log(e.message,e.stack);}},loadNextItems:function(){try{var filters=tops.filters;var pagination=tops.pagination;setTimeout(hideLoading,360);if(pagination.start<pagination.max&&(pagination.start+pagination.nb)<pagination.max){tops.load(filters.tag,filters.type,{'start':(pagination.start+pagination.nb),'nb':pagination.nb},false);return true;}
return false;}catch(e){console.log(e.message,e.stack);}},updateTrackList:function(params){try{var cache_key=params.filters.type+'_'+params.filters.tag;var data=tops.cache[cache_key]||[];var nb=data.length;tops.tracklist=[];for(var i=0;i<nb;i++){if(typeof(data[i])!=='undefined'){for(var j=0;j<data[i].length;j++){tops.tracklist.push(data[i][j]);}}}}catch(e){console.log(e.message,e.stack);}},_play:function($item){try{var index=$item.attr('data-index');dzPlayer.playTracks(tops.tracklist,index,true,{TYPE:"tops_track",ID:tops.tracklist[index].SNG_ID});}catch(e){console.log(e.message,e.stack);}},tweaking:function(){try{if(tops.tweaked===true){return false;}
tops.tweaked=true;var container_height=tops.getContainerHeight();var container_width=tops.getContainerWidth();var items_per_col=Math.ceil(container_height/tops.resizeData.item_size);var items_per_line=Math.ceil(container_width/tops.resizeData.item_size);var total_items=items_per_col*items_per_line;var current_total_items=$('.top_charts_item',tops.elements.$items_container).length;if(current_total_items<total_items){tops.cache={};tops.pagination.start=0;tops.pagination.nb=((tops.pagination.nb*2)<=tops.pagination.max)?(tops.pagination.nb*2):tops.pagination.nb;tops.resizeData.item_size=Math.floor(container_height/items_per_col);tops.load(tops.filters.tag,tops.filters.type,tops.pagination,true);}
return true;}catch(e){console.log(e.message,e.stack);}}}};
if(typeof visio=="undefined"){var visio={current:null,prev:0,intervalID:0,timeoutID:0,container:null,content_modele:null,tab_modele:null,data:null,defaultDuration:10,add:function(container,data){try{visio.data=data.slice();if(visio.data.length==0){return false;}
visio.reset();$("#viewer_arrow").hide();visio.current=null;duration=(DZPS==true)?0:500;visio.container=container;if(visio.content_modele==null){visio.content_modele=$('#visio_content_modele').clone();}
$('#visio_content_modele').remove();if(visio.tab_modele==null){visio.tab_modele=$('#visio_tab_modele').clone();}
$('#visio_tab_modele').remove();clearInterval(visio.intervalID);visio.timeoutID=setTimeout(function(){visio.displayBillboard();},duration);}catch(e){console.log(e.message,e.stack);}},displayBillboard:function(){try{visio.timeoutID=0;var advert=((typeof(adsBillboard)=='undefined')||(adsBillboard==null))?false:true;if(advert==true){var ad_data=new Object();ad_data["ADS"]=true;ad_data["MENU_TITLE"]=adsBillboard.tab.tabTitle;ad_data["MENU_DESCRIPTION"]=adsBillboard.tab.tabDescription;ad_data["DISPLAY_TITLE"]=adsBillboard.tab.tabTitle;ad_data["DISPLAY_DESCRIPTION"]=adsBillboard.tab.tabDescription;ad_data["TIME"]=adsBillboard.options.duration;ad_data["STYLE_ID"]=100;ad_data["BANNER"]=0;ad_data["COLOR"]=adsBillboard.options.backgroundColor;ad_data["TEXT_COLOR"]="0x000000";visio.data.unshift(ad_data);visio.data.splice(visio.data.length-1,1);}
visio.drawTab();visio.createSource();visio.launch(0);}catch(e){console.log(e.message,e.stack);}},drawTab:function(){try{i=0;for(i in visio.data){var div_tab_id='tab_'+i;if($('#'+div_tab_id).length==1){continue;}
$tabItem=visio.tab_modele.clone().attr('id',div_tab_id);$('a',$tabItem).attr("data-i",i);$('a',$tabItem).click(function(){visio.launch(parseInt($(this).attr("data-i")));return false;});if(i==0){$tabItem.addClass("selected");}else{$tabItem.removeClass();}
$tabItem.show();$("#visio_navbar_list").append($tabItem);i++;}
return true;}catch(e){console.log(e.message,e.stack);}},createSource:function(){try{for(i in visio.data){var div_content_id='c_'+i;if($('#'+div_content_id).length==1){continue;}
$contentItem=visio.content_modele.clone().attr('id',div_content_id);$contentItem.data("loaded",false);if(visio.data[i]["BANNER"]=="0"||typeof(visio.data[i]['VISIO_ID'])!='undefined'){$("#info",$contentItem).hide();}else{$("#title",$contentItem).text(visio.data[i]["DISPLAY_TITLE"]).css("color","#"+visio.data[i]["TEXT_COLOR"].substr(2)).attr("onClick","loadBox( 'artist/"+visio.data[i]['ARTIST_ID']+"'); tracking.track('edito_visio_artist_click', {'tab_id': "+(parseInt(i)+1)+", 'type':'album', 'id' : "+visio.data[i]['ALBUM_ID']+", 'name' : '"+addslashes(visio.data[i]["DISPLAY_TITLE"])+" - "+addslashes(visio.data[i]["DISPLAY_DESCRIPTION"])+"' }); return false;");$("#description",$contentItem).text(visio.data[i]["DISPLAY_DESCRIPTION"]).css("color","#"+visio.data[i]["TEXT_COLOR"].substr(2)).attr("onClick","loadBox( 'album/"+visio.data[i]['ALBUM_ID']+"'); tracking.track('edito_visio_album_click', {'tab_id': "+(parseInt(i)+1)+", 'type':'album', 'id' : "+visio.data[i]['ALBUM_ID']+", 'name' : '"+addslashes(visio.data[i]["DISPLAY_TITLE"])+" - "+addslashes(visio.data[i]["DISPLAY_DESCRIPTION"])+"' }); return false;");$("#listen",$contentItem).attr("onClick","dzPlayer.playAlbum("+visio.data[i]['ALBUM_ID']+", 0, true, {TYPE:'selection_billboard', ID:"+visio.data[i]['ALBUM_ID']+"}); tracking.track('edito_visio_play', {'tab_id': "+(parseInt(i)+1)+", 'type':'album', 'id' : "+visio.data[i]['ALBUM_ID']+", 'name' : '"+addslashes(visio.data[i]["DISPLAY_TITLE"])+" - "+addslashes(visio.data[i]["DISPLAY_DESCRIPTION"])+"' }); return false;");}
$contentItem.hide();$("#visio_viewer_content").append($contentItem);}}catch(e){console.log(e.message,e.stack);}},launch:function(startIndex){try{if(visio.data.length==0)return false;if(visio.current==startIndex){return false;}
if(startIndex<0){startIndex=visio.data.length-1;}
if(startIndex>=visio.data.length){startIndex=0;}
if(visio.intervalID!=0){clearInterval(visio.intervalID);}
if(visio.current==null){var fade=false;}else{var fade=true;$curr=$("#c_"+visio.current);if($(".swfContent",$curr).length==1){$(".swfContent",$curr).remove();$curr.data("loaded",false);}
$curr.hide();visio.prev=visio.current;}
visio.current=startIndex;visio.enabledTab();$curr=$("#c_"+visio.current);if($curr.data("loaded")==false){visio.loadSource(visio.current);}
if(fade){$curr.fadeIn();}else{$curr.show();}
var fctname="start_"+visio.current;if(window[fctname]){window[fctname]();}
var bgColor=(typeof(visio.data[visio.current]["COLOR"])!='undefined')?"#"+visio.data[visio.current]["COLOR"].substr(2):visio.data[visio.current]["BACKGROUND"];visio.container.css("background-color",bgColor);var duration=(typeof(visio.data[visio.current].TIME)!='undefined')?visio.data[visio.current].TIME:visio.defaultDuration;visio.intervalID=setTimeout(function(){visio.next();},duration*1000);if($("#c_"+(visio.current+1)).data("loaded")==false){visio.loadSource(visio.current+1);}}catch(e){console.log(e.message,e.stack);}},loadSource:function(i){try{type="";if(visio.data[i]["ADS"]==true){switch(adsBillboard.format.formatType){case"swf":type='ad-swf';break;case"video":type='ad-video';break;case"image":type='ad-img';break;}}else{var ext='';if(typeof(visio.data[i]['IMAGE'])=='undefined'){type='visio_bo';}else{ext=visio.extension(visio.data[i]['IMAGE']).substring(0,3);if(ext=="jpg"){type='image';}
if(ext=="htm"){type='html';}
if(ext=="htm"){type='html';}
if(ext=="swf"&&visio.data[i]['VIDEO'].length==false){type='swf-simple';}
if(ext=="swf"&&visio.data[i]['VIDEO'].length>0){type='swf-video';}
if(ext==""&&visio.data[i]['VIDEO'].length>0){type='video-simple';}}}
switch(type){case'visio_bo':$("#c_"+i).empty();$("#c_"+i).append(visio.data[i]["CONTENT"]);break;case'swf-simple':$("#c_"+i).prepend("<a id='videoPlayer-"+i+"' class='slide swfContent' />");so=new SWFObject(HOST_CONTENT+'/billboard/'+visio.data[i]['IMAGE'],"SWF-VideoPlayer","770","260","10.0.12.36");so.addParam("allowFullScreen","true");so.addParam("allowScriptAccess","always");so.addParam("wmode","opaque");so.addParam("bgcolor","#"+visio.data[i]["COLOR"].substr(2));so.addVariable("user_premium",DZPS);so.write("videoPlayer-"+i);break;case'swf-video':$("#videoPlayer-"+i).remove();$("#c_"+i).prepend("<a id='videoPlayer-"+i+"' class='slide swfContent' />");so=new SWFObject(HOST_CONTENT+'/billboard/'+visio.data[i]['IMAGE'],"SWF-VideoPlayer","770","260","10.0.12.36");so.addParam("allowFullScreen","true");so.addParam("allowScriptAccess","always");so.addParam("wmode","opaque");so.addParam("bgcolor","#"+visio.data[i]["COLOR"].substr(2));so.addVariable("images_host",SETTING_DOMAIN_IMG+"/{1}/{2}/{3}x{4}-000000-80-0-0.jpg");so.addVariable("visioStartClipFunction","visio.showVideo("+i+", '"+HOST_CONTENT+"/flv/"+visio.data[i]['VIDEO']+"', '' )");so.write("videoPlayer-"+i);break;case'image':$c=$("#c_"+i);var textAlbumColor=visio.data[i]['TEXT_COLOR'].substr(2);if(visio.data[i]['CITATION_AUTHOR']!=''&&visio.data[i]['CITATION']!=''){if(typeof(visio.data[i]['ALTERNATIVE_COLOR'])!='undefined'&&visio.data[i]['ALTERNATIVE_COLOR']!=''){textAlbumColor=visio.data[i]['ALTERNATIVE_COLOR'].substr(2);}}else{$('.simple_viewer > div:eq(1) > dl',$c).css('margin-top',30);}
$('.simple_viewer',$c).css('background','url('+HOST_CONTENT+"/billboard/"+visio.data[i]['IMAGE']+')');$('.simple_viewer > div:eq(0) > .block_cover > .cover > a > img:eq(1)',$c).attr('src',SETTING_DOMAIN_IMG+'/cover/'+visio.data[i]['ALBUM_PICTURE']+'/100x100-000000-80-0-0.jpg');$('.simple_viewer > div:eq(0) > .block_cover > .cover > a',$c).attr('onClick','dzPlayer.playAlbum('+visio.data[i]['ALBUM_ID']+', 0, true, {TYPE:"selection_billboard", ID:'+visio.data[i]['ALBUM_ID']+'}); tracking.track("edito_visio_play", {type:"album", tab_id:'+i+', id:'+visio.data[i]['ALBUM_ID']+', name:"'+visio.data[i]['ARTIST_NAME']+'"});');$('.simple_viewer > div:eq(1) > dl > .art_name > a',$c).text(visio.data[i]['ARTIST_NAME']).css('color','#'+visio.data[i]['TEXT_COLOR'].substr(2)).attr('onClick',"loadBox('artist/"+visio.data[i]['ARTIST_ID']+"'); tracking.track('edito_visio_artist_click', {type:'album', tab_id:"+i+", id:"+visio.data[i]['ARTIST_ID']+", name:'"+addslashes(visio.data[i]['ARTIST_NAME'])+"'});");$('.simple_viewer > div:eq(1) > dl > .album_name > a',$c).text(visio.data[i]['ALBUM_NAME']).css('color','#'+textAlbumColor).attr('onClick',"loadBox('album/"+visio.data[i]['ALBUM_ID']+"'); tracking.track('edito_visio_album_click', {type:'album', tab_id:"+i+", id:"+visio.data[i]['ALBUM_ID']+", name:'"+addslashes(visio.data[i]['ALBUM_NAME'])+"'});");$('.simple_viewer > div:eq(1) > dl > .quote',$c).text(visio.data[i]['CITATION']).css('color','#'+visio.data[i]['TEXT_COLOR'].substr(2));$('.simple_viewer > div:eq(1) > dl > .quote_author',$c).text(visio.data[i]['CITATION_AUTHOR']).css('color','#'+visio.data[i]['TEXT_COLOR'].substr(2));break;case'video-simple':var playVideo=$("<span id='playVideo-"+i+"' class='playVideo main' onclick=\"visio.showVideo("+i+", '"+HOST_CONTENT+"/flv/"+visio.data[i]['VIDEO']+"', '"+HOST_CONTENT+"/billboard/"+visio.data[i]['IMAGE']+"' ); return false;\" />").css({"height":"88px","margin-right":"10px","margin-top":"3px","width":"88px","z-index":"1002","position":"absolute","top":"106px","left":"336px","cursor":"pointer"}).hover(function(){$(this).css({});},function(){$(this).css({});});$("#c_"+i).prepend("<a id='videoPlayer-"+i+"' class='slide' />");$("#videoPlayer-"+i).append("<span id='linkContainer-"+i+"' />");$("#linkContainer-"+i).prepend("<img src='"+HOST_CONTENT+"/billboard/"+visio.data[i]['IMAGE']+"'>").append(playVideo);break;case'ad-video':$("#c_"+i).empty();$("#videoPlayer-"+i).remove();$("#c_"+i).prepend("<a id='videoPlayer-"+i+"' class='slide swfContent' />");$("#videoPlayer-"+i).append("<span id=\"linkContainer-"+i+"\"></span>");so=new SWFObject(SETTING_STATIC+"/swf/billboardVideoPlayer-v"+STATIC_VERSION+".swf","ads_banner_video","770","260","9");so.addParam('wmode','opaque');so.addParam("allowScriptAccess","always");so.addParam("allowFullScreen","true");so.addVariable("urlContent",adsBillboard.content.urlContent);so.addVariable("urlStartImage",adsBillboard.content.urlStartImage);so.addVariable("urlEndImage",adsBillboard.content.urlEndImage);so.addVariable("autoPlayDelay","3");so.addVariable("adsVideo","true");so.addVariable("clickCommand",adsBillboard.tracking.clickCommand);so.write("linkContainer-"+i);if((adsBillboard.tracking.pixelAgence!="")&&($("#ad_pixel_"+i).attr('src')!=adsBillboard.tracking.pixelAgence))$("#c_"+i).append("<img src='"+adsBillboard.tracking.pixelAgence+"' style='display: none;' id='ad_pixel_"+i+"' />");break;case'ad-swf':$("#c_"+i).empty();$("#c_"+i).prepend("<a id='videoPlayer-"+i+"' class='slide swfContent' />");so=new SWFObject(adsBillboard.content.urlContent,"Ads","770","260","10.0.12.36");so.addParam("allowFullScreen","true");so.addParam("allowScriptAccess","always");so.addParam("wmode","opaque");so.addVariable(adsBillboard.tracking.clickTagMethod,adsBillboard.tracking.clickCommand);so.write("videoPlayer-"+i);if((adsBillboard.tracking.pixelAgence!="")&&($("#ad_pixel_"+i).attr('src')!=adsBillboard.tracking.pixelAgence))$("#c_"+i).append("<img id='ad_pixel_"+i+"' src='"+adsBillboard.tracking.pixelAgence+"' style='display:none;' />");break;case'ad-img':$("#c_"+i).empty();$("#c_"+i).prepend("<a href='"+adsBillboard.tracking.clickCommand+"' target='_blank' class='slide'><img src='"+adsBillboard.content.urlContent+"''></a>");if((adsBillboard.tracking.pixelAgence!="")&&($("#ad_pixel_"+i).attr('src')!=adsBillboard.tracking.pixelAgence))$("#c_"+i).append("<img id='ad_pixel_"+i+"' src='"+adsBillboard.tracking.pixelAgence+"' style='display:none;' />");break;case'html':var Reg=new RegExp('function start');var decoded=$("<div/>").html(visio.data[i]['HTML']).text();if(Reg.test(decoded)){decoded=decoded.replace('function start','function start_'+i);}
$("#c_"+i).empty();$("#c_"+i).append("<div class='visiohtml'>"+decoded+"</div>");break;}
$("#c_"+i).data("loaded",true);visio.appendSocial(i);return true;}catch(e){console.log(e.message,e.stack);}},appendSocial:function(i){try{if(visio.data[i]["BANNER"]==0)return false;var link="http://www.deezer.com/album/"+visio.data[i]['ALBUM_ID'];ilike.add($("#c_"+i+" #btn_facebook"),link,null,null,("c_"+i));return true;}catch(e){console.log(e.message,e.stack);}},enabledTab:function(){try{$("#tab_"+visio.prev).data("selected",false).removeClass("selected");$tab=$("#tab_"+visio.current);$tab.data("selected",true).addClass("selected");return true;}catch(e){console.log(e.message,e.stack);}},next:function(){try{if($("#"+visio.container.attr('id')).length==0){clearInterval(visio.intervalID);return true;}
$("#c_"+visio.current).hide();visio.prev=visio.current;if(visio.current==(visio.data.length-1)){visio.current=0;}else{visio.current++;}
visio.enabledTab();$curr=$("#c_"+visio.current);if($curr.data("loaded")==false){visio.loadSource(visio.current);}
$curr.stop(true,true).fadeIn();var fctname="start_"+visio.current;if(window[fctname]){window[fctname]();}
var bgColor=(typeof(visio.data[visio.current]["COLOR"])!='undefined')?"#"+visio.data[visio.current]["COLOR"].substr(2):visio.data[visio.current]["BACKGROUND"];visio.container.css("background-color",bgColor);var duration=(typeof(visio.data[visio.current].TIME)!='undefined')?visio.data[visio.current].TIME:visio.defaultDuration;visio.intervalID=setTimeout(function(){visio.next();},duration*1000);$prev=$("#c_"+(visio.current-1));if($(".swfContent",$prev).length==1){$(".swfContent",$prev).remove();$prev.data("loaded",false);}
return true;}catch(e){console.log(e.message,e.stack);}},extension:function(urlName){try{var adr=urlName.lastIndexOf("\\");var fic=urlName.substring(adr+1).split(".");return fic[fic.length-1];}catch(e){console.log(e.message,e.stack);}},endMedia:function(id,url,urlImglast){try{$("#videoPlayer-"+id).empty().append("<img src='"+urlImglast+"' />");var playVideo=$("<span id='playVideo-"+id+"' class='playVideo main' onclick='visio.showVideo("+id+", \""+url+"\", \""+urlImglast+"\" ); return false;'><span>");playVideo.css({"height":"88px","margin-right":"10px","margin-top":"3px","width":"88px","z-index":"1002","position":"absolute","top":"106px","left":"336px","cursor":"pointer"}).hover(function(){$(this).css({});},function(){$(this).css({});});$("#videoPlayer-"+id).append(playVideo);}catch(e){console.log(e.message,e.stack);}},beginMedia:function(id,url,urlImgFirst,urlImglast){try{$("#linkContainer-"+id).remove();var img=new Image();img.src=urlImgFirst;var $linkContainer=$("<span />").attr({"id":"linkContainer-"+id});$linkContainer.append(img);var playVideo="<span id='playVideo-"+id+"' onclick='visio.showVideo("+id+", '"+url+"', '"+urlImglast+"' ); return false;' class='playVideo main' style='height:88px;margin-right:10px;margin-top:3px;width:88px;z-index:1002;position:absolute;top:90px;left:340px;cursor:pointer'></span>";$linkContainer.append(playVideo);$("#videoPlayer-"+id+"").append($linkContainer);}catch(e){console.log(e.message,e.stack);}},showVideo:function(id,url,urlImglast){try{clearInterval(visio.intervalID);$("#videoPlayer-"+id).empty();so=new SWFObject(SETTING_STATIC+"/swf/billboardVideoPlayer-v"+STATIC_VERSION+".swf","billboardVideoPlayer","770","260","10.0.12.36");so.addParam("allowFullScreen","true");so.addParam("allowScriptAccess","always");so.addParam("wmode","opaque");so.addVariable("urlVideo",url);if(urlImglast!=""){so.addVariable("callBackEndVideo","visio.endMedia('"+id+"','"+url+"','"+urlImglast+"')");}else{so.addVariable("callBackEndVideo","visio.loadSource('"+id+"')");}
so.write("videoPlayer-"+id);}catch(e){console.log(e.message,e.stack);}},reset:function(){for(var i=0;i<7;i++){$('#visio_content #c_'+i).remove();$('#visio_content #tab_'+i).remove();}
clearInterval(visio.intervalID);return true;}}};
if(typeof(chronicles)=="undefined"){var chronicles={alb_id:0,provider:0,displayChronicle:function(alb_id,provider){try{if(typeof(provider)=='undefined')provider='';chronicles.alb_id=alb_id;chronicles.provider=provider;var params={alb_id:alb_id,lang:SETTING_LANG};api.call('review_getList',params,chronicles.displayChronicleCallback,{},'major_pages');return true;}catch(e){console.log(e);}},displayChronicleCallback:function(request){try{if(typeof(album.tabs_loaded['chronicles_'+chronicles.alb_id])=='undefined'){if(request.results.count!=null&&request.results.count>0){for(chronicle_item in request.results.data){var chronicle_data=request.results.data[chronicle_item];var logo_chronicle=SETTING_STATIC+'/img/review/big/'+chronicle_data.LOGO_BIG;var name_chronicle=chronicle_data.PARTNER_NAME;var id_chronicle=chronicle_data.SOURCE;if(chronicles.provider==''){chronicles.provider=id_chronicle;}
$('#tab_chronicles_content > table .naboo_album_chronicles_providers').append('<div id="naboo_album_chronicles_provider_'+id_chronicle+'"><a href="javascript:void(0)" onclick="chronicles.changePovider(\''+id_chronicle+'\'); return false;"><img src="'+logo_chronicle+'" alt="'+name_chronicle+'" /></a></div>');if(request.results.data[chronicle_item].AUTHOR_NAME==null)request.results.data[chronicle_item].AUTHOR_NAME='';if(request.results.data[chronicle_item].URL!=null&&request.results.data[chronicle_item].CHRONICLE!=null){var html_chronicles='<div id="naboo_album_chronicles_text_'+id_chronicle+'" style="display:none">'+request.results.data[chronicle_item].CHRONICLE+'<br/><br/>'+request.results.data[chronicle_item].AUTHOR_NAME;if((request.results.data[chronicle_item].URL!=null)&&(request.results.data[chronicle_item].URL!='')){html_chronicles+='<br/>'+trad.music.naboo_all_chronicles+' <a href="'+request.results.data[chronicle_item].URL+'" target="_blank">'+request.results.data[chronicle_item].URL+'</a>';}
html_chronicles+='</div>';$('#tab_chronicles_content > table .naboo_album_chronicles_texts').append(html_chronicles);}}}}
album.tabs_loaded['chronicles_'+chronicles.alb_id]=true;chronicles.activeScroll(chronicles.provider);hideLoading();return true;}catch(e){console.log(e);}},changePovider:function(id_provider){try{if(id_provider!=''){$('#tab_chronicles_content .naboo_album_chronicles_texts div').hide();$('#naboo_album_chronicles_text_'+id_provider).show();}
$('#tab_chronicles_content .naboo_album_chronicles_providers div a').removeClass('selected');$('#naboo_album_chronicles_provider_'+id_provider+' a').addClass('selected');}catch(e){console.log(e);}},activeScroll:function(id_provider){try{if(id_provider!=''){chronicles.changePovider(id_provider);}
var div_position=$('#tab_chronicles_content').position();if(div_position['top']!=null){$('#page_content').scrollTop(div_position['top']);}
return false;}catch(e){console.log(e);}}}};
if(typeof(collection)=="undefined"){var collection={data:{},init:function(){try{collection.selectedTab='';collection.loadedTrack=false;collection.loadedPlaylist=false;collection.loadedAlbum=false;collection.loadedArtist=false;collection.loadedRadio=false;collection.minTrackToLoad=40;collection.elementList=[];for(var playlist_element in userData.data.PLAYLISTS.data){collection.elementList.push({TYPE:1,ELEMENT_ID:userData.data.PLAYLISTS.data[playlist_element].PLAYLIST_ID});}
collection.$model_playlist=$('#naboo_home_default_playlist').clone();$('#naboo_home_default_playlist').remove();collection.$content_playlist=$('#stats_playlist_listing');collection.$model_album=$('#naboo_home_default_album').clone();$('#naboo_home_default_album').remove();collection.$content_album=$('#stats_album_listing');collection.$model_artist=$('#naboo_home_default_artist').clone().remove();$('#naboo_home_default_artist').remove();collection.$content_artist=$('#stats_artist_listing');collection.$model_radio=$('#naboo_home_default_radio').clone();$('#naboo_home_default_radio').remove();collection.$content_radio=$('#stats_radio_listing');advertising.call('collection');menu.selectItem('collection',0);if(dzoffline.AVAILABLE){Events.unsubscribe(Events.offline.elementDownloadProgress,collection.elementDownloadProgress);Events.unsubscribe(Events.offline.elementDownloadStatus,collection.elementDownloadStatus);Events.subscribe(Events.offline.elementDownloadProgress,collection.elementDownloadProgress);Events.subscribe(Events.offline.elementDownloadStatus,collection.elementDownloadStatus);}
$('#naboo_home_playlist').coverPane({'cover_size':200,'padding':15,'label_size':35});$('#naboo_home_album').coverPane({'cover_size':200,'padding':15,'label_size':35});$('#naboo_home_artist').coverPane({'cover_size':200,'padding':15,'label_size':35});$('#naboo_home_radio').coverPane({'cover_size':200,'padding':15,'label_size':35});return true;}catch(e){console.log(e.message,e.stack);}},display:function(){try{template.load('naboo/collection',$('#naboo_content'));collection.init();request=api.call('deezer_pageCollection',{},collection.displayCallback,null,'major_pages');}catch(e){console.log(e.message,e.stack);}},displayCallback:function(request){try{if(request===false||request===null){return false;}
collection.data=request.results;naboo.afterLoad(true);$('#naboo_home_track_link').html('<strong>'+request.results.counters.nb_playlists_tracks+'</strong> '+request.results.counters.nb_playlists_tracks_text+' <span class="arrow_tab sprite_naboo"></span>');$('#naboo_home_playlist_link').html('<strong>'+request.results.counters.nb_playlists+'</strong> '+request.results.counters.nb_playlists_text+' <span class="arrow_tab sprite_naboo"></span>');$('#naboo_home_album_link').html('<strong>'+request.results.counters.nb_favorite_albums+'</strong> '+request.results.counters.nb_favorite_albums_text+' <span class="arrow_tab sprite_naboo"></span>');$('#naboo_home_artist_link').html('<strong>'+request.results.counters.nb_favorite_artists+'</strong> '+request.results.counters.nb_favorite_artists_text+' <span class="arrow_tab sprite_naboo"></span>');$('#naboo_home_radio_link').html('<strong>'+request.results.counters.nb_favorite_radios+'</strong> '+request.results.counters.nb_favorite_radios_text+' <span class="arrow_tab sprite_naboo"></span>');collection.selectTab('track');}catch(e){console.log(e.message,e.stack);}},selectTab:function(type){try{infinite_scroll.disable();if(collection.selectedTab!==''){$('#naboo_home_'+collection.selectedTab+'_link').removeClass('selected');$('#naboo_home_'+collection.selectedTab).hide();}
collection.selectedTab=type;$('#naboo_home_'+type+'_link').addClass('selected');$('#naboo_home_'+type).show();if(collection.selectedTab!='track'){$('#naboo_home_'+type).coverPane_resize();}else if($('#naboo_home_tracks_track').is('.datagrid_master')){datagrid.action($('#naboo_home_tracks_track'),['activeInfiniteScroll']);}
if(!collection['loaded'+ucfirst(type)]){collection['load'+ucfirst(type)](0,30);}}catch(e){console.log(e.message,e.stack);}},loadTrack:function(){try{collection.trackList={count:0,total:0,data:[]};if(collection.elementList.length>0&&parseInt(collection.data.counters.nb_playlists_tracks,10)>0){showLoading();collection.current_element=0;collection.loadElementTracks(collection.loadElementTracksCallback);}else{$('#naboo_home_tracks_track').createDatagrid({type:'home_tracks',id:0,songs:collection.trackList});}}catch(e){console.log(e.message,e.stack);}},loadElementTracks:function(callBackFunction){try{if(collection.elementList.length>=collection.current_element+1){var params;var element=collection.elementList[collection.current_element];switch(element.TYPE){case 1:case 2:params={playlist_id:element.ELEMENT_ID,start:0,nb:1000,lang:SETTING_LANG};request=api.call('playlist_getSongs',params,callBackFunction);break;case 3:params={alb_id:element.ELEMENT_ID,start:0,nb:500,lang:SETTING_LANG};request=api.call('song_getListByAlbum',params,callBackFunction);break;}}
return true;}catch(e){console.log(e.message,e.stack);}},loadElementTracksCallback:function(request){try{if(request.error.length===0){collection.current_element++;collection.trackList.count+=request.results.count;$.merge(collection.trackList.data,request.results.data);if(collection.trackList.count<collection.minTrackToLoad&&!collection.isAllElementLoaded()){collection.loadElementTracks(collection.loadElementTracksCallback);}else{if(collection.isAllElementLoaded()){collection.trackList.total=collection.trackList.count;}else{collection.trackList.total=100000;}
if(collection.trackList.total>0){$('#naboo_home_tracks_track').createDatagrid({type:'home_tracks',id:0,songs:collection.trackList,externalLoadingDataClass:'collection'});hideLoading();}
collection.loadedTrack=true;}}
return true;}catch(e){console.log(e.message,e.stack);}},isAllElementLoaded:function(){try{return(collection.current_element>=collection.elementList.length);}catch(e){console.log(e.message,e.stack);}},loadCommunCallback:function(request,params){try{if(request===false||request===null){return false;}
if(request.error.length>0){return false;}
if(request.results.count>0){$('#naboo_home_empty_'+collection.selectedTab).hide();display_element=$('<p></p>');for(var nb_item in request.results.data){var item=request.results.data[nb_item];if(collection.selectedTab==='playlist'){if(typeof(item.TYPE)!=='undefined'&&parseInt(item.TYPE,10)===4){continue;}
if(typeof(item.STATUS)!=='undefined'&&parseInt(item.STATUS,10)===1&&typeof(item.PARENT_USER_ID)!=='undefined'&&parseInt(item.PARENT_USER_ID,10)!==parseInt(USER.USER_ID,10)){continue;}}
display_element.append(collection['append'+ucfirst(collection.selectedTab)](request.results.data[nb_item]));}
collection['$content_'+collection.selectedTab].append(display_element.children());}else{$('#naboo_home_empty_'+collection.selectedTab).show();}
if(request.results.total>0){$('#naboo_home_'+collection.selectedTab).coverPane_update();}
if(request.results.total>parseInt((params.start+params.nb),10)){Events.subscribeOnce(Events.layout.infiniteScroll,function(){collection['load'+ucfirst(collection.selectedTab)](params.start+params.nb,params.nb);});infinite_scroll.active();}else{infinite_scroll.disable();}
collection['loaded'+ucfirst(collection.selectedTab)]=true;hideLoading();return true;}catch(e){console.log(e.message,e.stack);}},elementDownloadProgress:function(event,params){try{if(collection.selectedTab==params.type){$('#naboo_home_'+params.type+'_'+params.id+' > .cover > .actions_hover > .dl').progresspie('draw',params.percent);}}catch(e){console.log(e);}},elementDownloadStatus:function(event,params){try{if(collection.selectedTab==params.type){$cel=$('#naboo_home_'+params.type+'_'+params.id+' > .cover > .actions_hover > .dl');if(params.state==dzoffline.STARTED){if($('div',$cel).length===0){$cel.removeClass('picto').addClass('picto_progress_download');$cel.progresspie({initPercent:0,displayIcon:'progress_download',size:42,backgroundColor:'transparent',centerColor:'#95c100',borderColor:'#95c100'});}}else if(params.state==dzoffline.FINISH){$cel.empty();$cel.removeClass('picto_progress_download').addClass('picto').addClass('selected');}else if(params.state==dzoffline.FINISH_DELETE){$cel.empty();$cel.removeClass('picto_progress_download').addClass('picto').removeClass('selected');}}}catch(e){console.log(e);}},loadPlaylist:function(start,nb){try{showLoading();var array_default=['TYPE','STATUS','PLAYLIST_ID','TITLE','PLAYLIST_PICTURE','PICTURE_TYPE','PARENT_USER_ID','PARENT_USERNAME','NB_SONG'];var params={start:start,nb:nb,array_default:array_default};request=api.call('playlist_getAllItemsByUser',params,collection.loadCommunCallback,params);}catch(e){console.log(e.message,e.stack);}},appendPlaylist:function(data){try{$new_playlist=collection.$model_playlist.clone().show();$new_playlist.attr({'id':'naboo_home_playlist_'+data.PLAYLIST_ID,'data-id':data.PLAYLIST_ID});$('.cover .img_main',$new_playlist).attr('src',SETTING_DOMAIN_IMG+'/'+data.PICTURE_TYPE+'/'+data.PLAYLIST_PICTURE+'/200x200-000000-80-0-0.jpg');$('.cover a',$new_playlist).attr('href','/'+SETTING_LANG+'/playlist/'+data.PLAYLIST_ID);$('.info dt a',$new_playlist).attr('href','/'+SETTING_LANG+'/playlist/'+data.PLAYLIST_ID).html(data.TITLE);$('.info dd',$new_playlist).text(data.NB_SONG+' '+((data.NB_SONG>1)?trad.music.naboo_tracks:trad.music.naboo_track));return $new_playlist;}catch(e){console.log(e.message,e.stack);}},loadAlbum:function(start,nb){try{var params={user_id:USER.USER_ID,start:start,nb:nb};request=api.call('album_getFavorites',params,collection.loadCommunCallback,params);}catch(e){console.log(e.message,e.stack);}},appendAlbum:function(data){try{$new_album=collection.$model_album.clone().show();$new_album.attr({'id':'naboo_home_album_'+data.ALB_ID,'data-id':data.ALB_ID,'data-art-id':data.ART_ID});$('.cover .img_main',$new_album).attr('src',SETTING_DOMAIN_IMG+'/cover/'+data.ALB_PICTURE+'/200x200-000000-80-0-0.jpg');$('.cover a',$new_album).attr('href','/'+SETTING_LANG+'/album/'+data.ALB_ID);$('.label dt a',$new_album).attr('href','/'+SETTING_LANG+'/album/'+data.ALB_ID).text(data.ALB_TITLE);$('.label dd a',$new_album).attr('href','/'+SETTING_LANG+'/artist/'+data.ART_ID).text(data.ART_NAME);return $new_album;}catch(e){console.log(e.message,e.stack);}},loadArtist:function(start,nb){try{var params={user_id:USER.USER_ID,start:start,nb:nb};request=api.call('artist_getFavorites',params,collection.loadCommunCallback,params);}catch(e){console.log(e.message,e.stack);}},appendArtist:function(data){try{$new_artist=collection.$model_artist.clone().show();$new_artist.attr({'id':'naboo_home_album_'+data.ART_ID,'data-id':data.ART_ID});$('.cover .img_main',$new_artist).attr('src',SETTING_DOMAIN_IMG+'/artist/'+data.ART_PICTURE+'/200x200-000000-80-0-0.jpg');$('.cover a',$new_artist).attr('href','/'+SETTING_LANG+'/artist/'+data.ART_ID);$('.label dt a',$new_artist).attr('href','/'+SETTING_LANG+'/artist/'+data.ART_ID).html(data.ART_NAME);if(parseInt(data.NB_FAN,10)>1){$('.label dd',$new_artist).text(breakUpThousands(data.NB_FAN)+' '+trad.music.naboo_fans);}else{$('.label dd',$new_artist).text(breakUpThousands(data.NB_FAN)+' '+trad.music.naboo_fan);}
return $new_artist;}catch(e){console.log(e.message,e.stack);}},loadRadio:function(start,nb){try{var params={user_id:USER.USER_ID,start:start,nb:nb};request=api.call('radio_getFavorites',params,collection.loadCommunCallback,params);}catch(e){console.log(e.message,e.stack);}},appendRadio:function(data){try{$new_radio=collection.$model_radio.clone().show();$new_radio.attr({'id':'naboo_home_radio_'+data.RADIO_ID,'data-id':data.RADIO_ID});$('.cover .img_main',$new_radio).attr('src',SETTING_DOMAIN_IMG+'/misc/'+data.RADIO_PICTURE+'/200x200-000000-80-0-0.jpg');$('.cover a',$new_radio).attr('href','/'+SETTING_LANG+'/radio/radio-'+data.RADIO_ID);$('.label dt a',$new_radio).attr('href','/'+SETTING_LANG+'/radio/radio-'+data.RADIO_ID).html(data.TITLE);return $new_radio;}catch(e){console.log(e.message,e.stack);}},openFavoriteBox:function(type){try{modal.open('lightbox/favoritebox.php?type='+type);Events.subscribeOnce(Events.favoritebox.close,function(evt,data){if(data.type=='artist'){collection.loadArtist(0,30);}else if(data.type=='album'){collection.loadAlbum(0,30);}});}catch(e){console.log(e.message,e.stack);}},createPlaylist:function($btn){try{menu.openElement($btn);Events.subscribeOnce(Events.playlist.created,function(evt,data){if($('#naboo_home_playlist').is(':visible')&&userData.data.PLAYLISTS.count==1){collection.loadPlaylist(0,30);}});}catch(e){console.log(e.message,e.stack);}}};};
if(typeof(loved)=="undefined"){var loved={data:{},init:function(data){try{loved.data=data;menu.selectItem('loved',0);loved.drawDatagrid(data);advertising.call('loved');}catch(e){console.log(e.message,e.stack);}},display:function(){try{api.call('deezer_pagePlaylist',{playlist_id:userData.data.FAVORITES_SONGS_ID,lang:SETTING_LANG,start:0,nb:40,tags:false},loved.displayCallback,null,'major_pages');}catch(e){console.log(e.message,e.stack);}},displayCallback:function(request){try{if(request==false||request==null){return false;}
if(request.results==null){return false;}
template.load('naboo/loved',$('#naboo_content'));loved.init(request.results.SONGS);naboo.afterLoad(true);}catch(e){console.log(e.message,e.stack);}},drawDatagrid:function(data){try{Events.ready(Events.user.userReady,function(){$('#naboo_loved_tracks').createDatagrid({type:'loved',id:userData.data.FAVORITES_SONGS_ID,playlist_personnal:true,songs:data,offline_data:{playlist_checksum:userData.data.FAVORITES_SONGS.checksum,playlist_picture:'87fc4422c7138e9fe33205ae5707d93f',playlist_picture_type:'playlist'}});});}catch(e){console.log(e.message,e.stack);}}}};