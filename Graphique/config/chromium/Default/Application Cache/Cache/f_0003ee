
var ressources={dz:[[SETTING_STATIC+"/js/min/dzdeezer-v"+STATIC_VERSION+".js","js"]],features:[],home:[[SETTING_STATIC+"/js/min/home-v"+STATIC_VERSION+".js","js"]],legal:[[SETTING_STATIC+"/css/legal-v"+STATIC_VERSION+".css","css"]],naboo:[[SETTING_STATIC+"/css/naboo-v"+STATIC_VERSION+".css","css"],[SETTING_STATIC+"/js/min/naboo-v"+STATIC_VERSION+".js","js"]],premium:[],radio:[[SETTING_STATIC+"/css/radio-v"+STATIC_VERSION+".css","css"],[SETTING_STATIC+"/js/min/radio-v"+STATIC_VERSION+".js","js"]],offers:[[SETTING_STATIC+"/css/offpages-v"+STATIC_VERSION+".css","css"]],devices:[[SETTING_STATIC+"/css/devices-v"+STATIC_VERSION+".css","css"]],cached:[],setInitScripts:function(){$('head link[rel="stylesheet"]').each(function(i,val){ressources.cached[$(val).attr('href')]=true;});$('head script[type="text/javascript"][src]').each(function(i,val){ressources.cached[$(val).attr('src')]=true;});return true;}};
var api={gateway:'/'+SETTING_LANG+'/ajax/gw-light.php',version:'1.0',uniqId:0,getUniqId:function(){if(api.uniqId==0){api.uniqId=util.uniqid();}
return api.uniqId;},call:function(method,input,callback,callback_parameters,async_group,retry){if(OFFLINE&&dzoffline.AVAILABLE){var key=method;if(key=='deezer_userMenu'){var value=JSON.parse(window.localStorage.getItem(key+'_'+USER.USER_ID));}else{if(method=='deezer_pagePlaylist'){key+='_'+input.playlist_id+'_'+input.start+'_'+input.nb;}
if(method=='deezer_pageAlbum'){key+='_'+input.alb_id;}
var value=dzoffline.listInterface[key];}
if(typeof(value)!='undefined'){callback(value,callback_parameters);}else{console.log("L'interface ",key," n est pas en cache");}
return false;}
if(typeof(retry)==='undefined'){retry=0;}
if(retry==4){return false;}
if(typeof(callback_parameters)=='undefined'||callback_parameters==null){callback_parameters=false;}
url=api.gateway+'?api_version='+api.version+'&api_token='+encodeURIComponent(checkForm)+'&method='+method+'&input=3&uniqid='+api.getUniqId();sendRequest(url,'text',(input==''||input==null?'':JSON.stringify(input)),true,function(xhr){request=xhr.responseText;request=eval('('+request+')');api.callback(method,input,callback,callback_parameters,async_group,request,retry);},null,async_group);return true;},callback:function(method,input,func,params,async_group,request,retry){if(retry==4){return false;}
if(typeof(request.error)!=='undefined'&&(typeof(request.error.VALID_TOKEN_REQUIRED)!=='undefined'||typeof(request.error.NEED_USER_AUTH_REQUIRED)!=='undefined')){console.log('Error: Token Invalid, Need to Ping !')
api.call('deezer_ping',{},function(r){if(typeof(r.results.CHECKFORM)!=='undefined'){if(USER.USER_ID>0&&r.results.USER_ID==0){SESSION_ID=r.results.SESSION;checkForm=r.results.CHECKFORM;hideLoading();modal.open('lightbox/no_session.php');return;}else{USER.USER_ID=r.results.USER_ID;SESSION_ID=r.results.SESSION;checkForm=r.results.CHECKFORM;}
api.call(method,input,func,params,async_group,retry+1)}},{},'ping',retry+1)}else{if(typeof(func)!=='undefined'&&func!=''){if(!OFFLINE&&dzoffline.AVAILABLE&&(method=='deezer_userMenu'||method=='deezer_pagePlaylist'||method=='deezer_pageAlbum'||method=='playlist.getSongs')){var key=method;if(key=='deezer_userMenu'){window.localStorage.setItem(key+'_'+USER.USER_ID,JSON.stringify(request));}else{if(method=='deezer_pagePlaylist'){key+='_'+input.playlist_id+'_'+input.start+'_'+input.nb;}
if(method=='deezer_pageAlbum'){key+='_'+input.alb_id;}
if(request.error.length>0){alert('Caching impossible, voir console JS')
console.log('interface error found:',request.error);}else{dzDB.addItem(key,JSON.stringify(request));dzoffline.listInterface[key]=request;}}}
func(request,params);}}}};
if(typeof(console)==='undefined'){console=function(){};console.log=function(msg){};}
if(ENV!='DEV'){var logJS=[];console.log=function(){var log=[].join.call(arguments,', ')
logJS.unshift(log);};}
if(typeof(window.onerror)==='undefined'){window.onerror=function(){};}
document.write=function(){return false;}
document.open=function(){return false;}
document.close=function(){return false;}
function redirect(url,options){try{if(url==''){return false;}
if(typeof(options)=='undefined'){options={};}
url=decodeURIComponent(url);if(url.indexOf("/music/")!=-1){var path=url.split('/music/');var page=path[1].split('/');if(page.length==1){api.call('artist_getIdByRewriting',{'URL_REWRITING':page[0]},function(request){if(request==false||request==null||request.results==null||typeof(request.results.ART_ID)=='undefined'){return false;}
url='artist/'+request.results.ART_ID;loadBox(url,options);return true;},{});return true;}else if(path.length==2&&page[0]=='playlist'){url='playlist/'+page[1];}else if(path.length==2&&page[0]=='track'){url='track/'+page[1];}else if(path.length==2){var buffer=page[1].split('-');url='album/'+buffer[(buffer.length-1)];}
loadBox(url,options);return true;}
if(url.indexOf("/profile/")!=-1){var path=url.split('/profile/');loadBox('profile/'+path[1],options);return true;}
if(url.indexOf("/search/")!=-1){var path=url.split('/search/');loadBox('search/'+path[1],options);return true;}
if(url.indexOf("/radio/")!=-1){var path=url.split('/radio/');loadBox('radio/'+path[1],options);return true;}
if(url.indexOf("/artist/")!=-1){var path=url.split('/artist/');loadBox('artist/'+path[1],options);return true;}
if(url.indexOf("/album/")!=-1){var path=url.split('/album/');loadBox('album/'+path[1],options);return true;}
if(url.indexOf("/playlist/")!=-1){var path=url.split('/playlist/');loadBox('playlist/'+path[1],options);return true;}
if(url.indexOf("/track/")!=-1){var path=url.split('/track/');loadBox('track/'+path[1],options);return true;}
console.log('js redirect not found');return false;}catch(e){console.log(e.message,e.stack);}}
function loadFacebox(page){try{dclk_hide();$('.tipsy').remove();$('#hovercard').hide();$('#sharebox').remove();$('#favoritebox').remove();$('#facebox_overlay').fadeOut();if(typeof(actual_box)!='undefined'&&actual_box.substr(0,6)=='video/'){$('#naboo_video_player').text('');}
param=page.split('?');var query_param='';if(typeof(param[1])!='undefined'){var query_param=param[1];}
var url='/'+SETTING_LANG+'/'+param[0]+'?checkForm='+encodeURIComponent(checkForm)+'&'+query_param;if(PLATFORM!='web'){$.get(url,function(data){$('body').html(data);});return true;}
var id=util.uniqid();jQuery.facebox({ajax:url});$("#facebox").data('uniqid',id);return id;}catch(e){console.log(e.message,e.stack);}}
function loadTab(selectedTabId,options){try{if(typeof(selectedTabId)=='undefined'){return false;}
if(typeof(options)=='undefined'){options='';}
$tab=$('#tab_'+selectedTabId+'_link > a');var type=$tab.attr('data-type');$tab.parents('.nav-tabs').children().removeClass('active');$tab.parents('.tabbable').children('.tabs-content').children().removeClass('active');$('#tab_'+type+'_link').addClass('active');$('#tab_'+type+'_link .badge').text(0).hide();$('#tab_'+type+'_content').addClass('active');Events.trigger(Events.tabs.open,{tab_id:selectedTabId,options:options});if(selectedTabId=='biography'){var head_height=$('#naboo_artist_head').height();var global_height=$('#head-content').height()+head_height+$('#naboo_artist_second').height();if(global_height>client_height){var scroll_diff=global_height-client_height;$('#page_content').animate({scrollTop:(scroll_diff>head_height)?head_height+20:scroll_diff+20},'slow');}}}catch(e){console.log(e.message,e.stack);}}
function loadBox(page,options){try{if(arguments.length>2){console.log('WARNING : loadBox multi parameters found');}
if(typeof(options)=='undefined'||typeof(options)!='object'){options={};}
if(typeof(actual_box)!='undefined'&&actual_box.substr(0,6)=='video/'){$('#naboo_video_player').text('');}
if(page.substr(0,9)=='login.php'||page.substr(0,12)=='register.php'||page.substr(0,20)=='register_confirm.php'||page.substr(0,9)=='reset.php'||page.substr(0,18)=='premium_result.php'||page.substring(0,17)=='premium/video.php'||page.substring(0,12)=='videobox.php'||page.substring(0,15)=='profile/search/'||page=='payment/paypal_unsubscribe.php'||page=='confirm.php'||page=='facebook.php'||page=='developers/api/register.php'||page=='music/player_options.php'||page.match(new RegExp("(profile|user)[/][0-9]+[/]write"))!=null||page.match(new RegExp("(profile|user)[/][0-9]+[/]friendbox"))!=null||page.match(new RegExp("(profile|user)[/][0-9]+[/]info_change/premplus"))!=null||page.match(new RegExp("(profile|user)[/][0-9]+[/]info_change/prem"))!=null){console.log('You should call loadFacebox to open this lb');loadFacebox(page);return;}else{dclk_hide();infinite_scroll.disable();$('.tipsy').remove();$('#hovercard').hide();if(options.forceFaceboxClose!=false){$('#sharebox').remove();$('#favoritebox').remove();$('#facebox_overlay').fadeOut();$.facebox.close();}}
Events.trigger(Events.navigation.page_changed,page);actual_box=page;var path=page.split('/');if(typeof(naboo.allowed_pages[path[0]])!='undefined'||(page==''&&USER.USER_ID>0)){if(page=='home'&&naboo.last_page!=null&&naboo.last_page!=''&&naboo.displayed!=true){$.address.value((naboo.last_page=='picks')?'':naboo.last_page);getScripts(ressources.naboo,function(){naboo.display(naboo.last_page);});}else{$.address.value((page=='picks')?'':page);getScripts(ressources.naboo,function(){naboo.display(page);});}
return true;}
showLoading();naboo.last_page=null;if(path[0]=='radio'){getScripts(ressources.radio,function(){radio.display(page);});$.address.value(page);return true;}
if(path[0]=='offers'){OFFER_CODE_ORIGIN=1;if(typeof(options.origin)!='undefined'){OFFER_CODE_ORIGIN=options.origin;}}
getParam=page.split('?');var get_query_param='';if(typeof(getParam[1])!='undefined'){var get_query_param=getParam[1];}
request=sendRequest('/'+SETTING_LANG+'/ajax/loader.php?checkForm='+encodeURIComponent(checkForm)+'&'+get_query_param,'text','page='+encodeURIComponent(page)+'&full=1',true,loadBoxCallback,{'page':page},'major_pages');return true;}catch(e){console.log(e.message,e.stack);}}
function loadBoxCallback(request,callback_parameters){try{if(request==false||request==null||typeof(request.responseText)=='undefined'){return false;}
request=request.responseText;page='';if(callback_parameters['page']!=null){page=callback_parameters['page'];}
var path=page.split('/');switch(path[0]){case'':scripts=ressources.home;break;case'legal':scripts=ressources.legal;break;case'features':scripts=ressources.features;break;case'premium':scripts=ressources.premium;break;case'devices':scripts=ressources.devices;break;case'offers':scripts=ressources.offers;break;default:scripts=[];}
if(DZPS!='undefined'&&DZPS!=null&&DZPS===true){disableAdsHabillage(page);}else if(page!=''){disableAdsHabillage(page);}
ads_url_300x250='';ads_url_728x90='';getScripts(scripts,function(){loadBoxFinal('naboo_content',request);});$('#page_content').scrollTop(0);$.address.value((page=='picks')?'':page);hideLoading();return true;}catch(e){console.log(e.message,e.stack);}}
function displayInterstitial(data){try{var content='',self_close=false;switch(data.type){case'autopromo_img':if(!www.allowAutoPromo(data)){return false;}
if(data.target=='internal'){data.target='_self';data.click='javascript:'+data.click+'; removeInterstitial(); return false';}else{data.target='_'+data.target;}
content='<img src="'+data.url+'"/>';setCookie('autopromo_intersticiel',true,SERVER_TIMESTAMP+86400);break;case'autopromo_video':if(!www.allowAutoPromo(data)){return false;}
content=data.embed;if(data.self_close==='0')self_close=true;setCookie('autopromo_intersticiel',true,SERVER_TIMESTAMP+86400);break;case'ads_billboard':if(!USER.OPTIONS.ads_display){return false;}
content='<img src="'+data.url+'"/>';break;case'ads_interstitial':if(!USER.OPTIONS.ads_display){return false;}
var formatSize=data.formatSize.split('x');if(data.format=='image'){content='<img src="'+data.url+'"/>';}else if(data.format=='swf'){ads.setSwf('interstitial_ads','interstitial_ads_swf',data.url,formatSize[0],formatSize[1],data.clickTagMethod,data.click,'#FFFFFF','opaque');data.click='javascript:void(0)';data.target='_self';}else if(data.format=='redirect'){ads.setRedirect('interstitial_ads',data.redirect.js,data.redirect.clickCommand,formatSize[0],formatSize[1]);data.click='javascript:void(0)';data.target='_self';}else if(data.format=='video'){ads.setVideo('interstitial_ads','interstitial_ads_swf',data.url,formatSize[0],formatSize[1],'','',0,data.click);data.click='javascript:void(0)';data.target='_self';}
break;default:console.log('displayInterstitial : type unknow');return false;}
if(typeof(data.duration)=='undefined'){data.duration=3;}
if(content!=''){$('#interstitial_ads').append($(content));}
$('#interstitial_ads').attr({'href':data.click,'target':data.target});$('#interstitial').show();if(!self_close){setTimeout(function(){removeInterstitial();},parseInt(data.duration)*1000);}}catch(e){console.log(e.message,e.stack);}}
function removeInterstitial(){try{$('#interstitial').hide();$('#interstitial_ads').removeAttr('href').empty();}catch(e){console.log(e.message,e.stack);}}
function loadBoxFinal(id_inner,request){if(id_inner!=''){$('body').removeClass('layout-naboo').addClass('layout-page');$("#"+id_inner).html(request);Events.trigger(Events.navigation.page_displayed);}
return true;}
function show(id){$('#'+id).css('display','block');}
function hide(id){$('#'+id).css('display','none');}
function inline(id){$('#'+id).css('display','inline');}
var last_asynch_request;var async_groups=new Object();function sendRequest(url,response,post,asynchronous,callback,callback_parameters,async_group){try{if(post!=''&&post!='undefined'){post_status='POST';}else{post_status='GET';}
if(asynchronous!=true&&asynchronous!=false){asynchronous=false;}
if(typeof(callback_parameters)=='undefined'||callback_parameters==null){callback_parameters=false;}
if(typeof(async_group)=='undefined'||async_group==null){async_group=false;}
if(typeof(callback)!=='undefined'&&callback!=''&&asynchronous&&async_group!==false&&async_groups[async_group]!=null){async_groups[async_group].success=null;async_groups[async_group].abort();}
ajax=$.ajax({url:url,type:post_status,data:post,async:asynchronous,success:function(data,textStatus,xhr){if(typeof(callback)!=='undefined'&&callback!=''&&callback!=null){try{callback(xhr,callback_parameters);}
catch(e){console.log(e.message,e.stack)}}else{return data;}}});if(typeof(callback)!=='undefined'&&callback!=''&&asynchronous&&async_group!==false){async_groups[async_group]=ajax;}
if(response=='xml'){result=ajax.responseXML;}else{result=ajax.responseText;}
return result;}catch(e){console.log(e.message,e.stack);}}
function setCookie(name,value,expiredays){var exdate=new Date();exdate.setDate(exdate.getDate()+expiredays);document.cookie=name+"="+escape(value)+"; path=/"+((expiredays==null)?"":";expires="+exdate.toGMTString());}
function getCookie(name){if(document.cookie.length>0){c_start=document.cookie.indexOf(name+"=");if(c_start!=-1){c_start=c_start+name.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end==-1){c_end=document.cookie.length;}
return unescape(document.cookie.substring(c_start,c_end));}}
return'';}
function addslashes(string){return(string+'').replace(/([\\"'])/g,"\\$1").replace(/\0/g,"\\0");}
function stripslashes(string){return(string+'').replace(/\\(.?)/g,function(s,n1){switch(n1){case'\\':return'\\';case'0':return'\u0000';case'':return'';default:return n1;}});}
function ucfirst(str){try{var f=str.charAt(0).toUpperCase();return f+str.substr(1);}catch(e){console.log(e.message,e.stack);}}
function base64_decode(data){try{var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,dec="",tmp_arr=[];if(!data){return data;}
data+='';do{h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;o1=bits>>16&0xff;o2=bits>>8&0xff;o3=bits&0xff;if(h3==64){tmp_arr[ac++]=String.fromCharCode(o1);}else if(h4==64){tmp_arr[ac++]=String.fromCharCode(o1,o2);}else{tmp_arr[ac++]=String.fromCharCode(o1,o2,o3);}}while(i<data.length);dec=tmp_arr.join('');return dec;}catch(e){console.log(e.message,e.stack);}}
function bin2hex(str){var len=str.length;var rv='';var i=0;var c;while(len-->0){c=str.charCodeAt(i++);rv+=_bin2hex[(c&0xf0)>>4];rv+=_bin2hex[(c&0x0f)];}
return rv;}
function hex2bin(str){var len=str.length;var rv='';var i=0;var c1;var c2;while(len>1){h1=str.charAt(i++);c1=h1.charCodeAt(0);h2=str.charAt(i++);c2=h2.charCodeAt(0);rv+=String.fromCharCode((_hex2bin[c1]<<4)+_hex2bin[c2]);len-=2;}
return rv;}
var _bin2hex=['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f'];var _hex2bin=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,0,0,0,0,0,0,0,10,11,12,13,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,11,12,13,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function analyticsTrackingEvent(category,action,optional_label){try{date=new Date();timestamp=date.getTime();timestamp=Math.round(timestamp/1000)+315622800;if(typeof(_gaq)!='undefined'){_gaq.push(['_trackEvent',category,action,optional_label]);}}catch(e){console.log(e.message,e.stack);}}
function insertAfter(element,node){try{element.parentNode.insertBefore(node,element.nextSibling);}catch(e){console.log(e.message,e.stack);}}
function crontab(){if(typeof(crontab_timeout)!='undefined'){window.clearTimeout(crontab_timeout);}
update_server_timestamp();try{if((SESSION_DURATION%10)==0){ads.incrementRefreshCounter();friends.updateOnline();}
if((SESSION_DURATION%30)==0){calculeTime();}}
catch(e){}
crontab_timeout=window.setTimeout(crontab,1000);return true;}
function update_server_timestamp(){SERVER_TIMESTAMP+=1;SESSION_DURATION+=1;return true;}
function rewriting(str){if(typeof(str)=='undefined'){return'';}
var spec=new Array('À','Á','Â','Ã','Ä','Å','Æ','à','á','â','ã','ä','å','æ','È','É','Ê','Ë','è','é','ê','ë','Ì','Í','Î','Ï','ì','í','î','ï','Ò','Ó','Ô','Õ','Ö','Ø','ò','ó','ô','õ','ö','ø','Ù','Ú','Û','Ü','ù','ú','û','ü','ß','Ç','ç','Ð','ð','Ñ','ñ','Þ','þ','Ý','ş',' ','"',"'",'(',')',',','.',';','?','!',':','‘','&','$','+','[',']','{','}');var norm=new Array('A','A','A','A','A','A','A','a','a','a','a','a','a','a','E','E','E','E','e','e','e','e','I','I','I','I','i','i','i','i','O','O','O','O','O','O','o','o','o','o','o','o','U','U','U','U','u','u','u','u','B','C','c','D','d','N','n','P','p','Y','s','-','-','-','-','-','-','-','-','-','-','-','-','-','-','-','-','-');for(var i=0;i<spec.length;i++){str=str_replace(str,spec[i],norm[i]);}
return str;}
function urlRewriting(str){if(typeof(str)=='undefined'){return'';}
str=rewriting(str);str=str_replace(str,'//','-');str=str_replace(str,'/','-');str=str_replace(str,'----','-');str=str_replace(str,'---','-');str=str_replace(str,'--','-');str=str_replace(str,'#','-');if(str.slice(-1)=='-'){str=str.slice(0,-1);}
str=(str+'').toLowerCase();return str;}
String.prototype.trim=function(trimChar){return trim(this,typeof(trimChar)!='undefined'?trimChar:null);};function trim(myString,trimChar){if(typeof(trimChar)=='string'&&trimChar!=''){var regexpLeft=new RegExp('^['+trimChar+']['+trimChar+']*');var regexpRight=new RegExp('['+trimChar+']['+trimChar+']*$');}else{var regexpLeft=new RegExp('^\\s\\s*');var regexpRight=new RegExp('\\s\\s*$');}
return myString.replace(regexpLeft,'').replace(regexpRight,'');}
String.prototype.ltrim=function(trimChar){return ltrim(this,typeof(trimChar)!='undefined'?trimChar:null)};function ltrim(myString,trimChar){if(typeof(trimChar)=='string'&&trimChar!=''){var regexpLeft=new RegExp('^['+trimChar+']['+trimChar+']*');}else{var regexpLeft=new RegExp('^\\s\\s*');}
return myString.replace(regexpLeft,'');}
function str_replace(haystack,needle,replacement){var temp=haystack.split(needle);return temp.join(replacement);}
function truncateTxt(txt,max_length){if(txt.length>max_length){txt=txt.substr(0,max_length-4)+" ...";}
return txt;}
function shuffle(a){var j=0;var valI='';var valJ=valI;var l=a.length-1;while(l>-1){j=Math.floor(Math.random()*l);valI=a[l];valJ=a[j];a[l]=valJ;a[j]=valI;l=l-1;}
return a;}
function calculeTime(){$(".timestamp").each(function(index){var timestamp=SERVER_TIMESTAMP-$(this).attr("data-timestamp");$(this).text(($(this).attr("data-timestamp")==0)?'-':getAgoTime(timestamp));});return true;}
function localTimeStamp(){var d=new Date();return Math.floor(d.getTime()/1000);}
function getAgoTime(timer){try{if(timer==null||timer==''||timer<0){timer=0;}
if(timer<60){return trad.date.few_moments_ago;}else if(timer<3600){str_singular=trad.date.minute;str_plurial=trad.date.minutes;timer=Math.round(timer/60);}else if(timer<86400){str_singular=trad.date.hour;str_plurial=trad.date.hours;timer=Math.round(timer/3600);}else if(timer>86400&&timer<172800){return trad.date.yesterday;}else if(timer<604800){str_singular=trad.date.day;str_plurial=trad.date.days;timer=Math.round(timer/86400);}else if(timer<2592000){str_singular=trad.date.week;str_plurial=trad.date.weeks;timer=Math.round(timer/604800);}else{timer=Math.round(timer/2592000);if(timer>12){return trad.date.more_than_one_year_ago;}
str_singular=trad.date.month;str_plurial=trad.date.months;}
if(timer>1){timer=timer+' '+str_plurial;}else{timer=timer+' '+str_singular;}
str=sprintf(trad.date.time_ago,timer);return str;}catch(e){console.log(e.message,e.stack)}}
function pad(number,length){var str=''+number;while(str.length<length){str='0'+str;}
return str;}
function secToMin(seconds){try{return pad(Math.floor(seconds/60),2)+':'+pad(seconds%60,2);}catch(e){console.log(e.message,e.stack);}}
function getTotalDuration(seconds){minutes=Math.floor(seconds/60);if(minutes>59){hours=Math.floor(minutes/60);minutes=minutes-(hours*60);result=hours+' '+trad.music.naboo_datagrid_hour;if(minutes>0){result+=' '+pad(minutes,2)+' '+trad.music.naboo_datagrid_minute;}}else{result=' '+pad(minutes,2)+' '+trad.music.naboo_datagrid_minute;}
return result;}
function timestampToDate(timestamp,hours){if(typeof(hours)=='undefined'){hours=false;}
date=new Date();date.setTime(timestamp*1000);month=parseInt(date.getMonth())+1;dateString=date.getDate()+'/'+pad(month,2)+'/'+date.getFullYear();if(hours){dateString+=' '+date.getHours()+':'+date.getMinutes()+':'+date.getSeconds();}
return dateString;}
function serialize(txt){switch(typeof(txt)){case'string':return's:'+txt.length+':"'+txt+'";';case'number':if(txt>=0&&String(txt).indexOf('.')==-1&&txt<65536){return'i:'+txt+';';}
return'd:'+txt+';';case'boolean':return'b:'+((txt)?'1':'0')+';';case'object':var i=0,k,ret='';for(k in txt){if(!isNaN(k)){k=Number(k);}
ret+=serialize(k)+serialize(txt[k]);i++;}
return'a:'+i+':{'+ret+'}';default:return'N;';alert('var undefined: '+typeof(txt));return undefined;}}
function unserialize(txt){var level=0,arrlen=new Array(),del=0,final=new Array(),key=new Array(),save=txt;while(1){switch(txt.substr(0,1)){case'N':del=2;ret=null;break;case'b':del=txt.indexOf(';')+1;ret=(txt.substring(2,del-1)=='1')?true:false;break;case'i':del=txt.indexOf(';')+1;ret=Number(txt.substring(2,del-1));break;case'd':del=txt.indexOf(';')+1;ret=Number(txt.substring(2,del-1));break;case's':del=txt.substr(2,txt.substr(2).indexOf(':'));ret=txt.substr(1+txt.indexOf('"'),del);del=txt.indexOf('"')+1+ret.length+2;break;case'a':del=txt.indexOf(':{')+2;ret=new Array();arrlen[level+1]=Number(txt.substring(txt.indexOf(':')+1,del-2))*2;break;case'O':txt=txt.substr(2);var tmp=txt.indexOf(':"')+2;var nlen=Number(txt.substring(0,txt.indexOf(':')));name=txt.substring(tmp,tmp+nlen);txt=txt.substring(tmp+nlen+2);del=txt.indexOf(':{')+2;ret=new Object();arrlen[level+1]=Number(txt.substring(0,del-2))*2;break;case'}':txt=txt.substr(1);if(arrlen[level]!=0){alert('var missed : '+save);return undefined;};level--;continue;default:if(level==0){return final;}
alert('syntax invalid(1) : '+save+"\nat\n"+txt+"level is at "+level);return undefined;}
if(arrlen[level]%2==0){if(typeof(ret)=='object'){alert('array index object no accepted : '+save);return undefined;}
if(ret==undefined){alert('syntax invalid(2) : '+save);return undefined;}
key[level]=ret;}else{var ev='';for(var i=1;i<=level;i++){if(typeof(key[i])=='number'){ev+='['+key[i]+']';}else{ev+='["'+key[i]+'"]';}}
eval('final'+ev+'= ret;');}
arrlen[level]--;if(typeof(ret)=='object'){level++;}
txt=txt.substr(del);continue;}}
function countObject(obj){if(typeof(obj)=='string'||typeof(obj)=='number'){return false;}
if(typeof(Object.keys)=='function'){return Object.keys(obj).length;}
var count=0;for(var prop in obj){if(obj.hasOwnProperty(prop)){++count;}}
return count;}
function return_age(date){now=CURRENT_DATE;exp_date=date.split("-");exp_now=now.split("-");date_year=exp_date[0];date_month=exp_date[1];date_day=exp_date[2];now_year=exp_now[0];now_month=exp_now[1];now_day=exp_now[2];years=now_year-date_year;if(now_month<=date_month){if(date_month==now_month){if(date_day>now_day){years-=1;}}else{years-=1;}}
age=years;return age;}
function toTimestamp(year,month,day,hour,minute,second){var datum=new Date(Date.UTC(year,month-1,day,hour,minute,second));return datum.getTime()/1000;}
function dateToTimestamp(date){var date=date.split("-");return toTimestamp(date[0],date[1],date[2],0,0,0);}
function getShortMonthName(month){var months_name=Array(trad.date.jan,trad.date.feb,trad.date.mar,trad.date.apr,trad.date.may,trad.date.jun,trad.date.jul,trad.date.aug,trad.date.sep,trad.date.oct,trad.date.nov,trad.date.dec);return months_name[(month.charAt(0)=='0')?(parseInt(month.charAt(1))-1):(parseInt(month)-1)];}
function getScripts(scripts,finalCallback){_getScript(scripts,0,scripts.length,finalCallback);}
function _getScript(scripts,pos,max,finalCallback){if(pos<0||pos>=max){finalCallback();return;}
if(ressources.cached[scripts[pos][0]]==true){_getScript(scripts,pos+1,max,finalCallback);}else{if(scripts[pos][1]=='js'){$.ajax({cache:true,url:scripts[pos][0],dataType:'script',success:function(){ressources.cached[scripts[pos][0]]=true;_getScript(scripts,pos+1,max,finalCallback);}});}
if(scripts[pos][1]=='css'){$('head').append($('<link rel="stylesheet" type="text/css" href="'+scripts[pos][0]+'" />'));ressources.cached[scripts[pos][0]]=true;_getScript(scripts,pos+1,max,finalCallback);}}}
function getClientHeight(){if(typeof(window.innerHeight)=='number'){return window.innerHeight;}else if(typeof(document.documentElement.clientHeight)!='undefined'){return document.documentElement.clientHeight;}else if(typeof(document.body.clientHeight)!='undefined'){return document.body.clientHeight;}else{return 0;}}
function getClientWidth(){if(typeof(document.documentElement.clientWidth)!='undefined'){return document.documentElement.clientWidth;}else if(typeof(document.body.clientWidth)!='undefined'){return document.body.clientWidth;}else if(typeof(window.innerWidth)=='number'){return window.innerWidth;}else{return 0;}}
function showLoading(displayDelay){if(typeof(displayDelay)=='undefined'){displayDelay=350;}
notification.display(trad.general.loading,true,displayDelay,0);}
function hideLoading(){notification.hide();}
function timestampToIso8601(ts){if(typeof(ts)=='undefined'){var ts=Math.floor(new Date().getTime()/1000);}
var aDate=new Date();aDate.setTime(ts*1000);return(aDate.getFullYear()+"-"+pad((aDate.getMonth()+1),2)+"-"+pad(aDate.getDate(),2)+"T"+pad(aDate.getHours(),2)+":"+pad(aDate.getMinutes(),2));}
String.prototype.format=function(){var s=this,i=arguments.length;while(i--){s=s.replace(new RegExp('\\{'+i+'\\}','gm'),arguments[i]);}
return s;};function getObjectSize(obj){var size=0,key;for(key in obj){if(obj.hasOwnProperty(key)){size++;}}
return size;};function storeSongsDownload(sng_ids){try{api.call('store_getDownloadUrl',{songs:sng_ids},storeSongsDownloadCallBack,{songs:sng_ids});return true;}catch(e){console.log(e.message,e.stack);}};function storeSongsDownloadCallBack(request,callBackParams){try{if(request.error.length==0){if($('#store_downloads_file').length==0)
$('body').append('<iframe id="store_downloads_file" style="display:none;height:1px;width:1px"/></iframe>');$('#store_downloads_file').attr('src',request.results+((ENV=='DEV'&&callBackParams.songs.length>1)?'&ZIP=1':''));}else{console.log('error:',request.error);}}catch(e){console.log(e.message,e.stack);}};function getHelper(label){label=truncateTxt(label,30);return $('<div style="position:absolute;width:1px;height:1px;z-index:9001;"><div style="z-index:9001;top:-25px;left:0px;position:absolute;background-color:#333;width:180px;height:12px;padding:5px;color:#fff;font-size:11px;font-weight:bold;overflow:hidden">'+label+'</div></div>')};function getElementIdByType(params){var idName={'album':'ALB_ID','playlist':'PLAYLIST_ID','artist':'ART_ID','radio':'RADIO_ID','friend':'USER_ID','application':'APP_ID','song':'KEY'};return params[idName[params.type]];};function formatDate(date){var buffer=[];var format=DATE_FORMAT.split('-');if(date.indexOf('-')==-1&&date.length==8){date=date.substring(0,4)+'-'+date.substring(4,6)+'-'+date.substring(6,8);}
var parts=date.split('-');for(var i=0;i<3;i++){switch(format[i]){case'd':buffer.push(parts[2]);break;case'm':buffer.push(parts[1]);break;case'Y':buffer.push(parts[0]);break;}}
return buffer.join('-');}
function formatedTimeToSecond(time){var format=time.split(':');var seconds=0;if(format.length==3){seconds+=parseInt(format[2]);seconds+=parseInt(format[1])*60;seconds+=parseInt(format[0])*(60*60);}
return seconds;}
function breakUpThousands(nStr){nStr+='';var x=nStr.split('.');var x1=x[0];var x2=x.length>1?'.'+x[1]:'';var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,'$1'+' '+'$2');}
return x1+x2;}
function loadPayment(params,tracking_params){try{var query=[];var url=SETTING_HOST_SITE+'/payment/go.php?';if(typeof(params.id)=='undefined'){return false;}
if(typeof(params.origin)=='undefined'){params.origin=0;}
if(typeof(params.test_id)=='undefined'){params.test_id=0;}
for(var key in params){if(params.hasOwnProperty(key)){query.push(key+'='+params[key]);}}
url+=query.join('&');loadPaymentProgress=true;if(typeof(tracking_params)!='undefined'&&$.isPlainObject(tracking_params)&&countObject(tracking_params)>0){tracking_params.origin=params.origin;tracking.track('offers_subscribe_click',tracking_params,function(){window.location=url;});}else{window.location=url;}
return true;}catch(e){}}
function sprintf(){var regex=/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g;var a=arguments,i=0,format=a[i++];var pad=function(str,len,chr,leftJustify){if(!chr){chr=' ';}
var padding=(str.length>=len)?'':Array(1+len-str.length>>>0).join(chr);return leftJustify?str+padding:padding+str;};var justify=function(value,prefix,leftJustify,minWidth,zeroPad,customPadChar){var diff=minWidth-value.length;if(diff>0){if(leftJustify||!zeroPad){value=pad(value,minWidth,customPadChar,leftJustify);}else{value=value.slice(0,prefix.length)+pad('',diff,'0',true)+value.slice(prefix.length);}}
return value;};var formatBaseX=function(value,base,prefix,leftJustify,minWidth,precision,zeroPad){var number=value>>>0;prefix=prefix&&number&&{'2':'0b','8':'0','16':'0x'}[base]||'';value=prefix+pad(number.toString(base),precision||0,'0',false);return justify(value,prefix,leftJustify,minWidth,zeroPad);};var formatString=function(value,leftJustify,minWidth,precision,zeroPad,customPadChar){if(precision!=null){value=value.slice(0,precision);}
return justify(value,'',leftJustify,minWidth,zeroPad,customPadChar);};var doFormat=function(substring,valueIndex,flags,minWidth,_,precision,type){var number;var prefix;var method;var textTransform;var value;if(substring=='%%'){return'%';}
var leftJustify=false,positivePrefix='',zeroPad=false,prefixBaseX=false,customPadChar=' ';var flagsl=flags.length;for(var j=0;flags&&j<flagsl;j++){switch(flags.charAt(j)){case' ':positivePrefix=' ';break;case'+':positivePrefix='+';break;case'-':leftJustify=true;break;case"'":customPadChar=flags.charAt(j+1);break;case'0':zeroPad=true;break;case'#':prefixBaseX=true;break;}}
if(!minWidth){minWidth=0;}else if(minWidth=='*'){minWidth=+a[i++];}else if(minWidth.charAt(0)=='*'){minWidth=+a[minWidth.slice(1,-1)];}else{minWidth=+minWidth;}
if(minWidth<0){minWidth=-minWidth;leftJustify=true;}
if(!isFinite(minWidth)){throw new Error('sprintf: (minimum-)width must be finite');}
if(!precision){precision='fFeE'.indexOf(type)>-1?6:(type=='d')?0:undefined;}else if(precision=='*'){precision=+a[i++];}else if(precision.charAt(0)=='*'){precision=+a[precision.slice(1,-1)];}else{precision=+precision;}
value=valueIndex?a[valueIndex.slice(0,-1)]:a[i++];switch(type){case's':return formatString(String(value),leftJustify,minWidth,precision,zeroPad,customPadChar);case'c':return formatString(String.fromCharCode(+value),leftJustify,minWidth,precision,zeroPad);case'b':return formatBaseX(value,2,prefixBaseX,leftJustify,minWidth,precision,zeroPad);case'o':return formatBaseX(value,8,prefixBaseX,leftJustify,minWidth,precision,zeroPad);case'x':return formatBaseX(value,16,prefixBaseX,leftJustify,minWidth,precision,zeroPad);case'X':return formatBaseX(value,16,prefixBaseX,leftJustify,minWidth,precision,zeroPad).toUpperCase();case'u':return formatBaseX(value,10,prefixBaseX,leftJustify,minWidth,precision,zeroPad);case'i':case'd':number=+value||0;number=Math.round(number-number%1);prefix=number<0?'-':positivePrefix;value=prefix+pad(String(Math.abs(number)),precision,'0',false);return justify(value,prefix,leftJustify,minWidth,zeroPad);case'e':case'E':case'f':case'F':case'g':case'G':number=+value;prefix=number<0?'-':positivePrefix;method=['toExponential','toFixed','toPrecision']['efg'.indexOf(type.toLowerCase())];textTransform=['toString','toUpperCase']['eEfFgG'.indexOf(type)%2];value=prefix+Math.abs(number)[method](precision);return justify(value,prefix,leftJustify,minWidth,zeroPad)[textTransform]();default:return substring;}};return format.replace(regex,doFormat);};
try{var JSON={stringify:function stringify(arg){var c,i,l,s='',v;switch(typeof arg){case'object':if(arg){if(arg.constructor==Array){for(i=0;i<arg.length;++i){v=stringify(arg[i]);if(s){s+=',';}
s+=v;}
return'['+s+']';}else if(typeof arg.toString!='undefined'){for(i in arg){v=stringify(arg[i]);if(typeof v!='function'){if(s){s+=',';}
s+=stringify(i)+':'+v;}}
return'{'+s+'}';}}
return'null';case'number':return isFinite(arg)?String(arg):'null';case'string':l=arg.length;s='"';for(i=0;i<l;i+=1){c=arg.charAt(i);if(c>=' '){if(c=='\\'||c=='"'){s+='\\';}
s+=c;}else{switch(c){case'\b':s+='\\b';break;case'\f':s+='\\f';break;case'\n':s+='\\n';break;case'\r':s+='\\r';break;case'\t':s+='\\t';break;default:c=c.charCodeAt();s+='\\u00'+Math.floor(c/16).toString(16)+
(c%16).toString(16);}}}
return s+'"';case'boolean':return String(arg);default:return'null';}},parse:function(text){var at=0;var ch=' ';function error(m){throw{name:'JSONError',message:m,at:at-1,text:text};}
function next(){ch=text.charAt(at);at+=1;return ch;}
function white(){while(ch){if(ch<=' '){next();}else if(ch=='/'){switch(next()){case'/':while(next()&&ch!='\n'&&ch!='\r'){}
break;case'*':next();for(;;){if(ch){if(ch=='*'){if(next()=='/'){next();break;}}else{next();}}else{error("Unterminated comment");}}
break;default:error("Syntax error");}}else{break;}}}
function string(){var i,s='',t,u;if(ch=='"'){outer:while(next()){if(ch=='"'){next();return s;}else if(ch=='\\'){switch(next()){case'b':s+='\b';break;case'f':s+='\f';break;case'n':s+='\n';break;case'r':s+='\r';break;case't':s+='\t';break;case'u':u=0;for(i=0;i<4;i+=1){t=parseInt(next(),16);if(!isFinite(t)){break outer;}
u=u*16+t;}
s+=String.fromCharCode(u);break;default:s+=ch;}}else{s+=ch;}}}
error("Bad string");}
function array(){var a=[];if(ch=='['){next();white();if(ch==']'){next();return a;}
while(ch){a.push(value());white();if(ch==']'){next();return a;}else if(ch!=','){break;}
next();white();}}
error("Bad array");}
function object(){var k,o={};if(ch=='{'){next();white();if(ch=='}'){next();return o;}
while(ch){k=string();white();if(ch!=':'){break;}
next();o[k]=value();white();if(ch=='}'){next();return o;}else if(ch!=','){break;}
next();white();}}
error("Bad object");}
function number(){var n='',v;if(ch=='-'){n='-';next();}
while(ch>='0'&&ch<='9'){n+=ch;next();}
if(ch=='.'){n+='.';while(next()&&ch>='0'&&ch<='9'){n+=ch;}}
v=+n;if(!isFinite(v)){error("Bad number");}else{return v;}}
function word(){switch(ch){case't':if(next()=='r'&&next()=='u'&&next()=='e'){next();return true;}
break;case'f':if(next()=='a'&&next()=='l'&&next()=='s'&&next()=='e'){next();return false;}
break;case'n':if(next()=='u'&&next()=='l'&&next()=='l'){next();return null;}
break;}
error("Syntax error");}
function value(){white();switch(ch){case'{':return object();case'[':return array();case'"':return string();case'-':return number();default:return ch>='0'&&ch<='9'?number():word();}}
return value();}};}catch(e){};
var template={loaded:{},seo_page:{'naboo/album':true,'naboo/artist':true,'naboo/track':true,'naboo/profile':true,'naboo/playlist':true},load:function(name,div){try{if(template.loaded[name]==null){if(template.seo_page[name]){if(div.children('[data-template="'+name+'"]').length==1){div.children('[data-seo="'+name+'"]').remove();template.loaded[name]=util.getOuterHTML(div.children('[data-template="'+name+'"]').show());template.display(name,div);return true;}}
template_request=sendRequest('/'+SETTING_LANG+'/ajax/template.php?template='+encodeURIComponent(name)+'&v='+STATIC_VERSION,'text','');if(OFFLINE&&typeof(template_request)=='undefined'){window.location=SETTING_HOST_SITE+'/offline';}
if((template_request!==false)&&(template_request!='error')){template.loaded[name]=template_request;}}
if(template.loaded[name]!=null){div.html(template.loaded[name]);if(name!=='naboo/components/datagrid'){if($('body').is('.layout-page')&&typeof(menu)!=='undefined'){$('body').removeClass('layout-page').addClass('layout-naboo');if(typeof(menu)!='undefined'){menu.updateScrollPan();}}}
Events.trigger(Events.navigation.page_displayed);}
return true;}catch(e){console.log(e.message,e.stack);}},display:function(name,div){if(div.attr('id')=='general'){naboo.hide();}
div.html(template.loaded[name]);Events.trigger(Events.navigation.page_displayed);return true;}};
if(typeof(Events)=='undefined'){var Events={evts:{},deferredObjects:[],ready:function(evt,callback){if(typeof(Events.deferredObjects[evt])=='undefined'){Events.deferredObjects[evt]=$.Deferred();}
Events.deferredObjects[evt].done(callback);},resolve:function(evt){if(typeof(Events.deferredObjects[evt])=='undefined'){Events.deferredObjects[evt]=$.Deferred();}
Events.deferredObjects[evt].resolve();},subscribe:function(evt,callback){$(document).bind(evt,callback);},addEvent:function(group,evt,callback){if(typeof(group)!='string'||typeof(evt)!='string'||typeof(callback)!='function'){return false;}
if(typeof(Events.evts[group])=='undefined'){Events.evts[group]=[];}
Events.evts[group].push({fct:callback,evt:evt});Events.subscribe(evt,callback);},unsubscribeAll:function(group){if(typeof(group)!='string'||typeof(Events.evts[group])=='undefined'){return false;}
for(var i=0;i<Events.evts[group].length;i++){var evt=Events.evts[group][i];Events.unsubscribe(evt.evt,evt.fct);}
Events.evts[group]=null;delete Events.evts[group];},subscribeOnce:function(evt,callback){Events.subscribe(evt,function(event,args){callback(event,args);Events.unsubscribe(evt,event.handleObj.handler);});},unsubscribe:function(evt,handler){$(document).unbind(evt,handler);},trigger:function(evt,args){if(typeof(args)=='undefined')var args=null;$(document).trigger(evt,[args]);},initOverEvents:function(){try{$(document).on('mouseenter','.evt-over',function(e){e.stopPropagation();e.preventDefault();var data=$(this).data('deezer');if(typeof(data)==='undefined'){data={};}
if(typeof(data.tipsy)!=='undefined'){var tipsy_data=$.extend({},$.fn.tipsy.defaults,{'trigger':'manual'},data.tipsy);$(this).tipsy(tipsy_data);$(this).mouseleave(function(){$(this).tipsy('hide');}).tipsy('show');}
if(typeof(data.hovercard)!=='undefined'){if(typeof($(this).attr('data-hovercard'))==='undefined'){var hovercard_data=$.extend({},data.hovercard);var hovercard_url='/ajax/hovercard/page.php?';var hovercard_params=[];for(var prop in hovercard_data){if(hovercard_data.hasOwnProperty(prop)){hovercard_params.push(prop+'='+hovercard_data[prop]);}}
hovercard_url+=hovercard_params.join('&');$(this).attr('data-hovercard',hovercard_url);}
hovercard.init($(this));$(this).mouseleave(function(){hovercard.remove();});}
return true;});return true;}catch(e){console.log(e);}},initOutEvents:function(){try{$(document).on('mouseout','.evt-out',function(e){e.stopPropagation();e.preventDefault();});return true;}catch(e){console.log(e);}},initClickEvents:function(){try{$(document).on('click','.evt-click',function(e){e.stopPropagation();e.preventDefault();var data=$(this).data('deezer');if(typeof(data)==='undefined'){data={};}
if(typeof(data.link)==='undefined'){data.link=$(this).attr('data-link')||1;}
var href=$(this).attr('href');var event_name='evt-click-'+util.uniqid();Events.ready(event_name,function(){if(typeof(data.play)!=='undefined'){var data_play=$.extend({'playContext':'unknow','playAuto':true,'playIndex':0},data.play);var params;switch(data_play.playType){case'tracks':params=[data_play.songList,data_play.playIndex,data_play.playAuto,{TYPE:data_play.playContext,ID:data_play.playId}];break;case'album':case'playlist':params=[data_play.playId,data_play.playIndex,data_play.playAuto,{TYPE:data_play.playContext,ID:data_play.playId}];break;case'radio':case'smartradio':params=[data_play.playId,'','',data_play.playAuto];break;}
dzPlayer['play'+ucfirst(data_play.playType)].apply(dzPlayer,Array.prototype.slice.call(params));}
if(typeof(data.share)!=='undefined'){var share_types=['track','album','artist','playlist','radio','festival','sradio'];sharebox.load($.inArray(data.share.type,share_types),data.share.id);}
if(typeof(data.favorite)!=='undefined'){favorite.add($(this),data.favorite);}
if(parseInt(data.link,10)===1&&typeof(href)!=='undefined'&&href.indexOf('javascript:')===-1&&href!==''){if(href.length>=4&&href.substr(0,4)==='http'){window.open(href);}
if(href.substr(0,1)==='/'){href=href.substr(1,href.length);}
loadBox(href);}
delete Events.deferredObjects[event_name];});if(typeof(data.tracking)!=='undefined'){var data_tracking=$.extend({wait:0,params:{}},data.tracking);var wait=parseInt(data_tracking.wait,10);tracking.track(data_tracking.tag,data_tracking.params,function(){if(typeof(data_tracking.callback)==='function'){data_tracking.callback();}
if(wait===1){Events.resolve(event_name);}});if(wait===0){Events.resolve(event_name);}}else{Events.resolve(event_name);}});return true;}catch(e){console.log(e);}},player:{playerLoaded:'EVENT.PLAYER.playerLoaded',playerReady:'DEFERRED.PLAYER.playerReady',playing:'EVENT.PLAYER.playing',play:'EVENT.PLAYER.play',resume:'EVENT.PLAYER.resume',paused:'EVENT.PLAYER.pause',displayNextSong:'EVENT.PLAYER.displayNextSong',displayCurrentSong:'EVENT.PLAYER.displayCurrentSong',displayEmptyPlayer:'EVENT.PLAYER.displayEmptyPlayer',duration:'EVENT.PLAYER.duration',position:'EVENT.PLAYER.position',pourcentLoaded:'EVENT.PLAYER.pourcentLoaded',loading:'EVENT.PLAYER.loading',log:'EVENT.PLAYER.log',log_offline:'EVENT.PLAYER.log_offline',finish:'EVENT.PLAYER.finish',finishAds:'EVENT.PLAYER.finishAds',finishJingle:'EVENT.PLAYER.finishJingle',finishTrackList:'EVENT.PLAYER.finishTrackList',fadeOutProgress:'EVENT.PLAYER.fadeOutProgress',fadeInProgress:'EVENT.PLAYER.fadeInProgress',changePlayerType:'EVENT.PLAYER.changePlayerType',hq:'EVENT.PLAYER.hq',volume:'EVENT.PLAYER.volume',volume_changed:'EVENT.PLAYER.volume_changed',refreshSoundBar:'EVENT.PLAYER.refreshSoundBar',forceCloseMix:'EVENT.PLAYER.forceCloseMix',notify:'EVENT.PLAYER.notify',repeat:'EVENT.PLAYER.repeat',repeat_changed:'EVENT.PLAYER.repeat_changed',shuffle:'EVENT.PLAYER.shuffle',shuffle_changed:'EVENT.PLAYER.shuffle_changed',mute_changed:'EVENT.PLAYER.mute_changed',error:'EVENT.PLAYER.error',checkLimit:'EVENT.PLAYER.checkLimit',onAir:'EVENT.PLAYER.onAir',order_changed:'EVENT.PLAYER.order_changed',user_status:'EVENT.PLAYER.user_status',updateRestrictTime:'EVENT.PLAYER.updateRestrictTime',adsVastPlaying:'EVENT.PLAYER.adsVastPlaying',shareListen:'EVENT.PLAYER.shareListen',preloadComplete:'EVENT.PLAYER.preloadComplete',preloadAborted:'EVENT.PLAYER.preloadAborted'},player_widget:{loaded:'EVENT.PLAYER_WIDGET.loaded',tracksLoaded:'EVENT.PLAYER_WIDGET.tracksLoaded',notify:'EVENT.PLAYER_WIDGET.notify',displayLayer:'EVENT.PLAYER_WIDGET.displayLayer'},menu:{loaded:'EVENT.MENU.loaded',contextMenu:'EVENT.MENU.contextMenu'},user:{loaded:'DEFERRED.USER.loaded',addFavorite:'EVENT.USER.addFavorite',deleteFavorite:'EVENT.USER.deleteFavorite',share:'EVENT.USER.share',login:'EVENT.USER.login',logout:'EVENT.USER.logout',userReady:'DEFERRED.USER.userReady',dataStoreReady:'DEFERRED.USER.dataStoreReady',settingChange:'EVENT.USER.settingChange'},live:{simultaneousAccess:'EVENT.LIVE.simultaneousAccess',newMessage:'EVENT.LIVE.newMessage',newFriendInvitation:'EVENT.LIVE.newFriendInvitation',newFriendship:'EVENT.LIVE.newFriendship',newNotif:'EVENT.LIVE.newNotif',readNotif:'EVENT.LIVE.readNotif',ready:'EVENT.LIVE.ready',feed:'EVENT.LIVE.feed',limitation:'EVENT.LIVE.limitation',pagefeed:'EVENT.LIVE.pagefeed',update:'EVENT.LIVE.update'},offline:{chunckDownload:'EVENT.OFFLINE.chunckDownload',imageDownload:'EVENT.OFFLINE.imageDownload',trackDownloadStatus:'EVENT.OFFLINE.trackDownloadStatus',trackDownloadProgress:'EVENT.OFFLINE.trackDownloadProgress',elementDownloadStatus:'EVENT.OFFLINE.elementDownloadStatus',elementDownloadProgress:'EVENT.OFFLINE.elementDownloadProgress',changeDownloadStatusButton:'EVENT.OFFLINE.changeDownloadStatusButton',refleshAllDownloadStatus:'EVENT.OFFLINE.refleshAllDownloadStatus',openDBFinish:'EVENT.OFFLINE.openDBFinish',getImageError:'EVENT.OFFLINE.getImageError',loaded:'EVENT.OFFLINE.loaded'},playlist:{addSong:'EVENT.PLAYLIST.addSong',create:'EVENT.PLAYLIST.create',remove:'EVENT.PLAYLIST.remove',update:'EVENT.PLAYLIST.update',add:'EVENT.PLAYLIST.add',created:'EVENT.PLAYLIST.created',removed:'EVENT.PLAYLIST.removed'},folder:{create:'EVENT.FOLDER.create',remove:'EVENT.FOLDER.remove',update:'EVENT.FOLDER.update'},layout:{width_type:'EVENT.LAYOUT.width_type',scroll:'EVENT.LAYOUT.scroll',infiniteScroll:'EVENT.LAYOUT.infiniteScroll',resize:'EVENT.LAYOUT.resize',adsBackground:'EVENT.LAYOUT.adsBackground',scroll:'EVENT.LAYOUT.scroll'},navigation:{page_changed:'EVENT.NAVIGATION.page_changed',page_displayed:'EVENT.NAVIGATION.page_displayed'},datagrid:{displayed:'EVENT.DATAGRID.displayed',onAirPosition:'EVENT.DATAGRID.onAirPosition',allTracksDisplayed:'EVENT.DATAGRID.allTracksDisplayed',removedTrack:'EVENT.DATAGRID.removedTrack'},album:{displayed:'EVENT.ALBUM.displayed',checkReplace:'EVENT.ALBUM.checkReplace',noReplaceNeed:'EVENT.ALBUM.noReplaceNeed'},discography:{displayed:'EVENT.DISCOGRAPHY.displayed'},radio:{skipButtonStatus:'EVENT.RADIO.skipButtonStatus',blacklistTrack:'EVENT.RADIO.blacklistTrack',changeTrack:'EVENT.RADIO.changeTrack'},store:{buyFinish:'EVENT.STORE.buyFinish'},favoritebox:{close:'EVENT.FAVORITEBOX.close'},lightbox:{close:'EVENT.LIGHTBOX.close'},artist:{displayed:'EVENT.ARTIST.displayed'},search:{suggestDisplayed:'EVENT.SEARCH.suggestDisplayed'},tops:{displayed:'EVENT.TOPS.displayed'},tabs:{open:'EVENT.TABS.open'},modal:{close:'EVENT.MODAL.close'},googleplus:{ready:'EVENT.GOOGLEPLUS.ready'}};Events.initOverEvents();Events.initOutEvents();Events.initClickEvents();};
var ads={inactivity_count:0,ads_url_prefix:'http://ww400.smartadserver.com/call/pubj/',init:function(){try{smart_site='deezer';if(SETTING_HOST=='orange.deezer.com'||SETTING_HOST.indexOf('orange.deezerdev.com',0)!==-1){smart_site='orange';}
Events.subscribe(Events.navigation.page_changed,function(){ads.resetRefreshCounter();disableAds();ord=Math.random()*10000000000000000;});return true;}catch(e){console.log(e.message,e.stack);}},setMassMotion:function(data){try{if(typeof(data.redirect.js)!='undefined'&&data.redirect.js.length>0){var headElement=document.getElementsByTagName('head')[0];var script=document.createElement('script');script.async=true;script.src=data.redirect.js;headElement.appendChild(script);}
return true;}catch(e){console.log(e.message,e.stack);}},setSwf:function(div,id,content,w,h,clickMethod,clickCommand,bgColor,wmode){try{if($('#'+div).length===0){return false;}
var oldId;if($('[id='+div+']').length>1){oldId=div;var newId=div+'_'+SERVER_TIMESTAMP;$('#'+oldId).attr('id',newId);div=newId;}
var so=new SWFObject(content,id,w,h,"8",bgColor);so.addParam('wmode',wmode);so.addParam("allowScriptAccess","always");so.addVariable(clickMethod,clickCommand);so.write(div);$('#'+div).show();if(typeof(oldId)!='undefined'){$('#'+div).attr('id',oldId);}
return true;}catch(e){console.log(e.message,e.stack);}},setImage:function(div,content,clickCommand,clickCommandTarget){try{if($('#'+div).length===0){return false;}
$("#"+div).html('<a href="'+clickCommand+'" target="'+clickCommandTarget+'"><img src="'+content+'" /></a>').show();}catch(e){console.log(e.message,e.stack);}},setVideo:function(div,id,content,w,h,startImage,endImage,autoPlayDelay,clickCommand){try{if($('#'+div).length===0){return false;}
var so=new SWFObject(SETTING_STATIC+"/swf/videoAdsPlayer-v"+STATIC_VERSION+".swf",id,w,h,"9");so.addParam('wmode','opaque');so.addParam("allowScriptAccess","always");so.addVariable("urlContent",content);so.addVariable("urlStartImage",startImage);so.addVariable("urlEndImage",endImage);so.addVariable("autoPlayDelay",autoPlayDelay);so.addVariable("clickTag",clickCommand);so.write(div);return true;}catch(e){console.log(e.message,e.stack);}},setRedirect:function(div,js,clickCommand,w,h){try{if($('#'+div).length===0){return false;}
$('#'+div).html('<iframe src="'+SETTING_STATIC+'/ads/iframe-v'+STATIC_VERSION+'.html?tag='+bin2hex(js)+'&clickcommand='+encodeURIComponent(clickCommand)+'" scrolling="no" resizable="no" width="'+w+'" height="'+h+'" frameborder="0"></iframe>').show();return true;}catch(e){console.log(e.message,e.stack);}},setPixelAgence:function(url,id){try{if(url==''){return false;}
if($('#'+id).length==0){$('#global').prepend($('<div id="'+id+'"></div>'));}
$('#'+id).html('<img src="'+url+'" onLoad="try {ads.unsetPixelAgence('+"'"+id+"'"+')} catch(e) {}; return true" onError="try {ads.unsetPixelAgence('+"'"+id+"'"+')} catch(e) {}; return true" />');return true;}catch(e){console.log(e.message,e.stack);}},unsetPixelAgence:function(id){try{$('#'+id).text('');return true;}catch(e){console.log(e.message,e.stack);}},setAlenty:function(data){try{if(typeof(data.tracking.alenty)!='undefined'&&data.tracking.alenty.length>0){var headElement=document.getElementsByTagName('head')[0];var script=document.createElement('script');script.async=true;script.src=data.tracking.alenty;headElement.appendChild(script);}
return true;}catch(e){console.log(e.message,e.stack);}},callAds:function(tags,isAudio){try{if(typeof(isAudio)=='undefined'){isAudio=false;}
if(typeof(USER)!='undefined'&&USER.OPTIONS.ads_display===false&&!isAudio){return false;}
if(typeof(USER)!='undefined'&&USER.OPTIONS.ads_audio===false&&isAudio){return false;}
var headElement=document.getElementsByTagName('head')[0];var script=document.createElement('script');script.async=true;script.src=ads.ads_url_prefix+tags+ads.adsUrlParams();headElement.appendChild(script);var tagList=tags.split('/');if(typeof(tagList[2])=='undefined'){return false;}
var formatId=tagList[2];if(typeof(adsCurrentDisplay[formatId])=='undefined'){if(formatId!='7073'&&formatId!='17992'&&formatId!='19632'){adsCurrentDisplay[formatId]={url:tags,refreshDuration:ADS_REFRESH_DURATION,refreshCount:0};}}}catch(e){console.log(e.message,e.stack);}},adsUrlParams:function(){try{PR='0';if(typeof(DZPS)!='undefined'&&DZPS===true){PR='1';}
if(typeof(USER.BLOG_NAME)=='undefined'){USER.BLOG_NAME='';}
if(typeof(USER.FIRSTNAME)=='undefined'){USER.FIRSTNAME='';}
if(typeof(USER.LASTNAME)=='undefined'){USER.LASTNAME='';}
var isFbConnect=0;if(typeof(USER.FB_USER_ID)!=='undefined'){if(0!==USER.FB_USER_ID){isFbConnect=1;}}
params=';user_age='+USER.USER_AGE;params+=';user_sexe='+USER.USER_GENDER;params+=';env='+ENV;params+=';pr='+PR;params+=';user_id='+USER.USER_ID;params+=';username='+encodeURIComponent(USER.BLOG_NAME);params+=';firstname='+encodeURIComponent(USER.FIRSTNAME);params+=';lastname='+encodeURIComponent(USER.LASTNAME);params+=';partners='+encodeURIComponent(USER.PARTNERS);params+=';offer_id='+OFFER_ID;params+=';focus='+ads_focus_value;params+=';site='+smart_site;params+=';user_fc='+isFbConnect;params+=';favorite_tag='+USER.FAVORITE_TAG;params+=';lang='+SETTING_LANG;params+=';player_play='+((dzPlayer.playing)?'1':'O');return params+'?';}catch(e){console.log(e.message,e.stack);}},incrementRefreshCounter:function(){try{for(var a in adsCurrentDisplay){adsCurrentDisplay[a].refreshCount+=10;}
if(!ads_focus_value){ads.inactivity_count+=10;}
ads.checkAutoRefresh(false);}catch(e){console.log(e.message,e.stack);}},checkAutoRefresh:function(resetInactivity){try{for(var a in adsCurrentDisplay){if(adsCurrentDisplay[a].refreshCount>=adsCurrentDisplay[a].refreshDuration&&ads_focus_value){var reCallUrl=';automatic_refresh=true';if(ads.inactivity_count>=ADS_INACTIVITY_DURATION){reCallUrl+=';billboard=true';}
if(dzPlayer.getPlayerType()!='ads'){ads.callAds(adsCurrentDisplay[a].url+reCallUrl);}
adsCurrentDisplay[a].refreshCount=0;ads.inactivity_count=0;}}
if(resetInactivity){ads.inactivity_count=0;}
return true;}catch(e){console.log(e.message,e.stack);}},resetRefreshCounter:function(){try{ads.inactivity_count=0;adsCurrentDisplay={};}catch(e){console.log(e.message,e.stack);}},displayAutopromo:function(data){try{var clickCommandTarget='_'+data.LINKTYPE;var clickCommandUrl=data.LINK;if(clickCommandTarget=='_internal'){clickCommandTarget='_self';clickCommandUrl='javascript:'+clickCommandUrl;}
var adsHeader={format:{formatType:'image',formatSize:'770x120'},content:{urlContent:SETTING_DOMAIN_IMG+"/misc/"+data.BACKGROUND+"/0x0-000000-80-0-0.jpg"},background:{backgroundUrl:SETTING_DOMAIN_IMG+"/misc/"+data.RIGHT_COLUMN+"/0x0-000000-80-0-0.jpg",backgroundColor:"#"+data.COLOR},tracking:{clickCommand:clickCommandUrl,clickCommandTarget:clickCommandTarget,clickTagMethod:"",pixelAgence:"",alenty:"",timestamp:""},options:{repeat:"no-repeat",displayBackground:true}};displayAdsPlayer(adsHeader);return true;}catch(e){console.log(e.message,e.stack);}},changeBackgroundColor:function(banner){try{var className='bg-gray';switch(www.getCurrentPageType()){case'radio':className='ads-radio';break;case'profile':className='bg-white';break;}
banner.removeAttr('class').addClass(className);return true;}catch(e){console.log(e.message,e.stack);}}};ads.init();var adsCurrentDisplay={};var open_window_link='';var open_window_blank=true;var homepage_title_color='#000';var homepage_end_background='';var timeout_ads_video=null;function dclk_show(){if(typeof(expand_data)!='undefined'){var ads_expand=$('#ads_expand');if(ads_expand.length==1){ads.setSwf('ads_expand','ads_expand_swf',expand_data.expand.urlContentExpand,expand_data.expand.widthExpand,expand_data.expand.heightExpand,expand_data.tracking.clickTagMethod,expand_data.tracking.clickCommand,'#FFFFFF','transparent');ads_expand.parent().css('position','');var position={left:expand_data.expand.posXExpand,top:expand_data.expand.posYExpand};if(expand_data.format.formatSize=='300x250'){if(position.left===''&&position.top===''){position.top=$('#ads_300x250').offset().top;position.left=$('#ads_300x250').offset().left+300-expand_data.expand.widthExpand;}else{position.top=$('#ads_300x250').offset().top;position.left=$('#ads_300x250').offset().left-expand_data.expand.widthExpand-20;}}
ads_expand.css({'top':position.top+'px','left':position.left+'px','display':'block'});}}}
dclk_hide=dclk_hide_overlay=function(){$('#ads_expand').hide().text('');};function open_window(page){if(open_window_blank){window.open(page);}else if(page.substr(0,10)=='javascript'){eval(page.substr(11,page.length));}else{document.location=page;}}
function encodeClickCommand(str){try{split_command=str.split("%7Esscs%3D%3f",2);if(typeof(split_command[0])!='undefined'&&typeof(split_command[1])!='undefined'){split_command2=split_command[1].split("http%3A%2F",2);if(typeof(split_command2[0])!='undefined'&&typeof(split_command2[1])!='undefined'){str=split_command[0]+"%7Esscs%3D%3f"+split_command2[0]+"http%3A%2F"+split_command2[1];}else{str=split_command[0]+"%7Esscs%3D%3f"+escape(split_command[1]);}}
return str;}catch(e){console.log(e.message,e.stack);}}
function displayAdsHabillage(data){try{if(typeof(data.header.url)!='undefined'){data.header.url=encodeClickCommand(data.header.url);}
var banner_div;if(data.background.backgroundType=='image'){$('body').addClass('has-ads');$('#naboo > .page-content > .page-ads').css('background-color',data.background.color);$('#naboo > .page-content > .page-ads > img').attr('src',data.background.url);$('#ads_banner_top').addClass('ads-expand');}else if(typeof(data.background.backgroundType)!='undefined'&&data.background.backgroundType=='video'&&typeof(data.background.url)!='undefined'&&typeof(data.background.color)!='undefined'&&typeof(data.header.url)!='undefined'&&$('#ads_video').length==1){$('#ads_video').show();var so=new SWFObject(SETTING_STATIC+"/swf/deezerplayer-v"+STATIC_VERSION+".swf?feed="+data.background.url+"&stretch=fill&smooth=on&volume=0&clickTAG="+data.header.url,"ads_video_swf","100%","100%","9",data.background.color);so.addParam('wmode','opaque');so.addParam("allowScriptAccess","always");so.write('ads_video');if(typeof(data.background.urlEndImage)!='undefined'){homepage_end_background=data.background.urlEndImage+" no-repeat center 104px";}
if(typeof(data.background.videoDuration)!='undefined'&&data.background.videoDuration>0){timeout_ads_video=setTimeout(function(){disableAdsVideo();},(data.background.videoDuration*1000));}}else if(data.background.backgroundType=='massmotion'){ads.setMassMotion(data);}else if(data.background.backgroundType=='redirect'&&typeof(data.redirect.js)!='undefined'&&data.redirect.js.length>0){banner_div='naboo_banner_habillage';ads.setRedirect(banner_div,data.redirect.js,data.header.url,data.header.width,data.header.height);}
if(data.background.backgroundType!='massmotion'&&data.background.backgroundType!='redirect'){var bgColor="#FFFFFF";var wmode="transparent";if(typeof(data.header.swfBackgroundColor)!='undefined'&&data.header.swfBackgroundColor.length>0){bgColor=data.header.swfBackgroundColor;wmode="opaque";}
banner_div='naboo_banner_habillage';ads.setSwf(banner_div,banner_div+'_swf',data.header.location,data.header.width,data.header.height,data.header.method,data.header.url,bgColor,wmode);$('#'+banner_div).css('height',data.header.height).show();if(data.background.backgroundType=='video'){$('#'+banner_div).css('visibility','hidden');}}
if(typeof(data.background.centerColor)!='undefined'&&data.background.centerColor!==''){$('#homepage').css('background',data.background.centerColor);}
if(typeof(data.header.url)!='undefined'&&typeof(data.background.url)!='undefined'&&data.background.url!==''){$('#naboo > .page-content > .page-ads').attr('onclick',"window.open = '"+data.header.url+"'");}
if(typeof(data.tracking.pixelAgence)!='undefined'){ads.setPixelAgence(data.tracking.pixelAgence,'ads_pixel');}
ads.setAlenty(data);return true;}catch(e){console.log(e.message,e.stack);}}
function disableAdsHabillage(page){try{$('body').removeClass('has-ads');$('#naboo > .page-content > .page-ads > img').attr('src','');return true;}catch(e){console.log(e.message,e.stack);}}
function disableAdsVideo(){try{if(timeout_ads_video!==null){clearTimeout(timeout_ads_video);}
$('#ads_video').hide().text('');$('#banner_habillage').css('visibility','visible');if(homepage_end_background!==null&&homepage_end_background!==''){www.displayBackground(homepage_end_background);}
return true;}catch(e){console.log(e.message,e.stack);}}
function displayAdsBillboard(data){try{if(typeof(adsBillboard)=='undefined'||JSON.stringify(adsBillboard)!=JSON.stringify(data)){adsBillboard=data;clearTimeout(visio.timeoutID);visio.add($('#visio_content'),picks.data.VISIO.data);}}catch(e){console.log(e.message,e.stack);}}
function displayAdsInterstitial(data){try{var billboard_data={url:data.content.urlContent,click:data.tracking.clickCommand,clickTagMethod:data.tracking.clickTagMethod,target:'_blank',duration:data.options.duration,type:'ads_interstitial',format:data.format.formatType,formatSize:data.format.formatSize,redirect:data.redirect};displayInterstitial(billboard_data);}catch(e){console.log(e.message,e.stack);}}
var adsTimeoutId=0;var currentAudioAds="";var firstAudioAdsFinish=false;var firstAudioAdsTimer=300000;var audioAdsTimer=900000;function startAudioAdsTimer(){try{if(typeof(USER)!='undefined'&&USER.OPTIONS.ads_audio===false){return false;}
if(dzPlayer.getPlayerType()=='ads'||dzPlayer.getPlayerType()=='jingle'){return false;}
if(adsTimeoutId>0){return false;}
var currentAudioAdsTimer=0;if(ENV=="PROD"&&firstAudioAdsFinish){currentAudioAdsTimer=audioAdsTimer;}else if(ENV=="PROD"&&!firstAudioAdsFinish){currentAudioAdsTimer=firstAudioAdsTimer;firstAudioAdsFinish=true;}else{currentAudioAdsTimer=30000;}
adsTimeoutId=window.setTimeout(function(){getAudioAds();},currentAudioAdsTimer);return true;}catch(e){console.log(e.message,e.stack);}}
function stopAudioAdsTimer(){try{currentAudioAds="";if(adsTimeoutId>0){window.clearTimeout(adsTimeoutId);}
adsTimeoutId=0;return true;}catch(e){console.log(e.message,e.stack);}}
function startDisplayAudioAds(){try{if(currentAudioAds!==""){if(typeof(currentAudioAds.tracking.vastImpression)!='undefined'){for(var j=0;j<currentAudioAds.tracking.vastImpression.length;j++){var urlImpression=currentAudioAds.tracking.vastImpression[j];if(urlImpression.indexOf('sz=1x1')>-1){ads.setPixelAgence(urlImpression,'ads_pixel');}else{sendRequest(urlImpression,'text','');}}}
if((currentAudioAds.content.urlContent!==""||currentAudioAds.content.htmlContent!==""||(currentAudioAds.format.formatType=="massmotion"&&currentAudioAds.redirect.js!==""))){if(naboo.currentPageIsNaboo()||www.getCurrentPageType()=='radio'){Events.unsubscribe(Events.player.adsVastPlaying,adsVastPlayingControl);Events.subscribe(Events.player.adsVastPlaying,adsVastPlayingControl);displayAdsPlayer(currentAudioAds);}else{countAdsPlayer(currentAudioAds.tracking.pixelAgence);}}}
return true;}catch(e){console.log(e.message,e.stack);}}
function adsVastPlayingControl(evt,data){try{if(typeof(dzPlayer.getAudioAds().audio)=='undefined'){return false;}
var quartile=Math.round(dzPlayer.getAudioAds().audio.duration/4);if(Math.floor(data.position)==1&&typeof(dzPlayer.getAudioAds().tracking.trackingStart)!='undefined'){sendRequest(dzPlayer.getAudioAds().tracking.trackingStart,'text','');delete dzPlayer.getAudioAds().tracking.trackingStart;}else if(Math.floor(data.position)==quartile&&typeof(dzPlayer.getAudioAds().tracking.trackingFirstQuartile)!='undefined'){sendRequest(dzPlayer.getAudioAds().tracking.trackingFirstQuartile,'text','');delete dzPlayer.getAudioAds().tracking.trackingFirstQuartile;}else if(Math.floor(data.position)==quartile*2&&typeof(dzPlayer.getAudioAds().tracking.trackingMidpoint)!='undefined'){sendRequest(dzPlayer.getAudioAds().tracking.trackingMidpoint,'text','');delete dzPlayer.getAudioAds().tracking.trackingMidpoint;}else if(Math.floor(data.position)==quartile*3&&typeof(dzPlayer.getAudioAds().tracking.trackingThirdQuartile)!='undefined'){sendRequest(dzPlayer.getAudioAds().tracking.trackingThirdQuartile,'text','');delete dzPlayer.getAudioAds().tracking.trackingThirdQuartile;}else if(Math.floor(data.position)==dzPlayer.getAudioAds().audio.duration&&typeof(dzPlayer.getAudioAds().tracking.trackingComplete)!='undefined'){sendRequest(dzPlayer.getAudioAds().tracking.trackingComplete,'text','');delete dzPlayer.getAudioAds().tracking.trackingComplete;}}catch(e){console.log(e.message,e.stack);}}
function displayAdsVast(url,defaultSize){try{sendRequest(url,'text','',true,function(xml){var xmlDoc=$.parseXML(xml.responseText);$xml=$(xmlDoc);$linear=$xml.find('Linear');$companion=$xml.find('CompanionAds');$impressions=[];for(var i=0;i<$xml.find('Impression').length;i++){$impressions.push(str_replace($xml.find('Impression')[i].textContent,'[timestamp]',SERVER_TIMESTAMP));}
for(var i=0;i<$xml.find('CompanionAds [event="creativeView"]').length;i++){$impressions.push(str_replace($xml.find('CompanionAds [event="creativeView"]')[i].textContent,'[timestamp]',SERVER_TIMESTAMP));}
var format='';if($companion.find('StaticResource').text()!==''){format=$companion.find('StaticResource').attr('creativeType');if(format.indexOf('image')>-1){format='image';}else if(format.indexOf('massmotion')>-1){format='massmotion';}else if(format.indexOf('swf')>-1){format='swf';}}else if($companion.find('HTMLResource').text()!==''){format='html';}
var size=(typeof(defaultSize)!='undefined')?defaultSize:'728x90';if($companion.find('Companion').attr('width')!="0"&&$companion.find('Companion').attr('height')!="0"){size=$companion.find('Companion').attr('width')+"x"+$companion.find('Companion').attr('height');}
currentAudioAds={format:{formatType:format,formatSize:size},content:{urlContent:$companion.find('StaticResource').text(),htmlContent:str_replace($companion.find('HTMLResource').text(),'[timestamp]',SERVER_TIMESTAMP)},audio:{url:$linear.find('MediaFile').text(),duration:formatedTimeToSecond($linear.find('Duration').text())},textlink:{text:$xml.find('AdTitle').text()},tracking:{clickCommand:$companion.find('CompanionClickThrough').text(),vastImpression:$impressions,trackingStart:$linear.find('Tracking[event="start"]').text(),trackingFirstQuartile:$linear.find('Tracking[event="firstQuartile"]').text(),trackingMidpoint:$linear.find('Tracking[event="midpoint"]').text(),trackingThirdQuartile:$linear.find('Tracking[event="thirdQuartile"]').text(),trackingComplete:$linear.find('Tracking[event="complete"]').text()}};dzPlayer.setAudioAds(currentAudioAds);});}catch(e){console.log(e.message,e.stack);}}
function displayAudioAds(data){try{stopAudioAdsTimer();if(typeof(data.format)!='undefined'&&typeof(data.format.formatType)!='undefined'&&data.format.formatType=='redirect'){displayAdsVast(data.redirect.js,data.format.formatSize);return true;}
dzPlayer.setAudioAds(data);if(typeof(data.expand)!='undefined'&&typeof(data.expand.urlContentExpand)!='undefined'&&data.expand.urlContentExpand.length>0){expand_data=data;}
currentAudioAds=data;}catch(e){console.log(e.message,e.stack);}}
function disableAudioAds(){try{$('#ads_player_audio').hide().text('');$('#ads_banner_top').show();}catch(e){console.log(e.message,e.stack);}}
function getAudioAds(){try{sas_id=0;switch(www.getCurrentPageType()){case"home":case"collection":sas_id=115056;break;case"recommendations":sas_id=274132;break;case"tops":sas_id=274126;break;case"search":case"result":sas_id=115072;break;case"playlist":sas_id=115067;break;case"album":sas_id=115066;break;case"artist":sas_id=115069;break;case"radio":sas_id=115070;break;case"video":sas_id=115077;break;case"loved":sas_id=274137;break;default:sas_id=0;}
if(sas_id>0){var elementType=www.getCurrentPageType();var elementId=www.getCurrentPageId();var elementStyle=0;ads.callAds('15829/'+sas_id+'/7073/S/'+ord+'/element_type='+elementType+';element_id='+elementId+';element_style='+elementStyle,true);}
stopAudioAdsTimer();}catch(e){console.log(e.message,e.stack);}}
histoUrl={adsPlayer:[]};function displayAdsPlayer(data){try{if(typeof(data)=='undefined'){return false;}
if(!naboo.currentPageIsNaboo()&&www.getCurrentPageType()!='radio'){return false;}
if(typeof(data.format)!='undefined'&&typeof(data.format.formatSize)!='undefined'){formatSize=data.format.formatSize;formatSizes=formatSize.split('x');formatType=data.format.formatType;}else{return false;}
if(typeof(data.audio)!='undefined'&&typeof(data.audio.url)!='undefined'){div_ads='ads_player_audio';$('#ads_player_audio').show();$('#ads_banner_top').hide();}else{div_ads='ads_banner_top';$('#ads_player_audio').hide();}
ads.changeBackgroundColor($('#ads_banner_top'));if(typeof(data.options)!='undefined'&&typeof(data.options.refresh)!='undefined'&&typeof(data.format.formatId)!='undefined'){if(data.options.refresh===false){delete adsCurrentDisplay[data.format.formatId];}
if(typeof(data.options.refreshDuration)!='undefined'&&data.options.refreshDuration!=0){adsCurrentDisplay[data.format.formatId]={};adsCurrentDisplay[data.format.formatId].refreshDuration=data.options.refreshDuration;}}
disableAdsHabillage();if(typeof(data.background)!='undefined'&&typeof(data.background.backgroundUrl)!='undefined'&&data.background.backgroundUrl.length>0){$('body').addClass('has-ads');$('#naboo > .page-content > .page-ads > img').attr('src',data.background.backgroundUrl);$('#ads_banner_top').addClass('ads-expand');Events.trigger(Events.layout.adsBackground,artist.adjustContent);}
if(typeof(data.background)!='undefined'&&typeof(data.background.backgroundColor)!='undefined'&&data.background.backgroundColor.length>0){$('body').addClass('has-ads');$('#naboo > .page-content > .page-ads').css('background-color',data.background.backgroundColor);}
if(typeof(data.tracking.clickCommand)!='undefined'&&formatType=='swf'){data.tracking.clickCommand=encodeClickCommand(data.tracking.clickCommand);}
if(typeof(data.billboard)!='undefined'&&typeof(data.billboard.billboardUrl)!='undefined'&&data.billboard.billboardUrl.length>0){var billboard_data={url:data.billboard.billboardUrl,click:data.tracking.clickCommand,target:'_blank',duration:3,type:'ads_billboard'};displayInterstitial(billboard_data);}
if(formatType=='massmotion'){ads.setMassMotion(data);}else if(formatType=='swf'){var bgColor="#FFFFFF";if(typeof(data.content.swfBackgroundColor)!='undefined'&&data.content.swfBackgroundColor.length>0){bgColor=data.content.swfBackgroundColor;}
ads.setSwf(div_ads,div_ads+"_swf",data.content.urlContent,formatSizes[0],formatSizes[1],data.tracking.clickTagMethod,data.tracking.clickCommand,bgColor,'transparent');}else if(formatType=='image'){if(typeof(data.tracking.clickCommandTarget)=='undefined'){data.tracking.clickCommandTarget='_blank';}
ads.setImage(div_ads,data.content.urlContent,data.tracking.clickCommand,data.tracking.clickCommandTarget);}else if(formatType=='redirect'&&typeof(data.redirect.clickCommand)!='undefined'){ads.setRedirect(div_ads,data.redirect.js,data.redirect.clickCommand,formatSizes[0],formatSizes[1]);}else if(formatType=='html'&&data.content.htmlContent!=''&&currentAudioAds.format.formatSize!=null){ads.setRedirect(div_ads,escape(data.content.htmlContent),'',formatSizes[0],formatSizes[1]);}
if(typeof(data.tracking.pixelAgence)!='undefined'&&typeof(data.tracking.timestamp)!='undefined'){if(typeof(histoUrl.adsPlayer[data.tracking.pixelAgence+"|"+data.tracking.timestamp])=='undefined'){ads.setPixelAgence(data.tracking.pixelAgence,'ads_pixel');histoUrl.adsPlayer[data.tracking.pixelAgence+"|"+data.tracking.timestamp]=true;}}
if(typeof(data.background)!='undefined'&&typeof(data.tracking.clickCommand)!='undefined'&&typeof(data.background.backgroundUrl)!='undefined'&&data.background.backgroundUrl.length>0){if(typeof(data.tracking.clickCommandTarget)=='undefined'){data.tracking.clickCommandTarget='_blank';}
$('#naboo > .page-content > .page-ads').attr({'onclick':"window."+((data.tracking.clickCommandTarget=='_blank')?'open':'location')+"('"+data.tracking.clickCommand+"'); return false;"});}
if(typeof(data.expand)!='undefined'&&typeof(data.expand.urlContentExpand)!='undefined'&&data.expand.urlContentExpand.length>0){expand_data=data;if(expand_data.expand.autoExpand=='Yes'){dclk_show();expand_data=null;}}
ads.setAlenty(data);if(typeof(menu)!='undefined'&&typeof(menu.adjustUserMenu)!='undefined'){menu.adjustUserMenu();}
return true;}catch(e){console.log(e.message,e.stack);}}
function countAdsPlayer(pixelAgence){try{$('#ads_pixel').html('<img src="'+pixelAgence+'"/>');return true;}catch(e){console.log(e.message,e.stack);}}
function disableAdsPlayer(){try{$('#ads_banner_top').hide().text('');return true;}catch(e){console.log(e.message,e.stack);}}
function disableAds(){try{$('#ads_banner_top').hide().text('');$('#ads_banner_bottom').hide().text('');disableAdsHabillage();return true;}catch(e){console.log(e.message,e.stack);}}
var expand_data=null;function displayAdsClassic(data){try{formatSize=data.format.formatSize;formatSizes=formatSize.split('x');formatType=data.format.formatType;if(typeof(data.options)!='undefined'&&typeof(data.options.refresh)!='undefined'&&typeof(data.format.formatId)!='undefined'){if(data.options.refresh===false){delete adsCurrentDisplay[data.format.formatId];}
if(typeof(data.options.refreshDuration)!='undefined'&&data.options.refreshDuration!=0){adsCurrentDisplay[data.format.formatId].refreshDuration=data.options.refreshDuration;}}
if(formatSize=='300x250'||formatSize=='300x600'||formatSize=='120x600'){div_ads='ads_'+formatSize;}else if(formatSize=='728x90'){div_ads='ads_banner_bottom';ads.changeBackgroundColor($('#ads_banner_bottom'));}
if(typeof(data.tracking.clickCommand)!='undefined'&&(formatType=='swf'||formatType=='video')){data.tracking.clickCommand=encodeClickCommand(data.tracking.clickCommand);}
if(formatType=='massmotion'){ads.setMassMotion(data);}else if(formatType=='swf'){ads.setSwf(div_ads,div_ads+"_swf",data.content.urlContent,formatSizes[0],formatSizes[1],data.tracking.clickTagMethod,data.tracking.clickCommand,'#FFFFFF','opaque');}else if(formatType=='image'){if(typeof(data.tracking.clickCommandTarget)=='undefined'){data.tracking.clickCommandTarget='_blank';}
ads.setImage(div_ads,data.content.urlContent,data.tracking.clickCommand,data.tracking.clickCommandTarget);}else if(formatType=='video'){ads.setVideo(div_ads,div_ads+'_swf',data.content.urlContent,formatSizes[0],formatSizes[1],data.content.urlStartImage,data.content.urlEndImage,data.options.autoPlayDelay,data.tracking.clickCommand);}else if(formatType=='redirect'&&typeof(data.redirect.clickCommand)!='undefined'){ads.setRedirect(div_ads,data.redirect.js,data.redirect.clickCommand,formatSizes[0],formatSizes[1]);}
if(typeof(data.tracking.pixelAgence)!='undefined'){ads.setPixelAgence(data.tracking.pixelAgence,div_ads+'_pixel');}
ads.setAlenty(data);if(typeof(data.expand)!='undefined'&&typeof(data.expand.urlContentExpand)!='undefined'&&data.expand.urlContentExpand.length>0){expand_data=data;if(data.expand.autoExpand=='Yes'){dclk_show();}}}catch(e){console.log(e.message,e.stack);}}
function immersive_end_from_mmm(){try{Events.trigger(Events.player.finishAds);disableAudioAds();}catch(e){console.log(e.message,e.stack);}};
var dzoffline={ACTIVE:true,AVAILABLE:false,LOADED:false,PENDING:0,STARTED:1,FINISH:2,DELETE:3,ERROR:4,SYNC_BROKEN:5,FINISH_DELETE:6,FORBIDDEN:7,COMPATIBILITY:false,listSync:{},listSong:{},listLog:[],listInterface:{},justInstalledExtension:false,retryErrorInterval:3600*4,listSongsUpdatedElement:[],listSongsPlaylist:[],init:function(){try{if(USER.USER_ID==0){return false;}
if(Modernizr.indexeddb){if(!OFFLINE&&$('#frame_manifest').length==0){$('body').append('<iframe id="frame_manifest" style="display:none;height:1px;width:1px"></iframe>');if(dzoffline.browserCompatibility()){$('#frame_manifest').attr('src','/appcache/index.php?page=site');}}
if(OFFLINE){if(typeof(localStorage['USER_'+USER.USER_ID])=='undefined'){return false;}
USER=JSON.parse(localStorage['USER_'+USER.USER_ID]);if(!USER.OPTIONS.web_offline){return false;}}else{localStorage['USER_'+USER.USER_ID]=JSON.stringify(USER);}
dzoffline.AVAILABLE=(typeof(USER)!='undefined'&&USER.OPTIONS.web_offline==true);dzoffline.COMPATIBILITY=true;if(dzoffline.AVAILABLE){window.addEventListener("online",dzoffline.changeDisplay);window.addEventListener("offline",dzoffline.changeDisplay);if(OFFLINE){SERVER_TIMESTAMP=localTimeStamp();dzoffline.changeDisplay({type:'offline'});}}}
return true;}catch(e){console.log(e.message,e.stack);}},changeDisplay:function(event){try{OFFLINE=(event.type=='offline');console.log('OFFLINE MODE:',OFFLINE);dzoffline.changeLink($('#header_content_profil_user'),!OFFLINE);dzoffline.changeLink($('body header > .navbar > span > .logo'),!OFFLINE);dzoffline.changePlayer();$('#naboo_menu_add_playlist').toggle();$('#naboo_menu_add_folder').toggle();if(OFFLINE){livebar.destroy();loadBox('offline');downloader.stop();}else{if(actual_box=='offline'){setTimeout(function(){loadBox('');},10000);}
if(typeof(offline)!='undefined'&&typeof(offline.backupOnlineTrackList)!='undefined'){if(offline.backupOnlineTrackList.length>0&&dzPlayer.trackList.length==0){dzPlayer.playTracks(offline.backupOnlineTrackList.data,0,false);}}
if($('#frame_manifest').length==0){$('body').append('<iframe id="frame_manifest" style="display:none;height:1px;width:1px"></iframe>');}
livebar.init();livebar.initUser();downloader.start();}
if(typeof(menu)!='undefined')menu.changeDisplayMenu(OFFLINE);dzPlayer.setOffline(OFFLINE);return true;}catch(e){console.log(e.message,e.stack);}},changePlayer:function(){try{$('body header > .navbar > ul').toggle();$('#dzSearch').toggle();$("#player_action_buy").toggle();$("#player_action_add").toggle();$('#player_action_share').toggle();$('#player_action_love').toggle();$("#player_option_others").toggle();}catch(e){console.log(e.message,e.stack);}},changeLink:function($elt,active){try{if(active){var click_action=$elt.attr('data-action');if(typeof(click_action)!='undefined')$elt.attr({'data-action':'','onClick':click_action});var href=$elt.attr('href');if(typeof(href)!='undefined')$elt.attr({'data-href':'','href':href});}else{var click_action=$elt.attr('onClick');var href=$elt.attr('href');$elt.attr({'data-href':href,'data-action':click_action,'onClick':'javascript:void(0);return false;'}).removeAttr('href');}
return true;}catch(e){console.log(e.message,e.stack);}},download:function(type,id,songs,data){try{console.log('Download:',type,id,songs);if(!USER.OPTIONS.web_offline){dzoffline.notAvailableAction('premium_only');return false;}
if(!dzoffline.browserCompatibility()){dzoffline.notAvailableAction('browser_not_available');return false;}
if(!dzoffline.checkAppInstallation()){dzoffline.notAvailableAction('app_not_installed');dzoffline.callbackAppInstalled=function(){dzoffline.download(type,id,songs,data);}
return false;}else{delete dzoffline.callbackAppInstalled;}
if(dzDB.db==null){console.log('indexeddb not initialised');alert(trad.offline.openDBError);return false;}
if(jQuery.isEmptyObject(data)){console.log('Empty data for :',type);return false;}
if(songs.data.length==0){console.log('Empty songs for :',type);return false;}
if(type=='album'){dzoffline.downloadAlbum(id,songs,data);}else if(type=='playlist'){dzoffline.downloadPlaylist(id,songs,data);}else if(type=='loved'){dzoffline.downloadLoved(id,songs,data);}
tracking.track('offline_download',{type:type,id:id,user_id:USER.USER_ID});return true;}catch(e){console.log(e.message,e.stack);}},downloadAlbum:function(id,songs,data){try{console.log('download Album');var savedCallApi=dzoffline.listInterface['deezer_pageAlbum_'+id];if(savedCallApi==null||savedCallApi.error.length>0){var params={alb_id:encodeURIComponent(id),lang:encodeURIComponent(SETTING_LANG),tab:-1};api.call('deezer_pageAlbum',params,function(){});}
if(!dzoffline.isElementSync('album',id)){if(typeof(dzoffline.getListSync('album',id))!='undefined'&&dzoffline.getListSync('album',id).STATE==dzoffline.DELETE)return false;if(!userData.isFavorite('album',id)){favorite.add($('#naboo_album_favorite > a'),{type:'album',ALB_ID:id,ART_NAME:data.alb_artist,ALB_TITLE:data.alb_name,URL_REWRITING:data.alb_rewriting});}
dzoffline.sync('album',id,songs.data,{ALB_NAME:data.alb_name,ART_NAME:data.alb_artist,URL_REWRITING:data.alb_rewriting,ALB_PICTURE:data.alb_picture});}else if(dzoffline.getListSync('album',id).STATE==dzoffline.FINISH||dzoffline.getListSync('album',id).STATE==dzoffline.PENDING||dzoffline.getListSync('album',id).STATE==dzoffline.SYNC_BROKEN){dzoffline.unSync('album',id);}else{console.log('Impossible a stopper :',dzoffline.getListSync('album',id),dzoffline.getListSync('album',id).STATE);}
return true;}catch(e){console.log(e.message,e.stack);}},downloadPlaylist:function(id,songs,data){try{var savedCallApi=dzoffline.listInterface['deezer_pagePlaylist_'+id+'_0_40'];if(savedCallApi==null||savedCallApi.error.length>0){var params={playlist_id:encodeURIComponent(id),lang:SETTING_LANG,start:0,nb:40,tags:false};api.call('deezer_pagePlaylist',params,function(){});}
if(!dzoffline.isElementSync('playlist',id)){if(typeof(dzoffline.getListSync('playlist',id))!='undefined'&&dzoffline.getListSync('playlist',id).STATE==dzoffline.DELETE)return false;if(!userData.isFavorite('playlist',id)&&$('#naboo_menu_element_playlist_'+id).length==0){favorite.add($('#naboo_playlist_favorite > a'),{type:'playlist',PLAYLIST_ID:id,TITLE:data.playlist_name,PARENT_USERNAME:data.playlist_creator,PARENT_USER_ID:1});}
dzoffline.sync('playlist',id,songs.data,{CHECK_SUM:data.playlist_checksum,PLAYLIST_NAME:data.playlist_name,PLAYLIST_PICTURE:data.playlist_picture,PLAYLIST_PICTURE_TYPE:data.playlist_picture_type});}else if(dzoffline.getListSync('playlist',id).STATE==dzoffline.FINISH||dzoffline.getListSync('playlist',id).STATE==dzoffline.PENDING||dzoffline.getListSync('playlist',id).STATE==dzoffline.SYNC_BROKEN){dzoffline.unSync('playlist',id);}else{console.log('Impossible a stopper :',dzoffline.getListSync('playlist',id),dzoffline.getListSync('playlist',id).STATE);}
return true;}catch(e){console.log(e.message,e.stack);}},downloadLoved:function(id,songs,data){try{if(id==0){id=userData.data.FAVORITES_SONGS_ID;}
console.log('DOWNLOAD:',id,songs,data);var savedCallApi=dzoffline.listInterface['favorite_song.getSongs_'+id+'_0_40'];if(savedCallApi==null||savedCallApi.error.length>0){var params={playlist_id:encodeURIComponent(userData.data.FAVORITES_SONGS_ID),lang:SETTING_LANG,start:0,nb:40,tags:false};api.call('deezer_pagePlaylist',params,function(){});}
if(!dzoffline.isElementSync('loved',id)){if(typeof(dzoffline.getListSync('loved',id))!='undefined'&&dzoffline.getListSync('loved',id).STATE==dzoffline.DELETE)return false;dzoffline.sync('loved',id,songs.data,{CHECK_SUM:data.playlist_checksum,PLAYLIST_NAME:trad.offline.loved,PLAYLIST_PICTURE:data.playlist_picture,PLAYLIST_PICTURE_TYPE:data.playlist_picture_type});}else if(dzoffline.getListSync('loved',id).STATE==dzoffline.FINISH||dzoffline.getListSync('loved',id).STATE==dzoffline.PENDING||dzoffline.getListSync('loved',id).STATE==dzoffline.SYNC_BROKEN){dzoffline.unSync('loved',id);}else{console.log('Impossible a stopper :',dzoffline.getListSync('loved',id),dzoffline.getListSync('loved',id).STATE);}
return true;}catch(e){console.log(e.message,e.stack);}},sync:function(type,id,songs,data){try{if(dzoffline.AVAILABLE==false)return false;if(OFFLINE)return false;dzoffline.createListSync(type,id,dzoffline.PENDING,data);for(var i in songs){dzoffline.setElement(type,id,songs[i]);}
dzoffline.saveElement(type,id);if(!downloader.running)downloader.start();return true;}catch(e){console.log(e.message,e.stack);}},unSync:function(type,id){try{if(dzoffline.AVAILABLE==false)return false;dzoffline.updateListSync(type,id,{STATE:dzoffline.DELETE});songs=dzoffline.getElement(type,id);for(var i in songs){dzoffline.unsetElement(type,id,songs[i]);}
dzoffline.saveElement(type,id);if(OFFLINE){Events.trigger(Events.offline.elementDownloadStatus,{id:id,type:type,state:dzoffline.FINISH_DELETE});loadBox('offline');}
downloader.start();return true;}catch(e){console.log(e.message,e.stack);}},openData:function(data){try{Events.unsubscribe(Events.offline.openDBFinish,dzoffline.readData);Events.subscribe(Events.offline.openDBFinish,dzoffline.readData);dzDB.open();return true;}catch(e){console.log(e);}},readData:function(evt,params){try{var value=params.result;for(var i=0;i<value.length;i++){switch(value[i].method){case"listSync":dzoffline.listSync=JSON.parse(value[i].content);for(var element in dzoffline.listSync){var elt=dzoffline.listSync[element];dzoffline.changeElementDisplay(elt.TYPE,elt.ID,elt.STATE);}
break;case"listLog":var logOffline=JSON.parse(value[i].content);dzoffline.listLog=Array.isArray(logOffline)?logOffline:[];if(!OFFLINE)dzoffline.sendLog();break;default:var method=value[i].method.split('_');if(method.length>=2){if(method[0]=="deezer"){dzoffline.listInterface[value[i].method]=JSON.parse(value[i].content);}else if((method[0]=="playlist"||method[0]=="album"||method[0]=="loved")&&!isNaN(method[1])){dzoffline.listSong[method[0]+'_'+method[1]]=JSON.parse(value[i].content);}}
break;}}
Events.trigger(Events.offline.loaded);dzoffline.LOADED=true;menu.changeDisplayMenu(OFFLINE);if(actual_box.substr(0,7)=='offline'||actual_box.substr(0,6)=='chrome'){offline.displayElement();}
if(!OFFLINE){dzoffline.checkSumsVerif();downloader.retryErrorTrack();downloader.start();if(countObject(dzoffline.listSync)>0&&!dzoffline.checkAppInstallation()){console.log('le user a vire son appli');dzoffline.notAvailableAction('app_is_removed');}else if(countObject(dzoffline.listSync)>0){filesystem.rootFolderExist(countObject(dzoffline.listSync)>0);}
Events.subscribe(Events.user.deleteFavorite,function(evt,params){if(dzoffline.isElementSync(params.type,getElementIdByType(params))){if(dzoffline.getListSync(params.type,getElementIdByType(params)).STATE==dzoffline.FINISH){dzoffline.unSync(params.type,getElementIdByType(params));}}});Events.subscribe(Events.playlist.removed,function(evt,params){if(dzoffline.isElementSync('playlist',params.playlist_id)){if(dzoffline.getListSync('playlist',params.playlist_id).STATE==dzoffline.FINISH){dzoffline.unSync('playlist',params.playlist_id);}}});}
return true;}catch(e){console.log(e.message,e.stack);}},checkSumsVerif:function(){try{if(OFFLINE)return false;if(!userData.isLoaded)return false;var modifiedElement=[];if(typeof(userData.data.PLAYLISTS)!='undefined'&&typeof(userData.data.FAVORITES_PLAYLISTS)!='undefined'){var allPlaylists=$.merge($.merge([],userData.data.PLAYLISTS.data),userData.data.FAVORITES_PLAYLISTS.data);if(typeof(allPlaylists)=='object'){for(var j=0;j<allPlaylists.length;j++){var currentPlaylist=allPlaylists[j];if(dzoffline.isElementSync('playlist',currentPlaylist.PLAYLIST_ID)){if(dzoffline.getListSync('playlist',currentPlaylist.PLAYLIST_ID).DATA.CHECK_SUM!=currentPlaylist.CHECKSUM){modifiedElement.push({id:currentPlaylist.PLAYLIST_ID,type:'playlist'});}}}}}
if(dzoffline.isElementSync('loved',userData.data.FAVORITES_SONGS_ID)){if(userData.data.FAVORITES_SONGS.checksum!=dzoffline.getListSync('loved',userData.data.FAVORITES_SONGS_ID).DATA.CHECK_SUM){modifiedElement.push({id:userData.data.FAVORITES_SONGS_ID,type:'loved'});}}
if(modifiedElement.length>0){console.log('checkSumsVerif:diff found:',modifiedElement);dzoffline.getUpdatedElement(modifiedElement,0);}
return true;}catch(e){console.log(e.message,e.stack);}},getUpdatedElement:function(modifiedElement,start){try{if(start==0){dzoffline.listSongsUpdatedElement=[];}
if(modifiedElement.length==0){downloader.start()
return false;}
var callBackParams={id:modifiedElement[0].id,type:modifiedElement[0].type,start:start,modifiedElement:modifiedElement};var params={playlist_id:modifiedElement[0].id,lang:SETTING_LANG,start:start,nb:40,tags:false};api.call('deezer_pagePlaylist',params,dzoffline.getUpdatedElementCallback,callBackParams);return true;}catch(e){console.log(e.message,e.stack);}},getUpdatedElementCallback:function(request,callBackParams){try{if(request.error.length==0){var results=request.results.SONGS;var checksum=request.results.DATA.CHECKSUM;$.merge(dzoffline.listSongsUpdatedElement,results.data);if(results.total>dzoffline.listSongsUpdatedElement.length){dzoffline.getUpdatedElement(callBackParams.modifiedElement,callBackParams.start+40);}else{dzoffline.updateElementContent(callBackParams.id,callBackParams.type,checksum,dzoffline.listSongsUpdatedElement,callBackParams.modifiedElement);}}
return true;}catch(e){console.log(e.message,e.stack);}},updateElementContent:function(id,type,checksum,newContent,modifiedElement){try{dzoffline.listSongsUpdatedElement=[];var isAdded=false;for(var a=0;a<newContent.length;a++){var current_id=(newContent[a].SNG_ID==0)?newContent[a].UPLOAD_ID:newContent[a].SNG_ID;if(typeof(dzoffline.listSong[type+'_'+id]["song_"+current_id])=='undefined'){isAdded=true;dzoffline.setElement(type,id,newContent[a],dzoffline.PENDING);}}
var isRemoved=false;for(var s in dzoffline.listSong[type+'_'+id]){var foundTrack=false;for(var n=0;n<newContent.length;n++){var current_id=(dzoffline.listSong[type+'_'+id][s].SNG_ID==0)?dzoffline.listSong[type+'_'+id][s].UPLOAD_ID:dzoffline.listSong[type+'_'+id][s].SNG_ID;if(((newContent[n].SNG_ID==0)?newContent[n].UPLOAD_ID:newContent[n].SNG_ID)==current_id){foundTrack=true;break;}}
if(!foundTrack){isRemoved=true;dzoffline.unsetElement(type,id,{SNG_ID:current_id})}}
if(isAdded||isRemoved){dzoffline.updateListSync(type,id,{STATE:dzoffline.SYNC_BROKEN,CHECK_SUM:checksum});}else{dzoffline.updateListSync(type,id,{CHECK_SUM:checksum});}
dzoffline.getUpdatedElement(modifiedElement.slice(1),0);return true;}catch(e){console.log(e.message,e.stack);}},getListSync:function(type,id){try{return dzoffline.listSync[type+'_'+id];return true;}catch(e){console.log(e.message,e.stack);}},createListSync:function(type,id,state,data){try{if(dzoffline.listSync[type+'_'+id]==null){var obj={};if(typeof(id)!='undefined')obj.ID=id;if(typeof(type)!='undefined')obj.TYPE=type;obj.STATE=(typeof(state)!='undefined')?state:dzoffline.PENDING;obj.DATA=(typeof(data)!='undefined')?data:{};dzoffline.listSync[type+'_'+id]=obj;dzoffline.changeElementDisplay(type,id,obj.STATE);dzDB.addItem('listSync',JSON.stringify(dzoffline.listSync));}
return true;}catch(e){console.log(e.message,e.stack);}},updateListSync:function(type,id,data){try{if(dzoffline.listSync[type+'_'+id]!=null){for(var o in data){switch(o){case'STATE':dzoffline.listSync[type+'_'+id].STATE=data[o];dzoffline.changeElementDisplay(type,id,dzoffline.listSync[type+'_'+id].STATE);break;case'CHECK_SUM':dzoffline.listSync[type+'_'+id].DATA.CHECK_SUM=data[o];break;case'PLAYLIST_NAME':dzoffline.listSync[type+'_'+id].DATA.PLAYLIST_NAME=data[o];break;case'PLAYLIST_PICTURE':dzoffline.listSync[type+'_'+id].DATA.PLAYLIST_PICTURE=data[o];break;case'PLAYLIST_PICTURE_TYPE':dzoffline.listSync[type+'_'+id].DATA.PLAYLIST_PICTURE_TYPE=data[o];break;}}
dzDB.addItem('listSync',JSON.stringify(dzoffline.listSync));}}catch(e){console.log(e.message,e.stack);}},unsetListSync:function(type,id){try{delete dzoffline.listSync[type+'_'+id];dzDB.addItem('listSync',JSON.stringify(dzoffline.listSync));delete dzoffline.listSong[type+'_'+id];dzDB.addItem('listSong',JSON.stringify(dzoffline.listSong));dzoffline.changeElementDisplay(type,id,dzoffline.FINISH_DELETE);return true;}catch(e){console.log(e);}},isListSync:function(type,id){try{return(dzoffline.listSync[type+'_'+id]!=null);}catch(e){console.log(e.message,e.stack);}},isElementSync:function(type,elt_id){try{if(typeof(dzoffline.getListSync(type,elt_id))!='object')return false;if(dzoffline.getListSync(type,elt_id).STATE==dzoffline.DELETE)return false;return true;}catch(e){console.log(e.message,e.stack);}},getElement:function(type,id,sng_id){try{if(typeof(sng_id)!='undefined'){if(typeof(dzoffline.listSong[type+'_'+id])=='object'){if(typeof(dzoffline.listSong[type+'_'+id]['song_'+sng_id])=='object'){return dzoffline.listSong[type+'_'+id]['song_'+sng_id];}}}else{return dzoffline.listSong[type+'_'+id];}
return false;}catch(e){console.log(e.message,e.stack);}},songExist:function(sng_id,except){try{if(typeof(except)=='undefined')except={type:'',id:0};for(var e in dzoffline.listSong){if(e!=except.type+'_'+except.id){if(typeof(dzoffline.listSong[e])!='undefined'){if(typeof(dzoffline.listSong[e]['song_'+sng_id])!='undefined'){if(dzoffline.listSong[e]['song_'+sng_id].STATE==dzoffline.FINISH)return{STATUS:true,CHUNK:dzoffline.listSong[e]['song_'+sng_id].CHUNK,MD5_ORIGIN:dzoffline.listSong[e]['song_'+sng_id].MD5_ORIGIN};}}}}
return{STATUS:false};}catch(e){console.log(e.message,e.stack);}},readSongError:function(song_data){try{for(var e in dzoffline.listSong){if(typeof(dzoffline.listSong[e]['song_'+song_data.SNG_ID])!='undefined'){var info=e.split('_');if(info.length==2){Events.trigger(Events.offline.trackDownloadStatus,{type:'error',currentTrack:{SNG_ID:song_data.SNG_ID,PARENT_TYPE:info[0],PARENT_ID:info[1]}});dzoffline.setElement(info[0],info[1],song_data,dzoffline.ERROR,true);}}}}catch(e){console.log(e.message,e.stack);}},setElement:function(type,id,sng_data,state,save){try{if(typeof(state)=='undefined')state=dzoffline.PENDING;if(typeof(save)=='undefined')save=false;if(isNaN(id)){return false;}
if(typeof(sng_data.RIGHTS)!='undefined'){var rgt=right.checkSongAvailable(sng_data);if((rgt==right.LOCALITY||rgt==right.MP3_FRIEND)&&state==dzoffline.PENDING){state=dzoffline.FORBIDDEN;}}
var sng_id=(sng_data.SNG_ID>0)?sng_data.SNG_ID:sng_data.UPLOAD_ID;var sng_type=(sng_data.SNG_ID>0)?0:1;if(dzoffline.listSong[type+'_'+id]==null)dzoffline.listSong[type+'_'+id]={};var options={SNG_ID:sng_id,TYPE:sng_type,STATE:state};if(state==dzoffline.ERROR){options.ERROR_DATE=SERVER_TIMESTAMP;}
dzoffline.listSong[type+'_'+id]['song_'+sng_id]=$.extend(dzoffline.listSong[type+'_'+id]['song_'+sng_id],options);if(save)dzoffline.saveElement(type,id);return true;}catch(e){console.log(e.message,e.stack);}},setElementDetail:function(type,id,sng_id,params){try{if(typeof(params)=='undefined')return false;dzoffline.listSong[type+'_'+id]['song_'+sng_id]=$.extend(dzoffline.listSong[type+'_'+id]['song_'+sng_id],params);return true;}catch(e){console.log(e.message,e.stack);}},unsetElement:function(type,id,sng_data,save){try{if(typeof(save)=='undefined')save=false;var sng_id=(sng_data.SNG_ID>0)?sng_data.SNG_ID:sng_data.UPLOAD_ID;dzoffline.listSong[type+'_'+id]['song_'+sng_id].STATE=dzoffline.DELETE;if(save)dzoffline.saveElement(type,id);return true;}catch(e){console.log(e.message,e.stack);}},deleteElement:function(type,id,sng_id,save){try{if(typeof(save)=='undefined')save=false;delete dzoffline.listSong[type+'_'+id]['song_'+sng_id];if(save)dzoffline.saveElement(type,id);return true;}catch(e){console.log(e.message,e.stack);}},saveElement:function(type,id){try{dzDB.addItem(type+'_'+id,JSON.stringify(dzoffline.listSong[type+'_'+id]));}catch(e){console.log(e.message,e.stack);}},changeElementDisplay:function(type,id,state){try{Events.trigger(Events.offline.elementDownloadStatus,{type:type,id:id,state:state});}catch(e){console.log(e.message,e.stack);}},isSongSyncFinish:function(type,elt_id,sng_id){try{if(dzoffline.isListSync(type,elt_id))return(dzoffline.getElement(type,elt_id,sng_id).STATE==dzoffline.FINISH);else return false;}catch(e){console.log(e.message,e.stack);}},isSongSyncError:function(type,elt_id,sng_id){try{if(dzoffline.isListSync(type,elt_id))return(dzoffline.getElement(type,elt_id,sng_id).STATE==dzoffline.ERROR);else return false;}catch(e){console.log(e.message,e.stack);}},saveLog:function(log){try{if(OFFLINE){dzoffline.listLog.push(log);dzDB.addItem('listLog',JSON.stringify(dzoffline.listLog));}}catch(e){console.log(e.message,e.stack);}},sendLog:function(){try{if(dzoffline.listLog.length>0){api.call("log_batch_listen",{array:dzoffline.listLog},dzoffline.sendLogCallBack);}}catch(e){console.log(e.message,e.stack);}},sendLogCallBack:function(request){try{if(request.results){dzoffline.listLog=[];dzDB.addItem('listLog',JSON.stringify(dzoffline.listLog));}}catch(e){console.log(e.message,e.stack);}},elementChanged:function(type,id){try{if(dzoffline.AVAILABLE&&!OFFLINE&&dzoffline.isListSync(type,id)){dzoffline.updateListSync(type,id,{STATE:dzoffline.SYNC_BROKEN,CHECK_SUM:'changed'});dzoffline.getUpdatedElement([{id:id,type:type}],0);}}catch(e){console.log(e.message,e.stack);}},reset:function(){try{if(confirm(trad.offline.confirmReset)){showLoading();dzDB.deleteAllItems();for(var d in dzoffline.listSync){Events.trigger(Events.offline.elementDownloadStatus,{id:dzoffline.listSync[d].ID,type:dzoffline.listSync[d].TYPE,state:dzoffline.FINISH_DELETE});}
filesystem.deleteAllFiles();}}catch(e){console.log(e.message,e.stack);}},forceOffline:function(){try{if(confirm(trad.offline.confirmForceOffline)){dzoffline.changeDisplay({type:'offline'});}}catch(e){console.log(e.message,e.stack);}},browserCompatibility:function(){try{switch(BrowserDetect.browser){case"Chrome":if(BrowserDetect.version>=15){return true;}else{return false;}
return true;break;case"Firefox":return false;break;default:return false;}
return false;}catch(e){console.log(e.message,e.stack);}},checkAppInstallation:function(){try{if(!dzoffline.browserCompatibility())return false;switch(BrowserDetect.browser){case"Chrome":return(window.chrome.app.isInstalled)||(ENV=='DEV'&&window.chrome.app.getDetails())||dzoffline.justInstalledExtension;break;case"Firefox":return false;break;default:return false;}
return false;}catch(e){console.log(e.message,e.stack);}},notAvailableAction:function(type){try{if(type=='premium_only'){modal.open('offline_status.php?e=option_not_available');}else if(type=='browser_not_available'){modal.open('offline_status.php?e=browser_not_available');}else if(type=='app_not_installed'){modal.open('offline_status.php?e=app_not_installed&b='+BrowserDetect.browser);}else if(type=='app_is_removed'){modal.open('offline_status.php?e=app_is_removed');}
tracking.track('offline_'+type,{user_id:USER.USER_ID,bowser:BrowserDetect.browser});}catch(e){console.log(e.message,e.stack);}}};
var facebook={logged:false,graph_action_id:0,graph_action_timestamp:0,graph_action_expiration:0,initBridge:false,timeoutId:0,stockTrackFromFB:false,isLinking:false,isPublishActions:false,notifyDisplayDelay:2000,notifyDisplayDelayId:0,whitelist_opengraph:{716256086:true,100002976912490:true,630501226:true},contextDeezerToFacebook:{track_page:'',album_page:'album',playlist_page:'playlist',downloads_page:'',personalsong_page:'',folder_page:'',radio_page:'radio_station',smartradio_page:'radio_station',search_page:'musician',collection_track:'',collection_playlist:'playlist',collection_album:'album',collection_radio:'radio_station',artist_top:'musician',artist_discography:'album',artist_radio:'radio_station',album_discography:'album',tops_album:'album',tops_track:'',recommendations_playlist:'playlist',recommendations_release:'album',recommendations_album:'album',recommendations_friend_top:'',recommendations_friend_share_track:'',recommendations_friend_share_album:'album',recommendations_friend_share_playlist:'playlist',ticker_track:'',ticker_playlist:'playlist',ticker_album:'album',profile_top:'',profile_album:'album',profile_playlist:'playlist',selection_billboard:'album',selection_album:'album',selection_playlist:'playlist',selection_top:'',selection_radio:'radio_station',player_default_playlist:'playlist',contextmenu_playlist:'playlist',contextmenu_album:'album',facebook_track:'',facebook_artist:'artist'},init:function(){Events.subscribe(Events.player.shareListen,function(evt,params){facebook.graphAction('shareListen',params.value);});Events.subscribe(Events.player.resume,function(evt,params){if(typeof(params)=='object'){facebook.graphAction('resume',params.value);}});Events.subscribe(Events.player.paused,function(evt,params){if(typeof(params)=='object'){facebook.graphAction('pause',params.value);}});Events.subscribe(Events.player.error,function(evt,params){facebook.graphAction('error',params.value);});Events.subscribe(Events.playlist.addSong,function(evt,params){setTimeout(function(){facebook.graphAction('addSongPlaylist',params.playlist_id);},15000);});Events.subscribe(Events.playlist.created,function(evt,params){setTimeout(function(){facebook.graphAction('createPlaylist',params);},15000);});Events.subscribe(Events.playlist.removed,function(evt,params){facebook.graphAction('deletePlaylist',{id:params.playlist_id});});Events.subscribe(Events.user.addFavorite,function(evt,params){facebook.graphAction('like',params);});Events.ready(Events.user.loaded,function(evt,params){if(USER.FB_USER_ID>0){facebook.checkValidPublishActions(USER.FB_USER_ID);}
setTimeout(function(){facebook.updateProfil();},2000);setTimeout(function(){facebook.syncFriends();},8000);setTimeout(function(){facebook.syncLikes();},14000);});if(USER.FB_USER_ID>0){facebook.checkValidPublishActions(USER.FB_USER_ID);}
return true;},isLinked:function(){console.log("method deprecated, please contact dm");return false;},login:function(scope,redirect){if(typeof(FB)=='undefined'){return false;}
var permissions;if(typeof(scope)=='undefined'||scope===''){permissions='email, user_birthday, user_likes, publish_actions, offline_access';}else{permissions=scope;}
FB.login(function(response){if(response.authResponse){facebook.logged=true;FB_ACCESS_TOKEN=response.authResponse.accessToken;facebook.connect(response.authResponse.userID,FB_ACCESS_TOKEN,redirect);}else{console.log('User cancelled login or did not fully authorize.');}},{scope:permissions});},connect:function(uid,token,redirect){try{if(typeof(token)=='undefined'){token='';}
facebook.checkValidPublishActions(uid);is_linked=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=facebook_islinked&uid='+uid+'&token='+token);is_linked=JSON.parse(is_linked);if(is_linked=='no_cookie'){return false;}
if(typeof(is_linked.USER_ID)!='undefined'&&typeof(is_linked.FB_USER_ID)!='undefined'){if(USER.USER_ID==0){USER.FB_USER_ID=is_linked.FB_USER_ID;facebook.initMusicBridge();facebook.checkValidityToken();return facebook.pageLogin(redirect);}else if(USER.USER_ID==is_linked.USER_ID){LOG_TYPE='facebook';USER.FB_USER_ID=is_linked.FB_USER_ID;facebook.initMusicBridge();facebook.checkValidityToken();window.redirect(redirect_fb);return true;}else if(USER.USER_ID!=is_linked.USER_ID){document.location.href=document.location.protocol+'//'+SETTING_HOST+'/logout.php';return true;}}else if(is_linked===false){if(USER.USER_ID>0&&USER.FB_USER_ID>0){document.location.href=document.location.protocol+'//'+SETTING_HOST+'/logout.php';}
facebook.isLinking=true;var url='facebook.php?token='+token;if(typeof(redirect)!='undefined'&&typeof(redirect.type)!='undefined'&&typeof(redirect.link)!='undefined'){url+='&redirect_type='+encodeURIComponent(redirect.type);url+='&redirect_link='+encodeURIComponent(redirect.link);}
modal.open(url,true);facebook.initMusicBridge();return true;}
return false;}catch(e){console.log(e.message,e.stack);}},unlinkAccount:function(user_id,fb_user_id){try{if(typeof(user_id)=='undefined'||user_id<=0){return false;}
if(typeof(fb_user_id)=='undefined'||fb_user_id<=0){return false;}
if(confirm(sprintf(trad.setting.unlinkAccount_text1,'Facebook'))){FB.api("me/permissions",'delete',function(){request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=facebook_unlink&user_id='+user_id+'&fb_user_id='+fb_user_id);if(request===false||request=='error'){$('#fb_unlink_status').html(trad.facebook.unlinkFacebookAccount_text2).show();return true;}
LOG_TYPE='internal';USER.FB_USER_ID=0;USER.FACEBOOK.TOKEN='';if(www.getCurrentPageType()=='account'){$('#page_account_share_facebook').removeClass('active');$('#page_account_share_facebook_title > div > span').removeClass('active');$('#page_account_share_facebook_title > div > a').css('display','none');}});}
return true;}catch(e){console.log(e);}},updateProfil:function(){try{if(LOG_TYPE!='facebook'){return false;}
if(USER.FB_USER_ID==0){return false;}
if(USER.USER_ID==0){return false;}
var d=new Date();d=d.getTime();var cookie_name='fb_update_profil_'+USER.FB_USER_ID;var last_sync=getCookie(cookie_name);if(last_sync===''||(d-last_sync)>12600000){api.call('facebookapi.updateProfil',{},function(){});setCookie(cookie_name,d);}
return true;}catch(e){console.log(e);}},syncLikes:function(){try{if(LOG_TYPE!='facebook'){return false;}
if(USER.FB_USER_ID==0){return false;}
if(USER.USER_ID==0){return false;}
var d=new Date();d=d.getTime();var cookie_name='fb_likes_sync_'+USER.FB_USER_ID;var last_sync=getCookie(cookie_name);if(last_sync===''||(d-last_sync)>25200000){api.call('facebookapi.syncLikes',{},function(){});setCookie(cookie_name,d);}
return true;}catch(e){console.log(e);}},syncFriends:function(){try{if(LOG_TYPE!='facebook'){return false;}
if(USER.FB_USER_ID==0){return false;}
if(USER.USER_ID==0){return false;}
var d=new Date();d=d.getTime();var cookie_name='fb_friends_sync_'+USER.FB_USER_ID;var last_sync=getCookie(cookie_name);if(last_sync===''||(d-last_sync)>25200000){api.call('facebookapi.syncFriends',{},function(request){if(typeof(request.results.new_matched)!='undefined'&&request.results.new_matched>0){userData.load();}});setCookie(cookie_name,d);}
return true;}catch(e){console.log(e);}},pageLogin:function(redirect){try{request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=facebook_login');if(request!='error'){request=JSON.parse(request);USER.FB_USER_ID=request.FB_USER_ID;LOG_TYPE='facebook';user.userLogin();$('#banner_habillage').text('');Events.ready(Events.user.loaded,function(){user.refreshPageAfterLogin(redirect);});return true;}else{USER.FB_USER_ID=0;return false;}}catch(e){console.log(e);}},graphAction:function(action,data){try{if(gatekeeper.isAllowed('facebook_og_action')){return false;}
if(USER.FB_USER_ID==0){return false;}
if(LOG_TYPE=='internal'&&(typeof(USER.FACEBOOK.TOKEN)=='undefined'||USER.FACEBOOK.TOKEN==='')){return false;}
if(OFFLINE){return false;}
if(ENV=='DEV'){facebook.app_namespace='deezerdev';}else{facebook.app_namespace='deezer-app';}
var fb_url;var context;switch(action){case"shareListen":if((typeof(data.TYPE)!=='undefined'&&data.TYPE==1)||!facebook.listenEnable()){return false;}
var now=Math.floor(new Date().getTime()/1000);if(now<facebook.graph_action_expiration){facebook.graphAction("stop",{position:(now-facebook.graph_action_timestamp)});}
var fb_play_url="/me/music.listens?song="+encodeURIComponent('http://www.deezer.com/track/'+data.SNG_ID);context=facebook.songContext();if(context!==''){fb_play_url+='&'+context.type+"="+context.url;}
if(LOG_TYPE=='internal'&&USER.FACEBOOK.TOKEN!==''){fb_play_url+='&access_token='+USER.FACEBOOK.TOKEN;}
fb_play_url+='&expires_in='+data.DURATION;FB.api(fb_play_url,'post',function(response){if(!response||response.error){facebook.fbApiError(response.error);}else{console.log('Listen ID: ',response);facebook.graph_action_id=response.id;facebook.graph_action_timestamp=now;facebook.graph_action_expiration=facebook.graph_action_timestamp+parseInt(data.DURATION,10);}});var sendStatus={playing:true,song:decodeURIComponent('http://www.deezer.com/track/'+data.SNG_ID),created_time:timestampToIso8601(now),expires_in:data.DURATION,user_id:USER.FB_USER_ID};if(context!==''){sendStatus[context.type]=decodeURIComponent(context.url);}
FB.Music.send('STATUS',sendStatus);console.log('PLAY:',fb_play_url,sendStatus);break;case"stop":if(typeof(data.SNG_ID)=='undefined'||data.SNG_ID===0){return false;}
if(!facebook.listenEnable()){return false;}
fb_url=facebook.graph_action_id+'?';if(LOG_TYPE=='internal'&&USER.FACEBOOK.TOKEN!==''){fb_url+='access_token='+USER.FACEBOOK.TOKEN;}
break;case"pause":if(typeof(data.SNG_ID)=='undefined'||data.SNG_ID===0){return false;}
var pauseStatus={playing:false,song:decodeURIComponent('http://www.deezer.com/track/'+data.SNG_ID),user_id:USER.FB_USER_ID};context=facebook.songContext();if(context!==''){pauseStatus[context.type]=decodeURIComponent(context.url);}
console.log('pauseStatus:',pauseStatus);FB.Music.send('STATUS',pauseStatus);break;case"resume":if(typeof(data.SNG_ID)=='undefined'||data.SNG_ID===0){return false;}
var resumeStatus={playing:true,song:decodeURIComponent('http://www.deezer.com/track/'+data.SNG_ID),created_time:timestampToIso8601(),expires_in:parseInt(data.DURATION,10)-parseInt(dzPlayer.getPosition(),10),user_id:USER.FB_USER_ID};context=facebook.songContext();if(context!==''){resumeStatus[context.type]=decodeURIComponent(context.url);}
console.log('resumeStatus:',resumeStatus);FB.Music.send('STATUS',resumeStatus);break;case"createPlaylist":var fb_create_url="/me/music.playlists?playlist="+encodeURIComponent('http://www.deezer.com/playlist/'+data.id);if(LOG_TYPE=='internal'&&USER.FACEBOOK.TOKEN!==''){fb_create_url+='&access_token='+USER.FACEBOOK.TOKEN;}
FB.api(fb_create_url,'post',function(response){if(!response||response.error){facebook.fbApiError(response.error);}else{console.log('CreatePlaylist ID: '+response.id);}});console.log('fb_create_url:',fb_create_url);break;case"deletePlaylist":fb_url='/me/music.playlists';if(LOG_TYPE=='internal'&&USER.FACEBOOK.TOKEN!==''){fb_url+='?access_token='+USER.FACEBOOK.TOKEN;}
FB.api(fb_url,'get',function(response){if(!response||response.error){facebook.fbApiError(response.error);}else{facebook.graphAction("deletePlaylistCallback",{fb_playlist:response,deleted_playlist:data.id});}});break;case"deletePlaylistCallback":var fb_playlist_id='';if(typeof(data.fb_playlist.data)!='undefined'){for(var j=0;j<data.fb_playlist.data.length;j++){if(data.fb_playlist.data[j].data.playlist.url=='http://www.deezer.com/playlist/'+data.deleted_playlist){fb_playlist_id=data.fb_playlist.data[j].id.toString();}}}
if(fb_playlist_id!==''){fb_url=fb_playlist_id;if(LOG_TYPE=='internal'&&USER.FACEBOOK.TOKEN!==''){fb_url+='?access_token='+USER.FACEBOOK.TOKEN;}
FB.api(fb_url,'delete',function(response){if(!response||response.error){facebook.fbApiError(response.error);}else{console.log("deletedPlaylist:",response);}});console.log('delete_playlist:',fb_url);}
break;case"addSongPlaylist":fb_url='https://graph.facebook.com?id='+encodeURIComponent('http://www.deezer.com/playlist/'+data.id)+'&scrape=true';if(LOG_TYPE=='internal'&&USER.FACEBOOK.TOKEN!==''){fb_url+='&access_token='+USER.FACEBOOK.TOKEN;}
sendRequest(fb_url);console.log('playlist scrape');break;case"error":var fbError={};fbError.song='http://www.deezer.com/track/'+data.songId;fbError.playing=false;fbError.error_code=0;if(typeof(data.dzErrorCode)!='undefined'){if(data.dzErrorCode==right.NOT_ENCODED){fbError.error_code=4;}else if(data.dzErrorCode==right.MP3_FRIEND){fbError.error_code=103;}else if(data.dzErrorCode==right.LOCALITY){fbError.error_code=103;}else if(data.dzErrorCode==right.PREMIUM_ONLY||data.dzErrorCode==NOT_RELEASE_FREE){fbError.error_code=102;}}else if(typeof(data.fbErrorCode)!='undefined'){fbError.error_code=data.fbErrorCode;}
if(fbError.error_code==1||fbError.error_code==2||fbError.error_code==102){fbError.redirect_url='http://www.deezer.com/premium';}
if(fbError.error_code>0){FB.Music.send('STATUS',fbError);console.log("send_FB_STATUS:",fbError);}
break;case"share":if(!facebook.shareEnable()){return false;}
fb_url="/me/"+facebook.app_namespace+":share?expires_in=1&";switch(data.type){case 0:fb_url+="song=";break;case 1:fb_url+="album=";break;case 2:fb_url+="profile=";break;case 3:fb_url+="playlist=";break;case 4:case 6:fb_url+="radio_station=";break;default:return;}
fb_url+=data.url+'&message='+encodeURIComponent(data.comment)+'&fb:explicitly_shared=true';if(LOG_TYPE=='internal'&&USER.FACEBOOK.TOKEN!==''){fb_url+='&access_token='+USER.FACEBOOK.TOKEN;}
FB.api(fb_url,'post',function(response){if(!response||response.error){facebook.fbApiError(response.error);}
if(typeof(data.callback)=='function'){data.callback(true);}});console.log('SHARE:',fb_url);break;case"comment":if(!facebook.commentEnable()){return false;}
fb_url="/me/"+facebook.app_namespace+":comment?expires_in=1&";switch(data.type){case 1:fb_url+="profile=";break;case 2:fb_url+="album=";break;case 3:fb_url+="profile=";break;case 4:fb_url+="playlist=";break;case 5:fb_url+="radio_station=";break;case 6:fb_url+="video=";break;default:return;}
fb_url+=data.url+'&message='+encodeURIComponent(data.comment);if(LOG_TYPE=='internal'&&USER.FACEBOOK.TOKEN!==''){fb_url+='&access_token='+USER.FACEBOOK.TOKEN;}
FB.api(fb_url,'post',function(response){if(!response||response.error){facebook.fbApiError(response.error);}
if(typeof(data.callback)=='function'){data.callback(true);}});console.log('COMMENT:',fb_url);break;case"like":if(!facebook.favorisEnable()){return false;}
fb_url="/me/deezer-app:like?";switch(data.type){case'artist':fb_url+='profile=http://www.deezer.com/artist/'+data.ART_ID;break;case'album':fb_url+='album=http://www.deezer.com/album/'+data.ALB_ID;break;case'playlist':fb_url+='playlist=http://www.deezer.com/playlist/'+data.PLAYLIST_ID;break;case'radio':fb_url+='radio_station=http://www.deezer.com/radio/radio-'+data.RADIO_ID;break;default:return;}
if(LOG_TYPE=='internal'&&USER.FACEBOOK.TOKEN!==''){fb_url+='&access_token='+USER.FACEBOOK.TOKEN;}
FB.api(fb_url,'post',function(response){if(!response||response.error){facebook.fbApiError(response.error);}
if(typeof(data.callback)=='function'){data.callback(true);}});console.log('LIKE:',fb_url);break;case"video":break;}
return true;}catch(e){console.log(e.message,e.stack);}},fbApiError:function(error){try{if(typeof(error.type)!='undefined'&&error.type=="OAuthException"){if(error.message=="(#200) Requires extended permission: publish_actions"){console.log("Error : OAuthException (#200)");setCookie("facebookPermissions_"+USER.FB_USER_ID,"",30);facebook.isPublishActions=false;}else{console.log('Error occured:',error);}}else{console.log('Error occured:',error);}}catch(e){console.log(e);}},songContext:function(){try{if(typeof(dzPlayer.context.TYPE)!='undefined'){var currentContext=dzPlayer.context.TYPE;if(typeof(facebook.contextDeezerToFacebook[currentContext])!='undefined'&&facebook.contextDeezerToFacebook[currentContext]!==''){var fb_context=facebook.contextDeezerToFacebook[currentContext];var fb_context_url='http://www.deezer.com/';switch(fb_context){case'playlist':fb_context_url+='playlist/'+dzPlayer.context.ID;break;case'album':fb_context_url+='album/'+dzPlayer.context.ID;break;case'musician':var artist_id=dzPlayer.context.ID;if(isNaN(artist_id)){artist_id=dzPlayer.getCurrentSongInfo().ART_ID;}
fb_context_url+='artist/'+artist_id;break;case'radio_station':fb_context_url+='radio/'+dzPlayer.context.RADIO_TYPE+'-'+dzPlayer.context.RADIO_ID;break;}
return{type:fb_context,url:encodeURIComponent(fb_context_url)};}}
return'';}catch(e){console.log(e);}},checkValidPublishActions:function(fbUserId){try{if(facebook.isPublishActions){return true;}
var cookiePermissions=getCookie("facebookPermissions_"+USER.FB_USER_ID);if(typeof(cookiePermissions)!='undefined'&&cookiePermissions!==""){var cookiePermissionsData=JSON.parse(cookiePermissions);if(cookiePermissionsData.facebook_user_id==fbUserId&&cookiePermissionsData.publish_actions){facebook.isPublishActions=true;return false;}}
var fb_url='/me/permissions';if(LOG_TYPE=='internal'&&USER.FACEBOOK.TOKEN!='undefined'&&USER.FACEBOOK.TOKEN!==''){fb_url+='?access_token='+USER.FACEBOOK.TOKEN;}
FB.api(fb_url,function(e){if(typeof(e.data)!='undefined'&&e.data.length>0){console.log("FB permissions:",e);if(typeof(e.data[0].publish_actions)!='undefined'&&e.data[0].publish_actions==1){facebook.isPublishActions=true;clearTimeout(facebook.notifyDisplayDelayId);notificationBar.hide();}
setCookie("facebookPermissions_"+USER.FB_USER_ID,JSON.stringify({facebook_user_id:fbUserId,publish_actions:facebook.isPublishActions}),30);}});return true;}catch(e){console.log(e);}},initMusicBridge:function(){try{if(facebook.initBridge===true||OFFLINE){return false;}
console.log('initMusicBridge');facebook.initBridge=true;FB.Event.subscribe('fb.music.PLAY',function(params){console.log('Event: fb.music.PLAY',params);facebook.playerCallback("PLAY",params);});FB.Event.subscribe('fb.music.RESUME',function(params){console.log('Event: fb.music.RESUME',params);facebook.playerCallback("RESUME",params);});FB.Event.subscribe('fb.music.PAUSE',function(params){console.log('Event: fb.music.PAUSE',params);facebook.playerCallback("PAUSE",params);});FB.Event.subscribe('fb.music.BRIDGE_READY',function(){console.log('Event: fb.music.BRIDGE_READY');});FB.Event.subscribe('fb.music.ALREADY_CONNECTED',function(){console.log('Event: fb.music.ALREADY_CONNECTED');});FB.Event.subscribe('fb.music.STATUS',function(params){console.log('Event: fb.music.STATUS',params);facebook.sendStatus(params);});FB.Event.subscribe('fb.music.USER_MISMATCH',function(params){console.log('Event: fb.music.USER_MISMATCH:',params);facebook.closeMusicBridge();$('#fbMusicBridge').remove();});return true;}catch(e){console.log(e);}},sendStatus:function(params){if(USER.FB_USER_ID==0||USER.FB_USER_ID===''){return false;}
var statusObject={playing:dzPlayer.playing,user_id:USER.FB_USER_ID};if(typeof(dzPlayer.getCurrentSongInfo())!='undefined'){statusObject.song='http://www.deezer.com/track/'+dzPlayer.getCurrentSongInfo().SNG_ID;}
var context=facebook.songContext();if(context!==''){statusObject[context.type]=decodeURIComponent(context.url);}
console.log('Event: fb.music.STATUS',params,' - SEND:',statusObject);FB.Music.send('STATUS',statusObject);},closeMusicBridge:function(){try{if(USER.FB_USER_ID==0){return false;}
if(typeof(FB)=='undefined'){return false;}
if(OFFLINE){return false;}
FB.Music.send('STATUS',{offline:true,user_id:USER.FB_USER_ID});return true;}catch(e){console.log(e);}},playerCallback:function(command,params){try{switch(command){case'PLAY':if(facebook.isLinking&&USER.OPTIONS.web_streaming===false){facebook.stockTrackFromFB=params;return false;}
if(typeof(params.context)!='undefined'){if(typeof(params.context.profile_id)!='undefined'){}}
if(typeof(params.song_list)!='undefined'){var sng_url=params.song_list;var offset=(typeof(params.offset)!='undefined')?params.offset:0;var sng_id_list=[];var sng_index=0;for(var s=0;s<sng_url.length;s++){sng_id_list.push(sng_url[s].substr(sng_url[s].lastIndexOf('/')+1,sng_url[s].length));if(sng_url[s]==params.song){sng_index=s;}}
if(sng_id_list.length>0){dzPlayer.playTracksFromFacebook(sng_id_list,sng_index,true,offset);}}else if(typeof(params.song)!='undefined'){var sng_id=params.song.substr(params.song.lastIndexOf('/')+1,params.song.length);var paramMoreFacebook={};paramMoreFacebook.song_id=sng_id;if(typeof(params.playlist)!='undefined'){paramMoreFacebook.context_type='playlist';paramMoreFacebook.context_id=params.playlist.substr(params.playlist.lastIndexOf('/')+1,params.playlist.length);}else if(typeof(params.album)!='undefined'){paramMoreFacebook.context_type='album';paramMoreFacebook.context_id=params.album.substr(params.album.lastIndexOf('/')+1,params.album.length);}else if(typeof(params.musician)!='undefined'){paramMoreFacebook.context_type='artist';paramMoreFacebook.context_id=params.musician.substr(params.musician.lastIndexOf('/')+1,params.musician.length);}else{paramMoreFacebook.context_type='';paramMoreFacebook.context_id='';}
api.call('deezer_moreFacebook',paramMoreFacebook,function(request){if(request.error.length===0){if(typeof(request.results.SONGS)!='undefined'&&request.results.SONGS.length>0){dzPlayer.playTracks(request.results.SONGS,0,true,{TYPE:'facebook_track',ID:paramMoreFacebook.song_id});}
if(paramMoreFacebook.context_type===''){if(typeof(request.results.CONTEXT_ID)!='undefined'&&request.results.CONTEXT_ID!==''){loadBox('artist/'+request.results.CONTEXT_ID,{forceFaceboxClose:false});}}}});}
if(USER.OPTIONS.web_streaming===false){var paramsError={};paramsError.songId=sng_id_list[0];paramsError.fbErrorCode=1;facebook.graphAction('error',paramsError);}
if(dzPlayer.getPlayerType()!='ads'){var context=facebook.songContext();if(typeof(params.playlist)!='undefined'){if(context.type=="playlist"&&decodeURIComponent(context.url)==params.playlist){playercontrol.doAction('play');}else{redirect(params.playlist,{forceFaceboxClose:false});if(typeof(params.song_list)=='undefined'&&typeof(params.song)=='undefined'){var playlist_id=params.playlist.substr(params.playlist.lastIndexOf("/")+1,params.playlist.length);console.log("play playlist:",playlist_id);dzPlayer.playPlaylist(playlist_id);}}}else if(typeof(params.album)!='undefined'){if(context.type=="album"&&decodeURIComponent(context.url)==params.album){playercontrol.doAction('play');}else{redirect(params.album,{forceFaceboxClose:false});if(typeof(params.song_list)=='undefined'&&typeof(params.song)=='undefined'){var alb_id=0;if(params.album.indexOf("/album/")!=-1){alb_id=params.album.substr(params.album.lastIndexOf("/")+1,params.album.length);}else{alb_id=params.album.substr(params.album.lastIndexOf("-")+1,params.album.length);}
console.log("play album:",alb_id);if(parseInt(alb_id,10)>0){dzPlayer.playAlbum(alb_id);}}}}else if(typeof(params.musician)!='undefined'){if(context.type=="musician"&&decodeURIComponent(context.url)==params.musician){playercontrol.doAction('play');}else{redirect(params.musician,{forceFaceboxClose:false});if(typeof(params.song_list)=='undefined'&&typeof(params.song)=='undefined'){var art_id=params.musician.substr(params.musician.lastIndexOf("/")+1,params.musician.length);api.call('deezer_moreFacebook',{context_type:'artist',context_id:art_id,song_id:0},function(request){if(request.error.length===0){if(typeof(request.results.SONGS)!='undefined'&&request.results.SONGS.length>0){dzPlayer.playTracks(request.results.SONGS,0,true,{TYPE:'facebook_artist',ID:art_id});}}});}}}else if(typeof(params.radio_station)!='undefined'){if(context.type=="radio_station"&&decodeURIComponent(context.url)==params.radio_station){playercontrol.doAction('play');}else{redirect(params.radio_station,{forceFaceboxClose:false});}}}
break;case'RESUME':if(!dzPlayer.isPlaying()||dzPlayer.isMuted()){playercontrol.doAction('play');}
break;case'PAUSE':if(dzPlayer.isPlaying()){playercontrol.doAction('pause');}
break;}}catch(e){console.log(e);}},publish:function(_message,_link,_callback){if(!facebook.shareEnable()){return false;}
if(LOG_TYPE!='facebook'||USER.FB_USER_ID==0){if(typeof(_callback)=='function'){_callback(true);}
return false;}
FB.api('/me/feed','post',{message:_message,link:_link},function(response){if(!response||response.error){if(response.error.type=='OAuthException'){facebook.login('publish_stream');if(typeof(_callback)=='function'){_callback(false);}}}else{if(typeof(_callback)=='function'){_callback(true);}}});return true;},notify:function(uid,type){window.clearTimeout(facebook.timeoutId);if(typeof(FB)=='undefined'){return false;}
if(type=='follow'){FB.api('/'+uid,function(response){var txt="Vous êtes en train de suivre les écoutes de "+response.first_name+" "+response.last_name;if($('#notification_facebook').length===0){$("body").append("<div id='notification_facebook' class='' style='display:none;'></div>");}
$('#notification_facebook').text(txt).fadeIn();facebook.timeoutId=setTimeout(function(){$('#notification_facebook').fadeOut();},5000);});}
return true;},pushToConnect:function(){return false;},checkValidityToken:function(){if(USER.FB_USER_ID>0&&typeof(USER.FACEBOOK.TOKEN)!='undefined'){FB.api('/me?access_token='+USER.FACEBOOK.TOKEN,function(request){if(typeof(request.error)!='undefined'&&typeof(request.error.code)!='undefined'){api.call('facebookapi.refreshToken',{'short_token':FB_ACCESS_TOKEN,'force':true},function(req){console.log('facebookapi.refreshToken',req.results);});}});}
return true;},shareEnable:function(){if(USER.USER_ID==0||USER.FB_USER_ID==0){return false;}
if(typeof(USER.SETTING.facebook)=='undefined'){return true;}
if(typeof(USER.SETTING.facebook.share_share)=='undefined'){return true;}
if(!USER.SETTING.facebook.share_share){return false;}
return true;},commentEnable:function(){if(USER.USER_ID==0||USER.FB_USER_ID==0){return false;}
if(typeof(USER.SETTING.facebook)=='undefined'){return true;}
if(typeof(USER.SETTING.facebook.share_comment)=='undefined'){return true;}
if(!USER.SETTING.facebook.share_comment){return false;}
return true;},listenEnable:function(){if(USER.USER_ID==0||USER.FB_USER_ID==0){return false;}
if(typeof(USER.SETTING.facebook)=='undefined'){return true;}
if(typeof(USER.SETTING.facebook.share_listen)=='undefined'){return true;}
if(!USER.SETTING.facebook.share_listen){return false;}
return true;},favorisEnable:function(){if(USER.USER_ID==0||USER.FB_USER_ID==0){return false;}
if(typeof(USER.SETTING.facebook)=='undefined'){return true;}
if(typeof(USER.SETTING.facebook.share_favourite)=='undefined'){return true;}
if(!USER.SETTING.facebook.share_favourite){return false;}
return true;}};;
var googleplus={platform:'googleplus',gplus_clicked:false,connect:function(uid){api.call('signin.init',{'platform':googleplus.platform,'uid':uid,'data':{code:googleplus.code}},function(r){if(typeof(r.url)!='undefined'){if(modal.opened==true&&typeof(sharebox.obj_type)!='undefined'&&typeof(sharebox.obj_id)!='undefined'){r.url+='&redirect_type=modal&redirect_link='+encodeURIComponent('lightbox/sharebox.php?type='+sharebox.obj_type+'&id='+sharebox.obj_id+'&tab=google');}
modal.open(r.url,true);}
if(typeof(r.arl)!='undefined'){signin.login();modal.close();}});}}
var signin={login:function(redirect){user.userLogin();Events.ready(Events.user.loaded,function(){user.refreshPageAfterLogin(redirect);});},unlink:function(platform){if(confirm(sprintf(trad.setting.unlinkAccount_text1,'Google+'))){api.call('signin.unlink',{'platform':platform},function(r){if(www.getCurrentPageType()=='account'){$('#page_account_share_'+platform+', #page_account_share_'+platform+'_title > div > span').removeClass('active');$('#page_account_share_'+platform+'_title > div > a').hide();renderggplus();}});}
return true;}};
var ilike={map:new Array(),event:false,currentRetry:0,add:function(div,url,data,callback,toParse){try{return false;}catch(e){console.log(e);}}};
var musicbox={loaded:false,refreshPlaylist:true,songList:null,currentContext:'',datagridContent:'',options_default:{context:'',position:'left',deleteOption:false,datagridType:'playlist',datagridContent:'',x:0,y:0},options:{},$modeleSingleTrack:'',$modeleMultiTrack:'',$content:'',$template:'<div id="musicbox" class="musicbox absolute box-shadow"></div>',$modelePlaylistContent:'',$modelePlaylist:'',$createPlaylist:'',open:function(div,song_list,opt){try{if(USER.USER_ID==0){modal.open('/'+SETTING_LANG+'/login.php');return false;}
musicbox.options=$.extend({},musicbox.options_default,opt);if(typeof(song_list)!='object'||song_list.length==undefined){return false;}
musicbox.songList=song_list;$parent=(musicbox.options.context=='player')?$("body"):$("#page_content");if(!musicbox.loaded){$parent.append(musicbox.$template);musicbox.$content=$('#musicbox');template.load('naboo/components/musicbox',musicbox.$content);musicbox.$modeleSingleTrack=$('#head-add > div:eq(0)',musicbox.$content);musicbox.$modeleMultiTrack=$('#head-add > p',musicbox.$content);musicbox.$modelePlaylistContent=$('#add-playlist-content');musicbox.$modelePlaylistEmpty=$('#add-playlist-empty').clone();musicbox.$modelePlaylist=$('#add-playlist').clone();musicbox.$createPlaylist=$('#btn-new-list');Events.subscribe(Events.playlist.created,function(){musicbox.refreshPlaylist=true;});Events.subscribe(Events.playlist.removed,function(){musicbox.refreshPlaylist=true;});Events.subscribe(Events.playlist.update,function(){musicbox.refreshPlaylist=true;});musicbox.loaded=true;}
$parent.append(musicbox.$content);musicbox.currentContext=musicbox.options.context;musicbox.datagridContent=musicbox.options.datagridContent;musicbox.displayHeader();musicbox.displayButton(musicbox.options);if(musicbox.refreshPlaylist){musicbox.displayPlaylist();}
musicbox.setPosition(div,musicbox.options);musicbox.$content.bind("mousedown",musicbox.clickBox);$('body').bind("mousedown",musicbox.clickBody);}catch(e){console.log(e.stack,e.message);}},displayPlaylist:function(){try{musicbox.$modelePlaylistContent.empty();var playlists=$.merge([],userData.data['PLAYLISTS'].data);for(var f=0;f<userData.data['FAVORITES_PLAYLISTS'].count;f++){var favorite_playlist=userData.data['FAVORITES_PLAYLISTS'].data[f];if(favorite_playlist.STATUS=='2'){playlists.push(favorite_playlist);}}
playlists.sort(function(a,b){if(a['TITLE'].toLowerCase()==b['TITLE'].toLowerCase())return 0;return a['TITLE'].toLowerCase()<b['TITLE'].toLowerCase()?-1:1;});$display_line=$('<p></p>');var nbPlaylist=playlists.length;if(nbPlaylist>0){for(var p=0;p<nbPlaylist;p++){if(typeof(playlists[p].TYPE)!=='undefined'&&playlists[p].TYPE==4){continue;}
$item=musicbox.$modelePlaylist.clone();$item.attr('data-id',playlists[p].PLAYLIST_ID);$('a',$item).text(playlists[p].TITLE);$display_line.append($item);}}else{nbPlaylist=1;$display_line.append(musicbox.$modelePlaylistEmpty.clone());}
musicbox.$modelePlaylistContent.append($display_line.children());$('#add-content').height(22*Math.min(5,nbPlaylist));setTimeout(function(){$('#add-content').tinyscrollbar();},100);musicbox.refreshPlaylist=false;}catch(e){console.log(e.stack,e.message);}},displayHeader:function(){try{if(musicbox.songList.length==1){musicbox.$modeleSingleTrack.css('display','block');$('.label > dl > dt',musicbox.$modeleSingleTrack).text(musicbox.songList[0].SNG_TITLE);$('.label > dl > dd',musicbox.$modeleSingleTrack).text(musicbox.songList[0].ART_NAME);var cover='';if(typeof(musicbox.songList[0].ALB_PICTURE)!='undefined'){cover=musicbox.songList[0].ALB_PICTURE;}
$('.block_cover > .cover > img',musicbox.$modeleSingleTrack).attr('src',SETTING_DOMAIN_IMG+'/cover/'+cover+'/30x30-000000-80-0-0.jpg');musicbox.$modeleMultiTrack.css('display','none');}else{musicbox.$modeleSingleTrack.css('display','none');musicbox.$modeleMultiTrack.css('display','block').text(musicbox.songList.length+' '+trad.music.naboo_datagrid_ghost_element);}}catch(e){console.log(e.stack,e.message);}},displayButton:function(params){try{if(musicbox.songList.length==1&&musicbox.getSongIdList(true,true).length==1){$('#btn-share-track').css('display','block');}else{$('#btn-share-track').css('display','none');}
if(musicbox.getSongIdList(true,true).length>0){$('#btn-export-track').css('display','block');}else{$('#btn-export-track').css('display','none');}
if(musicbox.songList.length==1){var type=(typeof(musicbox.songList[0].TYPE)!='undefined')?musicbox.songList[0].TYPE:0;var sng_id=(type==1)?musicbox.songList[0].UPLOAD_ID:musicbox.songList[0].SNG_ID;favorite.display($('#btn-loved-track > a'),{type:'song',SNG_ID:sng_id,TYPE:type,KEY:sng_id+'_'+type});}else{$('#btn-loved-track').css('display','none');}
if(params.deleteOption){$('#btn-delete-track').css('display','block');$('#btn-delete-track > a > .label').text(trad.musicbox[params.datagridType+'_delete']);}else{$('#btn-delete-track').css('display','none');}
if(params.context!='player'&&params.datagridType!='queue'){$('#btn-add-queue').css('display','block');}else{$('#btn-add-queue').css('display','none');}}catch(e){console.log(e.stack,e.message);}},addQueue:function(){try{if(dzPlayer.getPlayerType()=="mod"){dzPlayer.addNextTracks(musicbox.songList);notification.display((musicbox.songList.length>1)?trad.player.confimAddTracksCurrentlist:trad.player.confimAddTrackCurrentlist,false,0,2500);musicbox.close();}
return false;}catch(e){console.log(e.stack,e.message);}},share:function(){try{if(typeof(musicbox.songList[0])!='undefined'){sharebox.load(0,musicbox.songList[0].SNG_ID);musicbox.close();}
return false;}catch(e){console.log(e.stack,e.message);}},deleteTrack:function(){try{if(musicbox.datagridContent!=''){musicbox.close();datagrid.action(musicbox.datagridContent,['removeTrack',musicbox.getSongIdList(musicbox.options.datagridType!='personal_song')]);}
return false;}catch(e){console.log(e.stack,e.message);}},exportTrack:function(){try{var trackList=musicbox.getSongIdList(false,true);if(trackList.length>0){window.open(SETTING_HOST_DEVELOPERS+'/musicplugins/player?type=tracks&id='+trackList.join(','));musicbox.close();}
return false;}catch(e){console.log(e.stack,e.message);}},addToPlaylist:function(playlist_id){try{if(musicbox.songList.length>0){api.call('playlist_addSongs',{playlist_id:playlist_id,songs:musicbox.getSongIdList()},musicbox.addToPlaylistCallback,{playlist_id:playlist_id});}
return false;}catch(e){console.log(e.stack,e.message);}},addToPlaylistCallback:function(request,callbackParameter){try{if(request.results==true){notification.display((musicbox.songList.length>1)?trad.player.confimAddTracksPlaylist:trad.player.confimAddTrackPlaylist,false,0,2500);dzoffline.elementChanged('playlist',callbackParameter.playlist_id);Events.trigger(Events.playlist.addSong,{playlist_id:callbackParameter.playlist_id,song:musicbox.songList});}else if(request.error.ERROR_PLAYLIST_FULL!=null){alert(trad.music.naboo_alert_limit_track);}else if(request.error.ERROR_TRACK_EXISTS!=null){notification.display(trad.musicbox.track_exists,false,0,2500);}
musicbox.close();}catch(e){console.log(e.stack,e.message);}},setPosition:function(div,params){try{var top=0;var left=0;var middleBoxHeight=Math.floor(musicbox.$content.height()/2);var middleBoxWidth=Math.floor(musicbox.$content.width()/2);var boxHeight=musicbox.$content.height();var boxWidth=musicbox.$content.width();musicbox.$content.children('span').css('display','none');if(params.position=='right'){left=Math.floor(div.offset().left)+div.width();if(musicbox.currentContext=='player'){top=50+div.height();} else{left=Math.floor(div.offset().left-$('#page_content').position().left)+boxWidth;top=Math.floor(div.offset().top-$('#naboo').position().top+yscroll)-middleBoxHeight+(Math.floor(div.height())/3);}
$('.l_arrow',musicbox.$content).show();}else if(params.position=='left'){if(musicbox.currentContext=='player'){left=div.offset().left;top=50+div.height();}else{left=Math.floor(div.offset().left-$('#page_content').position().left)-boxWidth;top=Math.floor(div.offset().top-$('#naboo').position().top+yscroll)-middleBoxHeight+(Math.floor(div.height())/3);}
$('.r_arrow',musicbox.$content).show();}else if(params.position=='bottom'){left=Math.floor(div.offset().left)+(div.width()/2)-middleBoxWidth;top=Math.floor(div.offset().top)+div.height();$('.t_arrow',musicbox.$content).show();}else if(params.position=='mouse'){var top=params.y-$('#naboo').position().top+yscroll;var left=params.x-$('#page_content').position().left;if((top+$('#naboo').position().top+boxHeight-yscroll)>$(window).height()){top-=boxHeight;}
if((left+boxWidth+$('#page_content').position().left)>$(window).width()){left-=boxWidth;}}
musicbox.$content.css({'top':top+'px','left':left+'px'}).show();}catch(e){console.log(e.stack,e.message);}},kill:function(evt){try{musicbox.$content.unbind("mousedown",musicbox.clickBox);$('body').unbind("mousedown",musicbox.clickBody);$('#musicbox').remove();musicbox.loaded=false;}catch(e){console.log(e.stack,e.message);}},close:function(){try{musicbox.$content.unbind("mousedown",musicbox.clickBox);$('body').unbind("mousedown",musicbox.clickBody);musicbox.closeCreatePlaylist();musicbox.$content.hide();}catch(e){console.log(e.stack,e.message);}},clickBox:function(){return false;},clickBody:function(){try{musicbox.close();}catch(e){console.log(e.stack,e.message);}},openCreatePlaylist:function(){try{$('a > span',musicbox.$createPlaylist).hide();$('a > input',musicbox.$createPlaylist).show().focus();}catch(e){console.log(e.stack,e.message);}},closeCreatePlaylist:function(){try{$('a > span',musicbox.$createPlaylist).show();$('a > input',musicbox.$createPlaylist).hide().val(trad.music.naboo_new_playlist)}catch(e){console.log(e.stack,e.message);}},createPlaylist:function($btn){try{var title=$btn.val();if(title!=trad.music.naboo_new_playlist&&title.length>0){api.call('playlist_create',{title:title},musicbox.createPlaylistCallback,{title:title});}
return false;}catch(e){console.log(e.stack,e.message);}},createPlaylistCallback:function(request,callbackParameter){try{if(request.results>0){Events.trigger(Events.playlist.add,{type:'playlist',TITLE:callbackParameter.title,PLAYLIST_ID:request.results,PARENT_USER_ID:USER.USER_ID});musicbox.addToPlaylist(request.results);musicbox.close();Events.trigger(Events.playlist.created,{id:request.results,title:callbackParameter.title});}}catch(e){console.log(e.stack,e.message);}},getSongIdList:function(fullList,deezerTrackOnly){try{if(typeof(fullList)=='undefined')fullList=true;if(typeof(deezerTrackOnly)=='undefined')deezerTrackOnly=false;var list=[];for(var t=0;t<musicbox.songList.length;t++){if(typeof(musicbox.songList[t].TYPE)=='undefined')musicbox.songList[t].TYPE=0;var songType=(musicbox.songList[t].TYPE==1)?1:0;var songId=(musicbox.songList[t].TYPE==1)?musicbox.songList[t].UPLOAD_ID:musicbox.songList[t].SNG_ID;if(deezerTrackOnly&&songType==1){continue;}
if(fullList){list.push([songId,songType]);}else{list.push(songId);}}
return list;}catch(e){console.log(e.stack,e.message);}}};
if(typeof(howto)=='undefined'){var howto={current:null,allowed_steps:[0,1,2,3,4,5,6,7,8],step_names:['search','add_favorite','add_artist','similar_artists','create_playlist','player_options','share','offline','end'],steps:{SEARCH:0,ADD_FAVORITE:1,ADD_ARTIST:2,SIMILAR_ARTIST:3,CREATE_PLAYLIST:4,PLAYER_OPTIONS:5,SHARE:6,OFFLINE:7,END:8},init:function(force){try{if(OFFLINE||PLATFORM!=='web'){return false;}
if(typeof(NEW_USER)!=='undefined'){return false;}
if(typeof(force)==='undefined'||force!==true){force=false;}
if(USER.USER_ID>0&&typeof(USER.SETTING.site)!=='undefined'&&typeof(USER.INSCRIPTION_DATE)!=='undefined'){if(typeof(USER.SETTING.site.howto_step)==='undefined'){Events.trigger(Events.user.settingChange,{site:{howto_step:0}});howto.current=0;}else{howto.current=USER.SETTING.site.howto_step;}
var delta_date_register=parseInt((new Date('2013-02-07').getTime()-new Date(USER.INSCRIPTION_DATE).getTime())/(1000*60*60*24),10);if(force===false&&delta_date_register>7&&howto.current===0){return false;}
howto.load(howto.current);}
return true;}catch(e){console.log(e.message,e.stack);}},load:function(step,force){try{if(typeof(step)==='undefined'){step=0;}
if($.inArray(step,howto.allowed_steps)===-1){return false;}
if(USER.SETTING.site.howto_step>howto.steps.END){return false;}
var href='http://'+SETTING_HOST+'/'+SETTING_LANG+'/howto/index.php?step='+step;$('#howto').remove();if(typeof(force)==='undefined'){force=false;}
$.get(href,function(data){howto.display(step,data,force);});return true;}catch(e){console.log(e.message,e.stack);}},display:function(step,data,force){try{if(typeof(step)==='undefined'||typeof(data)==='undefined'){return false;}
if($.inArray(step,howto.allowed_steps)===-1){return false;}
$("body").append('<div id="howto" class="module-howto"></div>');howto.current=step;var params;switch(step){case 0:var $howto=$('#howto');$howto.hide().html(data);$('.howto-arrow',$howto).hide();var $search_bar=$('#dzSearch');$howto.css({'z-index':'2000','position':'absolute','bottom':'-'+$howto.height()+'px','right':'1px'});$search_bar.append($howto.fadeIn());$('#howto-arrow-top-right').show();Events.subscribeOnce(Events.search.suggestDisplayed,function(){howto.load(howto.steps.ADD_FAVORITE,false);});break;case 1:var $album_favorite=$('#naboo_album_favorite');var add_to_library_callback=function add_to_library_callback(){var $howto=$('#howto');$howto.hide().html(data);$('.howto-arrow',$howto).hide();var $album_favorite=$('#naboo_album_favorite');$('#page_content').animate({scrollTop:0},'slow',function(){if($album_favorite.length>0){$howto.css({'z-index':'999','position':'absolute','bottom':'-'+parseInt(($howto.height()+18),10)+'px','left':0});$album_favorite.append($howto.fadeIn());$('#howto-arrow-top-left').show();}});};if($album_favorite.length>0&&www.getCurrentPageType()==='album'&&typeof(force)!=='undefined'&&force===true){add_to_library_callback();}else{Events.subscribeOnce(Events.album.displayed,add_to_library_callback);if(typeof(force)!=='undefined'&&force===true){params={'TYPE':'album','COUNTRY':(COUNTRY||'FR'),'TAG_ID':0,'START':0,'NB':10,'INCLUDE_TAGS':false};api.call('deezer_pageTops',params,function(request){if(request===false||request===null){return false;}
if(request.results===null){return false;}
if(request.results.ITEMS===null){return false;}
if(typeof(request.results.ITEMS.count)!=='number'||request.results.ITEMS.count===0){return false;}
var album=request.results.ITEMS.data[0];loadBox('album/'+album.ALB_ID);return true;});}}
break;case 2:var $artist_favorite=$('#naboo_artist_favorite');var add_to_favourites_callback=function add_to_favourites_callback(){var $howto=$('#howto');$howto.hide().html(data);$('.howto-arrow',$howto).hide();var $artist_favorite=$('#naboo_artist_favorite');if($artist_favorite.length>0){$howto.css({'z-index':'999','position':'absolute','bottom':'-'+parseInt(($howto.height()+18),10)+'px','left':0});$artist_favorite.append($howto.delay(500).fadeIn());$('#howto-arrow-top-left').show();$('#page_content').animate({scrollTop:0},'slow');}};if($artist_favorite.length>0&&typeof(force)!=='undefined'&&force===true){add_to_favourites_callback();}else{Events.subscribeOnce(Events.artist.displayed,add_to_favourites_callback);if(typeof(force)!=='undefined'&&force===true){if(www.getCurrentPageType()==='album'&&typeof(album.current_art_id)!=='undefined'&&parseInt(album.current_art_id,10)>0){loadBox('artist/'+album.current_art_id);}else{params={'TYPE':'artist','COUNTRY':(COUNTRY||'FR'),'TAG_ID':0,'START':0,'NB':10,'INCLUDE_TAGS':false};api.call('deezer_pageTops',params,function(request){if(request===false||request===null){return false;}
if(request.results===null){return false;}
if(request.results.ITEMS===null){return false;}
if(typeof(request.results.ITEMS.count)!=='number'||request.results.ITEMS.count===0){return false;}
var artist=request.results.ITEMS.data[0];loadBox('artist/'+artist.ART_ID);return true;});}}}
break;case 3:var $naboo_tab=$('#naboo_artist_second .nav-tabs');var $related=$('#tab_related_link').next('li');var similar_artists_callback=function similar_artists_callback(){var $howto=$('#howto');$howto.hide().html(data);$('.howto-arrow',$howto).hide();var $naboo_tab=$('#naboo_artist_second .nav-tabs');var $related=$('#tab_related_link').next('li');if($naboo_tab.length>0&&$related.length>0){$howto.css({'z-index':'999','position':'absolute','top':parseInt($related.position().top-(($howto.height()-$related.height())/2),10)+'px','left':parseInt($related.position().left+5,10)+'px'});var scroll_offset=$naboo_tab.position().top-($howto.outerHeight()-$related.height());$('#page_content').animate({scrollTop:scroll_offset},'slow');$naboo_tab.append($howto.delay(500).fadeIn());$('#howto-arrow-left-middle').show();loadTab('related');}};if($naboo_tab.length>0&&$related.length>0&&www.getCurrentPageType()==='artist'&&typeof(force)!=='undefined'&&force===true){similar_artists_callback();}else{Events.subscribeOnce(Events.artist.displayed,similar_artists_callback);if(typeof(force)!=='undefined'&&force===true){if(www.getCurrentPageType()==='artist'){loadBox('artist/'+artist.id);}else{params={'TYPE':'artist','COUNTRY':(COUNTRY||'FR'),'TAG_ID':0,'START':0,'NB':10,'INCLUDE_TAGS':false};api.call('deezer_pageTops',params,function(request){if(request===false||request===null){return false;}
if(request.results===null){return false;}
if(request.results.ITEMS===null){return false;}
if(typeof(request.results.ITEMS.count)!=='number'||request.results.ITEMS.count===0){return false;}
var artist=request.results.ITEMS.data[0];loadBox('artist/'+artist.ART_ID);return true;});}}}
break;case 4:var create_playlist_callback=function create_playlist_callback(){var $howto=$('#howto');$howto.hide().html(data);$('.howto-arrow',$howto).hide();var $create_playlist=$('#naboo_menu_create_playlist');var $menu_list=$('#naboo_menu_list');if($menu_list.length>0&&$create_playlist.length>0){var $app_menu_toggler=$('#naboo_menu_list_app [element-id]');var app_menu_id=$app_menu_toggler.attr('element-id');if(typeof(menu.folderStatus['f_'+app_menu_id])!=='undefined'&&menu.folderStatus['f_'+app_menu_id]==='open'){menu.openFolder($app_menu_toggler);}else if(typeof(menu.folderStatus['f_'+app_menu_id])==='undefined'){menu.openFolder($app_menu_toggler);if(menu.folderStatus['f_'+app_menu_id]==='open'){menu.openFolder($app_menu_toggler);}}
$howto.css({'z-index':'1000','position':'absolute','top':parseInt($create_playlist.position().top-(($howto.height()-$create_playlist.outerHeight())/2)+4,10)+'px','left':parseInt($create_playlist.offset().left+$create_playlist.innerWidth()+10,10)+'px'});console.log('create playlist top: '+$create_playlist.position().top);console.log('howto height: '+$howto.height());console.log('create playlist height: '+$create_playlist.height());if((typeof(USER.SETTING.site.menu_display_cover)!=='undefined'&&USER.SETTING.site.menu_display_cover===true)||(typeof(display_cover)!=='undefined'&&display_cover===true)){menu.displayCover();}
menu.$naboo_menu_list_content.tinyscrollbar_update('top');$menu_list.prepend($howto.fadeIn());$('#howto-arrow-left-middle').show();Events.subscribeOnce(Events.playlist.created,function(){howto.load(howto.steps.PLAYER_OPTIONS,true);});}};if(typeof(force)!=='undefined'&&force===true){create_playlist_callback();}else{Events.subscribeOnce(Events.navigation.page_changed,create_playlist_callback);}
break;case 5:var player_options_callback=function player_options_callback(){var $howto=$('#howto');$howto.hide().html(data);$('.howto-arrow',$howto).hide();var $shuffle=$('#player_option_shuffle');$howto.css({'z-index':'999','position':'absolute','bottom':'-'+parseInt($howto.height(),10)+'px','left':parseInt(($shuffle.offset().left+$shuffle.innerWidth()-$howto.innerWidth())+15,10)+'px'});$('.page-header > .player').prepend($howto.fadeIn());$('#howto-arrow-top-right').show();var on_layout_resize=function on_layout_resize(){if($howto.length>0&&$howto.is(':visible')&&howto.current==5){$howto.css({'bottom':'-'+parseInt($howto.height(),10)+'px','left':parseInt(($shuffle.offset().left+$shuffle.innerWidth()-$howto.innerWidth())+15,10)+'px'});}else{Events.unsubscribe(Events.layout.resize,on_layout_resize);}};Events.subscribe(Events.layout.resize,on_layout_resize);};if(typeof(force)!=='undefined'&&force===true){player_options_callback();}else{Events.subscribeOnce(Events.navigation.page_changed,player_options_callback);}
break;case 6:var share_callback=function share_callback(){var $howto=$('#howto');$howto.hide().html(data);$('.howto-arrow',$howto).hide();var $share=$('#player_action_share');$howto.css({'z-index':'999','position':'absolute','bottom':'-'+parseInt($howto.height()-20,10)+'px','left':parseInt(($share.offset().left+$share.innerWidth()-$howto.innerWidth())+15,10)+'px'});$('.page-header > .player').prepend($howto.fadeIn());$('#howto-arrow-top-right').show();var on_layout_resize=function on_layout_resize(){if($howto.length>0&&$howto.is(':visible')&&howto.current==6){$howto.css({'bottom':'-'+parseInt($howto.height()-20,10)+'px','left':parseInt(($share.offset().left+$share.innerWidth()-$howto.innerWidth())+15,10)+'px'});}else{Events.unsubscribe(Events.layout.resize,on_layout_resize);}};Events.subscribe(Events.layout.resize,on_layout_resize);};if(typeof(force)!=='undefined'&&force===true){share_callback();}else{Events.subscribeOnce(Events.navigation.page_changed,share_callback);}
break;case 7:var $offline_link=$('#naboo_datagrid_offline_local');var offline_callback=function offline_callback(){var $howto=$('#howto');$howto.html(data).hide();$('.howto-arrow',$howto).hide();var $offline_link=$('#naboo_datagrid_offline_local');$('#page_content').animate({scrollTop:0},'slow',function(){if($offline_link.length>0){$howto.css({'z-index':'999','position':'absolute','top':parseInt(($offline_link.position().top-($howto.height()/2))+15,10)+'px','left':parseInt($offline_link.position().left+$offline_link.outerWidth()+15,10)+'px'});$offline_link.parent().append($howto.fadeIn(100));$('#howto-arrow-left-middle').show();}});};if($offline_link.length>0&&www.getCurrentPageType()==='album'){offline_callback();}else{Events.subscribeOnce(Events.album.displayed,offline_callback);if(typeof(force)!=='undefined'&&force===true){params={'TYPE':'album','COUNTRY':(COUNTRY||'FR'),'TAG_ID':0,'START':0,'NB':10,'INCLUDE_TAGS':false};api.call('deezer_pageTops',params,function(request){if(request===false||request===null){return false;}
if(request.results===null){return false;}
if(request.results.ITEMS===null){return false;}
if(typeof(request.results.ITEMS.count)!=='number'||request.results.ITEMS.count===0){return false;}
var album=request.results.ITEMS.data[0];loadBox('album/'+album.ALB_ID);return true;});}}
break;case 8:var end_callback=function end_callback(){var $howto=$('#howto');$howto.hide().html(data);$('.howto-arrow',$howto).hide();var $tops=$('#naboo_menu_discover_tops');var $menu_list=$('#naboo_menu_list');if($menu_list.length>0&&$tops.length>0){$howto.css({'z-index':'1000','position':'absolute','top':parseInt($tops.position().top-(($howto.height()-$tops.height())/2),10)+'px','left':parseInt($tops.offset().left+$tops.innerWidth()+10,10)+'px'});$menu_list.prepend($howto.fadeIn());$('#howto-arrow-left-middle').show();Events.subscribeOnce(Events.tops.displayed,function(){howto.close();});}};if(typeof(force)!=='undefined'&&force===true){end_callback();}else{Events.subscribeOnce(Events.navigation.page_changed,end_callback);}
break;default:$('#howto').remove();Events.trigger(Events.user.settingChange,{site:{howto_step:step}});return false;}
return true;}catch(e){console.log(e.message,e.stack);}},next:function(){try{var step=howto.current+1;var new_reg=(typeof(NEW_USER)!=='undefined'&&NEW_USER===true)?true:false;if($.inArray(step,howto.allowed_steps)===-1){return false;}
if(step>USER.SETTING.site.howto_step){Events.trigger(Events.user.settingChange,{site:{howto_step:step}});}
tracking.track('tips_next_click',{'step':step,'step_name':howto.step_names[step],'new_reg':new_reg});$('#howto').remove();howto.load(step,true);return true;}catch(e){console.log(e.message,e.stack);}},previous:function(){try{var step=howto.current-1;var new_reg=(typeof(NEW_USER)!=='undefined'&&NEW_USER===true)?true:false;if($.inArray(step,howto.allowed_steps)===-1){return false;}
tracking.track('tips_prev_click',{'step':step,'step_name':howto.step_names[step],'new_reg':new_reg});$('#howto').remove();howto.load(step,true);return true;}catch(e){console.log(e.message,e.stack);}},close:function(){try{var step=howto.current;var new_reg=(typeof(NEW_USER)!=='undefined'&&NEW_USER===true)?true:false;step+=1;if(step>USER.SETTING.site.howto_step){Events.trigger(Events.user.settingChange,{site:{howto_step:step}});}
tracking.track('tips_close_click',{'step':step,'step_name':howto.step_names[step],'new_reg':new_reg});$('#howto').remove();if(step==howto.steps.ADD_FAVORITE||step==howto.steps.ADD_ARTIST||step==howto.steps.SIMILAR_ARTIST||step==howto.steps.OFFLINE){howto.load(step,false);}else{Events.subscribeOnce(Events.navigation.page_changed,function(){howto.load(step,true);});}
return true;}catch(e){console.log(e.message,e.stack);}},reset:function(){if(USER.USER_ID>0){Events.trigger(Events.user.settingChange,{site:{howto_step:0}});if(typeof(NEW_USER)!=='undefined'){delete NEW_USER;}
setTimeout(function(){howto.init(true);},100);}else{modal.open('/'+SETTING_LANG+'/login.php?redirect_link=tour&redirect_type=refresh');}}};};
var playercontrol={RETRY_DELAI:500,currentQueueOrder:[],lastLoadingPourcent:0,startType:"",startData:"",startIndex:0,startId:"",startAutoplay:false,playlist_focus:null,mix:false,previousMode:"",isDraggingCursorTime:false,smartRadioCounter:3600000,smartRadioIntervalId:0,smartRadioSkipTotal:5,smartRadioSkipCount:0,lastOnAirTrack:0,$sortable:'',heightPlayer:105,init:function(type,data,index,auto_play,restriction,element_id){try{if(typeof(restriction.results)!='undefined'&&!DZPS){dzPlayer.setForbiddenListen((parseInt(restriction.results.percent,10)>=100));restrict.init(restriction);}else{if(typeof(USER.USER_ID)!='undefined'&&USER.USER_ID>0){restrict.init();}}
playercontrol.$dz_player=$("#dz_player");playercontrol.$groupControls=$("#player_controls");playercontrol.$btnPrevious=$("#player_control_prev");playercontrol.$btnPlay=$("#player_control_play");playercontrol.$btnPause=$("#player_control_pause");playercontrol.$btnNext=$("#player_control_next");playercontrol.$btnMute=$("#player_volume");playercontrol.$IcnVolumeMute=$("#player_volume_mute");playercontrol.$IcnVolume0=$("#player_volume_0");playercontrol.$IcnVolume50=$("#player_volume_50");playercontrol.$IcnVolume100=$("#player_volume_100");playercontrol.$volumeCursor=$("#player_volume_handler");playercontrol.$volumeIndicator=$("#player_volume_bar");playercontrol.$volumeBar=$("#player_volume_progress");playercontrol.$labelArtName=$("#player_track_artist");playercontrol.$labelSongTitle=$("#player_track_title");playercontrol.$groupActions=$("#player_actions");playercontrol.$btnLoved=$('#player_action_love');playercontrol.$btnPartage=$('#player_action_share');playercontrol.$btnBuy=$("#player_action_buy");playercontrol.$btnAdd=$("#player_action_add");playercontrol.$songPosition=$("#player_track_position");playercontrol.$songDuration=$("#player_track_length");playercontrol.$contentBar=$("#player_track_progress");playercontrol.$progressBar=$("#player_track_progress_current");playercontrol.$previewBar=$("#player_track_progress_preview");playercontrol.$bufferingBar=$("#player_track_progress_loading");playercontrol.$timeCursor=$("#player_track_progress_handler");playercontrol.$groupOptions=$("#player_options");playercontrol.$btnQueue=$("#player_option_queue");playercontrol.$btnRepeat=$("#player_option_repeat");playercontrol.$btnRandom=$("#player_option_shuffle");playercontrol.$btnOptionPlayer=$("#player_option_others");playercontrol.$listQueueContent=$("#player_queue");playercontrol.$listQueue=$("#player_queue");playercontrol.$elementQueue=$("#current-list ol li").clone();playercontrol.$contentList=$("#current-list");playercontrol.$contentListQueue=$("#current-list .tinyscroll_overview").empty();playercontrol.$contextQueue=$("#current-playlistName > a");playercontrol.$btnOnTour=$("#current-ontour").hide();playercontrol.$btnPause.hide();playercontrol.$btnPlay.show();playercontrol.$bufferingBar.click(function(e){playercontrol.doAction("seek",[playercontrol.getSeekValue(e.pageX)]);});playercontrol.$progressBar.click(function(e){playercontrol.doAction("seek",[playercontrol.getSeekValue(e.pageX)]);});playercontrol.$timeCursor.draggable({axis:'x',containment:'parent',start:function(){playercontrol.isDraggingCursorTime=true;playercontrol.$previewBar.css("width",'0px').show();},drag:function(event,ui){var percent=((ui.offset.left-playercontrol.$contentBar.offset().left)/playercontrol.$contentBar.width())*100;playercontrol.$previewBar.css("width",percent+'%');},stop:function(event,ui){playercontrol.isDraggingCursorTime=false;playercontrol.$previewBar.hide();if(dzPlayer.isPlaying()){playercontrol.doAction("seek",[playercontrol.getSeekValue(ui.offset.left)]);}else{playercontrol.position(null,dzPlayer.position);}}});playercontrol.$volumeCursor.draggable({axis:'x',containment:'parent',drag:function(event,ui){if(dzPlayer.isMuted())playercontrol.doAction('mute');var calculVolume=Math.floor(((ui.offset.left-$(this).parent().offset().left)/($(this).parent().width()-5))*100);playercontrol.$volumeIndicator.css('width',calculVolume+'%');playercontrol.doAction("volume",[calculVolume,false]);},stop:function(event,ui){if(dzPlayer.isMuted())playercontrol.doAction('mute');var calculVolume=Math.floor(((ui.offset.left-$(this).parent().offset().left)/($(this).parent().width()-5))*100);playercontrol.$volumeIndicator.css('width',calculVolume+'%');playercontrol.doAction("volume",[calculVolume,true]);}});playercontrol.$volumeBar.click(function(e,ui){if(dzPlayer.isMuted())playercontrol.doAction('mute');var calculVolume=Math.floor(((e.originalEvent.layerX)/($(this).width()-1))*100);playercontrol.$volumeIndicator.css('width',calculVolume+'%');playercontrol.doAction("volume",[calculVolume,true]);playercontrol.$volumeCursor.css('left',calculVolume+'%');});$('#dzSearch').searchBar({analytics:true,autofocus:true,instance:'header',div_loading:'#search_button'});playercontrol.$btnRepeat.tipsy({gravity:'s',fallback:trad.player.repeat,force_top:true});playercontrol.$btnRandom.tipsy({gravity:'s',fallback:trad.player.random,force_top:true});playercontrol.$btnAdd.tipsy({gravity:'s',fallback:trad.player.addPlaylist,force_top:true});playercontrol.$btnQueue.tipsy({gravity:'s',fallback:trad.player.queue,force_top:true});playercontrol.$btnOptionPlayer.tipsy({gravity:'s',fallback:trad.player.options,force_top:true});playercontrol.$btnPartage.tipsy({gravity:'s',fallback:trad.player.share,force_top:true});playercontrol.$btnLoved.tipsy({gravity:'s',title:function(){return($(this).is('.selected'))?trad.music.favorite_remove_song:trad.music.favorite_add_song;},force_top:true});if(typeof(STORE_PLATEFORM)!='undefined'&&typeof(STORE_PLATEFORM.DEEZER)!='undefined'&&(getObjectSize(STORE_PLATEFORM)==1)){playercontrol.$btnBuy.tipsy({force_top:true,trigger:'manual',gravity:'s',title:function(){return $(this).attr('original-title');}});playercontrol.$btnBuy.mouseenter(function(e){if(typeof(dzPlayer.getCurrentSongInfo())!='undefined'){if(dzPlayer.getPlayerType()!='ads'&&dzPlayer.getPlayerType()!='jingle'){if(typeof(dzPlayer.getCurrentSongInfo().TYPE)=='undefined'||dzPlayer.getCurrentSongInfo().TYPE=='0'){if(USER.USER_ID>0){playercontrol.$btnBuy.attr('original-title','');api.call('store_createOrder',{type:3,element:[dzPlayer.getCurrentSongInfo().SNG_ID]},function(r){if(typeof(r.results.amount)!='undefined'&&playercontrol.$btnBuy.attr('original-title')!='stop'){if(r.results.amount>0){playercontrol.$btnBuy.attr('original-title',r.results.amount+' €');playercontrol.$btnBuy.tipsy('show');}}});}else{playercontrol.$btnBuy.attr('original-title',trad.player.buy_deezer);playercontrol.$btnBuy.tipsy('show');}}}}});playercontrol.$btnBuy.mouseleave(function(e){playercontrol.$btnBuy.attr('original-title','stop');playercontrol.$btnBuy.tipsy('hide');});}
playercontrol.startType=type;playercontrol.startData=data;playercontrol.startIndex=index;playercontrol.startId=element_id;playercontrol.startAutoplay=auto_play;Events.subscribe(Events.player.playerLoaded,playercontrol.playerLoaded);Events.subscribe(Events.player.displayEmptyPlayer,playercontrol.displayEmptyPlayer);Events.subscribe(Events.player.displayCurrentSong,playercontrol.displayCurrentSong);Events.subscribe(Events.player.volume,playercontrol.volume);Events.subscribe(Events.player.volume_changed,playercontrol.refreshSoundBar);Events.subscribe(Events.player.mute_changed,playercontrol.refreshSoundBar);Events.subscribe(Events.player.position,playercontrol.position);Events.subscribe(Events.player.duration,playercontrol.duration);Events.subscribe(Events.player.fadeOutProgress,playercontrol.fadeOutProgress);Events.subscribe(Events.player.finish,playercontrol.finish);Events.subscribe(Events.player.finishAds,playercontrol.finishAds);Events.subscribe(Events.player.finishJingle,playercontrol.finishJingle);Events.subscribe(Events.player.loading,playercontrol.loading);Events.subscribe(Events.player.playing,playercontrol.changeControlButtonStatus);Events.subscribe(Events.player.pourcentLoaded,playercontrol.pourcentLoaded);Events.subscribe(Events.player.changePlayerType,playercontrol.changePlayerType);Events.subscribe(Events.player.log_offline,playercontrol.log_offline);Events.subscribe(Events.player.refreshSoundBar,playercontrol.refreshSoundBar);Events.subscribe(Events.player.forceCloseMix,function(){if(playercontrol.mix)playercontrol.doAction('closeMix');});Events.subscribe(Events.player.repeat,playercontrol.displayRepeatStatus);Events.subscribe(Events.player.shuffle,playercontrol.displayShuffleStatus);Events.subscribe(Events.player.checkLimit,playercontrol.checkLimit5);Events.subscribe(Events.player.notify,playercontrol.displayNotify);Events.subscribe(Events.user.logout,playercontrol.userLogout);Events.ready(Events.user.userReady,function(){Events.subscribe(Events.user.addFavorite,playercontrol.changeLovedTrackDisplay);Events.subscribe(Events.user.deleteFavorite,playercontrol.changeLovedTrackDisplay);});var initPlayer=dzPlayer.initSoPlayer("core_player");if(!initPlayer&&PLATFORM==='web'){notificationBar.display('flash_update');}
if(BrowserDetect.browser=='Explorer'&&BrowserDetect.version<=7){notificationBar.display('ie7_support');}}catch(e){console.log(e.message,e.stack);}},changeLovedTrackDisplay:function(evt,arg){try{if(arg.type!='song')return false;var listenType=(typeof(arg.TYPE)!='undefined')?dzPlayer.getCurrentSongInfo().TYPE:0;var listenSngId=(listenType==1)?dzPlayer.getCurrentSongInfo().UPLOAD_ID:dzPlayer.getCurrentSongInfo().SNG_ID;if(listenSngId==arg.SNG_ID){favorite.display(playercontrol.$btnLoved,{type:'song',SNG_ID:arg.SNG_ID,TYPE:arg.TYPE,KEY:arg.SNG_ID+'_'+arg.TYPE});return true;}
return false;}catch(e){console.log(e.message,e.stack);}},playerLoaded:function(){try{dzPlayer.initRestriction();dzPlayer.restoreSetting(USER.SETTING);playercontrol.setFirstContent();playercontrol.player_loaded=true;return true;}catch(e){console.log(e.message,e.stack);}},setFirstContent:function(){try{if(playercontrol.startType!==""&&playercontrol.startData!==""){if(!OFFLINE&&!dzPlayer.loading){if(playercontrol.startData.count>0&&playercontrol.startType!="track_page"){dzPlayer.playTracks(playercontrol.startData.data,playercontrol.startIndex,playercontrol.startAutoplay,{TYPE:playercontrol.startType,ID:playercontrol.startId});if(typeof(dzPlayer.getCurrentSongInfo())=='undefined'){dzPlayer.playPlaylist(PLAYLIST_WELCOME_ID,playercontrol.startIndex,playercontrol.startAutoplay,{TYPE:'player_default_playlist',ID:PLAYLIST_WELCOME_ID});}}else if(getObjectSize(playercontrol.startData)>0&&playercontrol.startType=="track_page"){dzPlayer.playTracks([playercontrol.startData],playercontrol.startIndex,playercontrol.startAutoplay,{TYPE:'track_page',ID:playercontrol.startId});if(typeof(dzPlayer.getCurrentSongInfo())=='undefined'){dzPlayer.playPlaylist(PLAYLIST_WELCOME_ID,playercontrol.startIndex,playercontrol.startAutoplay,{TYPE:'player_default_playlist',ID:PLAYLIST_WELCOME_ID});}}else{dzPlayer.playPlaylist(PLAYLIST_WELCOME_ID,playercontrol.startIndex,playercontrol.startAutoplay,{TYPE:'player_default_playlist',ID:PLAYLIST_WELCOME_ID});}
Events.resolve(Events.player.playerReady);}}else{setTimeout(playercontrol.setFirstContent,playercontrol.RETRY_DELAI);}
return true;}catch(e){console.log(e.message,e.stack);}},getSeekValue:function(seek_position){var x=seek_position-playercontrol.$contentBar.offset().left;x=x/playercontrol.$contentBar.width();return x;},doAction:function(action,params){try{switch(action){case"play":if(playercontrol.$btnPlay.is('.disabled')){return false;}
if(dzPlayer.logListenId==0&&!DZPS){dzPlayer.logStartListen();playercontrol.displayNotify(null,'start');}
playercontrol.$btnPause.show();playercontrol.$btnPlay.hide();if(dzPlayer.getPlayerType()=="follower"){if(!dzPlayer.isFadeInProgress()&&!dzPlayer.isFadeOutProgress()){if(dzPlayer.isMuted()){dzPlayer.mute(false);Events.trigger(Events.player.resume,{value:dzPlayer.getCurrentSongInfo()});}}}else{dzPlayer.play();if((typeof(dj)!='undefined')&&typeof(dj.control)=="function"){dj.control("pause",false);}}
break;case"pause":if(playercontrol.$btnPause.is('.disabled')){return false;}
playercontrol.$btnPause.hide();playercontrol.$btnPlay.show();if(dzPlayer.getPlayerType()=="follower"){if(!dzPlayer.isFadeInProgress()&&!dzPlayer.isFadeOutProgress()){if(!dzPlayer.isMuted()){dzPlayer.mute(true);Events.trigger(Events.player.paused,{value:dzPlayer.getCurrentSongInfo()});}}}else{dzPlayer.pause();if((typeof(dj)!='undefined')&&typeof(dj.control)=="function"){dj.control("pause",true);}}
break;case"prev":if(playercontrol.$btnPrevious.is('.disabled')){return false;}
if(dzPlayer.getPlayerType()!="smartRadio"){dzPlayer.prevSong();}
break;case"next":if(playercontrol.$btnNext.is('.disabled')){return false;}
if(dzPlayer.getPlayerType()=="smartRadio"){playercontrol.smartRadioSkipCount++;if(playercontrol.smartRadioIsLockedSkip(false)){return false;}}
dzPlayer.nextSong();break;case"repeat":if(playercontrol.$btnRepeat.is('.disabled')){return false;}
playercontrol.$btnRepeat.tipsy("hide");if(typeof(params)=='number'){params=Math.max(0,Math.min(2,params*1));dzPlayer.setRepeat(params);}else{dzPlayer.setRepeat((dzPlayer.getRepeat()==2)?0:dzPlayer.getRepeat()+1);}
this.displayRepeatStatus();break;case"shuffle":if(playercontrol.$btnRandom.is('.disabled')){return false;}
playercontrol.$btnRandom.tipsy("hide");dzPlayer.setShuffle(!dzPlayer.isShuffle());Events.trigger(Events.player.order_changed);this.displayShuffleStatus();break;case"volume":if(!isNaN(params[0])){if(params[0]>100){params[0]=100;}
if(params[0]<0){params[0]=0;}
dzPlayer.setVolume(params[0]/100,params[1]);}
break;case"linkCurrentSong":if(dzPlayer.getPlayerType()=='jingle'){return false;}
if(dzPlayer.getPlayerType()=='ads'){if(dzPlayer.getAudioAds().tracking.clickCommand!==''){window.open(dzPlayer.getAudioAds().tracking.clickCommand);}
return false;}
if(dzPlayer.getCurrentSongInfo().SNG_ID>0&&!playercontrol.blindTestMode){loadBox('album/'+dzPlayer.getCurrentSongInfo().ALB_ID);}
break;case"seek":if(!isNaN(params[0])&&dzPlayer.getPlayerType()=="mod"){dzPlayer.seek(params[0]);if(typeof(dj)!='undefined'&&typeof(dj.control)=="function"){dj.control("seek",[params[0]]);}}
break;case"addSongPlaylist":if(playercontrol.$btnAdd.is('.disabled')){return false;}
if(!OFFLINE){playercontrol.$btnAdd.tipsy("hide");var songId=(dzPlayer.getCurrentSongInfo().TYPE==1)?dzPlayer.getCurrentSongInfo().UPLOAD_ID:dzPlayer.getCurrentSongInfo().SNG_ID;if(songId>0&&dzPlayer.getPlayerType()!="ads"&&dzPlayer.getPlayerType()!="jingle"){musicbox.open(playercontrol.$btnAdd,[dzPlayer.getCurrentSongInfo()],{context:'player',position:'bottom'});}}
break;case"toggleQueueList":if(playercontrol.$btnQueue.is('.disabled')){return false;}
if(!dzPlayer.playerLoaded){return false;}
playercontrol.$btnQueue.tipsy("hide");if(playercontrol.$listQueue.is('.close')&&!playercontrol.blindTestMode){playercontrol.$listQueue.removeClass('close').addClass('open');playercontrol.$btnQueue.addClass('selected');Events.subscribeOnce(Events.datagrid.allTracksDisplayed,function(evt,data){playercontrol.displayQueueListDuration(evt,data);playercontrol.$contentList.tinyscrollbar_update(playercontrol.onairPosition);});Events.subscribeOnce(Events.datagrid.onAirPosition,function(evt,data){playercontrol.onairPosition=0;if(data.top+(30*2)>=playercontrol.$contentList.height()){if(data.top>$('#current-list-inner > .tinyscroll_viewport > .datagrid_master',playercontrol.$contentList).height()-playercontrol.$contentList.height()){playercontrol.onairPosition='bottom';}else{playercontrol.onairPosition=data.top;}}});Events.unsubscribe(Events.datagrid.removedTrack,playercontrol.displayQueueListDuration);Events.subscribe(Events.datagrid.removedTrack,playercontrol.displayQueueListDuration);playercontrol.$contentList.tinyscrollbar();$('#current-list-inner > .tinyscroll_viewport > .tinyscroll_overview').createDatagrid({type:'queue',id:0,scrollAutoOnAir:true,songs:{data:dzPlayer.trackList,total:dzPlayer.trackList.length,count:dzPlayer.trackList.length},allowMoveToPlaylist:false,scrollInfinite:false});playercontrol.displayCurrentListen();playercontrol.$listQueueContent.bind("mousedown",playercontrol.clickBox);playercontrol.$btnQueue.bind("mousedown",playercontrol.clickBox);$('body').bind("mousedown",playercontrol.clickBody);}else if(playercontrol.$listQueue.is('.open')){playercontrol.$listQueue.removeClass('open').addClass('close');playercontrol.$btnQueue.removeClass('selected');$('#current-list-inner > .tinyscroll_viewport > .tinyscroll_overview',playercontrol.$contentList).destroy();playercontrol.$contentList.tinyscrollbar_update();}
break;case"playTrackAtIndex":if($(params).is('.disabled')){return false;}
var index=$(params).parent().children().index($(params));if(index>-1){dzPlayer.playTrackAtIndex(index);}
break;case"buy":if(playercontrol.$btnBuy.is('.disabled')){return false;}
playercontrol.buy(playercontrol.$btnBuy,dzPlayer.getCurrentSongInfo().SNG_ID);break;case"mute":if(playercontrol.$btnMute.is('.disabled')){return false;}
if(!dzPlayer.isFadeInProgress()&&!dzPlayer.isFadeOutProgress()){dzPlayer.mute(!dzPlayer.isMuted());}
break;case"hq":if(!OFFLINE){$('#btnHq').tipsy("hide");if(typeof(USER)!='undefined'&&USER.OPTIONS.web_hq){dzPlayer.setHq(!dzPlayer.isHq());}else{loadBox('offers');}}
break;case"openOption":if(playercontrol.$btnOptionPlayer.is('.disabled')){return false;}
if(!dzPlayer.playerLoaded){return false;}
if(dzPlayer.getPlayerType()!="ads"&&dzPlayer.getPlayerType()!="jingle"){playercontrol.$btnOptionPlayer.tipsy("hide");playeroptions.load(playercontrol.$btnOptionPlayer);}
break;case"smartNotLike":if(dzPlayer.getPlayerType()=="smartRadio"){playercontrol.smartRadioSkipCount++;if(!playercontrol.smartRadioIsLockedSkip(false)){dzPlayer.setSmartNotLike();}}
break;case"removeTracks":var currentIndex=params.parent().children().index(params);if(dzPlayer.getTrackListIndex()!=currentIndex){if(currentIndex>-1){dzPlayer.removeTracks(currentIndex);params.remove();playercontrol.$contentList.tinyscrollbar_update('relative');}
playercontrol.changeTrackOrder();}
break;case"openMix":if(DZPS&&!OFFLINE){playeroptions.close();$('#btnMixage').tipsy("hide");$(".page-header").append('<div id="mixage_player" class="open"><div id="mixage_player-content"></div></div>');$(".page-header").css('height','220px');$('.page-layout').css('top','220px');playercontrol.$mixagePlayer=$("#mixage_player");dzPlayer.pause();this.mix=true;playercontrol.$mixagePlayer.show();playercontrol.$listQueueContent.hide();$(".page-header > .player").hide();dzPlayer.initSoMixage("mixage_player-content");playercontrol.$mixagePlayer.droppable({accept:"tr",tolerance:"pointer",drop:function(event,ui){var type=$(ui.draggable.context).attr('class');var dropPosition=ui.offset.left-playercontrol.$mixagePlayer.offset().left;var chan=(dropPosition<(playercontrol.$mixagePlayer.width()/2))?1:2;if(type.indexOf('drag')>-1){var idTrack=$(ui.helper).data('value');if(typeof(idTrack)=='object'&&idTrack.length>0){var array_default=['RIGHTS','DATE_END_PREMIUM','RANK_SNG','FILESIZE_MP3_128','SMARTRADIO','STATUS','SNG_ID','PROVIDER_ID','MD5_ORIGIN','ART_ID','FILESIZE_MP3_320','SNG_TITLE','DURATION','TYPE','USER_ID','FILESIZE','MEDIA_VERSION','ALB_PICTURE','FILESIZE_MP3_256','VIDEO_URL','ART_NAME','ALB_ID','ALB_TITLE'];if(idTrack[0][1]=="0"){api.call('song_getData',{sng_id:idTrack[0][0],array_default:array_default},playercontrol.getSongData,{chan:chan});}else if(idTrack[0][1]=="1"){api.call('song_getPersonalSongData',{upload_id:idTrack[0][0],array_default:array_default},playercontrol.getSongData,{chan:chan});}}}},over:function(event,ui){try{$(ui.helper).addClass('dropable');}catch(e){console.log(e.message,e.stack);}},out:function(event,ui){try{$(ui.helper).removeClass('dropable');}catch(e){console.log(e.message,e.stack);}}});menu.adjustUserMenu();}
break;case"closeMix":this.mix=false;playercontrol.$mixagePlayer.remove();$('.page-layout').css('top',playercontrol.heightPlayer+'px');$(".page-header").css('height','auto');$(".page-header > .player").show();playercontrol.$listQueueContent.show();menu.adjustUserMenu();break;case"share":if(playercontrol.$btnPartage.is('.disabled')){return false;}
sharebox.load(0,dzPlayer.getCurrentSongInfo().SNG_ID);break;}
return true;}catch(e){console.log(e.message,e.stack);}},displayQueueListDuration:function(evt,data){try{if(data.nbSong>0){var n='';var l=' - '+data.nbSong+' '+((data.nbSong>1)?trad.music.naboo_tracks:trad.music.naboo_track);if(data.duration>0)n=' - '+getTotalDuration(data.duration);$('#next-current > .nbTrack').text(l+n);}}catch(e){console.log(e.message,e.stack);}},buy:function($btn,sng_id){try{if(dzPlayer.getPlayerType()!="ads"&&!OFFLINE&&dzPlayer.getPlayerType()!="jingles"){if(typeof(STORE_PLATEFORM)!='undefined'&&typeof(STORE_PLATEFORM.DEEZER)!='undefined'&&getObjectSize(STORE_PLATEFORM)==1){if(dzPlayer.playerLoaded){if(typeof(dzPlayer.getCurrentSongInfo())!='undefined'){if(typeof(dzPlayer.getCurrentSongInfo().TYPE)=='undefined'||dzPlayer.getCurrentSongInfo().TYPE=='0'){hovercard.remove();loadFacebox('store/index.php?product_type=track&product_id='+sng_id);}}}}else{buybutton.load($btn,'bottom',0,sng_id,'display_buybutton_head');}}
return true;}catch(e){console.log(e.message,e.stack);}},displayEmptyPlayer:function(evt,arg){try{playercontrol.$labelSongTitle.text("");playercontrol.$labelArtName.text("");$("#naboo_menu_infos_cover").removeAttr("src");$("#naboo_menu_infos_cover").attr("alt","");$("#naboo_menu_infos_cover_text_track").text("");$("#naboo_menu_infos_cover_text_artist").text("");playercontrol.$bufferingBar.css("width",0);playercontrol.$progressBar.css("width",0);return true;}catch(e){console.log(e.message,e.stack);}},blindTestModeSave:{},blindTestMode:false,setBlindTestMode:function(activ,options){if(typeof(activ)!='boolean'){activ=true;}
if(activ){playercontrol.blindTestMode=true;if(typeof(options)!='object'){options={};}
options=$.extend({title:'????',artist:'????',cover:''},options);playercontrol.$labelSongTitle.text(options.title);playercontrol.$labelArtName.text(options.artist);$("#naboo_menu_infos_cover").attr('src',(options.cover===''?(SETTING_DOMAIN_IMG+'/cover//315x315-000000-80-0-0.jpg'):options.cover));$("#naboo_menu_infos_cover_text_track").text(options.title);$("#naboo_menu_infos_cover_text_artist").text(options.artist);window.document.title=options.title+" - "+options.artist;}else{playercontrol.blindTestMode=false;playercontrol.displayCurrentSong('CURRENT_SONG',dzPlayer.getCurrentSongInfo());}
return true;},displayCurrentSong:function(evt,arg){try{if(dzPlayer.getCurrentSongInfo()===null){return false;}
playercontrol.changeControlButtonStatus();Events.trigger(Events.player.onAir,{SONG_DATA:arg,CONTEXT:dzPlayer.context});if(!(typeof(STORE_PLATEFORM)!='undefined'&&getObjectSize(STORE_PLATEFORM)==1)){if(typeof(buybutton)!="undefined")buybutton.update('buy_button_player',arg.ALB_ID,arg.SNG_ID);}
if(dzPlayer.getPlayerType()!='ads'&&dzPlayer.getPlayerType()!='jingle'){var type=(typeof(arg.TYPE)!='undefined')?arg.TYPE:0;var sng_id=(type==1)?arg.UPLOAD_ID:arg.SNG_ID;favorite.display(playercontrol.$btnLoved,{type:'song',SNG_ID:sng_id,TYPE:type,KEY:sng_id+'_'+type});if(parseInt(type,10)===0){playercontrol.$btnPartage.removeClass('disabled');playercontrol.$btnBuy.removeClass('disabled');}else{playercontrol.$btnPartage.addClass('disabled');playercontrol.$btnBuy.addClass('disabled');}}
dzPlayer.artistName=arg.ART_NAME;dzPlayer.albumTitle=arg.ALB_TITLE;dzPlayer.songTitle=arg.SNG_TITLE;dzPlayer.cover=arg.ALB_PICTURE;dzPlayer.songId=arg.SNG_ID;if(!playercontrol.blindTestMode){playercontrol.$labelSongTitle.text(arg.SNG_TITLE);playercontrol.$labelArtName.text(arg.ART_NAME);window.document.title=arg.SNG_TITLE+" - "+arg.ART_NAME+((typeof(SETTING_HOST)!="undefined")?" | "+SETTING_HOST:"");if(OFFLINE){filesystem.readImage(((typeof(arg.ALB_PICTURE)=='undefined')?'':arg.ALB_PICTURE),'315x315-000000-80-0-0.jpg',$('#naboo_menu_infos_cover'));}else{$("#naboo_menu_infos_cover").attr('src',SETTING_DOMAIN_IMG+'/cover/'+((typeof(arg.ALB_PICTURE)=='undefined')?'':arg.ALB_PICTURE)+'/315x315-000000-80-0-0.jpg');}
$("#naboo_menu_infos_cover_text_track").text(arg.SNG_TITLE);$("#naboo_menu_infos_cover_text_artist").text(arg.ART_NAME);}
if(typeof(dj)!='undefined'&&typeof(dj.control)=="function")dj.control("play",[arg.SNG_ID,0]);if(dzPlayer.getPlayerType()=="smartRadio"||dzPlayer.getPlayerType()=="jingle"){Events.trigger(Events.radio.blacklistTrack,arg.SNG_ID);Events.trigger(Events.radio.changeTrack,arg.SNG_ID);}
return true;}catch(e){console.log(e.message,e.stack);}},volume:function(evt,arg){try{if(arg>1)arg=1;if(arg<0)arg=0;playercontrol.$volumeIndicator.css('width',(arg*100)+'%');playercontrol.$volumeCursor.css('left',(arg*100)+'%');playercontrol.displaySpeakerBar(arg);return true;}catch(e){console.log(e.message,e.stack);}},position:function(evt,arg){try{if(!isNaN(arg)){arg=parseInt(arg,10);if(arg===0){playercontrol.$progressBar.css("width",0);playercontrol.$timeCursor.css("left",0);}
if(arg>dzPlayer.duration){arg=0;}
playercontrol.$songPosition.text(playercontrol.secondToMinutes(arg));var currentPosition=Math.floor((playercontrol.$contentBar.width()*arg)/dzPlayer.duration);playercontrol.$progressBar.css("width",currentPosition);if(!playercontrol.isDraggingCursorTime)
playercontrol.$timeCursor.css("left",currentPosition);}else{playercontrol.$timeCursor.css("left",0);}
return true;}catch(e){console.log(e.message,e.stack);}},duration:function(evt,arg){try{if(!isNaN(arg)){playercontrol.$songDuration.text(playercontrol.secondToMinutes(arg));}
return true;}catch(e){console.log(e.message,e.stack);}},pourcentLoaded:function(evt,arg){try{if(playercontrol.lastLoadingPourcent!=arg){playercontrol.lastLoadingPourcent=arg;if(parseInt(arg,10)===0){playercontrol.$bufferingBar.stop(true).width(0);} 
else{playercontrol.$bufferingBar.stop(true).animate({"width":arg+"%"},300);}}
return true;}catch(e){console.log(e.message,e.stack);}},finish:function(evt,arg){try{playercontrol.displayNotify(null,'end');dzPlayer.nextSong(true);playercontrol.$bufferingBar.css("width",0);playercontrol.$progressBar.css("width",0);playercontrol.changeControlButtonStatus();return true;}catch(e){console.log(e.message,e.stack);}},finishAds:function(evt,arg){try{Events.trigger(Events.player.adsVastPlaying,{position:dzPlayer.getAudioAds().audio.duration});if(dzPlayer.getPlayerType()=="ads")dzPlayer.setAudioAds(null);dzPlayer.setPlayerType(dzPlayer.previousPlayerType);dzPlayer.nextSong(true);playercontrol.$bufferingBar.css("width",0);playercontrol.$progressBar.css("width",0);playercontrol.changeControlButtonStatus();setTimeout(disableAudioAds,10000);return true;}catch(e){console.log(e.message,e.stack);}},finishJingle:function(evt,arg){try{dzPlayer.setPlayerType(dzPlayer.previousPlayerType);dzPlayer.nextSong(true);playercontrol.$bufferingBar.css("width",0);playercontrol.$progressBar.css("width",0);playercontrol.changeControlButtonStatus();return true;}catch(e){console.log(e.message,e.stack);}},fadeOutProgress:function(evt,arg){try{if(arg){dzPlayer.nextSong(true);playercontrol.$bufferingBar.css("width",0);playercontrol.$progressBar.css("width",0);playercontrol.changeControlButtonStatus();}
return true;}catch(e){console.log(e.message,e.stack);}},loading:function(evt,arg){try{if(arg&&parseInt(dzPlayer.pourcentLoaded,10)===0){dzPlayer.isFirstReadTrack=false;startAudioAdsTimer();playercontrol.$bufferingBar.css("width",0);playercontrol.$progressBar.css("width",0);playercontrol.$timeCursor.css("left",0);playercontrol.$songPosition.text("--:--");if(dzPlayer.version==1){playercontrol.$songDuration.text("--:--");}}
return true;}catch(e){console.log(e.message,e.stack);}},changePlayerType:function(evt,arg){try{playercontrol.$btnPlay.removeClass('disabled');playercontrol.$btnPause.removeClass('disabled');playercontrol.$btnNext.removeClass('disabled');playercontrol.$btnPrevious.removeClass('disabled');playercontrol.$btnMute.removeClass('disabled');playercontrol.$btnBuy.removeClass('disabled');playercontrol.$btnPartage.removeClass('disabled');playercontrol.$btnAdd.removeClass('disabled');playercontrol.$btnQueue.removeClass('disabled');playercontrol.$btnRepeat.removeClass('disabled');playercontrol.$btnRandom.removeClass('disabled');playercontrol.$btnOptionPlayer.removeClass('disabled');playercontrol.$btnLoved.removeClass('disabled');if(playercontrol.previousMode=="follower"&&arg!="follower"){dj.unFollow();}
switch(arg){case"mod":playercontrol.$timeCursor.draggable('option','disabled',false);playercontrol.$btnQueue.removeClass('disabled');playercontrol.smartRadioStopCounter();break;case"smartRadio":playercontrol.$timeCursor.draggable('option','disabled',true);playercontrol.$btnQueue.addClass('disabled');playercontrol.$btnRepeat.addClass('disabled');playercontrol.$btnRandom.addClass('disabled');playercontrol.smartRadioStartCounter();playercontrol.displayRepeatStatus();break;case"radio":console.log('changePlayerType("radio") : call deprecated');break;case"follower":playercontrol.$timeCursor.draggable('option','disabled',true);playercontrol.$btnQueue.addClass('disabled');playercontrol.$btnRepeat.addClass('disabled');playercontrol.$btnRandom.addClass('disabled');playercontrol.smartRadioStopCounter();playercontrol.displayRepeatStatus();break;case"ads":playercontrol.$timeCursor.draggable('option','disabled',true);playercontrol.closeQueueList();startDisplayAudioAds();playercontrol.$btnQueue.addClass('disabled');playercontrol.$btnRepeat.addClass('disabled');playercontrol.$btnRandom.addClass('disabled');playercontrol.$btnOptionPlayer.addClass('disabled');playercontrol.$btnMute.addClass('disabled');playercontrol.$btnPlay.addClass('disabled');playercontrol.$btnPause.addClass('disabled');playercontrol.$btnNext.addClass('disabled');playercontrol.$btnPrevious.addClass('disabled');playercontrol.$btnBuy.addClass('disabled');playercontrol.$btnPartage.addClass('disabled');playercontrol.$btnAdd.addClass('disabled');playercontrol.$btnLoved.addClass('disabled').attr('onClick','').removeClass('selected');playercontrol.$labelSongTitle.text(trad.player.pub);if(dzPlayer.getAudioAds().textlink.text!==''){playercontrol.$labelArtName.text(dzPlayer.getAudioAds().textlink.text);}else{playercontrol.$labelArtName.text("");}
break;case"jingle":playercontrol.$timeCursor.draggable('option','disabled',true);playercontrol.closeQueueList();playercontrol.$btnQueue.addClass('disabled');playercontrol.$btnRepeat.addClass('disabled');playercontrol.$btnRandom.addClass('disabled');playercontrol.$btnOptionPlayer.addClass('disabled');playercontrol.$btnMute.addClass('disabled');playercontrol.$btnPlay.addClass('disabled');playercontrol.$btnPause.addClass('disabled');playercontrol.$btnBuy.addClass('disabled');playercontrol.$btnPartage.addClass('disabled');playercontrol.$btnAdd.addClass('disabled');playercontrol.$labelArtName.text("");playercontrol.$labelSongTitle.text("");break;}
playercontrol.changeControlButtonStatus();playercontrol.previousMode=arg;return true;}catch(e){console.log(e.message,e.stack);}},displayHqStatus:function(evt,arg){try{if(arg){$("#btnHq").addClass("selected");}else{$("#btnHq").removeClass("selected");}
return true;}catch(e){console.log(e.message,e.stack);}},log_offline:function(evt,arg){try{dzoffline.saveLog(arg);return true;}catch(e){console.log(e.message,e.stack);}},refreshSoundBar:function(){try{if(dzPlayer.isMuted()){playercontrol.$btnMute.removeClass('h_icn_volume_100').addClass('h_icn_volume_0');playercontrol.$volumeCursor.css('left','0');playercontrol.$volumeIndicator.css('width','0');}else{playercontrol.$btnMute.removeClass('h_icn_volume_0').addClass('h_icn_volume_100');playercontrol.volume(null,dzPlayer.volume);}
playercontrol.displaySpeakerBar((dzPlayer.isMuted())?0:dzPlayer.getVolume());}catch(e){console.log(e.message,e.stack);}},secondToMinutes:function(p_second){try{p_second=Math.floor(p_second);var nbMinutes=Math.floor(p_second/60);var nbSeconds=p_second-(nbMinutes*60);return((nbMinutes<10)?"0"+nbMinutes:nbMinutes)+":"+((nbSeconds<10)?"0"+nbSeconds:nbSeconds);}catch(e){console.log(e.message,e.stack);}},displaySpeakerBar:function(volume){try{if(volume===0){playercontrol.$IcnVolumeMute.show();playercontrol.$IcnVolume0.css('opacity',0);playercontrol.$IcnVolume50.css('opacity',0);playercontrol.$IcnVolume100.css('opacity',0);}else if(volume<=0.5){playercontrol.$IcnVolumeMute.hide();playercontrol.$IcnVolume0.css('opacity',1);playercontrol.$IcnVolume50.css('opacity',volume);playercontrol.$IcnVolume100.css('opacity',0);}else{playercontrol.$IcnVolumeMute.hide();playercontrol.$IcnVolume0.css('opacity',1);playercontrol.$IcnVolume50.css('opacity',1);playercontrol.$IcnVolume100.css('opacity',volume);}
return true;}catch(e){console.log(e.message,e.stack);}},changeTrackOrder:function(order){try{if(typeof(order)=='undefined'){order=[];playercontrol.$contentListQueue.children().each(function(index){order.push($(this).attr("value"));$(this).children('.current-number').children('.numberSong').text(index+1);$(this).removeClass('grey').removeClass('black').addClass((index%2)?'black':'grey');});}
if(order.join()!=this.currentQueueOrder.join()){dzPlayer.orderTracks(order);this.currentQueueOrder=order;}
Events.trigger(Events.player.order_changed);return true;}catch(e){console.log(e.message,e.stack);}},changeControlButtonStatus:function(){try{if(dzPlayer.getNumSong()>-1&&dzPlayer.getNbSongs()>-1){if(dzPlayer.isPlaying()){playercontrol.$btnPause.show();playercontrol.$btnPlay.hide();}else if(dzPlayer.isPaused()){playercontrol.$btnPlay.show();playercontrol.$btnPause.hide();}else if(!dzPlayer.isPlaying()&&!dzPlayer.isPaused()){playercontrol.$btnPlay.show();playercontrol.$btnPause.hide();}
var bPrev=playercontrol.prevButtonActive();var bNext=playercontrol.nextButtonActive();if(bNext)playercontrol.$btnNext.removeClass('disabled');else playercontrol.$btnNext.addClass('disabled');if(bPrev)playercontrol.$btnPrevious.removeClass('disabled');else playercontrol.$btnPrevious.addClass('disabled');}else{setTimeout(playercontrol.changeControlButtonStatus,playercontrol.RETRY_DELAI);}}catch(e){console.log(e.message,e.stack);}},prevButtonActive:function(){try{return dzPlayer.getPlayerType()=="mod"&&(dzPlayer.getNumSong()>0||dzPlayer.getRepeat()>0);}catch(e){console.log(e.message,e.stack);}},nextButtonActive:function(){try{return(dzPlayer.getPlayerType()=="mod"||(dzPlayer.getPlayerType()=="smartRadio"&&!this.smartRadioIsLockedSkip(true)))&&(!dzPlayer.isLastSong()||dzPlayer.getRepeat()>0);}catch(e){console.log(e.message,e.stack);}},displayRepeatStatus:function(){try{if(dzPlayer.getRepeat()==1)playercontrol.$btnRepeat.addClass("selected");else if(dzPlayer.getRepeat()==2)playercontrol.$btnRepeat.removeClass('option-repeat').addClass("option-repeat-one selected");else{playercontrol.$btnRepeat.removeClass("option-repeat-one selected").addClass('option-repeat');}
playercontrol.changeControlButtonStatus();}catch(e){console.log(e.message,e.stack);}},displayShuffleStatus:function(){try{if(dzPlayer.isShuffle())playercontrol.$btnRandom.addClass("selected");else playercontrol.$btnRandom.removeClass("selected");}catch(e){console.log(e.message,e.stack);}},displayCurrentListen:function(){try{playercontrol.$contextQueue.hide();}catch(e){console.log(e.message,e.stack);}},smartRadioIsLockedSkip:function(nextAction){try{Events.trigger(Events.radio.skipButtonStatus,(playercontrol.smartRadioSkipCount>=playercontrol.smartRadioSkipTotal)?false:true);if(nextAction){return(playercontrol.smartRadioSkipCount>=playercontrol.smartRadioSkipTotal);}else{return(playercontrol.smartRadioSkipCount>playercontrol.smartRadioSkipTotal);}}catch(e){console.log(e.message,e.stack);}},smartRadioStartCounter:function(){try{if(dzPlayer.getPlayerType()=="smartRadio"&&this.smartRadioIntervalId===0)
this.smartRadioIntervalId=window.setTimeout(playercontrol.smartRadioStopCounter,this.smartRadioCounter);}catch(e){console.log(e.message,e.stack);}},smartRadioStopCounter:function(){try{if(playercontrol.smartRadioIntervalId>0){playercontrol.smartRadioSkipCount=0;window.clearTimeout(playercontrol.smartRadioIntervalId);playercontrol.smartRadioIntervalId=0;playercontrol.changeControlButtonStatus();Events.trigger(Events.radio.skipButtonStatus,true);if(dzPlayer.getPlayerType()=="smartRadio")playercontrol.smartRadioStartCounter();}}catch(e){console.log(e.message,e.stack);}},getSongData:function(request,callbackParameters){try{if(request.error.length===0){if(right.checkSongAvailable(request.results)==right.READABLE){executeActionscriptMethod("mixPlayerSWF","deezerDJ_playTrack",[request.results,callbackParameters.chan]);}}}catch(e){console.log(e.message,e.stack);}},getMixStatus:function(){try{return this.mix;}catch(e){console.log(e.message,e.stack);}},clickBody:function(){try{playercontrol.closeQueueList();$('body').unbind("mousedown",playercontrol.clickBody);}catch(e){console.log(e.message,e.stack);}},closeQueueList:function(){try{if(playercontrol.$listQueue.is('.open')){playercontrol.doAction('toggleQueueList');}}catch(e){console.log(e.message,e.stack);}},clickBox:function(){if(musicbox.loaded){musicbox.close();}
return false;},displayNotify:function(evt,type){try{if(typeof(USER)=='undefined'||dzPlayer.getPlayerType()!="mod"){return false;}
if(www.getCurrentPageType()=='landing'){return false;}
if(type=='start'){if(BrowserDetect.windows_version=='8'){}
if(USER.USER_ID===0){notificationBar.display('no_log',{origin:19});}
if(USER.USER_ID>0&&!DZPS){var available_tb=(USER.TRY_AND_BUY.DATE_END=="0000-00-00 00:00:00");if(USER.OPTIONS.web_streaming===false){if(available_tb){notificationBar.display('limit30sec_with_tb',{origin:43});}else{notificationBar.display('limit30sec_used_tb',{origin:44});}}
if(dzPlayer.isLimited()){notificationBar.display('discovery_limited',{origin:31,replaceText:(restrict.object.results.time_left+restrict.object.results.time_spend)/3600});if(dzPlayer.isFacebookTrack){Events.trigger(Events.player.facebook,{action:'error',value:{songId:dzPlayer.getCurrentSongInfo().SNG_ID,fbErrorCode:2}});}}
if(restrict.object.results.time_left<3600&&restrict.object.results.time_left>0&&!available_tb){notificationBar.display('discovery_used_tb',{origin:42});}
if(!restrict.object.results.discovery&&available_tb){notificationBar.display('discovery_with_tb',{origin:30});}}
if(USER.OPTIONS.web_streaming===false&&USER.OPTIONS.mobile_streaming===true){notificationBar.display('mobile_only',{origin:45});}}
if(type=='end'){if(USER.USER_ID===0){if(USER.OPTIONS.web_streaming===true){if(dzPlayer.isLimited()&&$('#facebox:visible').length===0){modal.open('/'+SETTING_LANG+'/register.php');}}else if($('#facebox:visible').length===0){modal.open('/'+SETTING_LANG+'/register.php');}}
if(USER.USER_ID>0&&!DZPS){if(USER.OPTIONS.web_streaming===true){if(dzPlayer.isLimited()){if(!(typeof(COBRANDING)!='undefined'&&COBRANDING=='orange')){modal.open('lightbox/restriction.php?id=2&message=push_subscribe&origin=6');}}}else{if(!(typeof(COBRANDING)!='undefined'&&COBRANDING=='orange')){modal.open('lightbox/restriction.php?id=2&message=push_subscribe&origin=6');}}}
if(USER.USER_ID>0&&DZPS){if(USER.OPTIONS.web_streaming===false&&USER.OPTIONS.mobile_streaming===true){}}}}catch(e){console.log(e.message,e.stack);}},checkLimit5:function(evt,arg){try{if(typeof(USER)=='undefined'){return false;}
if(!dzPlayer.isLimited()){if(typeof(arg)=='undefined'){add=false;}else{add=arg.value;}
var restriction=restrict.restrict5counter(add);dzPlayer.setForbiddenListen(!restriction.canplay);if(!restriction.canplay&&USER.OPTIONS.web_streaming===true){if(restriction.display=='lightbox'){}}}}catch(e){console.log(e.message,e.stack);}},userLogout:function(evt){try{dzPlayer.setHq(false);if(playercontrol.mix){playercontrol.doAction("closeMix");}
dzPlayer.setForbiddenListen(false);playercontrol.checkLimit5(false);dzPlayer.isFirstReadTrack=true;}catch(e){console.log(e.message,e.stack);}}};;
if(typeof deconcept=="undefined"){var deconcept=new Object();}if(typeof deconcept.util=="undefined"){deconcept.util=new Object();}if(typeof deconcept.SWFObjectUtil=="undefined"){deconcept.SWFObjectUtil=new Object();}deconcept.SWFObject=function(_1,id,w,h,_5,c,_7,_8,_9,_a){if(!document.getElementById){return;}this.DETECT_KEY=_a?_a:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object();this.variables=new Object();this.attributes=new Array();if(_1){this.setAttribute("swf",_1);}if(id){this.setAttribute("id",id);}if(w){this.setAttribute("width",w);}if(h){this.setAttribute("height",h);}if(_5){this.setAttribute("version",new deconcept.PlayerVersion(_5.toString().split(".")));}this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObject.doPrepUnload=true;}if(c){this.addParam("bgcolor",c);}var q=_7?_7:"high";this.addParam("quality",q);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var _c=(_8)?_8:window.location;this.setAttribute("xiRedirectUrl",_c);this.setAttribute("redirectUrl","");if(_9){this.setAttribute("redirectUrl",_9);}};deconcept.SWFObject.prototype={useExpressInstall:function(_d){this.xiSWFPath=!_d?"expressinstall.swf":_d;this.setAttribute("useExpressInstall",true);},setAttribute:function(_e,_f){this.attributes[_e]=_f;},getAttribute:function(_10){return this.attributes[_10];},addParam:function(_11,_12){this.params[_11]=_12;},getParams:function(){return this.params;},addVariable:function(_13,_14){this.variables[_13]=_14;},getVariable:function(_15){return this.variables[_15];},getVariables:function(){return this.variables;},getVariablePairs:function(){var _16=new Array();var key;var _18=this.getVariables();for(key in _18){_16[_16.length]=key+"="+_18[key];}return _16;},getSWFHTML:function(){var _19="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath);}_19="<embed type=\"application/x-shockwave-flash\" src=\""+this.getAttribute("swf")+"\" width=\""+this.getAttribute("width")+"\" height=\""+this.getAttribute("height")+"\" style=\""+this.getAttribute("style")+"\"";_19+=" id=\""+this.getAttribute("id")+"\" name=\""+this.getAttribute("id")+"\" ";var _1a=this.getParams();for(var key in _1a){_19+=[key]+"=\""+_1a[key]+"\" ";}var _1c=this.getVariablePairs().join("&");if(_1c.length>0){_19+="flashvars=\""+_1c+"\"";}_19+="/>";}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath);}_19="<object id=\""+this.getAttribute("id")+"\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" width=\""+this.getAttribute("width")+"\" height=\""+this.getAttribute("height")+"\" style=\""+this.getAttribute("style")+"\">";_19+="<param name=\"movie\" value=\""+this.getAttribute("swf")+"\" />";var _1d=this.getParams();for(var key in _1d){_19+="<param name=\""+key+"\" value=\""+_1d[key]+"\" />";}var _1f=this.getVariablePairs().join("&");if(_1f.length>0){_19+="<param name=\"flashvars\" value=\""+_1f+"\" />";}_19+="</object>";}return _19;},write:function(_20){if(this.getAttribute("useExpressInstall")){var _21=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(_21)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var n=(typeof _20=="string")?document.getElementById(_20):_20;n.innerHTML=this.getSWFHTML();return true;}else{if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"));}}return false;}};deconcept.SWFObjectUtil.getPlayerVersion=function(){var _23=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description){_23=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."));}}else{if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var _26=3;while(axo){try{_26++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+_26);_23=new deconcept.PlayerVersion([_26,0,0]);}catch(e){axo=null;}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");_23=new deconcept.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always";}catch(e){if(_23.major==6){return _23;}}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(e){}}if(axo!=null){_23=new deconcept.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","));}}}return _23;};deconcept.PlayerVersion=function(_29){this.major=_29[0]!=null?parseInt(_29[0]):0;this.minor=_29[1]!=null?parseInt(_29[1]):0;this.rev=_29[2]!=null?parseInt(_29[2]):0;};deconcept.PlayerVersion.prototype.versionIsValid=function(fv){if(this.major<fv.major){return false;}if(this.major>fv.major){return true;}if(this.minor<fv.minor){return false;}if(this.minor>fv.minor){return true;}if(this.rev<fv.rev){return false;}return true;};deconcept.util={getRequestParameter:function(_2b){var q=document.location.search||document.location.hash;if(_2b==null){return q;}if(q){var _2d=q.substring(1).split("&");for(var i=0;i<_2d.length;i++){if(_2d[i].substring(0,_2d[i].indexOf("="))==_2b){return _2d[i].substring((_2d[i].indexOf("=")+1));}}}return"";}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var _2f=document.getElementsByTagName("OBJECT");for(var i=_2f.length-1;i>=0;i--){_2f[i].style.display="none";for(var x in _2f[i]){if(typeof _2f[i][x]=="function"){_2f[i][x]=function(){};}}}};if(deconcept.SWFObject.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true;}}if(!document.getElementById&&document.all){document.getElementById=function(id){return document.all[id];};}var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;var SWFObject=deconcept.SWFObject;;
(function($){function fixTitle($ele){if($ele.attr('title')||typeof($ele.attr('original-title'))!='string'){$ele.attr('original-title',$ele.attr('title')||'').removeAttr('title');}}
function Tipsy(element,options){this.$element=$(element);this.options=options;this.enabled=true;fixTitle(this.$element);}
Tipsy.prototype={show:function(){var title=this.getTitle();if(title&&this.enabled){var $tip=this.tip();$tip.find('.tipsy-inner')[this.options.html?'html':'text'](title);$tip[0].className='tipsy';$tip.remove().css({top:0,left:0,visibility:'hidden',display:'block'}).appendTo(document.body);var pos=$.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});var actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight;var gravity=(typeof this.options.gravity=='function')?this.options.gravity.call(this.$element[0]):this.options.gravity;var tp;switch(gravity.charAt(0)){case'n':tp={top:pos.top+pos.height+this.options.offset+this.options.space,left:pos.left+pos.width/2-actualWidth/2};break;case's':tp={top:pos.top-actualHeight-this.options.offset-this.options.space,left:pos.left+pos.width/2-actualWidth/2};break;case'e':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth-this.options.offset-this.options.space};break;case'w':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width+this.options.offset+this.options.space};break;}
if(gravity.length==2){if(gravity.charAt(1)=='w'){tp.left=pos.left+pos.width/2-15;}else{tp.left=pos.left+pos.width/2-actualWidth+15;}}
if(this.options.force_top){$tip.css(tp).addClass('tipsy-ontop');}
$tip.css(tp).addClass('tipsy-'+gravity);if(this.options.fade){$tip.stop().css({opacity:0,display:'block',visibility:'visible'}).animate({opacity:this.options.opacity});}else{$tip.css({visibility:'visible',opacity:this.options.opacity});}}},hide:function(){if(this.options.fade){this.tip().stop().fadeOut(function(){$(this).remove();});}else{this.tip().remove();}},getTitle:function(){var title,$e=this.$element,o=this.options;fixTitle($e);var title,o=this.options;if(typeof o.title=='string'){title=$e.attr(o.title=='title'?'original-title':o.title);}else if(typeof o.title=='function'){title=o.title.call($e[0]);}
title=(''+title).replace(/(^\s*|\s*$)/,"");return title||o.fallback;},tip:function(){if(!this.$tip){this.$tip=$('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"/></div>');}
return this.$tip;},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null;}},enable:function(){this.enabled=true;},disable:function(){this.enabled=false;},toggleEnabled:function(){this.enabled=!this.enabled;}};$.fn.tipsy=function(options){if(options===true){return this.data('tipsy');}else if(typeof options=='string'){return this.data('tipsy')[options]();}
options=$.extend({},$.fn.tipsy.defaults,options);function get(ele){var tipsy=$.data(ele,'tipsy');if(!tipsy){tipsy=new Tipsy(ele,$.fn.tipsy.elementOptions(ele,options));$.data(ele,'tipsy',tipsy);}
return tipsy;}
function enter(){var tipsy=get(this);tipsy.hoverState='in';if(options.delayIn==0){tipsy.show();}else{setTimeout(function(){if(tipsy.hoverState=='in')tipsy.show();},options.delayIn);}};function leave(){var tipsy=get(this);tipsy.hoverState='out';if(options.delayOut==0){tipsy.hide();}else{setTimeout(function(){if(tipsy.hoverState=='out')tipsy.hide();},options.delayOut);}};if(!options.live)this.each(function(){get(this);});if(options.trigger!='manual'){var binder=options.live?'live':'bind',eventIn=options.trigger=='hover'?'mouseenter':'focus',eventOut=options.trigger=='hover'?'mouseleave':'blur';this[binder](eventIn,enter)[binder](eventOut,leave);}
return this;};$.fn.tipsy.defaults={delayIn:400,delayOut:200,fade:false,fallback:'',gravity:'n',html:false,live:false,offset:0,opacity:1,title:'title',trigger:'hover',space:0,force_top:false};$.fn.tipsy.elementOptions=function(ele,options){return $.metadata?$.extend({},options,$(ele).metadata()):options;};$.fn.tipsy.autoNS=function(){return $(this).offset().top>($(document).scrollTop()+$(window).height()/2)?'s':'n';};$.fn.tipsy.autoWE=function(){return $(this).offset().left>($(document).scrollLeft()+$(window).width()/2)?'e':'w';};})(jQuery);;
var buybutton={loaded:false,previousParent:undefined,yPositionLocked:70,load:function(div,position,alb_id,sng_id,skin,parent){if(OFFLINE)return false;if(position==null){position='left';}
$("#hovercard").remove();hovercard.template=false;div_offset=div.offset();div_width=div.width();var box_height=50;var t=0;if(position=='left'){var l=div_offset.left+div_width+10;if(div_offset.top<(box_height/2)){t=20;}else{t=div_offset.top-(box_height/2);}}else if(position=='bottom'){var l=div_offset.left-(95*2);t=div_offset.top+26;}
if(buybutton.previousParent!=parent){$("#buybutton").remove();buybutton.loaded=false;}
buybutton.loaded=false;if(!buybutton.loaded){if($('#buybutton').length==1){$('#buybutton').css("top",box_height);}else{if(parent==undefined){$("body").append('<div id="buybutton" style="position: absolute; z-index: 9999;"></div>');}else{$("#"+parent).append('<div id="buybutton" style="position: absolute; z-index: 9999;"></div>');}
buybutton.previousParent=parent;}
$('#buybutton').load('/'+SETTING_LANG+'/music/buy?a='+alb_id+'&s='+sng_id+'&skin='+skin,function(){buybutton.setArrowPosition(position,(div_offset.top-t));$('body').bind("mouseup",buybutton.clickBody);});}
$('#buybutton').bind("mouseup",buybutton.clickBox);if(parent==undefined){$('#buybutton').css({'top':t+'px',"left":l});}else{$('#buybutton').css({'top':buybutton.yPositionLocked+'px',"left":l});}
return false;},setArrowPosition:function(position,top,left){$("#buybutton").show();var musicbox_arrow=$('#musicbox_arrow');if(position=='left'){musicbox_arrow.css('top',top+'px');musicbox_arrow.css('left','-7px');musicbox_arrow.removeClass('t_arrow');musicbox_arrow.addClass('l_arrow');}else{musicbox_arrow.css('top',(top+14)+'px');musicbox_arrow.css('left','109px');musicbox_arrow.removeClass('l_arrow');musicbox_arrow.addClass('t_arrow');}
if(position=="left"){$("#addCurrentList").show();}else{$("#addCurrentList").hide();}},close:function(){buybutton.closeCreate();$("#buybutton").remove();buybutton.loaded=false;},clickBox:function(){return false;},clickBody:function(){buybutton.close();hovercard.loading=false;$('body').die("mouseup",buybutton.clickBody)},openCreate:function(){$('#create_button').hide();$('#create_bloc').show();},closeCreate:function(){$('#create_button').show();$('#create_bloc').hide();},create:function(div,text,alb_id,sng_id,skin){try{if(typeof(alb_id)=='undefined'){alb_id=0;}
if(typeof(sng_id)=='undefined'){sng_id=0;}
$('#'+div).html('<a href="javascript:void(0)" id="buy_button_link_'+div+'" data-skin="'+skin+'" onclick="buybutton.load($(this), \'bottom\', '+alb_id+', '+sng_id+', \''+skin+'\'); return false;">'+text+'</a>');}catch(e){console.log(e);}},update:function(div,alb_id,sng_id,skin){try{if(typeof(alb_id)=='undefined'){alb_id=0;}
if(typeof(sng_id)=='undefined'){sng_id=0;}
if(document.getElementById('buy_button_link_'+div)!=null){skin_value='display_buybutton_top';skin_value=$('#buy_button_link_'+div).attr('data-skin');document.getElementById('buy_button_link_'+div).onclick=function(){buybutton.load($(this),'bottom',alb_id,sng_id,skin_value);return false;}}}catch(e){console.log(e);}},getPrices:function(alb_id,sng_id,playlist_id,providers){try{if(typeof(alb_id)=='undefined'){alb_id=0;}
if(typeof(sng_id)=='undefined'){sng_id=0;}
if(typeof(playlist_id)=='undefined'){playlist_id=0;}
request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=buybutton_getPrices&alb_id='+alb_id+'&sng_id='+sng_id+'&playlist_id='+playlist_id+'&providers='+providers,true,buybutton.getPricesCallback);}catch(e){console.log(e);}},getPricesCallback:function(request){try{if(typeof request.responseText!='undefined'){request=request.responseText;}else{return false;}
if(request=='error'){request=new Array;request['amazon_fr']='N/A';request['amazon_us']='N/A';request['amazon_uk']='N/A';request['amazon_de']='N/A';request['itunes']='N/A';}else{request=eval('('+request+')');}
if(request['amazon_fr']!=null){if(request['amazon_fr']=='N/A'){$('#buy_button_price_amazon_fr').text('N/A');}else{$('#buy_button_price_amazon_fr').text(request['amazon_fr']+' €');}}
if(request['amazon_uk']!=null){$('#buy_button_price_amazon_uk').text(request['amazon_uk']);}
if(request['amazon_de']!=null){if(request['amazon_de']=='N/A'){$('#buy_button_price_amazon_de').text('N/A');}else{$('#buy_button_price_amazon_de').text(request['amazon_de']+' €');}}
if(request['amazon_us']!=null){$('#buy_button_price_amazon_us').text(request['amazon_us']);}
if(request['itunes']!=null){$('#buy_button_price_itunes').text(request['itunes']);}
if(request['deezer']!=null){$('#buy_button_price_deezer').text(request['deezer']+' €');if(request['deezer']==0){$('#buybutton .li_buy_deezer').hide();$('#hovercard').hide();}}}catch(e){console.log(e.message,e.stack);}},displayBuyAlbum:function(alb_id){try{if(typeof(alb_id)=='undefined'){alb_id=0;}
$('#buy_button_album').show();buybutton.create('buy_button_album','<span class="float:left;">'+trad.general.buy_button_album+'</span><span class="min_arrow main" style="float:right;"></span>',alb_id,0,'display_buybutton_top')}catch(e){console.log(e);}},removeBuyAlbum:function(){try{if(document.getElementById('buy_button_album')!=null){$('#buy_button_album').hide();$('#buy_button_album').text('');}}catch(e){console.log(e);}}};
var dzPlayer=deezerAudioJSPlayer={version:1,minimumFlashVersion:10.0,recommendedFlashVersion:10.1,volume:0.5,cover:"",songId:0,muted:false,paused:false,playing:false,loading:false,lastPosition:0,position:0,duration:0,fade:0,repeat:0,shuffle:false,pourcentLoaded:0,currentSongInfo:[],nextSongInfo:[],playerType:"mod",previousPlayerType:"mod",currentRadioInfo:[],currentSmartRadioInfo:[],currentFollowerInfo:[],fadeOutProgress:false,fadeInProgress:false,hq:false,numSong:-1,nbSongs:-1,adsLink:{},playerLoaded:false,audioAds:null,previousSkipAction:'',autoSkippedTrack:0,appId:0,appType:'',lastAlternativeAlbum:{},lastAlternativeSong:{},artistName:"",albumTitle:"",songTitle:"",trackList:[],trackListOriginal:[],trackListIndex:0,context:'',isFacebookTrack:false,isFirstReadTrack:true,logTrackTemplate:{sng_id:0,type:0,stat:{seek:0,pause:0},lt:0,ctxt:{},dev:{v:STATIC_VERSION,t:0}},logTrack:{},user_status:{},_play:function(autoPlay,naturalEnd){try{if(typeof(this.getCurrentSongInfo())=='undefined'||this.getCurrentSongInfo()==null)return false;if(this.getAudioAds()!=null&&this.isAudioAdsPage()&&this.getPlayerType()!="ads"&&!DZPS){this.trackListIndex--;this._playAudioAds();return false;}
if(this.getCurrentSongInfo().TYPE=='JINGLE'){this._playAudioJingle();return false;}
if(this.getNbSongs()==0)return false;if(typeof(autoPlay)=='undefined')autoPlay=true;if(typeof(naturalEnd)=='undefined')naturalEnd=false;if(this.getPlayerType()=="ads"&&this.getPlayerType()=="jingle")return false;this.autoSkippedTrack=0;this.trackList[this.trackListIndex].LOCAL_AVAILABLE=false;if(dzoffline.AVAILABLE&&countObject(dzoffline.listSync)>0){this.trackList[this.trackListIndex].LOCAL_AVAILABLE=(dzoffline.songExist(this.getCurrentSongInfo().SNG_ID).STATUS);}
if(autoPlay){dzPlayer.logManager();var withFade=(naturalEnd&&this.fade>0&&dzPlayer.version=='2');if(withFade){this.trigger("audioPlayer_appendTracks",[[dzPlayer.getCurrentSongInfo()],0,autoPlay]);}else{this.trigger("audioPlayer_playTracks",[[dzPlayer.getCurrentSongInfo()],0,autoPlay]);}
Events.trigger(Events.player.notify,'start');Events.trigger(Events.player.play,{value:this.getCurrentSongInfo()});if(dzPlayer.version==2){dzPlayer.duration=(dzPlayer.isLimited())?30:dzPlayer.getCurrentSongInfo().DURATION;Events.trigger(Events.player.duration,dzPlayer.duration);}}else{this.trigger("audioPlayer_stop",[]);if(dzPlayer.version==1){this.trigger("audioPlayer_playTracks",[[],0,autoPlay]);Events.trigger(Events.player.pourcentLoaded,0);}}
delete this.trackList[this.trackListIndex].OFFSET;Events.trigger(Events.player.displayCurrentSong,this.getCurrentSongInfo());Events.trigger(Events.player.displayNextSong,this.getNextSongInfo());}catch(e){console.log(e.message,e.stack);}},_playAudioJingle:function(){try{this.previousPlayerType=this.getPlayerType();this.trigger("setAudioJingle",[{audio:{url:SETTING_STATIC+'/'+this.getCurrentSongInfo().URL,duration:this.getCurrentSongInfo().DURATION},format:{formatType:'',formatType:''},content:{urlContent:''},tracking:{clickCommand:'',clickTagMethod:'',pixelAgence:''},textlink:{text:''}}]);Events.trigger(Events.player.displayCurrentSong,this.getCurrentSongInfo());this.setPlayerType("jingle");}catch(e){console.log(e.message,e.stack);}},_playAudioAds:function(){try{if(this.isAudioAdsPage()){this.previousPlayerType=this.getPlayerType();this.trigger("setAudioAds",[this.getAudioAds()]);this.setPlayerType("ads");}else{this._play(true);}}catch(e){console.log(e.message,e.stack);}},initSoPlayer:function(div_id){try{var currentFlashVersion=parseInt(deconcept.SWFObjectUtil.getPlayerVersion().major+"."+deconcept.SWFObjectUtil.getPlayerVersion().minor);if(currentFlashVersion==0||currentFlashVersion<this.minimumFlashVersion){return false;}
if(currentFlashVersion>=this.recommendedFlashVersion){dzPlayer.version=2;var soPlayer=new SWFObject(SETTING_STATIC+'/swf/coreplayer2-v'+STATIC_VERSION+'.swf',"audioPlayerSWF","1","1",this.recommendedFlashVersion.toString(),"#3a3a3a");soPlayer.addVariable("offline",OFFLINE);soPlayer.addVariable("playerURL",SETTING_STATIC+'/swf/coreplayer2-v'+STATIC_VERSION+'.swf');soPlayer.addVariable("token",PLAYER_TOKEN);soPlayer.addVariable("sound_stream_gateway",SOUND_STREAM_GATEWAY);soPlayer.addVariable("sound_preview_gateway",SOUND_PREVIEW_GATEWAY);soPlayer.addVariable("sound_proxies_versions",SOUND_PROXIES_VERSIONS);soPlayer.addVariable("sound_proxies_cdn",SOUND_PROXIES_CDN);soPlayer.addVariable("sound_always_cdn_for_premium",SOUND_ALWAYS_CDN_FOR_PREMIUM);}else{dzPlayer.version=1;var soPlayer=new SWFObject(SETTING_STATIC+'/swf/coreplayer-v'+STATIC_VERSION+'.swf',"audioPlayerSWF","24","24",this.minimumFlashVersion.toString(),"#000000",this.minimumFlashVersion.toString());soPlayer.addVariable("configXML",SETTING_HOST_SITE+'/'+SETTING_LANG+'/xml/config-v'+STATIC_VERSION+'.php');soPlayer.addVariable("sessionId",SESSION_ID);soPlayer.addVariable("currentDate",CURRENT_DATE);soPlayer.addVariable("userId",USER.USER_ID);soPlayer.addVariable("random_key",RANDOM_KEY);soPlayer.addVariable("offline",OFFLINE);soPlayer.addParam("allowFullscreen","true");}
soPlayer.addVariable("server_timestamp",SERVER_TIMESTAMP);soPlayer.addParam("wmode","transparent");soPlayer.addParam("allowScriptAccess","always");soPlayer.addParam("menu","false");soPlayer.addParam("hasPriority","true");soPlayer.write(div_id);return true;}catch(e){console.log(e.message,e.stack);}},initSoMixage:function(div_id){try{var soMixage=new SWFObject(SETTING_STATIC+'/swf/deezerDJ-v'+STATIC_VERSION+'.swf',"mixPlayerSWF","990","180","10.0.12.36","#000000");soMixage.addVariable("configXML",SETTING_HOST_SITE+'/'+SETTING_LANG+'/xml/config-v'+STATIC_VERSION+'.php');soMixage.addVariable("sessionId",SESSION_ID);soMixage.addVariable("currentDate",CURRENT_DATE);soMixage.addVariable("userId",USER.USER_ID);soMixage.addVariable("random_key",RANDOM_KEY);soMixage.addVariable("server_timestamp",SERVER_TIMESTAMP);soMixage.addVariable("mixage_close",trad.mixage.close);soMixage.addVariable("mixage_drag",trad.mixage.drag);soMixage.addVariable("mixage_hi",trad.mixage.hi);soMixage.addVariable("mixage_med",trad.mixage.med);soMixage.addVariable("mixage_low",trad.mixage.low);soMixage.addParam("allowScriptAccess","always");soMixage.addParam("wmode","transparent");soMixage.addParam("menu","false");soMixage.write(div_id);}catch(e){console.log(e.message,e.stack);}},initRestriction:function(){try{if(typeof(USER)!='undefined'&&USER.OPTIONS.web_streaming==false){dzPlayer.setForbiddenListen(true);}
if(typeof(USER)!='undefined'&&USER.USER_ID==0&&USER.OPTIONS.web_streaming_free_tracks==0){dzPlayer.setForbiddenListen(true);}
if(dzPlayer.version==1){this.trigger("audioPlayer_setLock",[dzPlayer.isLimited()]);}
dzPlayer.setOffline(OFFLINE);if(USER.USER_ID==0)Events.trigger(Events.player.checkLimit,{value:false});}catch(e){console.log(e.message,e.stack);}},setUserLogged:function(userId,md5,blogName,sid,gender,age,random_key,random_key2){try{if(dzPlayer.version==1){dzPlayer.trigger("setUserLogged",[userId,md5,blogName,sid,gender,age,random_key]);}else if(dzPlayer.version==2){dzPlayer.trigger("audioPlayer_setToken",[random_key2]);}}catch(e){console.log(e.message,e.stack);}},setUserUnlogged:function(){try{if(dzPlayer.version==1){dzPlayer.trigger("setUserUnlogged",[]);}else if(dzPlayer.version==2){dzPlayer.trigger("audioPlayer_setToken",['']);}}catch(e){console.log(e.message,e.stack);}},setEmptyPlayer:function(){try{if(this.getPlayerType()=='ads'||this.getPlayerType()=='jingle')return false;dzPlayer.trackList=[];dzPlayer.trackListOriginal=[];dzPlayer.trackListIndex=0;this.trigger("audioPlayer_playTracks",[[],0,false]);Events.trigger(Events.player.displayEmptyPlayer);return false;}catch(e){console.log(e.message,e.stack);}},playTracks:function(songList,index,autoPlay,contextParam){try{if(this.getPlayerType()=='ads'||this.getPlayerType()=='jingle')return false;if(this.getPlayerType()!='mod')dzPlayer.setPlayerType("mod");if(typeof(autoPlay)=='undefined')autoPlay=true;if(typeof(index)=='undefined')index=0;dzPlayer.isFirstReadTrack=!autoPlay;dzPlayer.isFacebookTrack=false;if(typeof(contextParam)!='undefined'){dzPlayer.context=contextParam;dzPlayer.context.PAGE_URL=actual_box;}else{dzPlayer.context='';}
this.setTrackList(songList,index);this._play(autoPlay);}catch(e){console.log(e.message,e.stack);}},playTracksFromFacebook:function(songList,index,autoPlay,offset){try{if(typeof(autoPlay)=='undefined')autoPlay=true;if(typeof(offset)=='undefined')offset=0;dzPlayer.isFirstReadTrack=!autoPlay;if(this.getPlayerType()=='ads'||this.getPlayerType()=='jingle'){Events.trigger(Events.player.error,{value:{songId:songList[0],fbErrorCode:5}});index--;}
var waitAdsEnd=(this.getPlayerType()=='ads');dzPlayer.isFacebookTrack=true;if(index===undefined)index=0;dzPlayer.context={TYPE:'facebook_track',ID:songList[0]};api.call('song_getListData',{sng_ids:songList},dzPlayer.onLoadedTracks,{type:'playTracksId',index:index,waitAdsEnd:waitAdsEnd,autoPlay:autoPlay,offset:offset});}catch(e){console.log(e.message,e.stack);}},playTracksId:function(songList,index,autoPlay,contextParam){try{if(this.getPlayerType()=='ads'||this.getPlayerType()=='jingle')return false;if(this.getPlayerType()!='mod')dzPlayer.setPlayerType("mod");if(typeof(autoPlay)=='undefined')autoPlay=true;dzPlayer.isFirstReadTrack=!autoPlay;if(typeof(contextParam)!='undefined'){dzPlayer.context=contextParam;dzPlayer.context.PAGE_URL=actual_box;}else{dzPlayer.context='';}
dzPlayer.isFacebookTrack=false;if(index===undefined)index=0;dzPlayer.context='';api.call('song_getListData',{sng_ids:songList},dzPlayer.onLoadedTracks,{type:'playTracksId',index:index,waitAdsEnd:false,autoPlay:autoPlay});}catch(e){console.log(e.message,e.stack);}},playFollowerTrackId:function(songId,offset,blogname){try{}catch(e){console.log(e.message,e.stack);}},playPlaylist:function(idPlaylist,index,autoPlay,contextParam){try{if(this.getPlayerType()=='ads'||this.getPlayerType()=='jingle')return false;if(typeof(autoPlay)=='undefined')autoPlay=true;if(typeof(index)=='undefined')index=0;dzPlayer.isFirstReadTrack=!autoPlay;if(typeof(contextParam)!='undefined'){dzPlayer.context=contextParam;dzPlayer.context.PAGE_URL=actual_box;}else{dzPlayer.context='';}
dzPlayer.isFacebookTrack=false;api.call('deezer_pagePlaylist',{playlist_id:idPlaylist,start:0,nb:80,tags:false,lang:SETTING_LANG},dzPlayer.onLoadedTracks,{type:'playPlaylist',index:index,waitAdsEnd:false,autoPlay:autoPlay});}catch(e){console.log(e.message,e.stack);}},playAlbum:function(idAlbum,index,autoPlay,contextParam){try{if(this.getPlayerType()=='ads'||this.getPlayerType()=='jingle')return false;if(typeof(autoPlay)=='undefined')autoPlay=true;if(typeof(index)=='undefined')index=0;dzPlayer.isFirstReadTrack=!autoPlay;if(typeof(contextParam)!='undefined'){dzPlayer.context=contextParam;dzPlayer.context.PAGE_URL=actual_box;}else{dzPlayer.context='';}
dzPlayer.isFacebookTrack=false;api.call('deezer_pageAlbum',{alb_id:idAlbum,lang:SETTING_LANG,header:true,tab:12},dzPlayer.onLoadedTracks,{type:'playAlbum',index:index,waitAdsEnd:false,autoPlay:autoPlay});}catch(e){console.log(e.message,e.stack);}},playRadio:function(idRadio,nameRadio,pictureRadio,autoPlay){try{if(this.getPlayerType()=='ads'||this.getPlayerType()=='jingle')return false;if(typeof(autoPlay)=='undefined')autoPlay=true;dzPlayer.isFirstReadTrack=!autoPlay;dzPlayer.isFacebookTrack=false;dzPlayer.context={TYPE:'radio_page',ID:idRadio};dzPlayer.setRadioInfo({idRadio:idRadio,radioName:nameRadio,radioUrlRewrite:urlRewriting(nameRadio)});api.call("deezer.getRadio",{user_id:USER.USER_ID,id:idRadio,type:0,limit:40,lang:SETTING_LANG},dzPlayer.onLoadedTracks,{type:'playRadio',nameRadio:nameRadio,pictureRadio:pictureRadio,index:0,waitAdsEnd:false,autoPlay:autoPlay});}catch(e){console.log(e.message,e.stack);}},playSmartRadio:function(idArtist,nameArtist,pictureArtist,autoPlay){try{if(this.getPlayerType()=='ads'||this.getPlayerType()=='jingle')return false;if(typeof(autoPlay)=='undefined')autoPlay=true;dzPlayer.isFacebookTrack=false;dzPlayer.isFirstReadTrack=!autoPlay;dzPlayer.context={TYPE:'smartradio_page',ID:idArtist};dzPlayer.setSmartRadioInfo({artistUrlRewrite:urlRewriting(nameArtist),artistName:nameArtist});api.call("deezer.getRadio",{user_id:USER.USER_ID,id:idArtist,type:1,limit:40,lang:SETTING_LANG},dzPlayer.onLoadedTracks,{type:'playSmartRadio',nameArtist:nameArtist,pictureArtist:pictureArtist,index:0,waitAdsEnd:false,autoPlay:autoPlay});}catch(e){console.log(e.message,e.stack);}},playSmartRadioTracks:function(songList,index,artId,artName,autoPlay){try{if(this.getPlayerType()=='ads'||this.getPlayerType()=='jingle')return false;if(typeof(autoPlay)=='undefined')autoPlay=true;if(typeof(index)=='undefined')index=0;dzPlayer.isFirstReadTrack=!autoPlay;dzPlayer.isFacebookTrack=false;dzPlayer.context={RADIO_ID:artId,RADIO_TYPE:artName,TYPE:'smartradio_page',ID:artId};dzPlayer.setPlayerType("smartRadio");dzPlayer.setSmartRadioInfo({artistUrlRewrite:urlRewriting(artName),artistName:artName,artId:artId});this.setTrackList(songList,index);this._play(autoPlay);}catch(e){console.log(e.message,e.stack);}},playRadioTracks:function(songList,index,radioId,radioName,autoPlay){try{if(this.getPlayerType()=='ads'||this.getPlayerType()=='jingle')return false;if(typeof(autoPlay)=='undefined')autoPlay=true;if(typeof(index)=='undefined')index=0;dzPlayer.isFirstReadTrack=!autoPlay;dzPlayer.isFacebookTrack=false;dzPlayer.context={RADIO_ID:radioId,RADIO_TYPE:radioName,TYPE:'radio_page',ID:radioId};dzPlayer.setPlayerType("smartRadio");dzPlayer.setRadioInfo({idRadio:radioId,radioName:radioName,radioUrlRewrite:urlRewriting(radioName)});this.setTrackList(songList,index);this._play(autoPlay);}catch(e){console.log(e.message,e.stack);}},onLoadedTracks:function(request,callback_parameters){try{if(countObject(request.error)>0){return false;}
var songList=[];switch(callback_parameters.type){case"playAlbum":songList=request.results.SONGS.data;if(dzPlayer.context==''){dzPlayer.context={TYPE:'album_page',ID:request.results.DATA.ALB_ID,ALB_TITLE:request.results.DATA.ALB_TITLE,PAGE_URL:'album/'+request.results.DATA.ALB_ID};}
dzPlayer.setPlayerType("mod");break;case"playPlaylist":songList=request.results.SONGS.data;if(dzPlayer.context==''){dzPlayer.context={TYPE:'playlist_page',ID:request.results.DATA.PLAYLIST_ID,PLAYLIST_NAME:request.results.DATA.TITLE,PAGE_URL:'playlist/'+request.results.DATA.PLAYLIST_ID};}
dzPlayer.setPlayerType("mod");break;case"playTracksId":songList=request.results.data;if(typeof(callback_parameters.offset)!='undefined'&&callback_parameters.offset>0){songList[parseInt(callback_parameters.index)].OFFSET=callback_parameters.offset;}
if(!callback_parameters.waitAdsEnd)dzPlayer.setPlayerType("mod");else dzPlayer.previousPlayerType="mod";break;case"playFollowerTrackId":request.results.OFFSET=parseInt(callback_parameters.offset);songList=[request.results];dzPlayer.setPlayerType("follower");break;case"playRadio":songList=request.results.SONGS.data;dzPlayer.setPlayerType("smartRadio");break;case"playSmartRadio":songList=request.results.SONGS.data;dzPlayer.setPlayerType("smartRadio");break;}
dzPlayer.setTrackList(songList,parseInt(callback_parameters.index));if(dzPlayer.trackList.length==0&&callback_parameters.type=='playAlbum'){api.call('album.getAlternative',{alb_id:request.results.DATA.ALB_ID,array_default:['ALB_ID']},function(request){var alternativeAlbId=(typeof(request.results.ALB_ID)!='undefined')?request.results.ALB_ID:0;if(request.error.length==0&&alternativeAlbId!=0&&typeof(dzPlayer.lastAlternativeAlbum[alternativeAlbId])=='undefined'){dzPlayer.lastAlternativeAlbum[alternativeAlbId]=true;dzPlayer.playAlbum(alternativeAlbId,callback_parameters.index,callback_parameters.autoPlay,dzPlayer.context);}});}else{dzPlayer.lastAlternativeAlbum={};}
if(dzPlayer.trackList.length==0&&callback_parameters.type=='playTracksId'){api.call('song.getAlternatives',{sng_id:request.results.data[0].SNG_ID,art_id:request.results.data[0].ART_ID,array_default:['SNG_ID']},function(request){if(request.error.length==0&&request.results.count>0){var alternativeSngId=(typeof(request.results.data[0].SNG_ID)!='undefined')?request.results.data[0].SNG_ID:0;if(alternativeSngId!=0&&typeof(dzPlayer.lastAlternativeSong[alternativeSngId])=='undefined'){dzPlayer.lastAlternativeSong[alternativeSngId]=true;dzPlayer.playTracksId([alternativeSngId],callback_parameters.index,callback_parameters.autoPlay,dzPlayer.context);}}});}else{dzPlayer.lastAlternativeSong={};}
if(!callback_parameters.waitAdsEnd&&songList.length>0){dzPlayer._play((typeof(callback_parameters.autoPlay)=='boolean')?callback_parameters.autoPlay:true);}}catch(e){console.log(e.message,e.stack);}},playTrackAtIndex:function(index){try{if(dzPlayer.getAudioAds()!=null&&this.isAudioAdsPage()){this._playAudioAds();}else{this.trackListIndex=index;this._play(true);}}catch(e){console.log(e.message,e.stack);}},setForbiddenListen:function(status){try{if(dzPlayer.version==1){dzPlayer.user_status.limited=status;this.trigger("audioPlayer_setLock",[dzPlayer.user_status.limited]);}}catch(e){console.log(e.message,e.stack);}},setTrackList:function(data,index,addQueue,addNext){try{if(typeof(data)=='undefined')return false;if(typeof(addQueue)=='undefined')addQueue=false;if(typeof(addNext)=='undefined')addNext=false;var fullRandom=(index==-1);if(!addQueue&&!addNext){this.trackListIndex=parseInt(index);if(this.trackListIndex==-1){this.trackListIndex=0;}}
var filtedTrack=[];for(var d=0;d<data.length;d++){if(typeof(right)!="undefined"){if(typeof(data[d])!='undefined'){if(right.checkSongAvailable(data[d])==right.READABLE){filtedTrack.push(data[d]);if(d==this.trackListIndex){this.trackListIndex=filtedTrack.length-1;}}else if(typeof(data[d].FALLBACK)!='undefined'){filtedTrack.push($.extend({},data[d],data[d].FALLBACK));}}}}
if(addQueue){dzPlayer.trackList=dzPlayer.trackList.concat(filtedTrack);}else if(addNext){Array.prototype.splice.apply(dzPlayer.trackList,[dzPlayer.trackListIndex+1,0].concat(filtedTrack));}else{this.trackList=filtedTrack;if(dzPlayer.isMuted()){dzPlayer.mute(false);Events.trigger(Events.player.refreshSoundBar);}}
if(this.isShuffle()&&dzPlayer.getPlayerType()=="mod"){if(!addNext&&!addQueue){dzPlayer.setShuffle(true,fullRandom);}else{dzPlayer.trackListOriginal=dzPlayer.trackListOriginal.concat(filtedTrack);}}}catch(e){console.log(e.message,e.stack);}},getTrackList:function(){try{return this.trackList;}catch(e){console.log(e.message,e.stack);}},getTrackListIndex:function(){try{return this.trackListIndex;}catch(e){console.log(e.message,e.stack);}},enqueueTracks:function(songs){try{dzPlayer.setTrackList(songs,0,true,false);}catch(e){console.log(e.message,e.stack);}},addNextTracks:function(songs){try{dzPlayer.setTrackList(songs,0,false,true);}catch(e){console.log(e.message,e.stack);}},setAudioAds:function(data){try{this.audioAds=data;}catch(e){console.log(e.message,e.stack);}},getAudioAds:function(){try{return this.audioAds;}catch(e){console.log(e.message,e.stack);}},isAudioAdsPage:function(){try{return true;}catch(e){console.log(e.message,e.stack);}},isStoreTrack:function(isrc){try{if(typeof(userData)=='undefined'){return false;}else{return(userData.dataStore[isrc]!=undefined&&isrc!='');}}catch(e){console.log(e.message,e.stack);}},play:function(){try{if(dzPlayer.isFirstReadTrack){if(typeof(this.getCurrentSongInfo())!='undefined'){this._play(true);}}else{Events.trigger(Events.player.resume,{value:this.getCurrentSongInfo()});this.trigger("audioPlayer_play");}}catch(e){console.log(e.message,e.stack);}},pause:function(){try{if(dzPlayer.getPlayerType()=='ads'){return false;}
this.trigger("audioPlayer_pause");if(countObject(dzPlayer.logTrack)>0){dzPlayer.logTrack.stat.pause++;}
Events.trigger(Events.player.paused,{value:this.getCurrentSongInfo()});}catch(e){console.log(e.message,e.stack);}},getNumSong:function(){try{return this.trackListIndex;}catch(e){console.log(e.message,e.stack);}},getNbSongs:function(){try{return this.trackList.length;}catch(e){console.log(e.message,e.stack);}},isLastSong:function(){try{if(dzPlayer.getNumSong()==dzPlayer.getNbSongs()-1){return true;}else{for(var u=this.trackListIndex+1;u<this.trackList.length;u++){if(typeof(this.trackList[u])!='undefined'){return false;}}
return true;}}catch(e){console.log(e.message,e.stack);}},getTotalDuration:function(){try{var totalDuration=0;for(var j=0;j<this.trackList.length;j++){if(typeof(this.trackList[j].DURATION)!='undefined')
totalDuration+=parseInt(this.trackList[j].DURATION);}
return totalDuration;}catch(e){console.log(e.message,e.stack);}},nextSong:function(naturalEnd){try{if(dzPlayer.getPlayerType()=='ads'){return false;}
if(typeof(naturalEnd)=='undefined'){naturalEnd=false;}
if(!naturalEnd){if(countObject(dzPlayer.logTrack)===0){dzPlayer.logManager(false);}
dzPlayer.logTrack.stat.next=true;}
if(this.getPlayerType()=='smartRadio'&&this.repeat>0){this.setRepeat(0);Events.trigger(Events.player.repeat);}
if(dzPlayer.getAudioAds()!=null&&this.isAudioAdsPage()&&!DZPS){this._playAudioAds();}else{dzPlayer.previousSkipAction='next';if(this.getRepeat()==0&&this.trackListIndex<this.trackList.length-1){this.trackListIndex++;}else if(this.getRepeat()==1&&this.trackListIndex<this.trackList.length-1){this.trackListIndex++;}else if(this.getRepeat()==1&&this.trackListIndex==this.trackList.length-1){this.trackListIndex=0;}else if(this.getRepeat()==2){this.trackListIndex=this.trackListIndex;}else if(dzPlayer.isFacebookTrack){this.trackListIndex=this.trackListIndex;}else{dzPlayer.isFirstReadTrack=true;dzPlayer.playing=false;dzPlayer.logManager(false);Events.trigger(Events.player.finishTrackList);return false;}
var autoPlay=true;if(naturalEnd&&this.playerType=="mod"){autoPlay=!this.isLimited();dzPlayer.isFirstReadTrack=!autoPlay;}
this._play(autoPlay,naturalEnd);}}catch(e){console.log(e.message,e.stack);}},prevSong:function(){try{if(dzPlayer.getPlayerType()=='ads'){return false;}
dzPlayer.logTrack.stat.prev=true;if(dzPlayer.getAudioAds()!=null&&this.isAudioAdsPage()&&!DZPS){this._playAudioAds();}else{dzPlayer.previousSkipAction='prev';if(this.getRepeat()==0&&this.trackListIndex>0){this.trackListIndex--;}else if(this.getRepeat()==1&&this.trackListIndex>0){this.trackListIndex--;}else if(this.getRepeat()==1&&this.trackListIndex==0){this.trackListIndex=this.trackList.length-1;}else if(this.getRepeat()==2){this.trackListIndex=this.trackListIndex;}else{return false;}
this._play(true);}}catch(e){console.log(e.message,e.stack);}},getNextSongInfo:function(){try{if(this.repeat==0){return(this.trackListIndex+1<this.getNbSongs())?this.trackList[this.trackListIndex+1]:null;}else if(this.repeat==1){if(this.trackListIndex==this.trackList.length-1)
return this.trackList[0];else
return this.trackList[this.trackListIndex+1];}else if(this.repeat==2){return this.getCurrentSongInfo();}}catch(e){console.log(e.message,e.stack);}},getPrevSongInfo:function(){try{if(this.repeat==0){return this.trackListIndex!=0?this.trackList[this.trackListIndex-1]:null;}else if(this.repeat==1){if(this.trackListIndex==0)
return this.trackList[this.trackList.length-1];else
return this.trackList[this.trackListIndex-1];}else if(this.repeat==2){return this.getCurrentSongInfo();}}catch(e){console.log(e.message,e.stack);}},getCurrentSongInfo:function(){try{if(typeof(this.trackList[this.trackListIndex])!='undefined'){this.currentSongInfo=this.trackList[this.trackListIndex];return this.trackList[this.trackListIndex];}
return null;}catch(e){console.log(e.message,e.stack);}},getRepeat:function(){try{if(typeof(this.repeat)=='string'&&this.repeat.length>1){this.repeat=0;}
return parseInt(this.repeat);}catch(e){console.log(e.message,e.stack);}},setRepeat:function(repeat){try{this.repeat=repeat;Events.trigger(Events.player.repeat_changed,this.repeat);Events.trigger(Events.player.displayNextSong,this.getNextSongInfo());Events.trigger(Events.user.settingChange,{site:{player_repeat:this.repeat}});}catch(e){console.log(e.message,e.stack);}},stop:function(){try{this.trigger("audioPlayer_stop");}catch(e){console.log(e.message,e.stack);}},togglePause:function(){try{this.trigger("audioPlayer_togglePause");}catch(e){console.log(e.message,e.stack);}},getPosition:function(){try{return this.position;}catch(e){console.log(e.message,e.stack);}},getExactPosition:function(){try{return this.trigger('audioPlayer_getPosition',[]);}catch(e){console.log(e.message,e.stack);}},getDuration:function(){try{return this.duration;}catch(e){console.log(e.message,e.stack);}},setVolume:function(volume,save){try{if(typeof(save)=='undefined')save=false;this.trigger("audioPlayer_setVolume",[volume]);this.volume=volume;Events.trigger(Events.player.volume_changed,Math.round(volume*100));if(save){if(Modernizr.localstorage){localStorage.setItem('volume_'+USER.USER_ID,this.volume);return false;}
setCookie('volume',this.volume);}}catch(e){console.log(e.message,e.stack);}},getVolume:function(){try{return this.volume;}catch(e){console.log(e.message,e.stack);}},setShuffle:function(status,fullRandom){try{if(typeof(fullRandom)=='undefined')fullRandom=false;this.shuffle=status;if(this.trackList.length>0){if(this.shuffle){this.trackListOriginal=this.trackList.slice();if(fullRandom){this.trackListIndex=Math.floor(Math.random()*this.trackList.length);}
var result=this.trackList.slice();var firstTrack=result[this.trackListIndex];result.splice(this.trackListIndex,1);var n=tmp=0;var len=result.length;for(var i=0;i<len;i++){n=Math.floor(Math.random()*len);tmp=result[i];result[i]=result[n];result[n]=tmp;}
result.splice(this.trackListIndex,0,firstTrack);this.trackList=result;if(fullRandom){this.trackListIndex=0;}}else{var currentTrackId=(this.getCurrentSongInfo().TYPE==1)?this.getCurrentSongInfo().UPLOAD_ID:this.getCurrentSongInfo().SNG_ID;this.trackList=this.trackListOriginal.slice();for(var i=0;i<this.getNbSongs();i++){var checkingTrack=(this.trackList[i].TYPE==1)?this.trackList[i].UPLOAD_ID:this.trackList[i].SNG_ID;if(checkingTrack==currentTrackId){this.trackListIndex=i;break;}}}}
Events.trigger(Events.player.displayNextSong,this.getNextSongInfo());Events.trigger(Events.user.settingChange,{site:{player_shuffle:this.shuffle}});Events.trigger(Events.player.shuffle_changed,this.shuffle);}catch(e){console.log(e.message,e.stack);}},isShuffle:function(){try{return this.shuffle;}catch(e){console.log(e.message,e.stack);}},removeTracks:function(index){try{if(index<this.trackListIndex)this.trackListIndex--;this.trackList.splice(index,1);Events.trigger(Events.player.displayNextSong,this.getNextSongInfo());}catch(e){console.log(e.message,e.stack);}},orderTracks:function(order){try{var newTrackList=[];var len=this.getNbSongs();var playedId=(this.getCurrentSongInfo().TYPE==1)?this.getCurrentSongInfo().UPLOAD_ID:this.getCurrentSongInfo().SNG_ID;if(len==order.length){for(var p=0;p<len;p++){for(var q=0;q<len;q++){var currentId=(this.trackList[q].TYPE==1)?this.trackList[q].UPLOAD_ID:this.trackList[q].SNG_ID;if(order[p]==currentId){newTrackList[p]=this.trackList[q];if(playedId==currentId)this.trackListIndex=p;}}}
this.trackList=newTrackList.slice();Events.trigger(Events.player.displayNextSong,this.getNextSongInfo());}}catch(e){console.log(e.message,e.stack);}},mute:function(bMute){try{this.muted=!this.muted;this.trigger("audioPlayer_mute",[bMute]);Events.trigger(Events.player.mute_changed,this.muted);}catch(e){console.log(e.message,e.stack);}},isMuted:function(){try{return this.muted;}catch(e){console.log(e.message,e.stack);}},isPlaying:function(){try{return this.playing;}catch(e){console.log(e.message,e.stack);}},isPaused:function(){try{return this.paused;}catch(e){console.log(e.message,e.stack);}},getArtistName:function(){try{return(this.getCurrentSongInfo()!=null)?this.getCurrentSongInfo().ART_NAME:'';}catch(e){console.log(e.message,e.stack);}},getAlbumTitle:function(){try{return(this.getCurrentSongInfo()!=null)?this.getCurrentSongInfo().ALB_TITLE:'';}catch(e){console.log(e.message,e.stack);}},getSongTitle:function(){try{return(this.getCurrentSongInfo()!=null)?this.getCurrentSongInfo().SNG_TITLE:'';}catch(e){console.log(e.message,e.stack);}},getPlayerType:function(){try{return dzPlayer.playerType;}catch(e){console.log(e.message,e.stack);}},getPlayerTypeId:function(){try{var type=0;if(dzPlayer.playerType=="mod"){type=0;}else if(dzPlayer.playerType=="smartRadio"){type=1;}else if(dzPlayer.playerType=="radio"){type=2;}
return type;}catch(e){console.log(e.message,e.stack);}},setPlayerType:function(type){try{if(dzPlayer.getPlayerType()!=type){dzPlayer.playerType=type;this.trigger("audioPlayer_setType",[type]);Events.trigger(Events.player.changePlayerType,dzPlayer.playerType);}}catch(e){console.log(e.message,e.stack);}},setSmartLike:function(){try{api.call('smart_likeSong',{sng_id:this.getCurrentSongInfo().SNG_ID},dzPlayer.onSmartAction,{type:'likeSong'});}catch(e){console.log(e.message,e.stack);}},setSmartNotLike:function(){try{api.call('smart_notLikeSong',{sng_id:this.getCurrentSongInfo().SNG_ID},dzPlayer.onSmartAction,{type:'notLikeSong'});this.nextSong();}catch(e){console.log(e.message,e.stack);}},onSmartAction:function(request){try{if(request.error.length==0){console.log('onSmartAction:ok');}}catch(e){console.log(e.message,e.stack);}},getSongId:function(){try{return(this.getCurrentSongInfo()!=null)?this.getCurrentSongInfo().SNG_ID:'';}catch(e){console.log(e.message,e.stack);}},isLoading:function(){try{return this.loading;}catch(e){console.log(e.message,e.stack);}},getFadeValue:function(){try{return[this.fade];}catch(e){console.log(e.message,e.stack);}},getCover:function(){try{return(this.getCurrentSongInfo()!=null)?this.getCurrentSongInfo().ALB_PICTURE:"";}catch(e){console.log(e.message,e.stack);}},seek:function(position){try{if(dzPlayer.getPlayerType()=='ads'){return false;}
position=parseFloat(position).toFixed(3);if(position==0){position=0.001;}
this.trigger("audioPlayer_seek",[position]);if(countObject(dzPlayer.logTrack)>0){dzPlayer.logTrack.stat.seek++;}}catch(e){console.log(e.message,e.stack);}},changeFadeValue:function(fade){try{var param=[fade];if(dzPlayer.version==1){param=[fade,fade]}
this.trigger("audioPlayer_changeFadeValue",param);this.fade=fade;Events.trigger(Events.user.settingChange,{site:{player_fade:this.fade}});}catch(e){console.log(e.message,e.stack);}},getRadioInfo:function(){try{return this.currentRadioInfo;}catch(e){console.log(e.message,e.stack);}},setRadioInfo:function(obj){try{this.currentRadioInfo=obj;}catch(e){console.log(e.message,e.stack);}},getSmartRadioInfo:function(){try{return this.currentSmartRadioInfo;}catch(e){console.log(e.message,e.stack);}},setSmartRadioInfo:function(obj){try{this.currentSmartRadioInfo=obj;}catch(e){console.log(e.message,e.stack);}},getFollowerInfo:function(){try{return this.currentFollowerInfo;}catch(e){console.log(e.message,e.stack);}},setFollowerInfo:function(obj){try{this.currentFollowerInfo=obj;}catch(e){console.log(e.message,e.stack);}},isFadeInProgress:function(){try{return this.fadeInProgress;}catch(e){console.log(e.message,e.stack);}},isFadeOutProgress:function(){try{return this.fadeOutProgress;}catch(e){console.log(e.message,e.stack);}},isHq:function(){try{return this.hq;}catch(e){console.log(e.message,e.stack);}},setHq:function(status){try{this.hq=status;this.trigger("audioPlayer_setHq",[status]);Events.trigger(Events.user.settingChange,{site:{player_hq:this.hq}});Events.trigger(Events.player.hq,this.hq);}catch(e){console.log(e.message,e.stack);}},setOffline:function(status){try{this.trigger("audioPlayer_setOffline",[status]);}catch(e){console.log(e.message,e.stack);}},sendFile:function(file){try{dzPlayer.trigger("audioPlayer_sendFile",[file]);}catch(e){console.log(e.message,e.stack);}},activeFullscreenButton:function(status){try{this.trigger("audioPlayer_activeFullscreenButton",[status]);}catch(e){console.log(e.message,e.stack);}},isLimited:function(){try{if(countObject(dzPlayer.user_status)>0){return dzPlayer.user_status.limited;}
return false;}catch(e){console.log(e.message,e.stack);}},logManager:function(sendNextSong){try{if(typeof(sendNextSong)=='undefined'){sendNextSong=true;}
if(countObject(dzPlayer.logTrack)>0){if(OFFLINE){dzPlayer.logTrack.force_timestamp=SERVER_TIMESTAMP;Events.trigger(Events.player.log_offline,dzPlayer.logTrack);}else{var logNextSong={};if(sendNextSong&&countObject(dzPlayer.logStartedTrack())>0){logNextSong=dzPlayer.logStartedTrack();}
if(typeof(dzPlayer.user_status.timestamp)!='undefined'){dzPlayer.logTrack.timestamp=dzPlayer.user_status.timestamp;}
if(dzPlayer.logTrack.type==0&&dzPlayer.getPlayerType()=='mod'){Events.trigger(Events.player.updateRestrictTime,dzPlayer.logTrack.lt);}
dzPlayer.sendLog(dzPlayer.logTrack,logNextSong);if(!sendNextSong){dzPlayer.logTrack={};return false;}}}else{if(countObject(dzPlayer.logStartedTrack())&&sendNextSong){dzPlayer.sendLog(dzPlayer.logTrack,dzPlayer.logStartedTrack());}}
if(dzPlayer.isLimited()){dzPlayer.logTrack.l_30sec=1;}
dzPlayer.logTrack=$.extend({},dzPlayer.logTrackTemplate);if(typeof(dzPlayer.getCurrentSongInfo().TYPE)!='undefined'&&dzPlayer.getCurrentSongInfo().TYPE==1){dzPlayer.logTrack.sng_id=parseInt(-dzPlayer.getCurrentSongInfo().UPLOAD_ID);}else{dzPlayer.logTrack.sng_id=dzPlayer.getCurrentSongInfo().SNG_ID;}
if(dzPlayer.appId!=0){dzPlayer.logTrack.app={id:dzPlayer.appId,t:dzPlayer.appType};}
if(typeof(dzPlayer.context.TYPE)!='undefined'||dzPlayer.context.TYPE!=''){dzPlayer.logTrack.ctxt.t=dzPlayer.context.TYPE;}else if(dzPlayer.appId!=0){dzPlayer.logTrack.ctxt.t='inapp';}
if(typeof(dzPlayer.context.ID)!='undefined'&&!isNaN(dzPlayer.context.ID)){dzPlayer.logTrack.ctxt.id=dzPlayer.context.ID;}else if(dzPlayer.appId!=0){dzPlayer.logTrack.ctxt.id=dzPlayer.appId;}
this.logTrack.type=dzPlayer.getPlayerTypeId();}catch(e){console.log(e.message,e.stack);}},logStartedTrack:function(){try{var liveTrack={};if((typeof(dzPlayer.getCurrentSongInfo().TYPE)=='undefined'||dzPlayer.getCurrentSongInfo().TYPE==0)&&USER.USER_ID>0){liveTrack={SNG_ID:dzPlayer.getCurrentSongInfo().SNG_ID,TYPE:dzPlayer.getPlayerTypeId()};}
return liveTrack;}catch(e){console.log(e.message,e.stack);}},sendLog:function(logSong,logNextSong){try{var songsParams={};if(countObject(logSong)>0){songsParams.params=logSong;}
if(countObject(logNextSong)>0){songsParams.next_song=logNextSong;}
api.call('log_listen',songsParams,function(req){if(dzPlayer.version==2){if(req.error.length==0&&req.results!=false){dzPlayer.trigger("audioPlayer_setToken",[req.results]);}}
if(USER.USER_ID==0){Events.trigger(Events.player.checkLimit,{value:true});}
if(countObject(dzPlayer.logTrack)>0){dzPlayer.logTrack.stat.seek=0;dzPlayer.logTrack.stat.pause=0;delete dzPlayer.logTrack.stat.next;delete dzPlayer.logTrack.stat.prev;}});}catch(e){console.log(e.message,e.stack);}},restoreSetting:function(settings){try{if(countObject(settings)==0)return false;this.hq=(typeof(settings.site.player_hq)=='undefined'||settings.site.player_hq==null)?(typeof(USER)!='undefined'&&USER.OPTIONS.web_hq):(settings.site.player_hq&&DZPS);if(Modernizr.localstorage){var storageVolume=localStorage.getItem('volume_'+USER.USER_ID);this.volume=(storageVolume==null||isNaN(storageVolume))?0.5:storageVolume;}else{this.volume=(getCookie('volume')=='')?0.5:getCookie('volume');}
this.fade=(typeof(settings.site.player_fade)=='undefined'||settings.site.player_fade==null)?0:settings.site.player_fade;this.repeat=(typeof(settings.site.player_repeat)=='undefined'||settings.site.player_repeat==null)?0:settings.site.player_repeat;this.shuffle=(typeof(settings.site.player_shuffle)=='undefined'||settings.site.player_shuffle==null)?0:settings.site.player_shuffle;Events.trigger(Events.player.hq,this.hq);Events.trigger(Events.player.volume,this.volume);Events.trigger(Events.player.shuffle,this.shuffle);Events.trigger(Events.player.repeat,this.repeat);this.changeFadeValue(this.fade);this.setVolume(this.volume);if(dzPlayer.version==2){this.setHq(this.hq);}}catch(e){console.log(e.message,e.stack);}},setAppId:function(app_id){try{dzPlayer.appId=app_id;}catch(e){console.log(e.message,e.stack);}},setApp:function(app){try{dzPlayer.appId=app.id;dzPlayer.appType=app.type;}catch(e){console.log(e.message,e.stack);}},isCached:function(sng_id){},setPropValue:function(propName,value){try{var authorizedCall=((dzPlayer.version==2)||(dzPlayer.version==1&&(propName=='playerLoaded'||propName=='loading'||propName=='pourcentLoaded'||propName=='duration'||propName=='position'||propName=='playing'||propName=='finish'||propName=='finishAds'||propName=='fadeOutProgress'||propName=='fadeInProgress'||propName=='finishJingle')));if(!authorizedCall)return false;if(propName=='loadError'){return false;}
if(propName=='preloadComplete'||propName=='preloadAborted'){Events.trigger(Events.player[propName],value);var nextSong=dzPlayer.getNextSongInfo();if(nextSong!==null&&nextSong.SNG_ID==value&&propName=='preloadComplete'){nextSong.CACHED=true;}
return false;}
if(propName=='position'&&value>0){if(dzPlayer.lastPosition!=Math.floor(value)){dzPlayer.logTrack.lt++;if(dzPlayer.logTrack.lt==10&&dzPlayer.getCurrentSongInfo().TYPE==0){var currentSongData={'TYPE':0,'SNG_ID':dzPlayer.songId,'DURATION':dzPlayer.duration}
Events.trigger(Events.player.shareListen,{value:currentSongData});}}
dzPlayer.lastPosition=Math.floor(value);if(dzPlayer.version==2&&value==dzPlayer.getDuration()-20&&!OFFLINE&&!dzPlayer.isLimited()&&dzPlayer.getPlayerType()!='ads'&&dzPlayer.getPlayerType()!='jingle'){var nextSong=dzPlayer.getNextSongInfo();if(nextSong!=null&&nextSong.DURATION>60&&typeof(nextSong.CACHED)=='undefined'){this.trigger("audioPlayer_preloadTrack",[[dzPlayer.getNextSongInfo()]]);}}
if(dzPlayer.getPlayerType()=='ads'){Events.trigger(Events.player.adsVastPlaying,{position:value});}}
this[propName]=value;Events.trigger(Events.player[propName],value);}catch(e){console.log(e.message,e.stack);}},trigger:function(methodName,params){try{if(params==null)params=[];Events.trigger(Events.player.forceCloseMix);if(dzPlayer.playerLoaded){document.getElementById("audioPlayerSWF").callAS(methodName,params);}}catch(e){console.log(e.message,e.stack);}}}
function setDzPlayerProp(prop,value){try{dzPlayer.setPropValue(prop,value);}catch(e){console.log(e.message,e.stack);}}
function setDzPlayerProps(keyValueObject){try{for(var key in keyValueObject){dzPlayer.setPropValue(key,keyValueObject[key]);}}catch(e){console.log(e.message,e.stack);}}
function executeActionscriptMethod(swfId,method,params){try{if(document.getElementById(swfId)==null)return;if(typeof(document.getElementById(swfId).callAS)!='undefined'){document.getElementById(swfId).callAS(method,params);}}catch(e){console.log(e.message,e.stack);}};
(function($){facebox_interval_id=0;$.facebox=function(data,klass){$.facebox.loading();if(data.ajax)fillFaceboxFromAjax(data.ajax)
else if(data.image)fillFaceboxFromImage(data.image)
else if(data.div)fillFaceboxFromHref(data.div)
else if($.isFunction(data))data.call($)
else $.facebox.reveal(data,klass)}
$.extend($.facebox,{settings:{opacity:0.7,overlay:true,loadingImage:SETTING_STATIC+'/img/popin/loading.gif',imageTypes:['png','jpg','jpeg','gif'],faceboxHtml:'\
      <div id="facebox" style="display:none;" class="absolute"> \
        <div class="popup relative"> \
       <table> \
         <tbody> \
        <tr> \
          <td class="tl main"/><td class="b_t"/><td class="tr main"/> \
        </tr> \
        <tr> \
          <td class="b_l"/> \
          <td class="body"> \
          <a href="#" class="close_popin sprite_others"> \
          </a> \
         <div class="content"> \
         </div> \
          </td> \
          <td class="b_r"/> \
        </tr> \
        <tr> \
          <td class="bl main"/><td class="b_b"/><td class="br main"/> \
        </tr> \
         </tbody> \
       </table> \
        </div> \
      </div>'},loading:function(){init();if($('#facebox .loading').length==1){return true;}
showOverlay();$('#facebox').addClass('lightbox_old');$('#facebox .content').empty();facebox_interval_id=setTimeout(function(){$('#facebox').show();$('#facebox .body').children().hide().end().append('<div class="loading"><br /><br /><img src="'+$.facebox.settings.loadingImage+'"/><br /><br /><br /></div>');facebox_interval_id=0;},200);$('#facebox').stop();$('#facebox').css({top:getPageScroll()[1]+50,left:$(window).width()/2-186});$(document).trigger('loading.facebox');},reveal:function(data,klass){clearInterval(facebox_interval_id);$(document).trigger('beforeReveal.facebox');if(klass)$('#facebox .content').addClass(klass);$('#facebox').show();$('#facebox .content').html(data);$('#facebox .loading').remove();$('#facebox .body').children().fadeIn('normal');$('#facebox').css('left',$(window).width()/2-($('#facebox table').width()/2))
$(document).trigger('reveal.facebox').trigger('afterReveal.facebox');},close:function(arg){if(typeof(arg)=='undefined'){arg=false;}
$(document).trigger('close.facebox',arg);return false;},showOverlay:function(){showOverlay();},hideOverlay:function(){hideOverlay();}})
$.fn.facebox=function(settings){init(settings);function clickHandler(){$.facebox.loading(true)
var klass=this.rel.match(/facebox\[?\.(\w+)\]?/)
if(klass)klass=klass[1]
fillFaceboxFromHref(this.href,klass)
return false}
return this.click(clickHandler)}
function init(settings){clearInterval(facebox_interval_id);if($.facebox.settings.inited)return true
else $.facebox.settings.inited=true
$(document).trigger('init.facebox')
makeCompatible()
var imageTypes=$.facebox.settings.imageTypes.join('|')
$.facebox.settings.imageTypesRegexp=new RegExp('\.'+imageTypes+'$','i')
if(settings)$.extend($.facebox.settings,settings)
$('body').append($.facebox.settings.faceboxHtml)
var preload=[new Image(),new Image()]
preload[0].src=$.facebox.settings.loadingImage
$('#facebox').find('.b:first, .bl, .br, .tl, .tr').each(function(){preload.push(new Image())
preload.slice(-1).src=$(this).css('background-image').replace(/url\((.+)\)/,'$1')})
$('#facebox .close_popin').click($.facebox.close);}
function getPageScroll(){var xScroll,yScroll;if(self.pageYOffset){yScroll=self.pageYOffset;xScroll=self.pageXOffset;}else if(document.documentElement&&document.documentElement.scrollTop){yScroll=document.documentElement.scrollTop;xScroll=document.documentElement.scrollLeft;}else if(document.body){yScroll=document.body.scrollTop;xScroll=document.body.scrollLeft;}
return new Array(xScroll,yScroll)}
function getPageHeight(){var windowHeight
if(self.innerHeight){windowHeight=self.innerHeight;}else if(document.documentElement&&document.documentElement.clientHeight){windowHeight=document.documentElement.clientHeight;}else if(document.body){windowHeight=document.body.clientHeight;}
return windowHeight}
function makeCompatible(){var $s=$.facebox.settings
$s.loadingImage=$s.loading_image||$s.loadingImage
$s.closeImage=$s.close_image
$s.imageTypes=$s.image_types||$s.imageTypes
$s.faceboxHtml=$s.facebox_html||$s.faceboxHtml}
function fillFaceboxFromHref(href,klass){if(href.match(/#/)){var url=window.location.href.split('#')[0]
var target=href.replace(url,'')
$.facebox.reveal($(target).clone().show(),klass)}else if(href.match($.facebox.settings.imageTypesRegexp)){fillFaceboxFromImage(href,klass)}else{fillFaceboxFromAjax(href,klass)}}
function fillFaceboxFromImage(href,klass){var image=new Image()
image.onload=function(){$.facebox.reveal('<div class="image"><img src="'+image.src+'" /></div>',klass)}
image.src=href}
function fillFaceboxFromAjax(href,klass){$.get(href,function(data){$.facebox.reveal(data,klass)})}
function skipOverlay(){return $.facebox.settings.overlay==false||$.facebox.settings.opacity===null}
function showOverlay(){if(skipOverlay())return
if($('#facebox_overlay').length==0){$("body").append('<div id="facebox_overlay" class="facebox_hide"></div>');$('#facebox_overlay').hide().addClass("facebox_overlayBG").css('opacity',$.facebox.settings.opacity);}
$('#facebox_overlay').stop();$('#facebox_overlay').fadeIn(200)
return false}
function hideOverlay(){if(skipOverlay())return
$('#facebox_overlay').fadeOut(function(){})
return false}
$(document).bind('close.facebox',function(evt,arg){clearInterval(facebox_interval_id);Events.trigger(Events.lightbox.close+'_'+$("#facebox").data('uniqid'),arg);$('#facebox').hide();$('#facebox .content').removeClass().addClass('content').html('');$('#facebox .loading').remove();hideOverlay();if(typeof(videobox_launch_player)!='undefined'&&videobox_launch_player===true){if(typeof(dzPlayer)!='undefined'&&typeof(dzPlayer.position)!='undefined'&&dzPlayer.position>0){dzPlayer.play();videobox_launch_player=null;}}})})(jQuery);;
var hovercard={loading:false,template:false,timeout:null,delayIn:800,delayOut:100,cacheCard:new Array(),current:null,mouseX:null,cache:true,gravity:'',offset:0,arrow:12,init:function(div,delayIn,cache,gravity,callback){try{if(typeof(callback)!='function'){callback=function(){};}
hovercard.callback=callback;if(OFFLINE){return false;}
if(typeof(delayIn)!='undefined'||delayIn!=null){hovercard.delayIn=delayIn;}else{hovercard.delayIn=800;}
if(hovercard.current!=null){hovercard.delayIn=0;}
if(typeof(cache)!='undefined'||delayIn!=null){hovercard.cache=cache;}else{hovercard.cache=true;}
if(typeof(gravity)!='undefined'||gravity!=null){hovercard.gravity=gravity;}else{hovercard.gravity='';}
div.mousemove(function(event){hovercard.mouseX=event.pageX;hovercard.mouseY=event.pageY;})
clearInterval(hovercard.timeout);if(!hovercard.loading&&hovercard.template==false){hovercard.loading=true;$("body").append('<div id="load_temp"></div>');$('#load_temp').load('/'+SETTING_LANG+'/ajax/hovercard/page.php?card=template',function(response,status,xhr){hovercard.template=true;if($('#hovercard #content').length===0){$('#hovercard').append('<div id="content" class="box-shadow"></div>');}
$("body").append($("#hovercard"));hovercard.$hovercard=$("#hovercard");hovercard.$hovercard_arrow=$("#hovercard #arrow");$('#load_temp').remove();hovercard.timeout=setTimeout(function(){hovercard.load(div)},hovercard.delayIn);});}else{if(hovercard.delayIn>0){hovercard.timeout=setTimeout(function(){hovercard.load(div);},hovercard.delayIn);}else{hovercard.load(div);}}
return true;}catch(e){console.log(e);}},load:function(div){try{data=div.attr('data-hovercard');if(data==null||data==""){return false;}
if(hovercard.current==data){hovercard.display(div);return false;}
hovercard.current=data;if(hovercard.cacheCard[data]){$("#content",hovercard.$hovercard).html(hovercard.cacheCard[data]);hovercard.display(div);hovercard.callback(div);}else{$('#content',hovercard.$hovercard).load('/'+SETTING_LANG+data,function(response,status,xhr){hovercard.display(div);hovercard.callback(div);if(hovercard.cache==true){hovercard.cacheCard[data]=response;}});}
return true;}catch(e){console.log(e);}},display:function(div){try{if(div.attr("id")==undefined){div.attr("id","tmp_for_hovercard");}
var hc_width=hovercard.$hovercard.width();var hc_height=hovercard.$hovercard.height()
obj=document.getElementById(div.attr("id"));coord=util.findPos(obj);objParent=obj.parentNode;coordParent=util.findPos(objParent);objNext=obj.nextSibling;coordNext=util.findPos(objNext);div_offset=div.offset();div_width=div.width();div_height=div.height();divTop=div_offset.top;posLeft=coord[0];sectionWidth=coordNext[0]-coord[0];sectionWidth=0;if(div.attr("id")=="tmp_for_hovercard"){div.removeAttr('id');}
if(sectionWidth<0){sectionWidth=div.width();}
if(hovercard.gravity==''){if(div.css("line-height").indexOf('px')>-1){lineHeight=div.css("line-height").replace("px","");if(div.height()>lineHeight){if((hovercard.mouseY-coord[1])>14){divTop=divTop+14;posLeft=div_offset.left;sectionWidth=coordNext[0]-div_offset.left;}else{sectionWidth=obj.offsetWidth-(coord[0]-coordParent[0]);}}}else{lineHeight=0;}
var arrowPos={};if(hc_width>(client_width-hovercard.mouseX)){arrowPos.right='25px';arrowPos.left='';paddingLeft=-hc_width+sectionWidth;if(sectionWidth>0&&sectionWidth<60){posLeft-=-30+(sectionWidth/2);}}else{arrowPos.left='25px';arrowPos.right='';paddingLeft=0;if(sectionWidth>0&&sectionWidth<60){posLeft+=-30+(sectionWidth/2);}}
posLeft+=paddingLeft;if(hc_height>(div_offset.top-$(window).scrollTop())){posTop=parseInt(divTop)+parseInt(lineHeight);hovercard.$hovercard_arrow.removeClass().addClass("hovercard_arrow arrow_n");arrowPos.top='-10px';arrowPos.bottom='';}else{posTop=divTop-$("#hovercard").height()-14;hovercard.$hovercard_arrow.removeClass().addClass("hovercard_arrow arrow_s");arrowPos.bottom='-5px';arrowPos.top='';}
hovercard.$hovercard.css('margin-top','11px');hovercard.$hovercard_arrow.css(arrowPos)}
switch(hovercard.gravity.charAt(0)){case'n':break;case's':break;case'e':if(hc_height>(client_height-(div_offset.top-$(window).scrollTop()))){posTop=divTop-(hc_height-(client_height-(div_offset.top-$(window).scrollTop())))-10;arrowTop=(hc_height-(client_height-(div_offset.top-$(window).scrollTop())))+(div_height/2)+hovercard.arrow;}else{posTop=divTop;arrowTop=(div_height/2-hovercard.arrow/2);}
posLeft=div_offset.left-hc_width-hovercard.offset-hovercard.arrow;hovercard.$hovercard.css('margin-top','0px');hovercard.$hovercard_arrow.removeClass().addClass("hovercard_arrow arrow_e");hovercard.$hovercard_arrow.css({'left':hc_width,'top':arrowTop+'px'});break;case'w':break;}
if(hovercard.gravity.length==2){if(hovercard.gravity.charAt(1)=='w'){}else{}}
hovercard.$hovercard.show().css({"top":posTop,"left":posLeft}).mouseenter(function(){div.off('mouseleave');clearInterval(hovercard.timeout);});hovercard.$hovercard.mouseleave(function(){hovercard.remove();});return true;}catch(e){console.log(e);}},remove:function(){try{clearInterval(hovercard.timeout);if(hovercard.current!=null){hovercard.timeout=setTimeout(function(){hovercard.hide()},hovercard.delayOut);}
return true;}catch(e){console.log(e);}},hide:function(){try{hovercard.current=null;$('#hovercard').hide();return true;}catch(e){console.log(e);}}};
var notification={delayTimeOut:0,display:function(message,ico,delay,duration){if(typeof(message)=='undefined')message='';if(typeof(ico)=='undefined')ico=false;if(typeof(delay)=='undefined')delay=0;if(typeof(delay)=='undefined')duration=0;$("#notification span").text(message);if(ico==true){$("#notification .icn_loading").show();}else{$("#notification .icn_loading").hide();}
if(notification.delayTimeOut>0){window.clearTimeout(notification.delayTimeOut);}
if(delay>0){notification.delayTimeOut=setTimeout(function(){$('#notification').stop(true).fadeIn(150);},delay);}else{$('#notification').show();}
if(duration>0){setTimeout(function(){notification.hide();},(duration+delay));}
return true;},hide:function(){window.clearTimeout(notification.delayTimeOut);$('#notification').fadeOut(150);notification.delayTimeOut=0;return true;}}
var notificationBar={display:function(msg,param){try{if(typeof(notifyAllreadyDisplay)=='undefined'){notifyAllreadyDisplay={};}
if(typeof(notifyAllreadyDisplay[msg])=='undefined'){if(window.localStorage.getItem('NOTIFY_'+msg)!=null){return false;}
var message=trad.notify[msg];if(typeof(param)!='undefined'&&typeof(param.replaceText)!='undefined'){message=sprintf(message,param.replaceText);}
var link='';switch(msg){case'expired_cc':return false;case'flash_update':link="window.open('http://get.adobe.com/flashplayer/');";break;case'facebook_publish_action':link="facebook.login('publish_actions');";break;case'ie7_support':link="modal.open('lightbox/browser_update.php');";break;case'no_log':link="modal.open('register.php');";break;case'win8_push':link="window.open('http://apps.microsoft.com/windows/app/deezer/e48b595e-b20a-4eb3-968c-c20b2cadaa1e');";window.localStorage.setItem('NOTIFY_'+msg,true);break;default:link="loadBox('offers', {origin: "+((typeof(param.origin)!='undefined')?param.origin:1)+"});";}
$('#notify').css('display','block').children('.message').attr('onClick',link+'notificationBar.hide(); return false;').text(message);notifyAllreadyDisplay[msg]=true;}}catch(e){console.log(e.message,e.stack);}},hide:function(){try{$('#notify').css('display','none');}catch(e){console.log(e.message,e.stack);}}};
var playeroptions={loaded:false,load:function(div){try{if(playeroptions.loaded==false){Events.ready(Events.user.loaded,function(){playeroptions.kill();});if($('#global-options').length==0){div.parent().append($('<div id="global-options" class="absolute rad_4 z_bulle"></div>'));}
$('#global-options').load('/'+SETTING_LANG+'/music/playeroptions',function(){$("#global-options").show();playeroptions.init();playeroptions.setPosition(div);});playeroptions.loaded=true;}else{playeroptions.setPosition(div);}
$("body").bind("mousedown",playeroptions.clickBody);$("#global-options").bind("mousedown",playeroptions.clickBox);}catch(e){console.log(e.message,e.stack);}},init:function(){try{Events.subscribe(Events.player.hq,playercontrol.displayHqStatus);playercontrol.displayHqStatus(null,dzPlayer.isHq());$('#btnHq').tipsy({gravity:'s',title:function(){return dzPlayer.isHq()?trad.player.hq_actif:trad.player.hq_inactif},fallback:trad.player.hq_inactif,force_top:true});if(!DZPS||OFFLINE){$('#btnMixage').hide();}else{$('#btnMixage').tipsy({gravity:'s',fallback:trad.player.openMix,force_top:true});}
$('#btnFade').draggable({axis:'x',containment:'parent',stop:function(event,ui){var calculFade=((ui.offset.left-$(this).parent().offset().left)/($(this).parent().width()-$('#btnFade').width()));playeroptions.doAction('changeFadeValue',calculFade);}});$('#btnFade').parent().click(function(e){var calculFade=(e.originalEvent.layerX/$(this).parent().width());var calculPosition=((e.originalEvent.layerX-($('#btnFade').width()/2))/$(this).parent().width());calculPosition=Math.max(calculPosition,0);calculPosition=Math.min(calculPosition,1);$(this).children().css('left',calculPosition*100+'%');playeroptions.doAction('changeFadeValue',calculFade);});if(dzPlayer.fade>0)$('#btnFade').css('left',(dzPlayer.fade>1)?0:Math.floor(dzPlayer.fade*100)+'%');}catch(e){console.log(e.message,e.stack);}},setPosition:function(div){try{$('#global-options').css({'top':(div.position().top+div.height())+'px','left':Math.floor(div.offset().left-($("#global-options").width()/2)+(div.width()/2))+'px'}).show();if(dzoffline.AVAILABLE&&dzoffline.checkAppInstallation()){$('#options-offline').show();$('#options-offline > a:eq(1)').tipsy({gravity:'s',fallback:trad.offline.tooltipReset,force_top:true});if(typeof(USER.SETTING.employee)=='object'){$('#options-offline > a:eq(0)').show().tipsy({gravity:'s',fallback:trad.offline.tooltipForceOffline,force_top:true});}else{$('#options-offline > a:eq(O)').hide();}}else{$('#options-offline').hide();}}catch(e){console.log(e.message,e.stack);}},doAction:function(type,params){try{switch(type){case"changeFadeValue":var fade=parseFloat(params);params=params.toFixed(3);params=Math.max(params,0);params=Math.min(params,1);dzPlayer.changeFadeValue(params);break;}}catch(e){console.log(e.message,e.stack);}},clickBody:function(){try{playeroptions.close();$('body').unbind("mousedown",playeroptions.clickBody);}catch(e){console.log(e.message,e.stack);}},close:function(){try{$("#global-options").hide();}catch(e){console.log(e.message,e.stack);}},clickBox:function(){try{return false;}catch(e){console.log(e.message,e.stack);}},kill:function(evt){try{$("#global-options").remove();playeroptions.loaded=false;}catch(e){console.log(e.message,e.stack);}}};
var premium={useGiftCode:function(){$('#input_subscribe_confirm').hide();$('#href_register_submit > .img_loading').show();var gift_code=$('#gift_code').val();if(gift_code==''){$('#gift_error').html(trad.premium.paymentCodePromoKo).show();return false;}
var gift_previous_store=$('#gift_previous_store').val();var gift_previous_store_url='';if((gift_previous_store!=null)&&(gift_previous_store!='')){gift_previous_store_url='&previous_store='+gift_previous_store;}
data='gift_code='+encodeURIComponent(gift_code);request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=useGiftCode&'+data);if(request=='ok'){user.userLogin();modal.open('gift.php?screen=result'+gift_previous_store_url,true);return true;}else if(request=='used'){$('#gift_error').html(trad.premium.paymentCodePromoUsed).show();$('#input_subscribe_confirm').show();$('#href_register_submit > .img_loading').hide();return false;}else{$('#gift_error').html(trad.premium.paymentCodePromoKo).show();$('#input_subscribe_confirm').show();$('#href_register_submit > .img_loading').hide();return false;}},useWallet:function(offer_id,duration){data='offer_id='+offer_id+'&duration='+duration;request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=useWallet&'+data);if(request=='ok'){modal.open('premium_result.php?status=1&offer_id='+offer_id,true);return true;}
if(request=='error'){$('#gift_error').html(wallet_error).show();return false;}
if(request=='wrong_parameters'){$('#gift_error').html(wallet_error_wrongparameters).show();return false;}
if(request=='no_credit'){$('#gift_error').html(trad.premium.wallet_error_nocredit).show();return false;}
if(request=='not_available'){$('#gift_error').html(trad.premium.wallet_error_notavailable).show();return false;}},test_phone:function(div){try{var phone_number='';if(typeof(div)=='object'){phone_number=$('#tester_phone_number',div).val();$tester_phone_msg=$('#tester_phone_msg',div);}else{phone_number=$('#tester_phone_number').val();$tester_phone_msg=$('#tester_phone_msg');}
if(phone_number==''){$tester_phone_msg.html('<div style="background:#FFDCDD;padding:10px;margin-top:5px;">'+trad.premium.test_phone_text4+'</div>').fadeIn();return false;}
request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=test_premium_phone&phone='+encodeURIComponent(phone_number));if(request=='already_send'){$tester_phone_msg.html('<div style="background:#e9ffed;padding:10px;margin-top:5px;">'+sprintf(trad.premium.test_phone_text1,'http://www.deezer.com')+'</div>').fadeIn();}else if(request=='error'){$tester_phone_msg.html('<div style="background:#FFDCDD;padding:10px;margin-top:5px;">'+trad.premium.test_phone_text2+'</div>').fadeIn();}else{$tester_phone_msg.html('<div style="background:#e9ffed;padding:10px;margin-top:5px;">'+trad.premium.test_phone_text3+'</div>').fadeIn();}
return true;}catch(e){console.log(e);}},order:function(){try{$('#input_subscribe_confirm').hide();$('#href_register_submit > .img_loading').show();var register_terms;register_terms=1;var register_payment='';if($('#register_payment_cb').length==1&&$('#register_payment_cb').prop('checked')){register_payment='ogone';}
else if($('#register_payment_paypal').length==1&&$('#register_payment_paypal').prop('checked')){register_payment='paypal';}
if(register_payment==''||register_terms==0){if(register_payment==''){$('#mode_payment_check').html('<img src="'+SETTING_STATIC+'/img/common/form_nok.png" alt="" />');}
if(register_terms==0){$('#register_terms_check').html('<img src="'+SETTING_STATIC+'/img/common/form_nok.png" alt="" />');}
if(register_payment==''&&register_terms==0){$('#register_errors_content').html(trad.premium.order_text7+'<br/>'+trad.premium.order_text1);}else if(register_payment==''){$('#register_errors_content').html(trad.premium.order_text7);}else if(register_terms==0){$('#register_errors_content').html(trad.premium.order_text1);}
$('#register_errors').show();$('#input_subscribe_confirm').show();$('#href_register_submit > .img_loading').hide();}
else{var register_offer_id=0;if($('#product_id').length==1){register_offer_id=$('#product_id').val();}
if(typeof(pageTracker)!='undefined'&&typeof(pageTracker._trackEvent)=='function'){pageTracker._trackEvent('client_tracking','payment');}
if(register_payment=='ogone'){payment.launch('ogone','ABO');}
else if(register_payment=='paypal'){window.location.href='/payment/?offer_id='+register_offer_id+'&plateform='+register_payment;}}
return true;}catch(e){console.log(e);}},unset_retry:function(){try{var request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=premium_unset_retry');if(request=='ko')return;$.facebox.close();return true;}catch(e){console.log(e);}},unset_switch_cb:function(){try{var request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=premium_unset_switch_cb');if(request=='ko'){return;}
$.facebox.close();return true;}catch(e){console.log(e);}},unset_renewal:function(){try{if(confirm(trad.premium.deletePremium_text1)){var request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=premium_unset_renewal');if(request=='ko'){return;}
$.facebox.close();return true;}
return false;}catch(e){console.log(e);}},changeMOP:function(){loadPayment({id:1,origin:21,change_mop:1});},resetCB:function(){try{jQuery.facebox({ajax:'/'+SETTING_LANG+'/payment/ogone_switch_cb.php?from=community'});}catch(e){console.log(e);}},deleteCB:function(){try{request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=premium_deleteCB');if(request=='success'){$('#premium_delete_cb_status').html('<div style="color:#00cc00;text-align:right">'+trad.premium.delete_cb_success+'</div>');}else{$('#premium_delete_cb_status').html('<div style="color:#cc0000;text-align:right">'+trad.premium.delete_cb_error+'</div>');}}catch(e){console.log(e);}},storeMailPub:function(){try{if(($('#premium_email')!=null)&&($('#premium_email').val().length>0)){request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=premium_storeMailPub&email='+encodeURIComponent($('#premium_email').val()));if(request=='ok'){$('#div_nooffer_form').html('Thanks for your interest in Deezer.<br>We\'ve got your email address and will let you know when you can subscribe.');$('#div_nooffer_result_fail').hide();}else{$('#div_nooffer_result_fail').html('Your e-mail address is incorrect.');}}
else{$('#div_nooffer_result_fail').html('Your e-mail address is incorrect.');}}catch(e){console.log(e);}}};
var payment={launch:function(plateform,type,reset_alias){try{if($('#register_errors').length==1)$('#register_errors').css('display','none');if(typeof(reset_alias)=='undefined'||reset_alias==null)reset_alias='-';if($('#input_subscribe_confirm').length==1){$('#input_subscribe_confirm').next().show();$('#input_subscribe_confirm').hide();}
var is_error=0;var register_terms;if($('#register_terms').prop('checked')){register_terms=1;}else{register_terms=0;}
if(register_terms==0){is_error=1;$('#register_terms_check').html('<img src="'+SETTING_STATIC+'/img/common/form_nok.png" alt="" />');if(type=='STORE'){$('#register_errors_content').html(trad.store.cgv_text_error);}else{$('#register_errors_content').html(trad.premium.order_text1);}}
var cb_transac_id;if($('#cb_transac_id').val())cb_transac_id=$('#cb_transac_id').val();else cb_transac_id='';var product_id='';if($('#product_id').length==1)product_id=$('#product_id').val();if(!(plateform=='ogone'||plateform=='orange'||plateform=='orange_p3t'||plateform=='wallet')){return false;}
if(plateform=='ogone'){var ogone_type_order;if($('#ogone_type_order').val())ogone_type_order=$('#ogone_type_order').val();else ogone_type_order='cb';if(ogone_type_order=='cb'){var cb_data_cardno;if($('#cb_data_cardno').val())cb_data_cardno=$('#cb_data_cardno').val();else cb_data_cardno='';var cb_data_cvc;if($('#cb_data_cvc').val())cb_data_cvc=$('#cb_data_cvc').val();else cb_data_cvc='';var cb_data_ed_month;if($('#cb_data_ed_month').val())cb_data_ed_month=$('#cb_data_ed_month').val();else cb_data_ed_month='-';var cb_data_ed_year;if($('#cb_data_ed_year').val())cb_data_ed_year=$('#cb_data_ed_year').val();else cb_data_ed_year='-';var check_card_no=cb_data_cardno.match(/^[0-9 \-]+$/);var check_cvc=cb_data_cvc.match(/^[0-9]{3}$/);if(!check_card_no||!check_cvc||cb_data_ed_month=='-'||cb_data_ed_year=='-'){if($('#div_alert_login').length==1){$('#div_alert_login').hide();}
if($('#div_info_perso').length==1){$('#div_info_perso').hide();}
if($('#div_block_sp').length==1){$('#div_block_sp').hide();}
if(!check_card_no)$('#cb_data_cardno_check').html('<img src="'+SETTING_STATIC+'/img/common/form_nok.png" alt="" />');if(!check_cvc)$('#cb_data_cvc_check').html('<img src="'+SETTING_STATIC+'/img/common/form_nok.png" alt="" />');if(cb_data_ed_month=='-'||cb_data_ed_year=='-')$('#cb_data_ed_check').html('<img src="'+SETTING_STATIC+'/img/common/form_nok.png" alt="" />');var nb_error=0;if(!check_card_no){if(nb_error==0)$('#register_errors_content').html(trad.premium.order_text4);else $('#register_errors_content').html($('#register_errors_content').html()+'<br />'+trad.premium.order_text4);nb_error=nb_error+1;}
if(!check_cvc){if(nb_error==0)$('#register_errors_content').html(trad.premium.order_text6);else $('#register_errors_content').html($('#register_errors_content').html()+'<br />'+trad.premium.order_text6);nb_error=nb_error+1;}
if(cb_data_ed_month=='-'||cb_data_ed_year=='-'){if(nb_error==0)$('#register_errors_content').html(trad.premium.order_text5);else $('#register_errors_content').html($('#register_errors_content').html()+'<br />'+trad.premium.order_text5);nb_error=nb_error+1;}
is_error=1;}}}
if(type=='STORE'){var product_type='';if($('#product_type').length==1)product_type=$('#product_type').val();if(!(product_type=='track'||product_type=='album'||product_type=='playlist')){is_error=1;}
var portail='';if($('#portail').length==1)portail=$('#portail').val();var ecran='';if($('#ecran').length==1)ecran=$('#ecran').val();}
if(product_id==''){$('#register_errors_content').html(trad.premium.order_text2);is_error=1;}
if(type=='STORE'){if(product_type==0){$('#register_errors_content').html(trad.premium.order_text2);is_error=1;}}
if(is_error==1){$('#register_errors').css('display','block');if(type=='ABO'){if(reset_alias=='-')$('#input_subscribe_confirm').attr('onClick','premium.order(); return false;');}
if($('#input_subscribe_confirm').length==1){$('#input_subscribe_confirm').next().hide();$('#input_subscribe_confirm').show();}
return false;}
var data='plateform='+encodeURIComponent(plateform)+'&type='+encodeURIComponent(type)+'&transac_id='+encodeURIComponent(cb_transac_id)+'&product_id='+encodeURIComponent(product_id)+'&ecran=www';if(plateform=='ogone'){if(ogone_type_order=='cb'){data=data+'&ogone_type_order=cb&cardno='+encodeURIComponent(cb_data_cardno)+'&cvc='+encodeURIComponent(cb_data_cvc)+'&ed='+encodeURIComponent(cb_data_ed_month+cb_data_ed_year);}
else{data=data+'&ogone_type_order=alias';}
data=data+'&reset_alias='+encodeURIComponent(reset_alias);}
if(type=='STORE'){var payment_password_ogone='';if($('#payment_password_ogone').val())payment_password_ogone=$('#payment_password_ogone').val();var payment_password_orange='';if($('#payment_password_orange').val())payment_password_orange=$('#payment_password_orange').val();var payment_password_orange_p3t='';if($('#payment_password_orange_p3t').val())payment_password_orange_p3t=$('#payment_password_orange_p3t').val();var payment_password_wallet='';if($('#payment_password_wallet').val())payment_password_wallet=$('#payment_password_wallet').val();data=data+'&product_type='+encodeURIComponent(product_type)+'&portail='+encodeURIComponent(portail)+'&ecran='+encodeURIComponent(ecran)+'&payment_password_ogone='+encodeURIComponent(payment_password_ogone)+'&payment_password_orange='+encodeURIComponent(payment_password_orange)+'&payment_password_orange_p3t='+encodeURIComponent(payment_password_orange_p3t)+'&payment_password_wallet='+encodeURIComponent(payment_password_wallet);}
if(ENV=='PROD'||ENV=='PREPROD'){var url='https://'+SETTING_HOST+'/payment/order.php';}
else{var url='http://'+SETTING_HOST+'/payment/order.php';}
var headElement=document.getElementsByTagName('head')[0];var script=document.createElement('script');script.async=true;script.src=url+'?params='+encodeURIComponent(bin2hex(data));headElement.appendChild(script);}catch(e){console.log(e);}},launch_callback:function(data){try{if(data.result=='ok'){user.refreshSession();if(data.type=='ABO'){user.userLogin();if(data.reset_alias=='reset_alias'){loadFacebox('premium_result.php?status=1&offer_id='+data.product_id+'&action=reset_alias');}
else{loadFacebox('premium_result.php?status=1&offer_id='+data.product_id);}}
else{loadFacebox('store/index.php?status=1&product_id='+encodeURIComponent(data.product_id)+'&product_type='+encodeURIComponent(data.product_type)+'&plateform='+encodeURIComponent(data.plateform)+'&transac_id='+encodeURIComponent(data.transac_id));}}
else{if(data.str=='1'||data.str=='2'||data.str=='3'||data.str=='5'){user.logout();}
else if(data.str=='4'){window.location.href='/'+SETTING_LANG+'/?lb=paypal_unsubscribe';}
else if(data.str=='6'){if(data.ncerror=='cardno'){$('#register_errors_content').html(trad.premium.order_text4);if($('#cb_data_cardno_check').length==1){$('#cb_data_cardno_check').html('<img src="'+SETTING_STATIC+'/img/common/form_nok.png" alt="" />');}}
else if(data.ncerror=='cvc'){$('#register_errors_content').html(trad.premium.order_text6);if($('#cb_data_cvc_check').length==1){$('#cb_data_cvc_check').html('<img src="'+SETTING_STATIC+'/img/common/form_nok.png" alt="" />');}}
else if(data.ncerror=='ed'){$('#register_errors_content').html(trad.premium.order_text5);if($('#cb_data_ed_check').length==1){$('#cb_data_ed_check').html('<img src="'+SETTING_STATIC+'/img/common/form_nok.png" alt="" />');}}
else if(data.plateform=='wallet'){$('#register_errors_content').html(trad.premium.order_text_wallet);}
else{$('#register_errors_content').html(trad.premium.order_text3);}}
else if(data.str=='7'){if(data.type=='ABO'){loadFacebox('premium_result.php?status=0&offer_id='+data.product_id);}
else{loadFacebox('store/index.php?status=0&product_id='+encodeURIComponent(data.product_id)+'&product_type='+encodeURIComponent(data.product_type));}}
else if((data.str=='8')&&(data.type=='STORE')){$('#register_errors_content').html(trad.premium.order_text_pwd);}
else if(data.str=='9'){loadFacebox('store/index.php?status=0&product_id='+encodeURIComponent(data.product_id)+'&product_type='+encodeURIComponent(data.product_type)+'&reset_token=1');}
else if(data.str=='10'){$('#register_errors_content').html(trad.premium.order_text8);}
else if(data.str=='11'){$('#register_errors_content').html(trad.premium.order_text9);}
else if(data.str=='12'){$('#register_errors_content').html(trad.premium.order_text10);}
else{user.logout();}
if($('#div_alert_login').length==1){$('#div_alert_login').hide();}
if($('#div_info_perso').length==1){$('#div_info_perso').hide();}
if($('#div_block_sp').length==1){$('#div_block_sp').hide();}
if(data.type=='ABO'){if(data.str=='6'&&data.reset_alias=='-')$('#input_subscribe_confirm').attr('onClick','premium.order(\'ABO\'); return false;');}
$('#register_errors').css('display','block');}
if($('#input_subscribe_confirm').length==1){$('#input_subscribe_confirm').next().hide();$('#input_subscribe_confirm').show();}
return true;}catch(e){console.log(e);}}};
if(typeof(sharebox)=='undefined'){var sharebox={nb:30,state:'ok',offsetStart:0,filter:'',prev_filter:'',ids:[],cache:{'list':[],'selected':[]},platform:'friends',modal_id:null,data:null,selected_friend_id:null,last_scroll_offset:0,$scrollbar:null,$friends_form:null,$friends_list:null,$friends_input:null,$friends_selected:null,$friends_list_item_model:null,$friends_selected_item_model:null,$share_btn_publish:null,$share_btn_embed:null,$share_btn_email:null,load:function(obj_type,obj_id){try{var url='lightbox/sharebox.php?type='+obj_type+'&id='+obj_id;var result;if(USER.USER_ID>0){result=modal.open(url);}else{result=modal.open('login.php?redirect_type=modal&redirect_link='+encodeURIComponent(url));}
return result;}catch(e){console.log(e.message,e.stack);}},init:function(type,id,data){try{sharebox.data=data;sharebox.state='ok';sharebox.ids=[];sharebox.cache={'list':[],'selected':[]};sharebox.obj_type=parseInt(type,10);sharebox.obj_id=id;sharebox.offsetStart=0;sharebox.total_friend=0;sharebox.platform='friends';sharebox.last_scroll_offset=0;sharebox.selected_friend_id=null;sharebox.modal_id=$('#modal').data('uniqid');sharebox.$friends_form=$('#share-friends-form');sharebox.$friends_list=$('#friends_list');sharebox.$scrollbar=$('.tinyscroll_scrollbar',sharebox.$friends_list);sharebox.$share_btn_publish=$('#share-btn-publish');sharebox.$share_btn_publish_google=$('#share-btn-publish-google');sharebox.$share_btn_embed=$('#share-btn-embed');sharebox.$share_btn_email=$('#share-btn-email');sharebox.$friends_selected=$('#friends_selected');sharebox.$friends_input=$('#friends_input');sharebox.$url_input=$('#url-input');sharebox.$friends_list_item_model=$('#tpl_friends_list .friend').clone();sharebox.$friends_selected_item_model=$('#tpl_friends_selected a').clone();$('#share-btn-email').tipsy({gravity:'w',fallback:trad.sharebox.tooltip_email,force_top:true});$('#share-btn-embed').tipsy({gravity:'w',fallback:trad.sharebox.tooltip_embed,force_top:true});sharebox.initPlatforms();sharebox.initTabNav();sharebox.initFriendsList();if($('#share-btn-link-google').length==1){Events.ready(Events.googleplus.ready,function(){renderggplus('share-btn-link-google')});}
return true;}catch(e){console.log(e.message,e.stack);}},initPlatforms:function(){try{if(typeof(sharebox.data.AVAILABLE_PLATFORMS['FRIENDS'])==='undefined'||sharebox.data.AVAILABLE_PLATFORMS['FRIENDS']!==true){$('#share-tab-friends').hide();$('#share-content-friends').hide();}
if(typeof(sharebox.data.AVAILABLE_PLATFORMS['FACEBOOK'])==='undefined'||sharebox.data.AVAILABLE_PLATFORMS['FACEBOOK']!==true){$('#share-tab-facebook').hide();$('#share-content-facebook').hide();}
if(typeof(sharebox.data.AVAILABLE_PLATFORMS['TWITTER'])==='undefined'||sharebox.data.AVAILABLE_PLATFORMS['TWITTER']!==true){$('#share-tab-twitter').hide();$('#share-content-twitter').hide();}
if(typeof(sharebox.data.AVAILABLE_PLATFORMS['EMBED'])==='undefined'||sharebox.data.AVAILABLE_PLATFORMS['EMBED']!==true||USER.USER_ID===0){sharebox.$share_btn_embed.parent().hide();}else{if(typeof(sharebox.data.AVAILABLE_PLATFORMS['EMBED'])!=='undefined'){sharebox.$share_btn_embed.attr('onclick',"window.open('"+SETTING_HOST_DEVELOPERS+"/musicplugins/player?type="+sharebox.idToType(sharebox.obj_type)+"&id="+sharebox.obj_id+"'); tracking.track('embed_click'); return false;").parent().show();}else{sharebox.$share_btn_embed.parent().hide();}}
$('#share-message-twitter').on('keyup, keydown',function(e){var txt=$(this).val();if(txt.length>140){txt=txt.substring(0,140);$(this).val(txt);}});sharebox.$share_btn_email.attr('onclick',"tracking.track('mail_click');");return true;}catch(e){console.log(e.message,e.stack);}},initTabNav:function(){try{$('#modal_sharebox .nav-tabs').on('click','a',function(e){e.preventDefault();e.stopPropagation();var $this=$(this);sharebox.platform=$this.data('target');$this.addClass('selected').siblings().removeClass('selected');$('#modal_sharebox [data-tab]').each(function(){if($(this).data('tab')===$this.data('target')){sharebox.switchPlatform(sharebox.platform);$(this).show();}else{$(this).hide();}});});$('#modal_sharebox .nav-tabs > a:first').trigger('click');setTimeout(function(){sharebox.$url_input.select();},100);return true;}catch(e){console.log(e.message,e.stack);}},initFriendsList:function(){try{if(USER.USER_ID===0){sharebox.$friends_form.hide();return false;}
sharebox.total_friend=userData.data['FRIENDS'].count;$('#modal_sharebox').on('click',function(e){var $target=$(e.target);if($target.closest('#friends_list').length===0&&$target.closest('#friends_filter').length===0){sharebox.selected_friend_id=null;sharebox.$friends_list.hide();}});sharebox.$friends_list.on('click','a',function(e){e.preventDefault();var $this=$(this);var $parent=$this.parent();var index=$parent.attr('data-friend-index');$this.remove();$this.addClass('selected');$parent.attr('data-selected','1');sharebox.selected_friend_id=null;sharebox.addFriendToSelection(index);sharebox.$friends_selected.show();sharebox.$friends_list.hide();sharebox.$friends_input.val('').trigger('focus');return true;});sharebox.$friends_list.bind('jsp-scroll-y',function(event,position){if(position==='bottom'){if(sharebox.state==='ok'){sharebox.state='loading';sharebox.buildFriendsList(sharebox.offsetStart);}}});sharebox.$friends_input.on('keyup',function(e){sharebox.prev_filter=sharebox.filter;sharebox.filter=$(this).val().toLowerCase();if(sharebox.filter!==sharebox.prev_filter){sharebox.selected_friend_id=null;}
if(sharebox.filter!==''){sharebox.buildFriendsList();sharebox.$friends_list.show();sharebox.handleKeyboardNav(e);}else{if(typeof(e.keyCode)!=='undefined'&&e.keyCode===8){var $selected_friends=$('a',sharebox.$friends_selected);if(sharebox.ids.length>0&&$selected_friends.length>0){sharebox.ids.pop();$selected_friends.last().remove();sharebox.buildFriendsList();}}else{sharebox.handleKeyboardNav(e);}
sharebox.$friends_input.trigger('focus');}});sharebox.$friends_input.parent().on('click',function(e){sharebox.$friends_input.trigger('focus');if(sharebox.$friends_input.val()!==''){sharebox.$friends_input.trigger('keyup');}});sharebox.$friends_form.on('submit',function(e){e.stopPropagation();e.preventDefault();return false;});return true;}catch(e){console.log(e.message,e.stack);}},buildFriendsList:function(start){try{var display_line=[];var filter=sharebox.filter.toLowerCase();var display_name;var friend_id;var j=0;var i;var $item;if(USER.USER_ID===0){return false;}
if(typeof(start)==='undefined'){start=0;}
if(typeof(start)!=='number'){start=sharebox.offsetStart;}
if(start===0){$('.friends-container',sharebox.$friends_list).empty();}
if(start>=sharebox.total_friend){return true;}
for(i=start;i<sharebox.total_friend;i++){display_name=userData.data['FRIENDS'].data[i].DISPLAY_NAME.toLowerCase();friend_id=parseInt(userData.data['FRIENDS'].data[i].USER_ID,10);if(display_name.indexOf(filter)!==-1&&$.inArray(friend_id,sharebox.ids)===-1){display_line[j]=sharebox.drawFriendListItem(i);j++;if(j===sharebox.nb){break;}}}
sharebox.offsetStart=i+1;$('.friends-container',sharebox.$friends_list).append(display_line.join(''));if(sharebox.selected_friend_id!==null){$item=$('#'+sharebox.selected_friend_id);$item.attr('data-selected',1).children('a').first().addClass('selected');}
sharebox.$friends_list.show();if(!sharebox.$friends_list.data('tsb')){setTimeout(function(){sharebox.$friends_list.tinyscrollbar({extremePosition:true});},0);}
if(start===0){sharebox.$friends_list.tinyscrollbar_update();}else{sharebox.$friends_list.tinyscrollbar_update('relative');}
sharebox.enableInfinite();sharebox.$friends_list.show();return true;}catch(e){console.log(e.message,e.stack);}},drawFriendListItem:function(i){try{if(typeof(sharebox.cache.list[i])==='string'){return sharebox.cache.list[i];}
var div_list_id='share-friend-list-item-'+i;var div_selected_id='share-friend-selected-item-'+i;var $item=sharebox.$friends_list_item_model.clone()
$item.attr({'id':div_list_id,'data-friend-index':i,'data-friend-id':userData.data['FRIENDS'].data[i].USER_ID,'data-selected':"0"});if($('#'+div_selected_id).length===1){$item.attr('data-selected',1).find('a').addClass('selected');}
$('img',$item).attr("src",SETTING_DOMAIN_IMG+"/user/"+userData.data['FRIENDS'].data[i].USER_PICTURE+"/75x75-000000-80-0-0.jpg");$("p",$item).text(userData.data['FRIENDS'].data[i].DISPLAY_NAME);var line_str=util.getOuterHTML($item);sharebox.cache.list[i]=line_str;return line_str;}catch(e){console.log(e.message,e.stack);}},addFriendToSelection:function(i){try{var dom_str=sharebox.drawFriendSelectedItem(i);var friend_id=parseInt(userData.data['FRIENDS'].data[i].USER_ID,10);if(typeof(friend_id)==='number'){sharebox.ids.push(friend_id);}
sharebox.$friends_selected.append(dom_str);if(sharebox.$friends_selected.children().length>0){sharebox.$share_btn_publish.show();}
return true;}catch(e){console.log(e.message,e.stack);}},drawFriendSelectedItem:function(i){try{if(typeof(sharebox.cache.selected[i])==='string'){return sharebox.cache.selected[i];}
var div_id='share-friend-selected-item-'+i;var $item=sharebox.$friends_selected_item_model.clone().attr({'id':div_id,'data-friend-index':i,'data-friend-id':userData.data['FRIENDS'].data[i].USER_ID,'onclick':"sharebox.removeFriendFromSelection(this); return false;"});$item.html(userData.data['FRIENDS'].data[i].DISPLAY_NAME+$item.html());var line_str=util.getOuterHTML($item);sharebox.cache.selected[i]=line_str;return line_str;}catch(e){console.log(e.message,e.stack);}},removeFriendFromSelection:function(element){try{var $this=$(element);var $parent=$this.parent();var index=$this.attr('data-friend-index');var id=parseInt($this.attr('data-friend-id'),10);var $list_item=$('#share-friend-list-item-'+index);$list_item.attr('data-selected','0').find('a').removeClass('selected');$this.remove();var position=$.inArray(id,sharebox.ids);if(-1!==position&&typeof(position)==='number'){sharebox.ids.splice(position,1);}
if($parent.children().size()===0){$parent.hide();sharebox.$share_btn_publish.hide();}
sharebox.$friends_list.hide();return true;}catch(e){console.log(e.message,e.stack);}},enableInfinite:function(){try{sharebox.state='ok';return true;}catch(e){console.log(e.message,e.stack);}},share:function(){try{switch(sharebox.platform){case'friends':return sharebox.shareToFriends();break;case'facebook':return sharebox.shareToFacebook();break;case'twitter':return sharebox.shareToTwitter();break;case'google':window.open('https://plus.google.com/share?url='+encodeURIComponent($('#url-input').val()),'','menubar=no,toolbar=no,height=600,width=600');break;}
return false;}catch(e){console.log(e.message,e.stack);}},shareToFriends:function(){try{var api_obj=new Object();api_obj.USER_ID=USER.USER_ID;api_obj.FRIEND_LIST=sharebox.ids;api_obj.TYPE=sharebox.obj_type;api_obj.ID=sharebox.obj_id;api_obj.MESSAGE=$('#share-message-friends').val();api_obj.FACEBOOK=0;api_obj.TWITTER=0;api_obj.NAME=sharebox.data.TITLE;api.call('share_add',api_obj,function(){Events.trigger(Events.user.share,api_obj);$('#modal_sharebox').hide();$('#modal_sharebox_confirm').show();});tracking.track('share_click',{'type':'deezer'});return true;}catch(e){console.log(e.message,e.stack);}},linkToFacebook:function(){try{return facebook.login('',{'type':'modal','link':'lightbox/sharebox.php?type='+sharebox.obj_type+'&id='+sharebox.obj_id+'&tab=facebook'});}catch(e){console.log(e.message,e.stack);}},shareToFacebook:function(){try{var success=false;if(typeof(sharebox.data.AVAILABLE_PLATFORMS.FACEBOOK)!=='undefined'&&sharebox.data.AVAILABLE_PLATFORMS.FACEBOOK===true){var msg=trim($('#share-message-facebook').val());if(typeof(FB)!=='undefined'&&LOG_TYPE==='facebook'&&USER.FB_USER_ID>0){if(!facebook.shareEnable()){Events.trigger(Events.user.settingChange,{facebook:{share_share:true}});}
if(gatekeeper.isAllowed('facebook_og_action')){var shareType=null;switch(sharebox.data.TYPE){case 0:shareType="song";break;case 1:shareType="album";break;case 2:shareType="profile";break;case 3:shareType="playlist";break;case 6:shareType="radio_station";break;default:return false;}
api.call('facebookapi_ogAction',{'type':shareType,'url':sharebox.data.URL,'comment':msg,'action_type':'shareContent'},function(response){api_obj=new Object();api_obj.USER_ID=USER.USER_ID;api_obj.FRIEND_LIST=[];api_obj.TYPE=sharebox.obj_type;api_obj.ID=sharebox.obj_id;api_obj.FACEBOOK=1;api_obj.TWITTER=0;api_obj.NAME=sharebox.data.TITLE;Events.trigger(Events.user.share,api_obj);$('#modal_sharebox').hide();$('#modal_sharebox_confirm').show();});}else{facebook.graphAction('share',{'type':sharebox.data.TYPE,'url':sharebox.data.URL,'comment':msg,'callback':function(result){if(result){api_obj=new Object();api_obj.USER_ID=USER.USER_ID;api_obj.FRIEND_LIST=[];api_obj.TYPE=sharebox.obj_type;api_obj.ID=sharebox.obj_id;api_obj.FACEBOOK=1;api_obj.TWITTER=0;api_obj.NAME=sharebox.data.TITLE;Events.trigger(Events.user.share,api_obj);$('#modal_sharebox').hide();$('#modal_sharebox_confirm').show();}}});}}else{FB.ui({method:'feed',name:sharebox.data.TITLE,link:sharebox.data.URL,picture:sharebox.data.PICTURE,caption:(typeof(sharebox.data.SUBTITLE)!=='undefined'?sharebox.data.SUBTITLE:'Deezer'),description:msg});sharebox.close();}
success=true;}
tracking.track('share_click',{'type':'facebook'});return success;}catch(e){console.log(e.message,e.stack);}},linkToTwitter:function(){try{actual_box+=((actual_box.indexOf('?')===-1)?'?':'&')+'lb=sharebox&type='+sharebox.obj_type+'&id='+sharebox.obj_id+'&tab=twitter';return twitter.link();}catch(e){console.log(e.message,e.stack);}},shareToTwitter:function(){try{var success=false;if(typeof(sharebox.data.AVAILABLE_PLATFORMS.TWITTER)!=='undefined'&&sharebox.data.AVAILABLE_PLATFORMS.TWITTER===true){if(typeof(USER.TWITTER.TOKEN)==='undefined'){window.open(sharebox.data.TWITTER+encodeURIComponent($("#share-message-twitter").val().split('http://www.deezer.com/')[0]));sharebox.close();}else{api.call('twitterapi_postStatus',{status:$("#share-message-twitter").val()},function(){api_obj=new Object();api_obj.USER_ID=USER.USER_ID;api_obj.FRIEND_LIST=[];api_obj.TYPE=sharebox.obj_type;api_obj.ID=sharebox.obj_id;api_obj.FACEBOOK=0;api_obj.TWITTER=1;api_obj.NAME=sharebox.data.TITLE;Events.trigger(Events.user.share,api_obj);$('#modal_sharebox').hide();$('#modal_sharebox_confirm').show();});}
success=true;}
tracking.track('share_click',{'type':'twitter'});return success;}catch(e){console.log(e.message,e.stack);}},shareToTumblr:function(){try{var link=$('#url-input').val();var message=encodeURIComponent(trim($('#share-message-tumblr').val()));var title=trim($('#share-title').text());var subtitle=trim($('#share-subtitle').text());var artist=trim($('#share-artist-name').val());if(subtitle!==''){title+=' - '+subtitle;}
var url='http://'+SETTING_HOST+'/tumblr.php?message='+message+'&link='+link+'&title='+title;if(artist!==''){url+='&artist='+artist;}
window.open(url);tracking.track('share_click',{'type':'tumblr'});sharebox.close();return false;}catch(e){console.log(e.message,e.stack);}},idToType:function(id){try{var type=['tracks','album','artist','playlist','radio','festival','sradio'];if(typeof(type[id])!=='undefined'){return type[id];}
return false;}catch(e){console.log(e.message,e.stack);}},switchPlatform:function(platform){try{switch(platform){case'friends':sharebox.$share_btn_publish_google.hide();if(sharebox.$friends_selected.children().length>0){sharebox.$share_btn_publish.show();}else{sharebox.$share_btn_publish.hide();}
return true;break;case'facebook':sharebox.$share_btn_publish_google.hide();if(typeof(sharebox.data.FACEBOOK)!=='undefined'&&USER.FB_USER_ID>0){sharebox.$share_btn_publish.show();}else{sharebox.$share_btn_publish.hide();}
return true;break;case'twitter':sharebox.$share_btn_publish_google.hide();if(typeof(sharebox.data.TWITTER)!=='undefined'&&typeof(USER.TWITTER.TOKEN)!=='undefined'){sharebox.$share_btn_publish.show();}else{sharebox.$share_btn_publish.hide();}
return true;break;case'google':sharebox.$share_btn_publish.hide();if(typeof(USER.GOOGLEPLUS)!=='undefined'&&typeof(USER.GOOGLEPLUS.GG_USER_ID)!=='undefined'){sharebox.$share_btn_publish_google.show();}else{sharebox.$share_btn_publish_google.hide();}
break;}
return false;}catch(e){console.log(e.message,e.stack);}},handleKeyboardNav:function(e){try{if(!sharebox.$friends_list.is(":visible")||typeof(e.keyCode)==='undefined'||$.inArray(e.keyCode,[13,37,38,39,40])===-1){return false;}
e.stopPropagation();e.preventDefault();var key=e.keyCode;var $friends=$('.friend',sharebox.$friends_list);var nb_friends=$friends.length;var min_top;var $selected_friend;if(key===false||nb_friends===0){return false;}
if(sharebox.selected_friend_id!==null){$selected_friend=$('#'+sharebox.selected_friend_id);if($selected_friend.length===0){return false;}}
min_top=$friends.first().position().top;switch(key){case 13:if(typeof($selected_friend)!=='undefined'){var $link=$selected_friend.children('a').first();$link.trigger('click');}
break;case 40:if(typeof($selected_friend)==='undefined'){$selected_friend=$friends.first();return sharebox.selectFriend($selected_friend,$friends,key);}else{var selected_friend_position=$selected_friend.position();for(var i=0;i<nb_friends;i++){var $tmp_friend=$($friends[i]);var tmp_friend_position=$tmp_friend.position();if(tmp_friend_position.top>selected_friend_position.top&&tmp_friend_position.left===selected_friend_position.left){return sharebox.selectFriend($tmp_friend,$friends,key);}}
if(sharebox.$scrollbar.is(':visible')){sharebox.$friends_list.tinyscrollbar_update(sharebox.last_scroll_offset);}}
break;case 38:if(typeof($selected_friend)!=='undefined'){var selected_friend_position=$selected_friend.position();var limit_top=selected_friend_position.top;var limit_left=selected_friend_position.left;if(min_top>=limit_top){return false;}
for(var i=(nb_friends-1);i>=0;i--){var $tmp_friend=$($friends[i]);var tmp_friend_position=$tmp_friend.position();if(tmp_friend_position.top<limit_top&&tmp_friend_position.left===limit_left){return sharebox.selectFriend($tmp_friend,$friends,key);}}
if(sharebox.$scrollbar.is(':visible')){sharebox.$friends_list.tinyscrollbar_update(sharebox.last_scroll_offset);}}
break;case 39:if(typeof($selected_friend)!=='undefined'){var selected_friend_position=$selected_friend.position();var limit_top=selected_friend_position.top;var limit_left=selected_friend_position.left;for(var i=0;i<nb_friends;i++){var $tmp_friend=$($friends[i]);var tmp_friend_position=$tmp_friend.position();if(tmp_friend_position.top===limit_top&&tmp_friend_position.left>limit_left){return sharebox.selectFriend($tmp_friend,$friends,key);}
var $next_friend=$tmp_friend.next();if($next_friend.length>0){var next_friend_position=$next_friend.position();if(next_friend_position.top>limit_top){limit_top=next_friend_position.top;limit_left=-1*next_friend_position.left;}}}
if(sharebox.$scrollbar.is(':visible')){sharebox.$friends_list.tinyscrollbar_update(sharebox.last_scroll_offset);}}
break;case 37:if(typeof($selected_friend)!=='undefined'){var selected_friend_position=$selected_friend.position();var limit_top=selected_friend_position.top;var limit_left=selected_friend_position.left;for(var i=(nb_friends-1);i>=0;i--){var $tmp_friend=$($friends[i]);var tmp_friend_position=$tmp_friend.position();if(tmp_friend_position.top===limit_top&&tmp_friend_position.left<limit_left){return sharebox.selectFriend($tmp_friend,$friends,key);}
var $prev_friend=$tmp_friend.prev();if($prev_friend.length>0){var prev_friend_position=$prev_friend.position();if(prev_friend_position.top<limit_top){limit_top=prev_friend_position.top;limit_left=prev_friend_position.left+$prev_friend.width();}}}
if(sharebox.$scrollbar.is(':visible')){sharebox.$friends_list.tinyscrollbar_update(sharebox.last_scroll_offset);}}
break;}
return false;}catch(e){console.log(e.message,e.stack);}},selectFriend:function($element,$friends,key){try{if(typeof($element)==='undefined'||typeof($element.length)==='undefined'||$element.length===0){return false;}
$friends.find('a.selected').removeClass('selected');$friends.find('[data-selected=1]').attr('data-selected',0);$element.attr('data-selected',1).children('a').addClass('selected');sharebox.selected_friend_id=$element.attr('id');var $container=$('.tinyscroll_overview',sharebox.$friends_list);var container_height=$container.height();var scrollbar_height=sharebox.$scrollbar.height();var viewport_height=sharebox.$friends_list.innerHeight();if(container_height<viewport_height){return true;}
var element_padding_top=parseInt($element.css('padding-top').replace('px',''),10);var element_top=$element.position().top;var element_height=$element.height();var element_bottom=element_top+element_height+element_padding_top;var scroll_offset=Math.abs(viewport_height-element_bottom-element_padding_top*2);var overflow=(element_bottom>viewport_height);if(element_top<element_height){return true;}
switch(key){case 40:if(overflow){if(scrollbar_height<=(scroll_offset+element_height)){scroll_offset='bottom';}
sharebox.$friends_list.tinyscrollbar_update(scroll_offset);}
break;case 39:if(overflow){if(element_top===$element.prev().position().top){scroll_offset=sharebox.last_scroll_offset;}
if(scrollbar_height<=(scroll_offset+element_height)){scroll_offset='bottom';}
sharebox.$friends_list.tinyscrollbar_update(scroll_offset);}
break;case 38:if(overflow){scroll_offset=scroll_offset+$element.height()+element_padding_top;if(scrollbar_height<=(scroll_offset+element_height)){scroll_offset='bottom';}
sharebox.$friends_list.tinyscrollbar_update(scroll_offset);}
break;case 37:if(overflow){if(element_top===$element.next().position().top){scroll_offset=sharebox.last_scroll_offset;}
if(scrollbar_height<=(scroll_offset+element_height)){scroll_offset='bottom';}
sharebox.$friends_list.tinyscrollbar_update(scroll_offset);}
break;}
sharebox.last_scroll_offset=scroll_offset;return true;}catch(e){console.log(e.message,e.stack);}},close:function(){try{if(modal.opened===true&&$('#modal').data('uniqid')===sharebox.modal_id){modal.close();}
return false;}catch(e){console.log(e.message,e.stack);}}}};
tokenizer.prototype.hideHint=function(){this.dom_hint.style.display='none';this.dom_hint.className='hint hint_help';this.dom_input.value='';this.dom_input.focus();}
tokenizer.prototype.selectToken=function(){var in_array=false;for(var i=0;i<this.list_token_selected.length;i++){if(this.list_token_selected[i]==this.list_token[this.dom_hint.firstChild.childNodes[this.token_active].token_pointer]['id'])in_array=true;}
if(this.token_active!='none'&&!in_array){this.addToken();this.list_token_selected[this.list_token_selected.length]=this.list_token[this.dom_hint.firstChild.childNodes[this.token_active].token_pointer]['id'];this.dom_input_hidden.value=this.list_token_selected.join('|');this.input_old_value=0;this.hideHint();}}
tokenizer.prototype.highlightToken=function(direction){var old_position=this.token_active;if(direction=='down'){if(old_position=='none')position=0;else if(old_position==this.nb_proposition-1)position=this.token_active;else position=old_position+1;if(old_position!='none')this.dom_hint.firstChild.childNodes[old_position].className='';this.dom_hint.firstChild.childNodes[position].className='selected';this.token_active=position;}
else if(direction=='up'){if(old_position==0)position=0;else if(old_position!='none')position=old_position-1;else position=this.nb_proposition-1;if(old_position!='none')this.dom_hint.firstChild.childNodes[old_position].className='';this.dom_hint.firstChild.childNodes[position].className='selected';this.token_active=position;}}
tokenizer.prototype.contactSearch=function(){var that=this;var ul=document.createElement('ul');var out=0;for(var i=0;i<this.list_token.length;i++){var rg=new RegExp('^'+this.dom_input.value,'gi');if(this.list_token[i]['data'].search(rg)!=-1){var li=document.createElement('li');var texte=document.createTextNode(this.list_token[i]['data']);li.token_pointer=i;li.onmouseover=function(){if(that.token_active!='none'){that.dom_hint.firstChild.childNodes[that.token_active].className='';}
this.className='selected';for(var i=0;i<that.dom_hint.firstChild.childNodes.length;i++){if(that.dom_hint.firstChild.childNodes[i].className=='selected'){that.token_active=i;}}}
li.onmouseout=function(){that.token_active='none';this.className='';}
li.onclick=function(){that.selectToken();}
li.appendChild(texte);ul.appendChild(li);out=out+1;}}
this.nb_proposition=out;this.dom_hint.removeChild(this.dom_hint.firstChild);this.dom_hint.appendChild(ul);if(this.nb_proposition>0){this.dom_hint.className='hint hint_overflow';this.dom_hint.style.display='block';this.token_active=0;this.dom_hint.firstChild.firstChild.className='selected';}
else this.dom_hint.style.display='none';}
tokenizer.prototype.addToken=function(){var that=this;var img=document.createElement('img');img.src='http://cdn-files.deezer.com/img/common/delete.png';var p=document.createElement('p');var texte=document.createTextNode(this.list_token[this.dom_hint.firstChild.childNodes[this.token_active].token_pointer]['data']);p.appendChild(texte);var li=document.createElement('li');li.className='token';li.token_id=this.list_token[this.dom_hint.firstChild.childNodes[this.token_active].token_pointer]['id'];li.appendChild(p);li.appendChild(img);img.onclick=function(){for(var i=0;i<that.dom_ul_token.childNodes.length-1;i++){if(that.dom_ul_token.childNodes[i].token_id==this.parentNode.token_id)node=i;}
that.deleteToken(node);}
this.dom_input.parentNode.parentNode.insertBefore(li,this.dom_input.parentNode.parentNode.lastChild);}
tokenizer.prototype.deleteToken=function(node){var array=new Array();for(var i=0;i<this.list_token_selected.length;i++){if(this.list_token_selected[i]!=this.dom_ul_token.childNodes[node].token_id)array[array.length]=this.list_token_selected[i];}
this.dom_ul_token.removeChild(this.dom_ul_token.childNodes[node]);this.list_token_selected=array;this.dom_input_hidden.value=this.list_token_selected.join('|');}
tokenizer.prototype.press=function(ns){if(document.all)keycode=event.keyCode;else keycode=ns.which;if(keycode==8&&this.input_old_value==0){if(this.dom_ul_token.childNodes.length>=2){this.deleteToken(this.dom_ul_token.childNodes.length-2);}}
else if(keycode==38&&this.nb_proposition>0)this.highlightToken('up');else if(keycode==40&&this.nb_proposition>0)this.highlightToken('down');else if(keycode==13&&this.nb_proposition>0){if(this.token_active!='none')this.selectToken();}
else if(keycode==27)this.hideHint();else{this.contactSearch();}
this.input_old_value=this.dom_input.value.length;}
function tokenizer(id,list_token,hint,token){var that=this;this.token_active='none';this.nb_proposition=0;this.input_old_value=0;this.list_token=eval(list_token);this.list_token_selected=new Array();var width=document.getElementById(id).style.width;var div_general=document.createElement('div');div_general.className='tokenizer';var input_hidden=document.createElement('input');input_hidden.type='hidden';input_hidden.id=id;input_hidden.name=id;var div_hint=document.createElement('div');div_hint.className='hint hint_help';div_hint.style.width=width;var input=document.createElement('input');input.onkeyup=function(ns){that.press(ns);}
var ul_token_list=document.createElement('ul');ul_token_list.className='token_list';ul_token_list.style.width=width;ul_token_list.onclick=function(){this.lastChild.firstChild.focus();div_hint.innerHTML=hint;div_hint.className='hint hint_help';div_hint.style.display='block';}
var li_for_input=document.createElement('li');li_for_input.appendChild(input);ul_token_list.appendChild(li_for_input);div_general.appendChild(ul_token_list);div_general.appendChild(div_hint);div_general.appendChild(input_hidden);var node=document.getElementById(id);insertAfter(node,div_general);node.parentNode.removeChild(node);this.dom_node=div_general;this.dom_hint=div_hint;this.dom_input=input;this.dom_input_hidden=input_hidden;this.dom_ul_token=ul_token_list;if(token){var img=document.createElement('img');img.src='http://cdn-files.deezer.com/img/common/delete.png';var p=document.createElement('p');var texte=document.createTextNode(token['data']);p.appendChild(texte);var li=document.createElement('li');li.className='token';li.token_id=token['id'];li.appendChild(p);li.appendChild(img);img.onclick=function(){for(var i=0;i<that.dom_ul_token.childNodes.length-1;i++){if(that.dom_ul_token.childNodes[i].token_id==this.parentNode.token_id)node=i;}
that.deleteToken(node);}
this.dom_input.parentNode.parentNode.insertBefore(li,this.dom_input.parentNode.parentNode.lastChild);this.list_token_selected[this.list_token_selected.length]=token['id'];this.dom_input_hidden.value=this.list_token_selected.join('|');}};
if(typeof(favorite)=="undefined"){var favorite={add:function($div,params){try{if(USER.USER_ID==0){modal.open('login.php');return false;}
if(typeof($div.type)!='undefined'){params=$div;$div=null;}
switch(params.type){case'artist':api_method='artist_addFavorite';var param={art_id:params.ART_ID};break;case'radio':api_method='radio_addFavorite';var param={radio_id:params.RADIO_ID};break;case'album':api_method='album_addFavorite';var param={ALB_ID:params.ALB_ID};break;case'application':api_method='application_addFavorite';var param={APP_ID:(params.APP_ID)}
break;case'playlist':api_method='playlist_addFavorite';var param={parent_playlist_id:params.PLAYLIST_ID,title:params.TITLE,parent_user_id:params.PARENT_USER_ID,parent_username:params.PARENT_USERNAME};break;case'song':api_method='playlist_addSongs';var param={playlist_id:userData.data.FAVORITES_SONGS_ID,songs:[[params.SNG_ID,params.TYPE]]};break;default:return false;}
api.call(api_method,param,function(req){if(req.error.length==0){if($div!=null){favorite.setRemoveState($div,params);}
Events.trigger(Events.user.addFavorite,params);if(params.type=='song'){dzoffline.elementChanged('loved',userData.data.FAVORITES_SONGS_ID);}}});return true;}catch(e){console.log(e.message,e.stack);}},remove:function($div,params){try{if(typeof($div.type)!='undefined'){params=$div;$div=null;}
switch(params.type){case'artist':api_method='artist_deleteFavorite';var param={art_id:params.ART_ID};break;case'radio':api_method='radio_deleteFavorite';var param={radio_id:params.RADIO_ID};break;case'album':api_method='album_deleteFavorite';var param={ALB_ID:params.ALB_ID};break;case'playlist':api_method='playlist_deleteFavorite';var param={playlist_id:params.PLAYLIST_ID};break;case'application':api_method='application_deleteFavorite';var param={APP_ID:(params.APP_ID)};break;case'song':api_method='playlist.deleteSongs';var param={playlist_id:userData.data.FAVORITES_SONGS_ID,songs:[[params.SNG_ID,params.TYPE]]};break;}
api.call(api_method,param,function(req){if(req.results===true){if($div!=null){favorite.setAddState($div,params);}
Events.trigger(Events.user.deleteFavorite,params);if(params.type=='song'){dzoffline.elementChanged('loved',userData.data.FAVORITES_SONGS_ID);}}});}catch(e){console.log(e.message,e.stack);}},display:function($div,params){try{if(USER.USER_ID==0){favorite.setAddState($div,params);}else{Events.ready(Events.user.userReady,function(){if(userData.isFavorite(params.type,getElementIdByType(params))){favorite.setRemoveState($div,params);}else{favorite.setAddState($div,params);}});}}catch(e){console.log(e.message,e.stack);}},setAddState:function($div,params){try{if(USER.USER_ID==0){$div.attr('onClick',"modal.open('/"+SETTING_LANG+"/login.php'); return false;");}else{$div.attr('onClick','favorite.add($(this), '+JSON.stringify(params)+'); return false;').removeClass('selected');}
var label=trad.music.favorite_add_to_my_music;if(typeof(trad.music['favorite_add_'+params.type])!='undefined'){label=trad.music['favorite_add_'+params.type];}
$('.label',$div).text(label);}catch(e){console.log(e.message,e.stack);}},setRemoveState:function($div,params){try{$div.attr('onClick','favorite.remove($(this), '+JSON.stringify(params)+'); return false;').addClass('selected');var label=trad.music.favorite_remove_to_my_music;if(typeof(trad.music['favorite_remove_'+params.type])!='undefined'){label=trad.music['favorite_remove_'+params.type];}
$('.label',$div).text(label);}catch(e){console.log(e.message,e.stack);}}}};
var util={findPos:function(obj){try{var curleft=curtop=0;if(obj.offsetParent){do{curleft+=obj.offsetLeft;curtop+=obj.offsetTop;}while(obj=obj.offsetParent);}
return[curleft,curtop];}catch(e){return[0,0];}},getPageScroll:function(){try{var xScroll,yScroll;if(self.pageYOffset){yScroll=self.pageYOffset;xScroll=self.pageXOffset;}else if(document.documentElement&&document.documentElement.scrollTop){yScroll=document.documentElement.scrollTop;xScroll=document.documentElement.scrollLeft;}else if(document.body){yScroll=document.body.scrollTop;xScroll=document.body.scrollLeft;}
return[xScroll,yScroll];}catch(e){console.log(e);}},findPosRelativeToViewport:function(obj){try{var objPos=this.findPos(obj);var scroll=this.getPageScroll()
return[objPos[0]-scroll[0],objPos[1]-scroll[1]]}catch(e){console.log(e);}},range:function(vmin,vmax){try{range=vmax-vmin+1;return Math.floor(Math.random()*range+vmin);}catch(e){console.log(e);}},getOuterHTML:function(div){try{var get=div.attr('outerHTML');if(typeof(get)=='undefined'){$div=$('<p></p>');$div.append(div.clone());get=$div.html();$div.remove();}
return get;}catch(e){console.log(e);}},uniqid:function(length){try{var retId;if(typeof(length)=='undefined'){length=7;}
length=Math.max(7,Math.floor(length));var length2=Math.min(7,Math.floor(length/2));var length1=length-length2;var formatSeed=function(seed,reqWidth){seed=parseInt(seed,10).toString(16);if(reqWidth<seed.length){return seed.slice(seed.length-reqWidth);}
if(reqWidth>seed.length){return Array(1+(reqWidth-seed.length)).join('0')+seed;}
return seed;};if(!this.php_js){this.php_js={};}
if(!this.php_js.uniqidSeed){this.php_js.uniqidSeed=Math.floor(Math.random()*0x75bcd15);}
this.php_js.uniqidSeed+=3;retId=formatSeed(parseInt(new Date().getTime()/1000,10),10);retId+=formatSeed(this.php_js.uniqidSeed,7);return retId;}catch(e){console.log(e.message,e.stack);}}};
if(typeof(userData)=="undefined"){var userData={data:{},dataStore:{},isLoaded:false,isLoadedRadio:false,checksums:{},load:function(){try{if(USER.USER_ID==0){return false;}
Events.subscribe(Events.user.addFavorite,function(evt,params){userData.addFavorite(params.type,getElementIdByType(params),params);});Events.subscribe(Events.user.deleteFavorite,function(evt,params){userData.deleteFavorite(params.type,getElementIdByType(params));});Events.subscribe(Events.playlist.created,function(evt,params){userData.addPlaylist(params);});Events.subscribe(Events.playlist.removed,function(evt,params){userData.deletePlaylist(params);});try{if(Modernizr.localstorage&&typeof(localStorage['USER_CHECKSUMS_'+USER.USER_ID])!='undefined'){userData.checksums=JSON.parse(localStorage['USER_CHECKSUMS_'+USER.USER_ID]);for(var c in userData.checksums){if(typeof(localStorage[c+'_'+USER.USER_ID])=='undefined'){console.log(c,' : localStorage not found');delete userData.checksums[c];}}}}catch(e){console.log(e);}
api.call('deezer_userMenu',{checksum:true,checksums:userData.checksums},userData.loadCallback);return true;}catch(e){console.log(e);}},loadCallback:function(request){try{if(typeof(request)=='undefined'||request===false||request===''){return false;}
if(request.error.length>0){console.log('deezer_userMenu:error');}
var conf={};conf.FAVORITES_ARTISTS={primary_key:'ART_ID',hash:true};conf.FAVORITES_ALBUMS={primary_key:'ALB_ID',hash:true};conf.FAVORITES_PLAYLISTS={primary_key:'PLAYLIST_ID',hash:true};conf.FAVORITES_APPLICATIONS={primary_key:'APP_ID',hash:true};conf.FAVORITES_RADIOS={primary_key:'RADIO_ID',hash:true};conf.FAVORITES_SONGS={primary_key:'SNG_ID',primary_key_replace:'UPLOAD_ID',secondary_key:'TYPE',hash:true};conf.PLAYLISTS={primary_key:'PLAYLIST_ID',hash:false};conf.FRIENDS={primary_key:'USER_ID',hash:true};conf.MESSAGE_UNREAD={primary_key:'AUTHOR',hash:true};conf.FOLDERS={primary_key:'FOLDER_ID',hash:false};conf.TOTAL_STORE_TRACKS={skip:true,primary_key:'FOLDER_ID',hash:false};conf.FAVORITES_SONGS_ID={skip:false,hash:false};for(var i in request.results){if(conf[i].skip){continue;}
if(typeof(request.results[i])!='undefined'){if(request.results[i]=='Not modified'&&Modernizr.localstorage){if(typeof(localStorage[i+'_'+USER.USER_ID])!='undefined'){userData.data[i]=JSON.parse(localStorage[i+'_'+USER.USER_ID]);}}else{userData.data[i]=request.results[i];if(Modernizr.localstorage&&typeof(userData.data[i].checksum)!='undefined'){window.localStorage[i+'_'+USER.USER_ID]=JSON.stringify(userData.data[i]);userData.checksums[i]=userData.data[i].checksum;}}
if(conf[i].hash){userData.data[i+'_HASH']={};for(var j=0;j<userData.data[i].count;j++){var key=userData.data[i].data[j][conf[i].primary_key];if(i=='FAVORITES_SONGS'){var id=Math.abs(userData.data[i].data[j][conf[i].primary_key]);if(id==0&&typeof(conf[i].primary_key_replace)!='undefined'){id=userData.data[i].data[j][conf[i].primary_key_replace];}
key=id+'_'+userData.data[i].data[j][conf[i].secondary_key];}
userData.data[i+'_HASH'][key]=j;}}}}
if(typeof(request.results.TOTAL_STORE_TRACKS)!='undefined'){userData.dataStore={};if(Modernizr.localstorage){if(window.localStorage.getItem('storeTrack_'+USER.USER_ID)!==null){userData.dataStore=JSON.parse(window.localStorage['storeTrack_'+USER.USER_ID]);}}
if(getObjectSize(userData.dataStore)<request.results.TOTAL_STORE_TRACKS){api.call('store_getList',{start:getObjectSize(userData.dataStore),nb:request.results.TOTAL_STORE_TRACKS-getObjectSize(userData.dataStore)},userData.storeListCallback);}else{Events.resolve(Events.user.dataStoreReady);}}
userData.isLoaded=true;Events.resolve(Events.user.userReady);if(Modernizr.localstorage){localStorage['USER_CHECKSUMS_'+USER.USER_ID]=JSON.stringify(userData.checksums);}
return true;}catch(e){console.log(e.message,e.stack);}},isFavorite:function(type,id){try{switch(type){case'artist':return(typeof(userData.data.FAVORITES_ARTISTS_HASH[id])!='undefined')?true:false;case'application':return(typeof(userData.data.FAVORITES_APPLICATIONS_HASH[id])!='undefined')?true:false;case'album':return(typeof(userData.data.FAVORITES_ALBUMS_HASH[id])!='undefined')?true:false;case'radio':return(typeof(userData.data.FAVORITES_RADIOS_HASH[id])!='undefined')?true:false;case'playlist':return(typeof(userData.data.FAVORITES_PLAYLISTS_HASH[id])!='undefined')?true:false;case'friend':return(typeof(userData.data.FRIENDS_HASH[id])!='undefined')?true:false;case'song':return(typeof(userData.data.FAVORITES_SONGS_HASH[id])!='undefined')?true:false;default:return false;}}catch(e){console.log(e.message,e.stack);}},addFavorite:function(type,id,data){try{switch(type){case'artist':userData.data.FAVORITES_ARTISTS_HASH[id]=true;if(data!==''){if(countObject(userData.data.FAVORITES_ARTISTS)===0){userData.data.FAVORITES_ARTISTS={data:[],total:0,count:0};}
userData.data.FAVORITES_ARTISTS.data.push(data);userData.data.FAVORITES_ARTISTS.count++;userData.data.FAVORITES_ARTISTS.total++;}
break;case'album':userData.data.FAVORITES_ALBUMS_HASH[id]=true;break;case'radio':userData.data.FAVORITES_RADIOS_HASH[id]=true;if(data!==''){if(countObject(userData.data.FAVORITES_RADIOS)===0){userData.data.FAVORITES_RADIOS={data:[],total:0,count:0};}
userData.data.FAVORITES_RADIOS.data.push(data);userData.data.FAVORITES_RADIOS.count++;userData.data.FAVORITES_RADIOS.total++;}
break;case'playlist':userData.data.FAVORITES_PLAYLISTS_HASH[id]=true;break;case'application':userData.data.FAVORITES_APPLICATIONS_HASH[parseInt(id,10)]=true;break;case'friend':if(typeof(data)!='undefined'){data.TIMER=0;data.SONG=false;if(typeof(userData.data.FRIENDS.data[userData.data.FRIENDS_HASH[data.USER_ID]])=='undefined'){var _id=(userData.data.FRIENDS.data.push(data));userData.data.FRIENDS_HASH[data.USER_ID]=_id-1;$item=friends.build(data,true);$('#offlinePane').prepend($item);}}
break;case'song':userData.data.FAVORITES_SONGS_HASH[id]=true;break;default:return false;}
return true;}catch(e){console.log(e.message,e.stack);}},deleteFavorite:function(type,id){try{switch(type){case'artist':delete userData.data.FAVORITES_ARTISTS_HASH[id];for(var a=0;a<userData.data.FAVORITES_ARTISTS.count;a++){if(userData.data.FAVORITES_ARTISTS.data[a].ART_ID==id){userData.data.FAVORITES_ARTISTS.data.splice(a,1);userData.data.FAVORITES_ARTISTS.total-=1;userData.data.FAVORITES_ARTISTS.count-=1;return false;}}
break;case'album':delete userData.data.FAVORITES_ALBUMS_HASH[id];break;case'radio':delete userData.data.FAVORITES_RADIOS_HASH[id];for(a=0;a<userData.data.FAVORITES_RADIOS.count;a++){if(userData.data.FAVORITES_RADIOS.data[a].RADIO_ID==id){userData.data.FAVORITES_RADIOS.data.splice(a,1);userData.data.FAVORITES_RADIOS.total-=1;userData.data.FAVORITES_RADIOS.count-=1;return false;}}
break;case'playlist':delete userData.data.FAVORITES_PLAYLISTS_HASH[id];break;case'application':delete userData.data.FAVORITES_APPLICATIONS_HASH[parseInt(id,10)];break;case'friend':delete userData.data.FRIENDS.data[userData.data.FRIENDS_HASH[id]];delete userData.data.FRIENDS_HASH[id];friends.removeFriend(id);break;case'song':delete userData.data.FAVORITES_SONGS_HASH[id];break;default:return false;}
return true;}catch(e){console.log(e);}},addPlaylist:function(data){try{var insertPlaylist={CHECKSUM:'',PARENT_USER_ID:USER.USER_ID.toString(),PLAYLIST_ID:data.id.toString(),STATUS:'0',TITLE:data.title};if(getObjectSize(userData.data.PLAYLISTS.data)===0){userData.data.PLAYLISTS={count:0,total:0,data:[]};}
userData.data.PLAYLISTS.data.push(insertPlaylist);userData.data.PLAYLISTS.count+=1;userData.data.PLAYLISTS.total+=1;}catch(e){console.log(e);}},deletePlaylist:function(data){try{for(var p=0;p<userData.data.PLAYLISTS.count;p++){if(userData.data.PLAYLISTS.data[p].PLAYLIST_ID==data.playlist_id){userData.data.PLAYLISTS.data.splice(p,1);userData.data.PLAYLISTS.count-=1;userData.data.PLAYLISTS.total-=1;break;}}}catch(e){console.log(e);}},storeListCallback:function(request){try{if(request.error.length===0){for(var j=0;j<request.results.count;j++){userData.dataStore[request.results.data[j].ISRC]=true;}
if(Modernizr.localstorage){window.localStorage.setItem('storeTrack_'+USER.USER_ID,JSON.stringify(userData.dataStore));}
Events.resolve(Events.user.dataStoreReady);}}catch(e){console.log(e);}},storeList:function(isrcList){try{if(typeof(isrcList)!='object'){return false;}
for(var j=0;j<isrcList.length;j++){userData.dataStore[isrcList[j]]=true;}}catch(e){console.log(e);}},addArtistCompleteList:function(request){try{userData.data.FAVORITES_RADIOS=request.results.FAVORITES_ARTISTS;}catch(e){console.log(e);}}};};
(function($){$.tiny=$.tiny||{};$.tiny.scrollbar={options:{axis:'y',wheel:40,scroll:true,size:'auto',sizethumb:'auto',extremePosition:false,extremePreventDefault:true}};$.fn.tinyscrollbar=function(options){var options=$.extend({},$.tiny.scrollbar.options,options);this.each(function(){$(this).data('tsb',new Scrollbar($(this),options));});return this;};$.fn.scrollPosition=function(){return $(this).data('tsb').scrollPosition();};$.fn.tinyscrollbar_update=function(sScroll){if(typeof($(this).data('tsb'))=='undefined'){return false;}
return $(this).data('tsb').update(sScroll);};$.fn.scrollTo=function(arg){return $(this).data('tsb').scrollTo(arg);};function Scrollbar(root,options){var oSelf=this;var oWrapper=root;var oViewport={obj:$('.tinyscroll_viewport',root)};var oContent={obj:$('.tinyscroll_overview',root)};var oScrollbar={obj:$('.tinyscroll_scrollbar',root)};var oTrack={obj:$('.tinyscroll_track',oScrollbar.obj)};var oThumb={obj:$('.tinyscroll_thumb',oScrollbar.obj)};var sAxis=options.axis=='x',sDirection=sAxis?'left':'top',sSize=sAxis?'Width':'Height';var iScroll,iPosition={start:0,now:0},iMouse={};function initialize(){oSelf.update();setEvents();return oSelf;}
this.scrollPosition=function(){return iScroll;};this.update=function(sScroll){oViewport[options.axis]=oViewport.obj[0]['offset'+sSize];oContent[options.axis]=oContent.obj[0]['scroll'+sSize];oContent.ratio=oViewport[options.axis]/oContent[options.axis];oScrollbar.obj.toggleClass('disable',oContent.ratio>=1);oTrack[options.axis]=options.size=='auto'?oViewport[options.axis]:options.size;oThumb[options.axis]=Math.min(oTrack[options.axis],Math.max(0,(options.sizethumb=='auto'?(oTrack[options.axis]*oContent.ratio):options.sizethumb)));oScrollbar.ratio=options.sizethumb=='auto'?(oContent[options.axis]/oTrack[options.axis]):(oContent[options.axis]-oViewport[options.axis])/(oTrack[options.axis]-oThumb[options.axis]);iScroll=(sScroll=='relative'&&oContent.ratio<=1)?Math.min((oContent[options.axis]-oViewport[options.axis]),Math.max(0,iScroll)):0;iScroll=(sScroll=='bottom'&&oContent.ratio<=1)?(oContent[options.axis]-oViewport[options.axis]):isNaN(parseInt(sScroll))?iScroll:parseInt(sScroll);setSize();if(options.extremePosition)isExtremePosition(iScroll);};this.scrollTo=function(position){iScroll=position;var oThumbAnimate={};oThumbAnimate[sDirection]=iScroll/oScrollbar.ratio;var oContentAnimate={};oContentAnimate[sDirection]=-iScroll;oThumb.obj.stop(true).animate(oThumbAnimate);oContent.obj.stop(true).animate(oContentAnimate);if(options.extremePosition)isExtremePosition(iScroll);};function setSize(){oThumb.obj.css(sDirection,iScroll/oScrollbar.ratio);oContent.obj.css(sDirection,-iScroll);iMouse['start']=oThumb.obj.offset()[sDirection];var sCssSize=sSize.toLowerCase();oScrollbar.obj.css(sCssSize,oTrack[options.axis]);oTrack.obj.css(sCssSize,oTrack[options.axis]);oThumb.obj.css(sCssSize,oThumb[options.axis]);};function setEvents(){oThumb.obj.bind('mousedown',start);oThumb.obj[0].ontouchstart=function(oEvent){oEvent.preventDefault();oThumb.obj.unbind('mousedown');start(oEvent.touches[0]);return false;};oTrack.obj.bind('mouseup',drag);if((options.scroll)&&this.addEventListener){oWrapper[0].addEventListener('DOMMouseScroll',wheel,false);oWrapper[0].addEventListener('mousewheel',wheel,false);}
else if(options.scroll){oWrapper[0].onmousewheel=wheel;}};function start(oEvent){iMouse.start=sAxis?oEvent.pageX:oEvent.pageY;var oThumbDir=parseInt(oThumb.obj.css(sDirection));iPosition.start=oThumbDir=='auto'?0:oThumbDir;$(document).bind('mousemove',drag);document.ontouchmove=function(oEvent){$(document).unbind('mousemove');drag(oEvent.touches[0]);};$(document).bind('mouseup',end);oThumb.obj.bind('mouseup',end);oThumb.obj[0].ontouchend=document.ontouchend=function(oEvent){$(document).unbind('mouseup');oThumb.obj.unbind('mouseup');end(oEvent.touches[0]);};return false;};function wheel(oEvent){if(!(oContent.ratio>=1)){var oEvent=oEvent||window.event;var iDelta=oEvent.wheelDelta?oEvent.wheelDelta/120:-oEvent.detail/3;iScroll-=iDelta*options.wheel;iScroll=Math.min((oContent[options.axis]-oViewport[options.axis]),Math.max(0,iScroll));oThumb.obj.css(sDirection,iScroll/oScrollbar.ratio);oContent.obj.css(sDirection,-iScroll);root.trigger('jsp-scrolling',iScroll);var is_extreme_position=false;if(parseInt(iScroll)==(oContent[options.axis]-oViewport[options.axis])||parseInt(iScroll)==0){is_extreme_position=true;}
if(options.extremePreventDefault||!is_extreme_position){oEvent=$.event.fix(oEvent);oEvent.preventDefault();}
if(options.extremePosition)isExtremePosition(iScroll);};};function end(oEvent){$(document).unbind('mousemove',drag);$(document).unbind('mouseup',end);oThumb.obj.unbind('mouseup',end);document.ontouchmove=oThumb.obj[0].ontouchend=document.ontouchend=null;return false;};function drag(oEvent){if(!(oContent.ratio>=1)){iPosition.now=Math.min((oTrack[options.axis]-oThumb[options.axis]),Math.max(0,(iPosition.start+((sAxis?oEvent.pageX:oEvent.pageY)-iMouse.start))));iScroll=iPosition.now*oScrollbar.ratio;oContent.obj.css(sDirection,-iScroll);oThumb.obj.css(sDirection,iPosition.now);if(options.extremePosition)isExtremePosition(iScroll);}
return false;};function isExtremePosition(iScroll){if(parseInt(iScroll)==(oContent[options.axis]-oViewport[options.axis])){root.trigger('jsp-scroll-y',['bottom']).trigger('scroll');}else if(parseInt(iScroll)==0){root.trigger('jsp-scroll-y',['top']).trigger('scroll');}};return initialize();};})(jQuery);;
(function($){$.fn.searchBar=function(method){var params={instance:'header',types:{'ARTIST':true,'ALBUM':true,'TRACK':true},nb_suggestion:4,label:trad.suggest.search_default,analytics:false,last_search:"",last_search_result:"",timer:null,query:null,div:null,length:0,selected:0,block:false,modele_completion:false,autofocus:false,div_loading:false,tinyscroll:false,link_type:'loadbox',artist_baseurl:"loadBox('artist/{0}');",album_baseurl:"loadBox('album/{0}');",track_baseurl:"dzPlayer.playTracksId([{0}]); loadBox('album/{1}');",search_baseurl:'loadBox("search/{0}");'}
var suggest={cache:new Object()}
var methods={init:function(options){params=$.extend(params,options);params.div=this;params.div_suggest=$('.suggest',this);params.div_input=$('input:first',this);params.div_submit_container=$('.search_button_container',this);if(params.div_loading!=false){params.div_submit_container=$('.search_button_container',params.div_loading);}
params.div_submit=$('[type="submit"]',params.div_submit_container);params.suggestion_type=0;params.suggestion_index=0;params.suggestion_id=0;params.suggestion_label='';params.modele_artist_completion=$('li.template',$('ul.artist',params.div_suggest)).hide().clone();params.modele_album_completion=$('li.template',$('ul.album',params.div_suggest)).hide().clone();params.modele_track_completion=$('li.template',$('ul.track',params.div_suggest)).hide().clone();$('li.suggestion',$('ul.artist',params.div_suggest)).remove();$('li.suggestion',$('ul.album',params.div_suggest)).remove();$('li.suggestion',$('ul.track',params.div_suggest)).remove();if($('.cross',params.div).length==1){$('.cross',params.div).unbind('click').click(function(){params.query='';params.div_input.val('');params.div_input.focus();$(this).hide();helpers.hideLoading();}).hide();}
params.div_submit.unbind('click').click(function(){if(params.div_input.val()!=params.label&&params.div_input.val()!=''){methods.search(params.div_input.val(),'click');}else{params.div_input.val('');};});if(params.autofocus){params.div_input.focus();}else{params.div_input.val(params.label);}
params.div_input.attr('placeholder',params.label);params.div_input.unbind('blur').blur(function(){helpers.hideSuggest();});params.div_input.unbind('focus').focus(function(){params.selected=0;if(this.value==params.label){this.value='';}
if(this.value!=''&&params.query!=this.value){params.query=this.value;}
$('#search_link',params.div_suggest).addClass('selected');params.timer=setTimeout(function(){methods.completion();},200);});params.div_suggest.unbind('mouseover').mouseover(function(e){params.block=true;});params.div_suggest.unbind('mouseout').mouseout(function(e){params.block=false;});params.div_input.unbind('keyup').keyup(function(event){if(params.timer!=null){clearTimeout(params.timer);}
if(event.keyCode!=38&&event.keyCode!=40&&event.keyCode!=13){params.query=this.value;$('#search_link',params.div_suggest).addClass('selected');params.timer=setTimeout(function(){methods.completion();},200);}
var first=$('.suggestion',params.div_suggest).first();var last=$('.suggestion',params.div_suggest).last();var selected=$('.suggestion.selected',params.div_suggest);var first_id=$(first).attr('data-i');var last_id=$(last).attr('data-i');var selected_id=0;if($(selected).length>0){var selected_id=parseInt($(selected).attr('data-i'));}
$('.suggestion',params.div_suggest).removeClass('selected');if(event.keyCode==38){if(selected_id==1){params.div_input.focus();return true;}
var prev_id=last_id;if(selected_id>0){prev_id=parseInt(selected_id)-1;if(prev_id<first_id){prev_id=last_id;}}
params.selected=prev_id;helpers.overItem(prev_id);}
if(event.keyCode==40){if(selected_id==last_id){params.div_input.focus();return true;}
var next_id=first_id;if(selected_id>0){next_id=parseInt(selected_id)+1;if(next_id>last_id){next_id=first_id;}}
params.selected=next_id;helpers.overItem(next_id);}
if(event.keyCode==13){params.block=false;params.div_input.val(params.query).blur();if($(selected).length>0){methods.trackingSuggestion('enter',selected);if(params.link_type=='location'){location.href=$('a.result_link',selected).attr('href');}else{eval('(function() { '+$('a.result_link',selected).attr('onClick')+'})()');}}else{params.timer=setTimeout(function(){methods.search(params.div_input.val(),'enter');},200);}}});$(document).click(function(event){if($(event.target).attr('id')!=$(params.div_input).attr('id')){params.block=false;helpers.hideSuggest();}});},completion:function(){if(params.query!=params.div_input.val()){params.query=params.div_input.val();}
if($('.cross',params.div).length==1){if(params.query==null||params.query==''||params.query==params.label){$('.cross',params.div).css('display','none');}else if($('.cross',params.div).css('display')=='none'){$('.cross',params.div).css('display','block');}}
if(params.query!=null&&params.query!=''&&params.query.length>=1){helpers.showLoading();params.query=jQuery.trim(params.query);$('.search_link_label',params.div_suggest).html(params.query);if(params.link_type=='location'){$('.search_link',params.div_suggest).attr('href',params.search_baseurl.format(addslashes(params.query)));}else{$('.search_link',params.div_suggest).attr('onclick',params.search_baseurl.format(addslashes(params.query))+' return false;');}
if(suggest.cache[params.query]!=null){methods.completionCallBack(suggest.cache[params.query]);}else{sendRequest('/'+SETTING_LANG+'/suggest?q='+encodeURIComponent(addslashes(params.query))+'&c='+encodeURIComponent(COUNTRY)+'&limit='+params.nb_suggestion,'text','',true,methods.completionCallBack,false,'suggest_request');}}else{params.block=false;helpers.hideSuggest();helpers.hideLoading();}},completionCallBack:function(request){helpers.hideLoading();params.selected=0;suggest.cache[params.query]=request;if(typeof(request.responseText)=='undefined'){return false;}
request=request.responseText;if(request==false||request.length==0||request=='error'){return false;}
request=eval('('+request+')');if(request['ARTIST'].length==0&&request['ALBUM'].length==0&&request['TRACK'].length==0){helpers.hideSuggest();return false;}
$('.search_result_container').hide();result='';var display_lines=[];display_lines['ARTIST']=[];display_lines['ALBUM']=[];display_lines['TRACK']=[];var j=0;for(type in request){for(i=0;i<request[type].length;i++){if(typeof(params.types[type])=='undefined'||!params.types[type]){continue;}
var label='';var title='';switch(type){case'ARTIST':var id=request[type][i].ART_ID;label=request[type][i].ART_NAME;title=label;$item=params.modele_artist_completion.clone();$('.artist_name',$item).html(methods.highlight(request[type][i].ART_NAME));$('img.artist_picture',$item).attr('src',SETTING_DOMAIN_IMG+'/artist/'+request[type][i].ART_PICTURE+'/26x26-000000-80-0-0.jpg');if(params.link_type=='location'){$('a.result_link',$item).attr('href',params.artist_baseurl.format(request[type][i].ART_ID));}else{$('a.result_link',$item).attr('onClick',params.artist_baseurl.format(request[type][i].ART_ID,addslashes(label))+' return false;');}
break;case'ALBUM':var id=request[type][i].ALB_ID;label=request[type][i].ALB_TITLE;title=request[type][i].ART_NAME+' '+request[type][i].ALB_TITLE;$item=params.modele_album_completion.clone();$('.artist_name',$item).html(methods.highlight(request[type][i].ART_NAME));$('.album_title',$item).html(methods.highlight(request[type][i].ALB_TITLE));$('img.album_picture',$item).attr('src',SETTING_DOMAIN_IMG+'/cover/'+request[type][i].ALB_PICTURE+'/26x26-000000-80-0-0.jpg');if(params.link_type=='location'){$('a.result_link',$item).attr('href',params.album_baseurl.format(request[type][i].ALB_ID));}else{$('a.result_link',$item).attr('onClick',params.album_baseurl.format(request[type][i].ALB_ID,addslashes(label))+' return false;');}
break;case'TRACK':var id=request[type][i].SNG_ID;label=request[type][i].SNG_TITLE;title=request[type][i].ART_NAME+' '+request[type][i].SNG_TITLE;var now=new Date();$item=params.modele_track_completion.clone();$('.artist_name',$item).html(methods.highlight(request[type][i].ART_NAME));$('.track_title',$item).html(methods.highlight(request[type][i].SNG_TITLE));$('.duration',$item).html('('+methods.formatTime(request[type][i].DURATION)+')');var release_date=null;if(typeof(request[type][i].RIGHTS.STREAM_ADS)!='undefined'){release_date=request[type][i].RIGHTS.STREAM_ADS;var release_date_year=release_date.substr(0,4);var release_date_month=release_date.substr(5,2)-1;var release_date_day=release_date.substr(8,2);release_date=new Date(release_date_year,release_date_month,release_date_day);}
if(release_date!=null&&methods.dateDiff(release_date,now)>0){$('a.result_link',$item).addClass('soon');$('a.result_link',$item).attr('release-day',release_date_day);$('a.result_link',$item).attr('release-month',release_date_month);}else{if(params.link_type=='location'){$('a.result_link',$item).attr('href',params.track_baseurl.format(request[type][i].SNG_ID));}else{$('a.result_link',$item).attr('onClick',params.track_baseurl.format(request[type][i].SNG_ID,request[type][i].ALB_ID)+' return false;');}}
break;}
$item.attr({'data-i':j+1,'data-query':addslashes(label),'id':id,'type':type,'label':addslashes(label),'title':title}).removeClass('template').addClass('suggestion').show();display_lines[type].push(util.getOuterHTML($item));j++;}}
$('ul.artist',params.div_suggest).html('');$('ul.album',params.div_suggest).html('');$('ul.track',params.div_suggest).html('');$('ul.artist',params.div_suggest).html(display_lines['ARTIST'].join(''));if(display_lines['ARTIST'].length>0){$('.artist',params.div_suggest).show();}
$('ul.album',params.div_suggest).html(display_lines['ALBUM'].join(''));if(display_lines['ALBUM'].length>0){$('.album',params.div_suggest).show();}
$('ul.track',params.div_suggest).html(display_lines['TRACK'].join(''));if(display_lines['TRACK'].length>0){$('.track',params.div_suggest).show();}
helpers.showSuggest();if(params.tinyscroll!==false){var max_height=params.tinyscroll*$('li.suggestion').outerHeight();var _height=j*$('li.suggestion').outerHeight();if(_height>max_height){_height=max_height;}
params.div_suggest.height(_height);if($('.tinyscroll_viewport',params.div_suggest).length==0){helpers.createTinyscrollView(params.div_suggest).tinyscrollbar();params.div_suggest.click(function(event){return false;});}
params.div_suggest.tinyscrollbar_update();if(j>10){$('.tinyscroll_scrollbar',params.div_suggest).show();}else{$('.tinyscroll_scrollbar',params.div_suggest).hide();}}
$('.suggestion',params.div_suggest).unbind('click').click(function(){methods.trackingSuggestion('click',this);params.block=false;helpers.hideSuggest();});$('.suggestion',params.div_suggest).unbind('mouseover').mouseover(function(){$('.suggestion',params.div_suggest).removeClass('selected');params.selected=$(this).attr('data-i');helpers.overItem(params.selected);});$('.close',params.div_suggest).unbind('click').click(function(){params.block=false;helpers.hideSuggest();});$('#search_link',params.div_suggest).unbind('click').click(function(){methods.trackingSuggestion('click');params.block=false;helpers.hideSuggest();});$('#search_link',params.div_suggest).unbind('mouseover').mouseover(function(){$('.suggestion',params.div_suggest).removeClass('selected');$(this).addClass('selected');});helpers.showUnreleasedTracks();return true;},search:function(query,event_type){if(params.timer!=null){clearTimeout(params.timer);}
if(query==''){return false;}
params.block=false;helpers.hideSuggest();query=query.replace(/\//g,' ');if(params.analytics){methods.trackingSuggestion(event_type);}
if(params.link_type=='location'){location.href=params.search_baseurl.format(addslashes(query));}else{eval(params.search_baseurl.format(addslashes(query)));}
return true;},dateDiff:function(date1,date2){return date1.getTime()-date2.getTime();},formatTime:function(timestamp){var dt=new Date();dt.setTime(timestamp*1000);var minutes=dt.getMinutes();var seconds=dt.getSeconds();if(minutes<10){minutes='0'+minutes;}
if(seconds<10){seconds='0'+seconds;}
return minutes+":"+seconds;},highlight:function(str){if(typeof(str)=='undefined'||str==''){return str;}
var reg=new RegExp("("+params.query+")","gi");return str.replace(reg,function(matched){return'<strong class="highlight">'+matched+'</strong>';});},trackingSuggestion:function(){var event_type='';if(arguments[0]!='undefined'){event_type=arguments[0];}
if(typeof(arguments[1])=='undefined'){params.suggestion_index=0;params.suggestion_id=0;params.suggestion_type='all';params.suggestion_label='';}else{var obj=arguments[1];params.suggestion_index=$(obj).attr('data-i');params.suggestion_id=$(obj).attr('id');params.suggestion_type=$(obj).attr('type');params.suggestion_label=$(obj).attr('label');}
if(params.analytics){tracking.track('search_trigger',{'instance':params.instance,'event_type':event_type,'suggestion_type':params.suggestion_type,'suggestion_index':params.suggestion_index,'suggestion_id':params.suggestion_id,'suggestion_label':params.suggestion_label,'query':addslashes(params.query)});return true;}
return false;}}
var helpers={showSuggest:function(){params.div_suggest.show();Events.trigger(Events.search.suggestDisplayed);return true;},hideSuggest:function(){if(!params.block){params.div_suggest.hide();}
return true;},showLoading:function(){$('.search_button',params.div_submit_container).hide();$('.loading',params.div_submit_container).show();},hideLoading:function(){$('.search_button',params.div_submit_container).show();$('.loading',params.div_submit_container).hide();},overItem:function(id){$('#search_link',params.div_suggest).removeClass('selected');var li=$('li[class~="suggestion"][data-i="'+(id)+'"]',params.div_suggest);$(li).addClass('selected');return true;},showUnreleasedTracks:function(){var months=new Array('',trad.date.jan,trad.date.feb,trad.date.mar,trad.date.apr,trad.date.may,trad.date.jun,trad.date.jul,trad.date.aug,trad.date.sep,trad.date.oct,trad.date.nov,trad.date.dec);$('a.result_link.soon',params.div_suggest).each(function(index){var day=$(this).attr('release-day');var month=$(this).attr('release-month');var month_id=month.substr(0,1)=='0'?month.substr(1):month;$('.naboo_line_soon_month',$('.icn_suggest-soon',$(this))).text(months[month_id]);$('.naboo_line_soon_num',$('.icn_suggest-soon',$(this))).text(day);$('.icn_suggest-play',$(this)).hide();$('.icn_suggest-soon',$(this)).show();$(this).removeAttr('href');$(this).removeAttr('onClick');$(this).attr('title',trad.music.naboo_rights_not_release_free);$('.artist_name',$(this)).addClass('soon');$('.track_title',$(this)).addClass('soon');$('.duration',$(this)).addClass('soon');$(this).tipsy({trigger:'hover',gravity:'s',fallback:trad.music.naboo_rights_not_release_free,force_top:true});});},createTinyscrollView:function($div){var scroll=util.getOuterHTML($('.tinyscroll_scrollbar','.tinyscroll_template'));var viewPort=util.getOuterHTML($('.tinyscroll_viewport','.tinyscroll_template'));return $div.wrapInner(viewPort).prepend(scroll);}}
if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method "'+method+'" does not exist in DeezerSearch plugin!');}}})(jQuery);;
var www={display_languages:false,layout_state_width:null,layoutDetectSize:function(){var layout_state_width;if(client_width<=1170){layout_state_width='small';}else if(client_width>1170){layout_state_width='big';}
if(www.layout_state_width!=layout_state_width){www.layout_state_width=layout_state_width;Events.trigger(Events.layout.width_type,www.layout_state_width);}
return www.layout_state_width;},drawFormResult:function(id,classname,data){try{$("#"+id).html(data).removeClass().addClass(classname).show();}catch(e){console.log(e.message,e.stack);}},hideFormResult:function(id){try{$("#"+id).hide();}catch(e){console.log(e.message,e.stack);}},openDemo:function(url){try{params='width=820, height=550, resizable=no, scrollbars=no, toolbars=no, location=no, directories=no, status=no, menubar=no, copyhistory=no';var fwin=window.open(url,'demoWin',params);if(fwin&&window.focus)fwin.focus();}catch(e){console.log(e.message,e.stack);}},displayBackground:function(body){try{$('body').css('background',body);}catch(e){console.log(e.message,e.stack);}},getAbsoluteTop:function(objectId){try{o=document.getElementById(objectId);oTop=o.offsetTop;return oTop;}catch(e){console.log(e.message,e.stack);}},getAbsoluteTopParent:function(objectId){try{var o=document.getElementById(objectId);oTop=o.offsetTop;while(o.offsetParent!==null){oParent=o.offsetParent;oTop+=oParent.offsetTop;o=oParent;}
return oTop;}catch(e){console.log(e.message,e.stack);}},displayLanguages:function(){try{if(www.display_languages===false){$('#languages-list').fadeIn("slow");www.display_languages=true;scrollTo(0,$(document).height());}else{$('#languages-list').fadeOut("slow");www.display_languages=false;}}catch(e){console.log(e.message,e.stack);}},displayInfo:function(div_id,string){try{if(string===0){$('#display_info').hide();}else{var offset=www.getAbsoluteTop(div_id);$('#display_info_text').html(string);$('#display_info').css('top',(offset-55)+'px').show();}}catch(e){console.log(e.message,e.stack);}},goto_anchor:function(id){try{$('#page_content').scrollTop(www.getAbsoluteTopParent(id));return false;}catch(e){console.log(e.message,e.stack);}},operator_form:function(form){try{if(form=='login'){$('#operator_form_login').show();$('#operator_form_register').hide();}else if(form=='register'){$('#operator_form_login').hide();$('#operator_form_register').show();}}catch(e){console.log(e.message,e.stack);}},orange_form:function(form){try{if(form=='login'){$('#orange_form_login').show();$('#orange_form_register').hide();}else if(form=='register'){$('#orange_form_login').hide();$('#orange_form_register').show();}}catch(e){console.log(e.message,e.stack);}},scrollOffersPage:function($el){try{$el.parent().siblings().removeClass('active');$el.parent().addClass('active');var target_id=$el.attr('href');var $target=$(target_id);var offset_y=(PLATFORM==='web')?$target.position().top:$target.offset().top;var $scroller=(PLATFORM==='web')?$('#page_content'):$('html,body');$scroller.animate({scrollTop:offset_y},'slow');}catch(e){console.log(e.message,e.stack);}},getCurrentPageType:function(){try{var path=[];if($.address.path().indexOf('landing')>-1){path=['landing'];}else if(actual_box!=''&&actual_box!='index.php'){path=actual_box.split('/');}else{path.push('');}
return path[0];}catch(e){console.log(e.message,e.stack);}},getCurrentPageId:function(){try{var page_id=0;var path=[];if(actual_box!==''&&actual_box!='index.php'){path=actual_box.split('/');}
switch(www.getCurrentPageType()){case"playlist":case"album":case"artist":case"video":case"radio":page_id=path[1];break;}
return page_id;}catch(e){console.log(e.message,e.stack);}},allowAutoPromo:function(data){try{if(data.FILTERS=='free'&&DZPS){return false;}
if(data.FILTERS=='premium'&&!DZPS){return false;}
if(data.LOGGED_FILTERS=='notlogged'&&USER.USER_ID>0){return false;}
if(data.LOGGED_FILTERS=='logged'&&USER.USER_ID===0){return false;}
return true;}catch(e){console.log(e.message,e.stack);}},updateContentBackground:function(){try{var $page=$('#naboo_content').children().first();var bg=$page.attr('data-bg');if(typeof(bg)!=='string'){$(page_content).removeAttr('data-bg');return false;}
$(page_content).attr('data-bg',bg);return true;}catch(e){console.log(e.message,e.stack);}}};try{$(document).ready(function(){window.page_content=$('#page_content').get(0);if(typeof(window.page_content)!='undefined'){page_content.onscroll=function(){try{yscroll=page_content.scrollTop;infinite_scroll.checkPosition();clearInterval(hovercard.timeout);if(hovercard.current!=null){hovercard.hide();}
Events.trigger(Events.layout.scroll,{yscroll:yscroll});return true;}catch(e){console.log(e.message,e.stack);}};}
client_height=getClientHeight();client_width=getClientWidth();window.onresize=document.onresize=function(){try{var prev_client_height=client_height;var prev_client_width=client_width;client_height=getClientHeight();client_width=getClientWidth();if(prev_client_height==client_height&&prev_client_width==client_width){return false;}
www.layoutDetectSize();if(typeof(menu)!='undefined'){menu.adjustUserMenu();}
infinite_scroll.checkPosition();Events.trigger(Events.layout.resize,{'client_width':client_width,'client_height':client_height});return true;}catch(e){console.log(e.message,e.stack);}};window.onblur=function(){ads_focus_value=false;ads.checkAutoRefresh(true);return true;};window.onfocus=function(){ads_focus_value=true;ads.checkAutoRefresh(true);return true;};window.onbeforeunload=function(){if(dzPlayer.playing&&(typeof(USER.SETTING.global.popup_unload)=='undefined'||!USER.SETTING.global.popup_unload)&&(typeof(loadPaymentProgress)=='undefined')){return trad.player.quitConfirm;}};window.onunload=function(){if(dzPlayer.getCurrentSongInfo()!=null){dzPlayer.logManager(false);facebook.closeMusicBridge();}};document.write=function(){return false;};document.open=function(){return false;};document.close=function(){return false;};if(typeof(Modernizr)!='undefined'&&Modernizr.history&&typeof($.address)!=='undefined'){$.address.state('/'+SETTING_LANG+'/');}
var init_state=true;if(typeof($.address)!='undefined'){$.address.init(function(event){actual_box=$.address.path().substr(1);if(actual_box===''&&USER.USER_ID>0){actual_box='picks';}
if(actual_box.indexOf('landing')>-1){actual_box=actual_box.substr(8);}}).change(function(event){try{if(init_state){init_state=false;return;}
var aPaths=event.value.split('/');if(!(typeof(aPaths[1])!='undefined'&&aPaths[1]=='app')&&event.value.indexOf("?")!=-1){return false;}
if(aPaths[1]=='apps'){return false;}
if(aPaths[1]=='app'){var actual=actual_box.split('/');if(actual[0]=='app'&&actual[1]==aPaths[2]){var new_app_page=aPaths.slice(3).join('/');actual_box=event.value.substr(1);if(typeof(app)!='undefined'){app.loadPage(new_app_page);}
return false;}}
back_hash=event.value;if(back_hash.substr(0,1)=='/'){back_hash=back_hash.substr(1,back_hash.length-1);}
if(typeof(actual_box)!='undefined'&&actual_box!=back_hash){if(www.getCurrentPageType()=='picks'&&actual_box=='picks'){return false;}
if(www.getCurrentPageType()=='tops'&&actual_box.substr(0,4)=='tops'){return false;}
actual_box=back_hash;loadBox(actual_box);}}catch(e){console.log(e.message,e.stack);}});}});}catch(e){console.log(e.message,e.stack);};
var dzform={password:null,checkMail:function(str,callback,output){try{if(!str.match(/^[_\.0-9a-z-+]+@([0-9a-z-]+\.)+[a-z]{2,6}$/i)){$("#register_mail_available").hide();$("#register_mail_unavailable").hide();return false;}else{callback_parameters=new Object();callback_parameters['callback']=callback;callback_parameters['output']=output;sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=check_mail&register_mail='+encodeURIComponent(str),true,dzform.checkMailCallback,callback_parameters);return true;}}catch(e){console.log(e);}},checkMailCallback:function(request,callback_parameters){try{if(request==false||request==null||typeof(request.responseText)=='undefined'){return false;}
request=request.responseText;if(callback_parameters['callback']!=null)callback=callback_parameters['callback'];else callback='';if(callback_parameters['output']!=null)output=callback_parameters['output'];else output='';if(request=='available'){callback('','',output,true);$("#register_mail_available").show();$("#register_mail_unavailable").hide();}else{callback('','',output,false);$("#register_mail_available").hide();$("#register_mail_unavailable").show();}
return true;}catch(e){console.log(e);}},checkPassword:function(str){try{dzform.password=str;if(str.length<6||str.length>50)return false;else return true;}catch(e){console.log(e);}},checkPasswordConfirm:function(str){try{if(str.length<6||str.length>50||str!=dzform.password)return false;else return true;}catch(e){console.log(e);}},checkUserName:function(str,callback,output){try{var regex_allowed=new RegExp("^([a-zA-Z0-9,-_\\s]+)$");var regex_denied=new RegExp("^([^<>\\\/]+)$");var regex_numeric=new RegExp("^([0-9]+)$");if(str.length<2||str.length>50||((regex_allowed.test(str)&&regex_denied.test(str))==false)||regex_numeric.test(str)==true){return false;}else{return true;}}catch(e){console.log(e);}},checkGender:function(str){try{if(str!='M'&&str!='F')return false;else return true;}catch(e){console.log(e);}},checkFirtname:function(str){try{if(trim(str).length==0)return false;else return true;}catch(e){console.log(e);}},checkLastname:function(str){try{if(trim(str).length==0)return false;else return true;}catch(e){console.log(e);}},checkDate:function(str){try{if(!str.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/))return false;else return true;}catch(e){console.log(e);}},checkCountry:function(str){try{if(trim(str).length!=2)return false;else return true;}catch(e){console.log(e);}},checkCheckbox:function(str){try{if($('#'+str).prop('checked'))return true;else return false;}catch(e){console.log(e);}},checkCBCardNo:function(str){try{if(trim(str).length==0)return false;else{var check_card_no=str.match(/^([0-9 \-]+)$/);if(!check_card_no)return false;else return true;}}catch(e){console.log(e);}},checkCBEd:function(str){try{if(!str.match(/^[0-9]{2}[0-9]{2}$/))return false;else return true;}catch(e){console.log(e);}},checkCBCVC:function(str){try{if(!str.match(/^[0-9]{3,4}$/))return false;else return true;}catch(e){console.log(e);}},checkPaymentPlateform:function(str){try{if(str!='cb'&&str!='paypal'&&str!='promo'&&str!='orange'&&str!='orange_p3t'&&str!='wallet')return false;else return true;}catch(e){console.log(e);}},callCheck:function(callback,str,output,result){try{if(result){if(result==true)$('#'+output).html('<img src="'+SETTING_STATIC+'/img/common/form_ok.png" alt="" />');else $('#'+output).html('<img src="'+SETTING_STATIC+'/img/common/form_nok.png" alt="" />');}
else if((typeof(callback)!=='undefined')&&(callback!='')){if(callback(str,dzform.callCheck,output))$('#'+output).html('<img src="'+SETTING_STATIC+'/img/common/form_ok.png" alt="" />');else $('#'+output).html('<img src="'+SETTING_STATIC+'/img/common/form_nok.png" alt="" />');}}catch(e){console.log(e);}},callbackRegisterError:function(error){try{if(error[0]=='error_ajax'||error==''||error=='undefined'){$('#register_errors_content').html(trad.general.register_errors_ajax);$('#register_errors').show();}else if(error!='undefined'){for(var idx in error){if(idx!='gender'&&idx!='birthday'&&idx!='country'&&idx!='terms'){$('#register_'+idx+'_check').html('<img src="'+SETTING_STATIC+'/img/common/form_nok.png" alt="" />');if($('#register_'+idx).attr('onfocus')==null){$('#register_'+idx).attr('onfocus','www.displayInfo(\'register_'+idx+'\', \''+addslashes(error[idx])+'\')');}}}}else{$('#register_errors_content').html(trad.general.register_errors_ajax);$('#register_errors').show();}}catch(e){console.log(e);}}};
var infinite_scroll={state:false,status:false,div:'',percent:95,active:function(div,percent){try{infinite_scroll.state=true;infinite_scroll.status=false;infinite_scroll.percent=95;if(typeof(percent)=="number"){infinite_scroll.percent=percent;}
return;}catch(e){console.log(e.message,e.stack);}},disable:function(){try{infinite_scroll.state=false;infinite_scroll.status=false;Events.unsubscribe(Events.layout.infiniteScroll);}catch(e){console.log(e.message,e.stack);}},checkPosition:function(evt){try{if(!infinite_scroll.state){return;}
if(infinite_scroll.status){return;}
var $page_content=$('#page_content');var content_height=$page_content.height();var content_scroll_height=$page_content.get(0).scrollHeight;var current_percent=(yscroll+content_height)*100/content_scroll_height;if(current_percent>=infinite_scroll.percent){infinite_scroll.status=true;Events.trigger(Events.layout.infiniteScroll,Math.min(100,Math.round(current_percent)));}
return;}catch(e){console.log(e.message,e.stack);}}};
if(typeof(naboo)=='undefined'){Events.subscribe(Events.live.pagefeed,function(evt,params){naboo.liveEvent(params[0]);});var naboo={displayed:false,set_via_seo:false,last_page:null,version:'old',allowed_pages:{'music':true,'track':true,'playlist':true,'album':true,'artist':true,'folder':true,'downloads':true,'personal_song':true,'search':true,'video':true,'offline':true,'profile':true,'app':true,'appstudio':true,'recommendations':true,'picks':true,'tops':true,'collection':true,'home':true,'loved':true},display:function(page){try{if(naboo.displayed==true&&naboo.last_page==page){return false;}
if(page=='home'&&naboo.last_page!=null&&naboo.displayed!=true){page=naboo.last_page;}
if(page==''){page='picks';}
split_param=page.split('?');paths=split_param[0].split('/');if(typeof(naboo.allowed_pages[paths[0]])=='undefined'){return false;}
disableAdsHabillage(page);naboo.set_via_seo=true;naboo.displayed=true;naboo.last_page=page;discography.last_album_type=null;menu_element_id=0;menu.load();infinite_scroll.disable();class_name=paths[0];showLoading();if(!window[class_name].display(page)){return false;}
return true;}catch(e){console.log(e.message,e.stack);}},afterLoad:function(scrolling){try{if(typeof(scrolling)=='undefined'||scrolling==null){scrolling=false;}
if(scrolling===true){$('#page_content').scrollTop(0);}
hideLoading();return true;}catch(e){console.log(e);}},hide:function(){try{naboo.displayed=false;$('#naboo').hide();infinite_scroll.disable();disableAudioAds();disableAdsPlayer();return true;}catch(e){console.log(e.message,e.stack);}},setViaSeo:function(type,id){try{if(naboo.set_via_seo!=true){naboo.set_via_seo=true;naboo.displayed=true;if(typeof(menu)!='undefined'){menu.load();menu.selectItem(type,id);if(typeof(dzPlayer)!='undefined'&&typeof(dzPlayer.cover)!='undefined'&&dzPlayer.cover!=null){$("#naboo_menu_infos_cover").attr('src',SETTING_DOMAIN_IMG+'/cover/'+dzPlayer.cover+'/315x315-000000-80-0-0.jpg');}
if(typeof(dzPlayer)!='undefined'&&typeof(dzPlayer.songTitle)!='undefined'&&dzPlayer.songTitle!=null){$("#naboo_menu_infos_cover_text_track").text(dzPlayer.songTitle);}
if(typeof(dzPlayer)!='undefined'&&typeof(dzPlayer.artistName)!='undefined'&&dzPlayer.artistName!=null){$("#naboo_menu_infos_cover_text_artist").text(dzPlayer.artistName);}
menu.displayCover(true);}}
return true;}catch(e){console.log(e.message,e.stack);}},removeAds:function(){try{if(naboo.last_page!=null){page=naboo.last_page;}else{page='';}
disableAudioAds();disableAdsHabillage(page);disableAdsPlayer();$('#ads_300x250_music').hide();$('#ads_adsense').hide();if(typeof(USER)!='undefined'&&USER.OPTIONS.ads_display==false&&$("#naboo_artist_biography_resume").html()!=''){$("#naboo_artist_biography_resume_premium").html($("#naboo_artist_biography_resume").html());$("#naboo_artist_biography_resume").html('');}
return true;}catch(e){console.log(e);}},adjustBackground:function(){try{console.log('naboo.adjustBackground is deprecated');return true;}catch(e){console.log(e.message,e.stack);}},checkLoggedStatus:function(){try{if($('#naboo_comment_new').length==1&&$('#naboo_comment_new_not_logged').length==1){if(typeof(USER.USER_ID)!='undefined'&&USER.USER_ID>0&&typeof(USER.BLOG_NAME)!='undefined'&&USER.BLOG_NAME!=null&&typeof(USER.USER_PICTURE)!='undefined'&&USER.USER_PICTURE!=null){$('#naboo_comment_new .naboo_comment_new_author .username').text(USER.BLOG_NAME);$('#naboo_comment_new .naboo_comment_new_author img').attr('src',SETTING_DOMAIN_IMG+'/user/'+USER.USER_PICTURE+'/40x40-000000-80-0-0.jpg');$('#naboo_comment_new').show();$('#naboo_comment_new_not_logged').hide();}else{$('#naboo_comment_new').hide();$('#naboo_comment_new_not_logged').show();}}
if($('#naboo_playlist').length==1){if(typeof(USER.USER_ID)!='undefined'&&USER.USER_ID>0&&typeof(USER.BLOG_NAME)!='undefined'&&USER.BLOG_NAME!=null&&typeof(USER.USER_PICTURE)!='undefined'&&USER.USER_PICTURE!=null){$('#naboo_vote_stars').unbind('mousemove',star.onMouseMouse).unbind('mouseout',star.onMouseOut).unbind('mouseup',star.onMouseClick).unbind('mouseover',star.onMouseOver);$("#naboo_vote_stars").bind('mouseover',star.onMouseOver);}else{$("#naboo_vote_stars").unbind('mouseover',star.onMouseOver);$('#naboo_vote_result').text('');$('#naboo_vote_stars').attr('onClick',"modal.open('/"+SETTING_LANG+"/login.php')");}}
return true;}catch(e){console.log(e);}},currentPageIsNaboo:function(){try{var path=[''];if(actual_box!=''){path=actual_box.split('/');}else if(USER.USER_ID>0){path=['picks'];}
if(naboo.allowed_pages[path[0]]){return true;}else{return false;}}catch(e){console.log(e);}},liveEvent:function(data){try{var currentNumber=1;switch(data.ACTION){case'ALBUM_COMMENT':case'ARTIST_COMMENT':case'PLAYLIST_COMMENT':if($('#tab_review_content').css('display')=='none'){if(!isNaN(parseInt($('#tab_review_link .badge').text()))){currentNumber=parseInt($('#tab_review_link .badge').text(),10)+1;}
$('#tab_review_link .badge').text('+'+currentNumber).show();}else{review.liveComment(data);}
break;case'ARTIST_FAN':case'PLAYLIST_FAN':if($('#tab_fan_content').css('display')=='none'){if(!isNaN(parseInt($('#tab_fan_link .badge').text()))){currentNumber=parseInt($('#tab_fan_link .badge').text(),10)+1;}
$('#tab_fan_link .badge').text('+'+currentNumber).show();}else{fan.liveFan();}
break;}
return true;}catch(e){console.log(e);}},}};
var orange={unlink:function(){try{if(confirm(trad.orange.unlink_text1)){$('#init_disable_orange_password').html(trad.orange.unlink_text2);$('#span_disable_orange_password').show();$('#div_disable_orange_password').show();}}catch(e){console.log(e);}},unlinkConfirm:function(){try{var password='';if($('#disable_orange_password').length==1)password=$('#disable_orange_password').val();var checkForm='';if($('#checkForm').length==1)
checkForm=$('#checkForm').val();var data='password='+encodeURIComponent(password)+'&checkForm='+encodeURIComponent(checkForm);request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=orange_unlink&'+data);if(request==false)return;var result=eval('('+request+')');if(result.error.length>0){www.drawFormResult('disable_orange_result','form_error',trad.orange.unlinkConfirm_text1);$('#disable_orange_result').delay(3000).fadeOut();}
else{www.drawFormResult('disable_orange_result','form_success',trad.orange.unlinkConfirm_text2);$('#disable_orange_result').delay(3000).fadeOut();setTimeout(function(){user.userLogin();loadBox('account/subscription');},3000);}}catch(e){console.log(e);}},checkPremium4Orange:function(){try{window.location.href='/orange/login.php';}catch(e){console.log(e);}},uk_test_number:function(){try{if(($('#ouk_test_phone')!=null)&&($('#ouk_test_phone').val().length>0)){var request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=orange_uk_test_number&phone='+encodeURIComponent($('#ouk_test_phone').val()));if(request=='error'){$('#ouk_error').html(trad.orange.uk_test_number1).show();}
else if(request=='fail'){modal.open('orange_uk/fail.php?phone='+encodeURIComponent($('#ouk_test_phone').val()),true);return true;}
else if(request=='error_soap'){$('#ouk_error').html(trad.orange.uk_test_number2).show();}
else{modal.open('orange_uk/final.php',true);}}
else{$('#ouk_error').html(trad.orange.uk_test_number2);}}catch(e){console.log(e);}},uk_check_code:function(){try{if(($('#ouk_code')!=null)&&($('#ouk_code').val().length>0)){var request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=orange_uk_check_code&code='+encodeURIComponent($('#ouk_code').val()));if(request=='error'){$('#ouk_error').html(trad.orange.uk_check_code1).show();}
else if(request=='error_check'){$('#ouk_error').html(trad.orange.uk_check_code2).show();}
else{modal.open('/orange_uk/confirm.php',true);return true;}}
else{$('#ouk_error').html(trad.orange.uk_active_account2);}}catch(e){console.log(e);}},uk_check_code_promo:function(){try{var code_promo='';if($('#code_promo').length==1)code_promo=$('#code_promo').val();check=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=orange_uk_check_code_promo&code='+encodeURIComponent(code_promo));if((check===false)||(check=='error')){$('#orange_code_promo_error').css('display','block');return false;}
modal.open('orange_uk/confirm.php',true);}catch(e){console.log(e);}}};
var operator={checkSubscriber:function(id){try{var $err=$('#subscriber_error');if(($('#subscriber_id')!=null)&&($('#subscriber_id').val().length>0)){var redirect_dir='operator';var redirect='';var request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=operator_check_subscriber&subscriber_id='+encodeURIComponent($('#subscriber_id').val()));if(request==''||request=='error'||request=='error_soap'){$err.html(operator_trad.error).show();}else if(request=='error_msisdn'){$err.html(operator_trad.error_msisdn).show();}else if(request=='error_activation_code'){$err.html(operator_trad.error_activation_code).show();}else if(request=='error_provisionning'){$err.html(operator_trad.error_provisionning).show();}else if(request=='error_quota_security_code'){$err.html(operator_trad.error_quota_security_code).show();}else if(request=='error_quota_sms'){$err.html(operator_trad.error_quota_sms).show();}else if(request=='fail'){modal.open(redirect_dir+'/fail.php?phone='+encodeURIComponent($('#subscriber_id').val()),'loading','general','','','1');return true;}else{if(request=='success_service'){if(USER.USER_ID!=0){redirect=redirect_dir+'/confirm.php';}else{redirect=redirect_dir+'/login_register.php';}}
if(request=='success_msisdn'||request=='success_email'){redirect=redirect_dir+'/code.php';}
if(redirect!=''){modal.open(redirect,true);}}}
else{$err.html(operator_trad.error);}}catch(e){if(typeof(console)!='undefined'){console.log(e);}}},checkCode:function(id){try{if(($('#activation_code')!=null)&&($('#activation_code').val().length>0)){var redirect_dir='operator';var redirect='';var request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=operator_check_activation_code&code='+encodeURIComponent($('#activation_code').val()));if(request=='error'){$('#activation_error').html(operator_trad.error).show();}else if(request=='error_activation_code'){$('#activation_error').html(operator_trad.error_activation_code).show();}else if(request=='error_quota_security_code'){$('#activation_error').html(operator_trad.error_quota_security_code).show();}else{if(USER.USER_ID>0){redirect=redirect_dir+'/confirm.php';}else{redirect=redirect_dir+'/login_register.php';}}
if(redirect!=''){modal.open(redirect,true);}}
else{$('#activation_error').html(operator_trad.error_security_code);}}catch(e){if(typeof(console)!='undefined'){console.log(e);}}}};
if(typeof(right)=="undefined"){var right={READABLE:0,NOT_ENCODED:1,LOCALITY:2,MP3_FRIEND:3,PREMIUM_ONLY:4,NOT_RELEASE_FREE:5,NOT_RELEASE_PREMIUM:6,FAN_ONLY:7,checkSongAvailable:function(currentData){try{if(typeof(currentData)=='object'){if(typeof(currentData.ISRC)!='undefined'){if(userData.dataStore[currentData.ISRC]==true&&currentData.ISRC!=''){return right.READABLE;}}
if(typeof(currentData.EXTERNAL)!='undefined'){return right.READABLE;}
if(dzPlayer.getPlayerType()=='radio'||dzPlayer.getPlayerType()=='smartRadio'){return right.READABLE;}
if(typeof(currentData.RIGHTS)=='undefined'){currentData.RIGHTS={};}
if(parseInt(currentData.TYPE)==1){if(getObjectSize(currentData.RIGHTS)==0){return(parseInt(currentData.ART_ID)==0)?right.MP3_FRIEND:right.LOCALITY;}
if(parseInt(currentData.FAN_ONLY)==1&&(!userData.isLoaded||!userData.isFavorite('artist',currentData.ART_ID))){return right.FAN_ONLY;}}
if(!DZPS&&typeof(currentData.RIGHTS.STREAM_ADS)=='undefined'&&typeof(currentData.RIGHTS.STREAM_SUB)=='string'){return right.PREMIUM_ONLY;}else if(typeof(currentData.RIGHTS.STREAM_ADS)=='undefined'&&typeof(currentData.RIGHTS.STREAM_SUB)=='undefined'){return right.LOCALITY;}else if(!DZPS&&(dateToTimestamp(currentData.RIGHTS.STREAM_ADS)>SERVER_TIMESTAMP)){return right.NOT_RELEASE_FREE;}else if(DZPS&&(dateToTimestamp(currentData.RIGHTS.STREAM_SUB)>SERVER_TIMESTAMP)){return right.NOT_RELEASE_PREMIUM;}else if(currentData.MD5_ORIGIN==""||(parseInt(currentData.FILESIZE_MP3_128)==0&&!DZPS&&parseInt(currentData.SNG_ID)>0)||(parseInt(currentData.FILESIZE_MP3_128)==0&&DZPS&&parseInt(currentData.SNG_ID)>0&&dzPlayer.isHq()==false)||(parseInt(currentData.FILESIZE_MP3_128)==0&&parseInt(currentData.FILESIZE_MP3_256)==0&&parseInt(currentData.FILESIZE_MP3_320)==0&&DZPS&&parseInt(currentData.SNG_ID)>0)||(parseInt(currentData.SNG_ID)==0&&parseInt(currentData.FILESIZE_MP3_MISC)==0)){return right.NOT_ENCODED;}
return right.READABLE;}else{return right.READABLE;}}catch(e){console.log(e.message,e.stack);}},getMessage:function(unavailable_code){try{switch(unavailable_code){case right.NOT_ENCODED:return trad.music.naboo_rights_not_encoded;break;case right.LOCALITY:return trad.music.naboo_rights_locality;break;case right.MP3_FRIEND:return trad.music.naboo_rights_mp3_friend;break;case right.PREMIUM_ONLY:return trad.music.naboo_rights_premium_only;break;case right.NOT_RELEASE_FREE:return trad.music.naboo_rights_not_release_free;break;case right.NOT_RELEASE_PREMIUM:return trad.music.naboo_rights_not_release_premium;break;case right.FAN_ONLY:return trad.music.naboo_rights_artist_only;break;default:return"";break;}}catch(e){console.log(e);}}}};
var restrict={statusExclamationMark:80,object:null,type:null,init:function(obj){try{if(typeof(obj)!='undefined'){restrict.type='discovery';restrict.object=obj;object=restrict.object;var percent=object.results.percent;var date_end_discover=object.results.date_end_discover;var date_now=Math.round((new Date()).getTime()/1000);if(DZPS==true){restrict.type='no_restriction';restrict.gaugeDisable();}else if(date_now<date_end_discover){restrict.type='discovery_unlimited';restrict.gaugeDisable();}else if(USER.OPTIONS.web_streaming){restrict.type='discovery';Events.unsubscribe(Events.player.updateRestrictTime,restrict.updateRestrictTime);Events.subscribe(Events.player.updateRestrictTime,restrict.updateRestrictTime);restrict.gaugeUpdatePercent(percent);restrict.gaugeEnable();}}else if(typeof(USER.TRY_AND_BUY)!='undefined'){api.call('restriction.getTime',{},function(request){restrict.object=request;var active=parseInt(USER.TRY_AND_BUY.ACTIVE,10);if(active==1&&typeof(USER.TRY_AND_BUY.PLATEFORM)!='undefined'&&USER.TRY_AND_BUY.PLATEFORM=='none'){restrict.type='try_and_buy';var date_start=USER.TRY_AND_BUY.DATE_START;var date_end=USER.TRY_AND_BUY.DATE_END;var buffer_start=date_start.split(' ');var buffer_start_date=buffer_start[0].split('-');var buffer_start_time=buffer_start[1].split(':');var buffer_end=date_end.split(' ');var buffer_end_date=buffer_end[0].split('-');var buffer_end_time=buffer_end[1].split(':');var timestamp_now=Math.floor((new Date()).getTime()/1000);var timestamp_start=toTimestamp(buffer_start_date[0],buffer_start_date[1],buffer_start_date[2],buffer_start_time[0],buffer_start_time[1],buffer_start_time[2]);var timestamp_end=toTimestamp(buffer_end_date[0],buffer_end_date[1],buffer_end_date[2],buffer_end_time[0],buffer_end_time[1],buffer_end_time[2]);var timestamp_max=timestamp_end-timestamp_start;var day_length=24*60*60;if(timestamp_max<=(day_length*2)||!USER.OPTIONS.web_streaming){restrict.gaugeDisable();}else{restrict.gaugeEnable();}
var max_days=Math.floor(timestamp_max/day_length);var elapsed_time=timestamp_now-timestamp_start;var elapsed_days=Math.ceil(elapsed_time/day_length);var percent=elapsed_days*100/max_days;restrict.gaugeUpdatePercent(percent);}else{if(!DZPS){restrict.init(request);}else{restrict.gaugeDisable();}}});}}catch(e){console.log(e);}},updateRestrictTime:function(e,time){try{object=restrict.object;if((object.results.time_left-time)>=0){object.results.time_spend+=time;object.results.time_left-=time;}else{object.results.time_spend=object.results.time_spend+object.results.time_left;object.results.time_left=0;dzPlayer.setForbiddenListen(true);}
if(parseInt(USER.TRY_AND_BUY.ACTIVE)==1){var days_left=object.results.days_left;var days_total=(new Date(USER.TRY_AND_BUY.DATE_END).getTime()-new Date(USER.TRY_AND_BUY.DATE_START).getTime())/(1000*60*60*24);var percent=((days_left*100)/days_total);$('#header_content_profil_user_data').removeClass('limit_off').addClass('limit_on');restrict.gaugeUpdatePercent(percent);}else{if(object.results.discovery==true){restrict.gaugeDisable();}else{object.results.percent=((object.results.time_spend*100)/(object.results.time_spend+object.results.time_left));if(isNaN(object.results.percent)){object.results.percent=0;}
restrict.gaugeUpdatePercent(object.results.percent);}}}catch(e){console.log(e);}},gaugeUpdatePercent:function(pct){try{var percent=parseFloat(pct).toFixed(3);if(percent>100){percent=100;}
if(percent>=restrict.statusExclamationMark){$('#header_content_restriction').addClass('alert-on');}
$('#header_content_restriction .remaining').css('width',percent+'%');}catch(e){console.log(e);}},gaugeEnable:function(){try{$('#push_abo').hide();$('#header_content_profil_user_data').removeClass('limit_off').addClass('limit_on');$('#header_content_restriction').show().bind('mouseover',restrict.gaugeMouseOver).bind('mouseout',restrict.gaugeMouseOut);}catch(e){console.log(e);}},gaugeDisable:function(){try{$('#push_abo').show();$('#header_content_profil_user_data').removeClass('limit_on').addClass('limit_off');$('#header_content_restriction').hide().unbind('mouseover',restrict.gaugeMouseOver).unbind('mouseout',restrict.gaugeMouseOut);}catch(e){console.log(e);}},gaugeMouseOver:function(){try{if($('#header_content_restriction_hovercard').is(':visible')==false){sendRequest('/'+SETTING_LANG+'/lightbox/hovercard_restriction.php','text','type='+restrict.type+'&time_spend='+restrict.object.results.time_spend+'&time_left='+restrict.object.results.time_left,true,restrict.gaugeMouseOverCallback);}}catch(e){console.log(e.message,e.stack);}},gaugeMouseOverCallback:function(response){try{response=response.responseText;$('#header_content_restriction_hovercard').html(response).show();}catch(e){console.log(e);}},gaugeMouseOut:function(e){try{if($(e.relatedTarget).parents('#header_content_restriction').length==1){return false;}
$('#header_content_restriction_hovercard').hide();}catch(e){console.log(e);}},updateTime:function(obj){try{restrict.object=obj;object=restrict.object;if(object.results.tryandbuy==true){$('#header_content_restriction_hovercard .t-b').show();$('#header_content_restriction_hovercard .discovery').hide();}else if(object.results.discovery==false){$('#header_content_restriction_hovercard .t-b').hide();$('#header_content_restriction_hovercard .discovery').show();}
if(object.results.discovery==false&&typeof(USER.OPTIONS.web_streaming)!='undefined'&&USER.OPTIONS.web_streaming==true&&typeof(USER.OPTIONS.web_streaming_duration)!='undefined'&&USER.OPTIONS.web_streaming_duration>0){if(typeof(object.results.percent)!='undefined'){if(parseInt(object.results.percent)>=restrict.statusExclamationMark){$('#header_content_restriction').addClass('alert-on');}
$('#header_content_profil_user_data').removeClass('limit_off').addClass('limit_on');var mouseover_callback=function(e){$('#header_content_restriction_hovercard').show();};var mouseout_callback=function(e){e.stopPropagation();var pos_x=e.clientX;var left_bound=$(this).offset().left;var right_bound=$(this).outerWidth()+left_bound;var relatedTarget=$(e.relatedTarget);var is_mouseout=(relatedTarget.parents('#head').length==0&&relatedTarget.attr('id')!='head')||(relatedTarget.parents('#search-content').length==1||relatedTarget.attr('id')=='search-content')||(relatedTarget.parents('#push_abo').length==1||relatedTarget.attr('id')=='push_abo')||(relatedTarget.parents('#header_content_profil_user').length==1||relatedTarget.attr('id')=='header_content_profil_user');if(is_mouseout==true||(pos_x<=left_bound||pos_x>=right_bound)){$('#header_content_restriction_hovercard').hide();}}
$('#header_content_restriction').show().on('mouseover',mouseover_callback).on('mouseout',mouseout_callback);$('#header_content_restriction .remaining').css('width',object.results.percent+'%');}
if(typeof(object.results.time_left)!='undefined'){var hours;var minutes;if(parseInt(object.results.time_left)==0){hours='00';minutes='00';}else{if(parseInt(object.results.time_left)<60){hours='00';minutes='00';}else if(parseInt(object.results.time_left)<3600){hours='00';minutes=Math.round(parseInt(object.results.time_left)/60);}else if(parseInt(object.results.time_left)<86400){hours=Math.floor(parseInt(object.results.time_left)/3600);minutes=Math.round((parseInt(object.results.time_left)-(parseInt(hours)*3600))/60);}}
$('#header_content_restriction_hovercard .hours').text(pad(hours,2));$('#header_content_restriction_hovercard .minutes').text(pad(minutes,2));var total_hours=(object.results.time_left+object.results.time_spend)/3600;var time_renew=(new Date()).setDate((new Date()).getDate()+object.results.days_left);var date_renew=new Date(time_renew);var day_renew=pad(date_renew.getDate(),2);var month_renew=pad(date_renew.getMonth()+1,2);var text_music_back=trad.restriction.music_back.replace('%s',total_hours).replace('%s',day_renew).replace('%s',month_renew);$('#header_content_restriction_hovercard .music_back').text(text_music_back);$('#header_content_restriction_hovercard .push_premiumplus').html(trad.restriction.push_premiumplus);}}else if(object.results.discovery==true&&typeof(USER.OPTIONS.web_streaming)!='undefined'&&USER.OPTIONS.web_streaming==true&&typeof(USER.OPTIONS.web_streaming_duration)!='undefined'&&USER.OPTIONS.web_streaming_duration>0){$('#header_content_profil_user_data').removeClass('limit_off').addClass('limit_on');$('#header_content_restriction').hide();}}catch(e){console.log(e);}},updateTimeCallback:function(request){try{restrict.updateTime(request);}catch(e){console.log(e);}},getTime:function(){try{api.call('restriction.getTime',{},restrict.updateTimeCallback);}catch(e){console.log(e);}},restrict5counter:function(add){if(typeof(add)=="undefined"){add=false;}
var addtime=3*3600000;var sessItem='b601a6950522a51b38a94502cdde6c2c';var oInfos=new Object();if(getCookie(sessItem)){var tmp=getCookie(sessItem);oInfos=JSON.parse(tmp);}
var date=new Date();var defaultT=date.getTime();if(typeof(oInfos.counter)=="undefined"){oInfos.counter=0;oInfos.first_hit=defaultT;oInfos.canplay=true;oInfos.display=null;oInfos.isDisplay=false;}else{if(add){oInfos.counter=oInfos.counter+1;}}
var limit=oInfos.first_hit+addtime;var diff=limit-defaultT;if(diff<=0&&parseInt(oInfos.counter)>0){oInfos.counter=0;oInfos.first_hit=defaultT-((defaultT-oInfos.first_hit)%addtime);oInfos.isDisplay=false;}
if(oInfos.counter>4&&diff>0){oInfos.canplay=false;oInfos.display=(oInfos.counter<6&&!oInfos.isDisplay)?'lightbox':'notify';oInfos.isDisplay=true;}
setCookie(sessItem,JSON.stringify(oInfos),addtime);return oInfos;},displayTime:function(){console.log('displayTime:deprecated');},changeBarColor:function(){console.log('changeBarColor:deprecated');}};
var downloader={currentDownloadTrack:false,currentDeleteTrack:false,running:false,totalToDownload:0,currentToDownload:0,start:function(){try{downloader.totalToDownload=downloader.getTotalTrack();if(!downloader.running){downloader.currentToDownload=0;downloader.running=true;downloader.getTrack();}else{downloader.totalToDownload+=downloader.currentToDownload;}}catch(e){console.log(e.message,e.stack);}},stop:function(){try{console.log('STOP DOWNLOADER');downloader.running=false;}catch(e){console.log(e.message,e.stack);}},retryErrorTrack:function(){try{var foundErrorTrack=false;for(var elt in dzoffline.listSong){var element=dzoffline.listSong[elt];for(var i in element){if(element[i].STATE==dzoffline.ERROR){console.log('Download Error found:',element[i]);if(element[i].ERROR_DATE+dzoffline.retryErrorInterval<=SERVER_TIMESTAMP){console.log('Retry : ok');dzoffline.listSync[elt].STATE=dzoffline.PENDING;element[i].STATE=dzoffline.PENDING;element[i].ERROR_DATE=SERVER_TIMESTAMP;foundErrorTrack=true;}else{console.log('Retry: not ok');}}}}
if(foundErrorTrack){downloader.start();}else{console.log('No Download Track Error found');}}catch(e){console.log(e.message,e.stack);}},imageError:function(evt,data){try{console.log('ERROR:',data);}catch(e){console.log(e.message,e.stack);}},getTrack:function(){try{downloader.currentDownloadTrack=downloader.getTrackByStatus(dzoffline.PENDING);if(downloader.currentDownloadTrack!=false){dzoffline.changeElementDisplay(downloader.currentDownloadTrack.PARENT_TYPE,downloader.currentDownloadTrack.PARENT_ID,dzoffline.STARTED);downloader.downloadTrack(downloader.currentDownloadTrack.TYPE,downloader.currentDownloadTrack.SNG_ID);}else{downloader.currentDeleteTrack=downloader.getTrackByStatus(dzoffline.DELETE);if(downloader.currentDeleteTrack!=false){dzoffline.changeElementDisplay(downloader.currentDeleteTrack.PARENT_TYPE,downloader.currentDeleteTrack.PARENT_ID,dzoffline.STARTED);downloader.deleteTrack(downloader.currentDeleteTrack.TYPE,downloader.currentDeleteTrack.SNG_ID);}else{downloader.running=false;}}
return true;}catch(e){console.log(e.message,e.stack);}},getTotalTrack:function(){try{var nb=0;for(var elt in dzoffline.listSync){if(dzoffline.listSync[elt].STATE==dzoffline.PENDING){var element=dzoffline.listSong[dzoffline.listSync[elt].TYPE+'_'+dzoffline.listSync[elt].ID];for(var i in element){if(element[i].STATE==dzoffline.PENDING){nb++;}}}}
return nb;}catch(e){console.log(e.message,e.stack);}},getTrackByStatus:function(status){try{var nb=0;for(var elt in dzoffline.listSync){if(dzoffline.listSync[elt].STATE==status||dzoffline.SYNC_BROKEN==dzoffline.listSync[elt].STATE){var element=dzoffline.listSong[dzoffline.listSync[elt].TYPE+'_'+dzoffline.listSync[elt].ID];var total_finish=0;for(var i in element){if(element[i].STATE==status){return{TYPE:element[i].TYPE,SNG_ID:element[i].SNG_ID,UPLOAD_ID:element[i].SNG_ID,PARENT_TYPE:dzoffline.listSync[elt].TYPE,PARENT_ID:dzoffline.listSync[elt].ID,CHUNK:element[i].CHUNK,MD5_ORIGIN:element[i].MD5_ORIGIN};}else if(element[i].STATE==dzoffline.FINISH||element[i].STATE==dzoffline.ERROR||element[i].STATE==dzoffline.FORBIDDEN){total_finish++;}}
if((dzoffline.PENDING==status||dzoffline.SYNC_BROKEN==dzoffline.listSync[elt].STATE)&&total_finish>=countObject(element)){console.log('Element tracks finish.');downloader.downloadCover(dzoffline.listSync[elt].TYPE,dzoffline.listSync[elt].DATA);dzoffline.updateListSync(dzoffline.listSync[elt].TYPE,dzoffline.listSync[elt].ID,{STATE:dzoffline.FINISH});return false;}else if(dzoffline.DELETE==status&&dzoffline.listSync[elt].STATE==dzoffline.DELETE){dzoffline.unsetListSync(dzoffline.listSync[elt].TYPE,dzoffline.listSync[elt].ID);}}}
return false;}catch(e){console.log(e.message,e.stack);}},getElementProgressDownload:function(type,id){try{var song_list=dzoffline.getElement(type,id);var finish=0;var pending=0;for(var song in song_list){if(song_list[song].STATE==dzoffline.FINISH||song_list[song].STATE==dzoffline.ERROR)
finish++;else
pending++;}
var percent=Math.floor((100*finish)/(finish+pending));if(!isNaN(percent))
Events.trigger(Events.offline.elementDownloadProgress,{type:type,id:id,percent:percent});}catch(e){console.log(e.message,e.stack);}},downloadTrack:function(type,sng_id){try{var songExist=dzoffline.songExist(downloader.currentDownloadTrack.SNG_ID,{type:downloader.currentDownloadTrack.PARENT_TYPE,id:downloader.currentDownloadTrack.PARENT_ID});if(songExist.STATUS){console.log('Song already downloaded');dzoffline.setElementDetail(downloader.currentDownloadTrack.PARENT_TYPE,downloader.currentDownloadTrack.PARENT_ID,downloader.currentDownloadTrack.SNG_ID,{CHUNK:songExist.CHUNK,MD5_ORIGIN:songExist.MD5_ORIGIN});downloader.flagAdded('added');}else{api.call("offline_dwlTrack",{sng_id:sng_id,type:type,user_id:USER.USER_ID},downloader.downloadTrackCallBack);}}catch(e){console.log(e.message,e.stack);}},downloadTrackCallBack:function(request){try{if(request.error.length==0){dzoffline.setElementDetail(downloader.currentDownloadTrack.PARENT_TYPE,downloader.currentDownloadTrack.PARENT_ID,downloader.currentDownloadTrack.SNG_ID,{CHUNK:request.results.CHUNK,MD5_ORIGIN:request.results.MD5_ORIGIN});downloader.currentDownloadTrack.TOTAL_ELEMENT=request.results.CHUNK.length;downloader.currentDownloadTrack.CHUNK_LIST=request.results.CHUNK;downloader.currentDownloadTrack.MD5_ORIGIN=request.results.MD5_ORIGIN;Events.unsubscribe(Events.offline.chunckDownload,downloader.downloadTrackControler);Events.subscribe(Events.offline.chunckDownload,downloader.downloadTrackControler);downloader.downloadCover('song',{ALB_PICTURE:request.results.COVER});}else{console.log('downloadTrackError:',request.error);if(typeof(request.error.NEED_USER_AUTH_REQUIRED)!='undefined'){downloader.stop();console.log('delog');return false;}else{downloader.flagAdded('error');}}}catch(e){console.log(e.message,e.stack);}},downloadTrackChunk:function(){try{if(typeof(downloader.currentDownloadTrack.CHUNK_LIST)!='object'){console.log('downloadTrackChunk:error with chunk list :',downloader.currentDownloadTrack);return false;}
if(downloader.currentDownloadTrack.CHUNK_LIST.length==0){console.log('Track finish');api.call('log_add_download',{sng_id:downloader.currentDownloadTrack.SNG_ID},function(data){});downloader.flagAdded('added');}else{var chunkUri='http://cdn-'+downloader.currentDownloadTrack.CHUNK_LIST[0];var chunkName=chunkUri.substr(chunkUri.lastIndexOf('/')+1,chunkUri.length);console.log('downloadTrackChunk:',chunkName.substr(0,20))
var data={fileName:chunkName,url:chunkUri,type:'video/flv',md5:downloader.currentDownloadTrack.MD5_ORIGIN};filesystem.writeFile(data);}}catch(e){console.log(e.message,e.stack);}},downloadTrackControler:function(evt,data){try{if(data.status=='FINISH'){if(typeof(downloader.currentDownloadTrack.CHUNK_LIST)=='object'){var percent=parseInt((100*(downloader.currentDownloadTrack.TOTAL_ELEMENT-downloader.currentDownloadTrack.CHUNK_LIST.length+1))/downloader.currentDownloadTrack.TOTAL_ELEMENT);console.log('Track progress:',percent,'%');}else{console.log('Impossible de calculer la progression:',downloader.currentDownloadTrack);return false;}
Events.trigger(Events.offline.trackDownloadProgress,{currentTrack:downloader.currentDownloadTrack,percent:percent});downloader.currentDownloadTrack.CHUNK_LIST=downloader.currentDownloadTrack.CHUNK_LIST.slice(1);downloader.downloadTrackChunk();}else if(data.status=='ERROR'){if(data.error_file.url.substr(0,11)=='http://cdn-'){console.log('error but isCdn:retry');data.error_file.url='http://'+data.error_file.url.substr(11,data.error_file.url.length);filesystem.writeFile(data.error_file);return false;}
downloader.flagAdded('error');}}catch(e){console.log(e.message,e.stack);}},downloadCover:function(type,data,retry){try{if(typeof(retry)=='undefined')retry='';Events.unsubscribe(Events.offline.imageDownload,downloader.downloadDataControler);Events.subscribe(Events.offline.imageDownload,downloader.downloadDataControler);if(type=='album'){var coverMd5=data.ALB_PICTURE;var coverName='200x200-000000-80-0-0.jpg';var coverDir='cover';}else if(type=='playlist'||type=='loved'){var coverMd5='';if(retry=='SPLIT_MD5'&&data.PLAYLIST_PICTURE.length>32){var part=data.PLAYLIST_PICTURE.split('-');if(part.length>0){coverMd5=part[0];}}
if(coverMd5=='')coverMd5=data.PLAYLIST_PICTURE;var coverName='200x200-000000-80-0-0.jpg';var coverDir=data.PLAYLIST_PICTURE_TYPE;}else if(type=='user'){var path=$('#img_avatar_mini').attr('src').split('/');var coverMd5=path[path.length-2];if(coverMd5.length!=32){return false;}
var coverName='34x34-000000-80-0-0.jpg';var coverDir='user';}else if(type=='song'){var coverMd5=data.ALB_PICTURE;var coverName='315x315-000000-80-0-0.jpg';var coverDir='cover';}else{console.log('Type inconnu');return false;}
var coverUri=((retry=='WITHOUT_CDN')?'http://'+SETTING_DOMAIN_IMG.substr(11,SETTING_DOMAIN_IMG.length):SETTING_DOMAIN_IMG)+'/'+coverDir+'/'+coverMd5+'/'+coverName;filesystem.writeImage({fileName:coverName,url:coverUri,type:'img/jpg',md5:coverMd5,element_type:type,origin_data:data});return true;}catch(e){console.log(e.message,e.stack);}},downloadDataControler:function(evt,data){try{if(data.status=='ERROR'){console.log('Impossible de downloader la cover:',data.error_file);var urlSplit=data.error_file.url.split('/');var md5=urlSplit[urlSplit.length-2];if(md5.length>32){console.log('Erreur de 302 sur une image en 4 parts');downloader.downloadCover(data.error_file.element_type,data.error_file.origin_data,'SPLIT_MD5');return false;}
if(data.error_file.url.substr(0,11)=='http://cdn-'){console.log('Erreur de header CDN');downloader.downloadCover(data.error_file.element_type,data.error_file.origin_data,'WITHOUT_CDN');return false;}}
if(downloader.currentDownloadTrack!=false){downloader.downloadTrackChunk();}else{downloader.start();}}catch(e){console.log(e.message,e.stack);}},downloadCoverDataFormat:function(type,md5,directory){try{if(type=='album'){return{ALB_PICTURE:md5};}else if(type=='playlist'){return{PLAYLIST_PICTURE:md5,PLAYLIST_PICTURE_TYPE:directory};}else if(type=='song'){return{ALB_PICTURE:md5};}
return false;}catch(e){console.log(e.message,e.stack);}},deleteTrack:function(type,sng_id){try{if(!dzoffline.songExist(sng_id,{type:downloader.currentDeleteTrack.PARENT_TYPE,id:downloader.currentDeleteTrack.PARENT_ID}).STATUS){var chunkToDelete=(typeof(downloader.currentDeleteTrack.CHUNK)!='undefined')?downloader.currentDeleteTrack.CHUNK:[];var md5=(typeof(downloader.currentDeleteTrack.MD5_ORIGIN)!='undefined')?downloader.currentDeleteTrack.MD5_ORIGIN:'';for(var t=0;t<chunkToDelete.length;t++){var fileName=chunkToDelete[t].split('/');filesystem.deleteChunk(fileName[fileName.length-1],md5);}}
downloader.flagDeleted();return true;}catch(e){console.log(e.message,e.stack);}},flagAdded:function(type){try{if(OFFLINE)return false;if(downloader.currentDownloadTrack!=false){Events.trigger(Events.offline.trackDownloadStatus,{type:type,currentTrack:downloader.currentDownloadTrack});var status=(type=='added')?dzoffline.FINISH:dzoffline.ERROR;if(dzoffline.isElementSync(downloader.currentDownloadTrack.PARENT_TYPE,downloader.currentDownloadTrack.PARENT_ID)){dzoffline.setElement(downloader.currentDownloadTrack.PARENT_TYPE,downloader.currentDownloadTrack.PARENT_ID,downloader.currentDownloadTrack,status,true);}
downloader.getElementProgressDownload(downloader.currentDownloadTrack.PARENT_TYPE,downloader.currentDownloadTrack.PARENT_ID);downloader.currentDownloadTrack=false;downloader.currentToDownload++;}
downloader.getTrack();}catch(e){console.log(e.message,e.stack);}},flagDeleted:function(){try{Events.trigger(Events.offline.trackDownloadStatus,{type:"deleted",currentTrack:downloader.currentDeleteTrack});dzoffline.deleteElement(downloader.currentDeleteTrack.PARENT_TYPE,downloader.currentDeleteTrack.PARENT_ID,downloader.currentDeleteTrack.SNG_ID,true);downloader.currentDeleteTrack=false;downloader.getTrack();}catch(e){console.log(e.message,e.stack);}},onProgress:function(type,loaded,total){try{return true;}catch(e){console.log(e.message,e.stack);}},onFinish:function(type){try{if(type=='site'){}
return true;}catch(e){console.log(e.message,e.stack);}},onNoUpdate:function(type){try{if(type=='site'){}
return true;}catch(e){console.log(e.message,e.stack);}},onUpdateReady:function(type){try{if(type=='site'){}
return true;}catch(e){console.log(e.message,e.stack);}},onChecking:function(){try{return true;}catch(e){console.log(e);}},onError:function(type){try{if(type=='site'){if((ENV=='DEV'||ENV=='PREPROD')&&!OFFLINE){console.warn('WARNING : MANIFEST SITE ERROR');}}
return true;}catch(e){console.log(e.message,e.stack);}}};
﻿var dzDB={DESIRED_VERSION:2,db:null,open:function(){try{if(!Modernizr.indexeddb||!dzoffline.browserCompatibility())return false;if(window.webkitIndexedDB){window.indexedDB=window.webkitIndexedDB;}else if(window.msIndexedDB){window.indexedDB=window.msIndexedDB;}
var request=window.indexedDB.open('deezer',dzDB.DESIRED_VERSION);request.onblocked=function(e){console.log('couldn\'t open DB (blocked)');};request.onabort=function(e){console.log('couldn\'t open DB (abort)');};request.onupgradeneeded=function(e){console.log('[OFFLINE - DB] DB upgrade needed');console.log('[OFFLINE - DB] old version: '+e.oldVersion);console.log('[OFFLINE - DB] new version: '+e.newVersion);dzDB.db=e.target.result;var db=dzDB.db;console.log('[OFFLINE - DB] DB opened with version: '+db.version);dzDB.doUpgrade(db);}
request.onsuccess=function(e){console.log('[OFFLINE - DB] DB successfully opened');dzDB.db=e.target.result;var db=dzDB.db;console.log('[OFFLINE - DB] version: '+db.version);console.log('[OFFLINE - DB] nb table : '+db.objectStoreNames.length);if(db.version==''){var setVrequest=db.setVersion(dzDB.DESIRED_VERSION);setVrequest.onsuccess=function(e){console.log('[OFFLINE - DB] setVersion : OK');dzDB.doUpgrade(db);};return false;}
dzDB.getAllItems();};request.onerror=function(e){console.log('couldn\'t open DB (onerror)');};return true;}catch(e){console.log(e.message,e.stack);}},doUpgrade:function(db){try{console.log('[OFFLINE - DB] doUpgrade for data :',(!db.objectStoreNames.contains('offlineData')),' for image:',(!db.objectStoreNames.contains('offlineImage')));if(!db.objectStoreNames.contains('offlineData'))
var store=db.createObjectStore("offlineData",{keyPath:"method"});if(!db.objectStoreNames.contains('offlineImage'))
var image=db.createObjectStore("offlineImage",{keyPath:"url"});setTimeout(dzDB.getAllItems,2000);}catch(e){console.log(e.message,e.stack);}},addItem:function(method,content){try{if(dzDB.db==null)return false;var trans=dzDB.db.transaction(["offlineData"],"readwrite");var store=trans.objectStore("offlineData");var request=store.put({"method":method,"content":content});request.onsuccess=function(e){};request.onerror=dzDB.onerror;return true;}catch(e){console.log(e.message,e.stack);}},getAllItems:function(){try{if(dzDB.db==null)return false;var trans=dzDB.db.transaction(["offlineData"],"readonly");var store=trans.objectStore("offlineData");var resultat=new Array();var cursorRequest=store.openCursor();cursorRequest.onsuccess=function(e){var result=e.target.result;if(!!result==false){Events.trigger(Events.offline.openDBFinish,{result:resultat});}else{resultat.push(result.value);result['continue']();}};cursorRequest.onerror=dzDB.onerror;return true;}catch(e){console.log(e.message,e.stack);}},getItem:function(key,callback){try{if(dzDB.db==null)return false;var trans=dzDB.db.transaction(["offlineData"],"readonly");var store=trans.objectStore("offlineData");var cursorRequest=store.get(key);var resultat=new Array();cursorRequest.onsuccess=function(e){var result=e.target.result;if(typeof(callback)!='undefined'){callback(result);}else{console.log(result);}};cursorRequest.onerror=dzDB.onerror;return true;}catch(e){console.log(e.message,e.stack);}},deleteItem:function(id){try{if(dzDB.db==null)return false;var trans=dzDB.db.transaction(["offlineData"],"readwrite");var store=trans.objectStore("offlineData");var request=store['delete'](id);request.onsuccess=function(e){};request.onerror=dzDB.onerror;return true;}catch(e){console.log(e.message,e.stack);}},deleteAllItems:function(){try{if(dzDB.db!=null){dzDB.db.close();}
window.indexedDB.deleteDatabase("deezer");return true;}catch(e){console.log(e.message,e.stack);}},addImageError:function(url,error){try{if(dzDB.db==null)return false;var trans=dzDB.db.transaction(["offlineImage"],"readwrite");var store=trans.objectStore("offlineImage");var request=store.put({"url":url,data:error});request.onsuccess=function(e){};request.onerror=dzDB.onerror;return true;}catch(e){console.log(e.message,e.stack);}},getAllImagesError:function(){try{if(dzDB.db==null)return false;var trans=dzDB.db.transaction(["offlineImage"],"readonly");var store=trans.objectStore("offlineImage");var cursorRequest=store.openCursor();var resultat=new Array();cursorRequest.onsuccess=function(e){var result=e.target.result;if(!!result==false){Events.trigger(Events.offline.getImageError,{result:resultat});}else{console.log(result.value);if(result.value.data)
resultat.push(result.value.url);result['continue']();}};cursorRequest.onerror=dzDB.onerror;return true;}catch(e){console.log(e.message,e.stack);}},onerror:function(e){try{console.log('dzDB.error:',e);return true;}catch(e){console.log(e.message,e.stack);}}};;
var filesystem={loaded:false,location:'persistent',prefix:'filesystem:',root:'',init:function(callBack){try{window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;window.resolveLocalFileSystemURL=window.resolveLocalFileSystemURL||window.webkitResolveLocalFileSystemURL;window.Blob=window.Blob||window.WebKitBlob||window.MozBlob;window.requestFileSystem(PERSISTENT,1024*1024*1024,function(fs){filesystem.loaded=true;filesystem.root=fs.root;if(typeof(callBack)!='undefined')callBack();},filesystem.errorHandler);}catch(e){console.log(e.message,e.stack);}},getOfflineFile:function(uri,puid){try{var chunkName=uri.substr(uri.lastIndexOf('/')+1,uri.length);filesystem.loadChunk(chunkName,puid);}catch(e){console.log(e.message,e.stack);}},writeFile:function(data,path){try{if(typeof(path)=='undefined'){if(filesystem.root==''){filesystem.init(function(){filesystem.writeFile(data)});return false;}
filesystem.createDir(filesystem.root,filesystem.getPathFromMd5(data.md5),data);}else{console.log('file download start:',data.type,data.fileName.substr(0,20));var xhr=new XMLHttpRequest();xhr.open('GET',data.url,true);xhr.responseType='blob';xhr.onload=function(e){console.log('file download succes:',data.type,data.fileName.substr(0,20));path.getFile(data.fileName,{create:true},function(fileEntry){fileEntry.createWriter(function(writer){writer.onwrite=function(e){console.log('file written:',data.type,data.fileName.substr(0,20));if(data.type=='video/flv')
Events.trigger(Events.offline.chunckDownload,{status:'FINISH'});else if(data.type=='img/jpg')
Events.trigger(Events.offline.imageDownload,{status:'FINISH'});};writer.onerror=function(e){console.log('file written error:',data.type);if(data.type=='video/flv')
Events.trigger(Events.offline.chunckDownload,{status:'ERROR',error_file:data});else if(data.type=='img/jpg')
Events.trigger(Events.offline.imageDownload,{status:'ERROR',error_file:data});};var bb=new Blob([xhr.response]);writer.write(bb);},filesystem.onError);},filesystem.onError);};xhr.onerror=function(e){console.log('file download error:',this);if(data.type=='video/flv')
Events.trigger(Events.offline.chunckDownload,{status:'ERROR',error_file:data});else if(data.type=='img/jpg')
Events.trigger(Events.offline.imageDownload,{status:'ERROR',error_file:data});}
xhr.send();}}catch(e){console.log(e.message,e.stack);}},writeImage:function(data){try{if(filesystem.root==''){filesystem.init(function(){filesystem.writeImage(data)});return false;}
var path=filesystem.getLocalPath(data.md5,data.fileName);window.resolveLocalFileSystemURL(path,function(fileEntry){console.log('picture already downloaded:',path);Events.trigger(Events.offline.imageDownload,{status:'FINISH'});},function(){console.log('picture not exist:',path);filesystem.writeFile(data);});}catch(e){console.log(e.message,e.stack);}},readImage:function(md5,fileName,insertTo){try{if(filesystem.root==''){filesystem.init(function(){filesystem.readImage(md5,fileName,insertTo)});return false;}
var path=filesystem.getLocalPath(md5,fileName);console.log('readImage:',path);window.resolveLocalFileSystemURL(path,function(fileEntry){$(insertTo).attr('src',path);},function(){if(fileName=='200x200-000000-80-0-0.jpg'){filesystem.readImage(md5,'120x120-000000-80-0-0.jpg',insertTo);}
console.log('readImage:error:',path);});}catch(e){console.log(e.message,e.stack);}},loadChunk:function(chunkName,md5){try{if(filesystem.root==''){filesystem.init(function(){filesystem.loadChunk(chunkName,md5)});return false;}
var url=filesystem.getLocalPath(md5,chunkName);console.log('loadChunk:',url);window.resolveLocalFileSystemURL(url,function(fileEntry){fileEntry.file(function(file){var reader=new FileReader();reader.onloadend=function(e){dzPlayer.sendFile(this.result);};reader.readAsDataURL(file);},function(e){filesystem.loadChunkError('error1');});},function(e){filesystem.loadChunkError('error2');});}catch(e){console.log(e.message,e.stack);}},loadChunkError:function(e){try{console.log('load chunk : ',e);dzoffline.readSongError(dzPlayer.getCurrentSongInfo());if(OFFLINE){if(dzPlayer.previousSkipAction=='prev'){dzPlayer.prevSong();}else{dzPlayer.nextSong();}}else{dzPlayer.sendFile('error');}}catch(e){console.log(e.message,e.stack);}},deleteChunk:function(chunkName,md5){try{if(filesystem.root==''){filesystem.init(function(){filesystem.loadChunk(chunkName,md5)});return false;}
var url=filesystem.getLocalPath(md5,chunkName);window.resolveLocalFileSystemURL(url,function(fileEntry){fileEntry.remove(function(){console.log('File removed.');},filesystem.errorHandler);});}catch(e){console.log(e.message,e.stack);}},createDir:function(rootDirEntry,folders,data){try{if(folders[0]=='.'||folders[0]==''){folders=folders.slice(1);}
rootDirEntry.getDirectory(folders[0],{create:true},function(dirEntry){if(folders.length){filesystem.createDir(dirEntry,folders.slice(1),data);}else{filesystem.writeFile(data,rootDirEntry);}},filesystem.onError);}catch(e){console.log(e.message,e.stack);}},getPathFromMd5:function(md5){try{if(typeof(md5)=='string'&&md5.length>=4){return['data',md5.substr(0,2),md5.substr(2,2)];}else{return['data'];}}catch(e){console.log(e.message,e.stack);}},getLocalPath:function(md5,fileName){try{return filesystem.prefix+SETTING_HOST_SITE+'/'+filesystem.location+'/'+filesystem.getPathFromMd5(md5).join('/')+'/'+fileName;}catch(e){console.log(e.message,e.stack);}},deleteAllFiles:function(){try{if(filesystem.root==''){filesystem.init(function(){filesystem.deleteAllFiles()});return false;}
var dirReader=filesystem.root.createReader();dirReader.readEntries(function(results){var totalFolder=results.length;var currentFolder=0;if(results.length==0){setTimeout(function(){window.location=SETTING_HOST_SITE;},2000);}else{for(var f=0;f<results.length;f++){results[f].removeRecursively(function(){console.log('Directory removed.');currentFolder++;if(currentFolder>=totalFolder){setTimeout(function(){window.location=SETTING_HOST_SITE;},2000);}},filesystem.errorHandler);}}});}catch(e){console.log(e.message,e.stack);}},rootFolderExist:function(deleteAllIfNotExist){try{if(filesystem.root==''){filesystem.init(function(){filesystem.rootFolderExist(deleteAllIfNotExist)});return false;}
var dirReader=filesystem.root.createReader();dirReader.readEntries(function(results){if(results.length>=1){for(var f=0;f<results.length;f++){if(results[f].name=="data"){console.log('data folder exist');return true;}}}
console.log('data folder not exist');if(deleteAllIfNotExist){console.log('delete database');dzDB.deleteAllItems();filesystem.deleteAllFiles();}
return false;});}catch(e){console.log(e.message,e.stack);}},errorHandler:function(e){try{var msg='';switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:msg='QUOTA_EXCEEDED_ERR';break;case FileError.NOT_FOUND_ERR:msg='NOT_FOUND_ERR';break;case FileError.SECURITY_ERR:msg='SECURITY_ERR';break;case FileError.INVALID_MODIFICATION_ERR:msg='INVALID_MODIFICATION_ERR';break;case FileError.INVALID_STATE_ERR:msg='INVALID_STATE_ERR';break;default:msg='Unknown Error';break;};console.log('Error: '+msg);}catch(e){console.log(e.message,e.stack);}}};
if(typeof(user)=='undefined'){var user={check_username_active:false,login:function(mail,password,remember){try{if(typeof(remember)=='undefined'){remember=0;}
request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=login&mail='+encodeURIComponent(mail)+'&password='+encodeURIComponent(password)+'&remember='+encodeURIComponent(remember));if(request=='success'){return true;}else{return false;}}catch(e){console.log(e.message,e.stack);}},ping:function(){try{api.call('deezer_ping',{},function(r){if(typeof(r.results.CHECKFORM)!=='undefined'){if(USER.USER_ID>0&&r.results.USER_ID===0){modal.open('lightbox/no_session.php');}else{USER.USER_ID=r.results.USER_ID;}
SESSION_ID=r.results.SESSION;checkForm=r.results.CHECKFORM;}});return true;}catch(e){console.log(e.message,e.stack);}},refreshSession:function(){refresh=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=refresh_session');return true;},userLogin:function(){Events.trigger(Events.user.login);user_data=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=user_data&request=login',true,user.userLoginCallback);return true;},userLoginCallback:function(user_data){try{user_data=user_data.responseText;if(user_data!==false&&user_data!='error'&&user_data!==''){notificationBar.hide();user_data=JSON.parse(user_data);USER.USER_ID=user_data.USER_ID;USER.FB_USER_ID=user_data.FB_USER_ID;USER.BLOG_NAME=user_data.BLOG_NAME;USER.FIRSTNAME=user_data.FIRSTNAME;USER.LASTNAME=user_data.LASTNAME;USER.USER_PICTURE=user_data.USER_PICTURE;USER.USER_GENDER=user_data.SEX;USER.USER_AGE=user_data.AGE;USER.PARTNERS=user_data.PARTNERS;USER.TRY_AND_BUY=user_data.TRY_AND_BUY;USER.OPTIONS=user_data.OPTIONS;USER.SETTING=user_data.SETTING;USER.TOOLBAR=user_data.TOOLBAR;USER.TWITTER=user_data.TWITTER;USER.GOOGLEPLUS=user_data.GOOGLEPLUS;USER.FACEBOOK=user_data.FACEBOOK;USER.LASTFM=user_data.LASTFM;USER.FAVORITE_TAG=user_data.FAVORITE_TAG;USER.INSCRIPTION_DATE=user_data.INSCRIPTION_DATE;NEW_SESSION_ID=user_data.SESSION_ID;RANDOM_KEY=user_data.RANDOM_KEY;PLAYER_TOKEN=user_data.PLAYER_TOKEN;DZPS=user_data.DZPS;OFFER_ID=user_data.OFFER_ID;COUNTRY=user_data.COUNTRY;SESSION_ID=user_data.SESSION_ID;STORE_PLATEFORM=user_data.STORE_PLATEFORM;dzPlayer.setUserLogged(USER.USER_ID,USER.USER_PICTURE,USER.BLOG_NAME,NEW_SESSION_ID,USER.USER_GENDER,USER.USER_AGE,RANDOM_KEY,PLAYER_TOKEN);if(typeof(naboo)!='undefined'){naboo.last_page=null;}
Events.resolve(Events.user.loaded);if(facebook.isLinking){LOG_TYPE='facebook';facebook.isLinking=false;}
$('#user_not_logged').hide();$('#user_logged').show();$('.page-header > .navbar').html(user_data.HEADER);if(typeof(USER)!='undefined'&&USER.OPTIONS.ads_display===false){$('body').removeClass('dz_ads');}
if(typeof(USER)!='undefined'&&USER.OPTIONS.ads_display===true){$('body').addClass('dz_ads');}
if(typeof(menu)!='undefined'&&typeof(naboo)!='undefined'){if(naboo.displayed){if(typeof(USER)!='undefined'&&USER.OPTIONS.ads_display===false){naboo.removeAds();}
naboo.checkLoggedStatus();}}
$('#top-nav ul').html(user_data.TAB_MENU);if(DZPS!='undefined'&&DZPS!==null&&DZPS===true){$('#tab_premium').remove();}
if(typeof(USER)!='undefined'&&USER.OPTIONS.web_streaming===true){if(typeof(USER)!='undefined'&&USER.OPTIONS.web_streaming_duration===0){dzPlayer.setForbiddenListen(false);if(typeof(USER.TRY_AND_BUY)!='undefined'){restrict.init();}}else{api.call('restriction.getTime',{},function(request){if(typeof(request.results.percent)!='undefined'){restrict.init(request);if(parseInt(request.results.percent,10)>=100){dzPlayer.setForbiddenListen(true);return false;}else{dzPlayer.setForbiddenListen(false);return true;}}});}}else{dzPlayer.setForbiddenListen(true);if(typeof(USER.TRY_AND_BUY)!='undefined'){restrict.init();}}
if(typeof(user_data.HEADER_CUSTO)!='undefined'&&typeof(user_data.HEADER_CUSTO.logos)!='undefined'&&typeof(user_data.HEADER_CUSTO.logos.header)!='undefined'&&user_data.HEADER_CUSTO.logos.header.length>0){if(typeof(user_data.HEADER_CUSTO.logos.logo_link)!='undefined'&&user_data.HEADER_CUSTO.logos.logo_link.length>0){$('#logo-partner').html('<a href="'+user_data.HEADER_CUSTO.logos.logo_link+'" target="_blank" class="floatl mr_10"><img src="'+SETTING_STATIC+'/img/partners/'+user_data.HEADER_CUSTO.logos.header+'-v'+STATIC_VERSION+'.png" /></a>');}else{$('#logo-partner').html('<a href="javascript:void(0)" class="floatl mr_10" onclick="loadBox(\'\'); return false;"><img src="'+SETTING_STATIC+'/img/partners/'+user_data.HEADER_CUSTO.logos.header+'-v'+STATIC_VERSION+'.png" /></a>');}}else{$('#logo-partner').html('');}
if(typeof(user_data.MARKETING_PUSH)!='undefined'&&typeof(user_data.MARKETING_PUSH)=='string'&&user_data.MARKETING_PUSH!==''){setTimeout(function(){if(modal.opened===false){modal.open(user_data.MARKETING_PUSH);}},500);}
CUSTO='';if(typeof(user_data.HEADER_CUSTO)!='undefined'){CUSTO=user_data.HEADER_CUSTO;}}else{return false;}
setTimeout(function(){howto.init();},3000);return true;}catch(e){console.log(e.message,e.stack);}},pageLogin:function(redirect){try{var mail='';if($('#login_mail').length==1){mail=$('#login_mail').val();}
var password='';if($('#login_password').length==1){password=$('#login_password').val();}
var remember=0;if($('#remember_me').length==1&&$('#remember_me').prop('checked')){remember=1;}
if(mail===''||password===''){$('#login_error').show();$('#login_password').val('');return false;}
var login_result=user.login(mail,password,remember);if(login_result===true){user.userLogin();Events.ready(Events.user.loaded,function(){user.refreshPageAfterLogin(redirect);});return true;}else{$('#login_error').show();$('#login_password').val('');return false;}}catch(e){console.log(e.message,e.stack);}},refreshPageAfterLogin:function(redirect){try{Events.trigger(Events.player.displayCurrentSong,dzPlayer.getCurrentSongInfo());if(typeof(redirect)=='object'){if(redirect.type=='refresh'){document.location.href=redirect.link;return true;}
if(redirect.type=='modal'){loadBox(actual_box);modal.open(redirect.link,(modal.opened?true:false));return true;}
if(redirect.type=='facebox'){loadBox(actual_box);loadFacebox(redirect.link);return true;}
if(redirect.type=='page'){loadBox(redirect.link);return true;}
if(redirect.type=='facebook_subscription'){loadBox('tops/track',{forceFaceboxClose:false});return true;}}else{loadBox(actual_box);}}catch(e){console.log(e.message,e.stack);}},relog:function(){try{if(LOG_TYPE=='facebook'){return facebook.connect(USER.FB_USER_ID);}else{request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=relog');if(request=='success'){return true;}else{modal.open('/'+SETTING_LANG+'/login.php');return false;}}}catch(e){console.log(e.message,e.stack);}},logout:function(redirect){try{if(typeof(redirect)=='undefined'){redirect='';}
if(LOG_TYPE=="facebook"){FB.getLoginStatus(function(response){console.log('FB status before logout',response);if(response.status=='connected'){FB.logout(function(response){console.log('FB logout success',response);LOG_TYPE='internal';user.logout(redirect);});}else{LOG_TYPE='internal';user.logout(redirect);}},true);return;}
document.location.href=document.location.protocol+'//'+SETTING_HOST+'/logout.php?redirect='+encodeURIComponent(redirect);return true;}catch(e){console.log(e.message,e.stack);}},register:function(payment,redirect,data){try{if(typeof(data.validButton)!='undefined'&&data.validButton!==''){$(data.validButton).hide();$(data.validButton).next().show();}
var lastname='';var firstname='';var mail='';if(typeof(data.email)!='undefined'&&data.email!==''){mail=data.email;}
var register_password='';if(typeof(data.password)!='undefined'&&data.password!==''){register_password=data.password;}
var register_password_confirm='';if(typeof(data.password_confirm)!='undefined'&&data.password_confirm!==''){register_password_confirm=data.password_confirm;}else{register_password_confirm=register_password;}
var register_username='';if(typeof(data.pseudo)!='undefined'&&data.pseudo!==''){register_username=data.pseudo;}
var gender='M';if(typeof(data.gender_f)!='undefined'&&data.gender_f){gender='F';}
var birthday_day='00';if(typeof(data.birthday_day)!='undefined'&&data.birthday_day!==''){birthday_day=data.birthday_day;}
var birthday_month='00';if(typeof(data.birthday_month)!='undefined'&&data.birthday_month!==''){birthday_month=data.birthday_month;}
var birthday_year='0000';if(typeof(data.birthday_year)!='undefined'&&data.birthday_year!==''){birthday_year=data.birthday_year;}
var country='';if(typeof(data.country)!='undefined'&&data.country!==''){country=data.country;}
var register_optin=0;if($('#register_optin').prop('checked')){register_optin=1;}
var checkForm='';if($('#checkForm').val()){checkForm=$('#checkForm').val();}
register_terms=1;var args='&register_mail='+encodeURIComponent(mail)+'&register_password='+encodeURIComponent(register_password)+'&register_password_confirm='+encodeURIComponent(register_password_confirm)+'&register_username='+encodeURIComponent(register_username)+'&register_lastname='+encodeURIComponent(lastname)+'&register_firstname='+encodeURIComponent(firstname)+'&register_gender='+encodeURIComponent(gender)+'&register_birthday_day='+encodeURIComponent(birthday_day)+'&register_birthday_month='+encodeURIComponent(birthday_month)+'&register_birthday_year='+encodeURIComponent(birthday_year)+'&register_country='+encodeURIComponent(country)+'&register_optin='+encodeURIComponent(register_optin)+'&checkForm='+encodeURIComponent(checkForm);if(payment){args+='&register_terms='+encodeURIComponent(register_terms);}
request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=register&'+args);if(request=='error'){user.ping();return false;}
var result=JSON.parse(request);if(typeof(result[0])=='number'&&result[0]>0){USER.USER_ID=result[0];user.login(mail,register_password,1);user.userLogin();if(payment){premium.order();}else{if(typeof(redirect)=='object'){if(redirect.type=='refresh'){document.location.href=redirect.link;return true;}
if(redirect.type=='modal'){var force=false;if(typeof(modal)!=='undefined'&&modal.opened===true){force=true;}
if(redirect.link==='gift'){loadBox('tops/track');}
modal.open(redirect.link,force);return true;}
if(redirect.type=='facebox'){if(redirect.link=='gift'){loadBox('tops/track');}
loadFacebox(redirect.link);return true;}
if(redirect.type=='page'){loadBox(redirect.link);return true;}}else{modal.open('lightbox/confirmation.php');loadBox('tops/track');return true;}}}else{if(typeof(data.callBackError)!='undefined'&&data.callBackError!==''){data.callBackError(result);}}
if(typeof(data.validButton)!='undefined'&&data.validButton!==''){$(data.validButton).show();$(data.validButton).next().hide();}
return true;}catch(e){console.log(e.message,e.stack);}},resetPassword:function(mail){try{if(typeof(mail)=='undefined'||mail===''||mail.length<=0){return false;}
request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=reset_password&reset_mail='+encodeURIComponent(mail));if(request=='success'){$('#reset_error').hide();$('#reset_first').hide();$('#reset_second').show();$('#reset_second_mail').html(mail);$('#foot_step3').show();$('#foot_step2').hide();return true;}else if(request=='error'){$('#reset_error div').html(trad.user.resetPassword_error1);$('#reset_error').show();return false;}else{if(request.indexOf('USER_SELECT_USER',0)!==-1){tmp_text=sprintf(trad.user.resetPassword_error3,mail);$('#reset_error div').html(tmp_text);$('#reset_error').show();}else if(request.indexOf('USER_ACTIVATION',0)!==-1){tmp_text=sprintf(trad.user.resetPassword_error2,mail);$('#reset_error div').html(tmp_text);$('#reset_error').show();}
return false;}}catch(e){console.log(e.message,e.stack);}},resetPasswordConfirm:function(){try{var password='';if($('#reset_new_password').length==1){password=$('#reset_new_password').val();}
var password_confirm='';if($('#reset_new_confirm').length==1){password_confirm=$('#reset_new_confirm').val();}
var key='';if($('#key').length==1){key=$('#key').val();}
var mail='';if($('#mail').length==1){mail=$('#mail').val();}
var checkForm='';if($('#checkForm').length==1){checkForm=$('#checkForm').val();}
var data='&password='+encodeURIComponent(password)+'&password_confirm='+encodeURIComponent(password_confirm)+'&key='+encodeURIComponent(key)+'&mail='+encodeURIComponent(mail)+'&checkForm='+encodeURIComponent(checkForm);request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=reset_passwordConfirm'+data);if(request=='error'){$('#reset_error').show();return false;}
$('#reset_error').hide();$('#reset_first').hide();$('#foot_step2').hide();$('#reset_confirm').show();$('#foot_step2_login').show();return true;}catch(e){console.log(e.message,e.stack);}},deleteAccountConfirm:function(md5){try{var password='';if($('#delete_account_password').length==1){password=$('#delete_account_password').val();}
var checkForm='';if($('#checkForm').length==1){checkForm=$('#checkForm').val();}
var data='&password='+encodeURIComponent(password)+'&md5='+encodeURIComponent(md5)+'&checkForm='+encodeURIComponent(checkForm);var request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=user_deleteConfirm'+data);var result=JSON.parse(request);if(result.error.length>0){www.drawFormResult('delete_result','form_error',trad.user.deleteAccountConfirm_text1);}else{www.drawFormResult('delete_result','form_success',trad.user.deleteAccountConfirm_text2);user.logout();}
return true;}catch(e){console.log(e.message,e.stack);}},reSendMail:function(){try{var request=sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=resendmail');if(request=='success'){$('#div_resendmail').html(trad.user.reSendMail_text1);return true;}else{$('#div_resendmail').html(trad.user.reSendMail_text2+' '+sprintf(trad.user.reSendMail_text3,'href="javascript:void(0)" onclick="user.reSendMail(); return false"'));return false;}}catch(e){console.log(e.message,e.stack);}},follow:function($div,friend_id,data){if(USER.USER_ID===0){modal.open('/'+SETTING_LANG+'/login.php');}
api.call('friend.follow',{'friend_id':friend_id},function(req){if(req.results===true){if($div!==null){user.setUnFollowState($div,friend_id,data);}
data.type='friend';data.USER_ID=friend_id;Events.trigger(Events.user.addFavorite,data);}});return true;},unfollow:function($div,friend_id,data){api.call('friend.unfollow',{'friend_id':friend_id},function(req){if(req.results===true){if($div!==null){user.setFollowState($div,friend_id,data);}
data.type='friend';data.USER_ID=friend_id;Events.trigger(Events.user.deleteFavorite,data);}});return true;},setFollowState:function($div,friend_id,data){$div.attr('onClick','user.follow($(this), '+friend_id+', '+JSON.stringify(data)+'); return false;');$('.label',$div).text(trad.user.label_follow);return true;},setUnFollowState:function($div,friend_id,data){$div.attr('onClick','user.unfollow($(this), '+friend_id+', '+JSON.stringify(data)+'); return false;').addClass('selected');$('.label',$div).text(trad.user.label_unfollow);return true;},block:function($div,friend_id,data){if(USER.USER_ID===0){modal.open('/'+SETTING_LANG+'/login.php');}
api.call('friend.block',{'friend_id':friend_id},function(req){if(req.results===true){user.setUnBlockState($div,friend_id,data);}});return true;},unblock:function($div,friend_id,data){api.call('friend.unblock',{'friend_id':friend_id},function(req){if(req.results===true){user.setBlockState($div,friend_id,data);}});return true;},setBlockState:function($div,friend_id,data){$div.unbind('click').bind('click',function(e){e.stopPropagation();user.block($(this),friend_id,data);return false;});$div.removeClass('green').removeClass('red');$div.off('mouseover','*').off('mouseout','*');$div.on('mouseover',function(){$(this).addClass('red');}).on('mouseout',function(){$(this).removeClass('red');});$div.tipsy({gravity:'n'}).attr('original-title',trad.user.label_block).tipsy('hide');return true;},setUnBlockState:function($div,friend_id,data){$div.unbind('click').bind('click',function(e){e.stopPropagation();user.unblock($(this),friend_id,data);return false;}).addClass('selected');$div.addClass('red').addClass('green');$div.off('mouseover','*').off('mouseout','*');$div.on('mouseover',function(){$(this).addClass('red');}).on('mouseout',function(){$(this).addClass('red');});$div.tipsy({gravity:'n'}).attr('original-title',trad.user.label_unblock).tipsy('hide');return true;}};};
if(typeof store=="undefined"){var store={checkPassword:function(product_type,product_id,password){try{callback_parameters=new Object();callback_parameters['product_id']=product_id;callback_parameters['product_type']=product_type;sendRequest('/'+SETTING_LANG+'/ajax/action.php','text','type=store_passwordVerification&store_password='+encodeURIComponent(password),true,store.checkPasswordCallback,callback_parameters);return true;}catch(e){console.log(e);}},checkPasswordCallback:function(request){try{if((request==false)||(request==null)||(request.responseText==false)||(request.responseText==''))return false;request=request.responseText;if(callback_parameters['product_id']!=null)product_id=callback_parameters['product_id'];if(callback_parameters['product_type']!=null)product_type=callback_parameters['product_type'];if(request=='error'){$('#store_password_error').text(trad.store.passwordVerification_error).show();}else if(request=='failed'){$('#store_password_error').text(trad.store.passwordVerification_failed).show();}else if(request=='success'){loadFacebox('store/index.php?product_type='+encodeURIComponent(product_type)+'&product_id='+encodeURIComponent(product_id));}
return true;}catch(e){console.log(e);}}}};
if(typeof(userSetting)=="undefined"){var userSetting={saveDelay:1000,intervalId:0,init:function(){try{Events.subscribe(Events.user.settingChange,userSetting.saveSetting);if(dzPlayer.playerLoaded){userSetting.restoreSetting();}
return true;}catch(e){console.log(e);}},saveSetting:function(evt,params){try{if(USER.USER_ID==0){return false;}
var newSetting=$.extend(true,{},USER.SETTING,params);if(JSON.stringify(newSetting)!=JSON.stringify(USER.SETTING)){USER.SETTING=newSetting;api.call('user.setSettings',{settings:params},function(){if(typeof(params.facebook)!='undefined'||typeof(params.twitter)!='undefined'||typeof(params.notification_mail)!='undefined'||typeof(params.notification_mobile)!='undefined'||(typeof(params.global)!='undefined'&&typeof(params.global.social)!='undefined')||(typeof(params.global)!='undefined'&&typeof(params.global.popup_unload)!='undefined')){notification.display(trad.general.save,false,0,2000);}});}
return true;}catch(e){console.log(e);}},restoreSetting:function(){try{dzPlayer.restoreSetting(USER.SETTING);}catch(e){console.log(e);}}}};
var twitter={isLinked:function(){if(typeof(USER.TWITTER.TOKEN)!='undefined'&&USER.TWITTER.TOKEN!=''){return true;}
return false;},link:function(){document.location.href='http://'+SETTING_HOST+'/twitter.php?callback_url='+encodeURIComponent("http://"+SETTING_HOST+"/"+actual_box);return true;},unlink:function(){if(confirm(sprintf(trad.setting.unlinkAccount_text1,'Twitter'))){api.call('twitterapi_unlinkAccount',{},function(request){if(typeof(request)!='undefined'&&request==true){delete USER.TWITTER.TOKEN;if(www.getCurrentPageType()=='account'){$('#page_account_share_twitter').removeClass('active');$('#page_account_share_twitter_title > div > span').removeClass('active');$('#page_account_share_twitter_title > div > a').css('display','none');}}});}
return true;},shareEnable:function(){if(USER.USER_ID==0)return false;if(typeof(USER.TWITTER.TOKEN)=='undefined'||USER.TWITTER.TOKEN=='')return false;if(typeof(USER.SETTING.twitter)=='undefined')return true;if(typeof(USER.SETTING.twitter.share_share)=='undefined')return true;if(!USER.SETTING.twitter.share_share)return false;return true;},commentEnable:function(){if(USER.USER_ID==0)return false;if(typeof(USER.TWITTER.TOKEN)=='undefined'||USER.TWITTER.TOKEN=='')return false;if(typeof(USER.SETTING.twitter)=='undefined')return true;if(typeof(USER.SETTING.twitter.share_comment)=='undefined')return true;if(!USER.SETTING.twitter.share_comment)return false;return true;}};
var lastfm={isLinked:function(){if(typeof(USER.LASTFM.TOKEN)!='undefined'&&USER.LASTFM.TOKEN!=''){return true;}
return false;},link:function(){document.location.href='http://www.last.fm/api/auth/?api_key=049131564a8f161381fc0da711a69a16';return true;},unlink:function(){try{api.call('lastfm.unlinkAccount',{},function(request){if(typeof(request.results)!='undefined'&&request.results==true){delete USER.LASTFM.TOKEN;if(www.getCurrentPageType()=='account'){$('#page_account_share_lastfm').removeClass('active');$('#page_account_share_lastfm_title > div > span').removeClass('active');$('#page_account_share_lastfm_title > div > a').css('display','none');}}});return true;}catch(e){console.log(e);}}};
if(typeof(dztoolbar)=="undefined"){var dztoolbar={init:function(){try{if(typeof(USER)=='undefined'){return false;}
Events.ready(Events.user.loaded,function(){if(USER.USER_ID>0&&typeof(USER.TOOLBAR)!="undefined"&&USER.TOOLBAR.length>0){dztoolbar.load();}});dztoolbar.load();return true;}catch(e){console.log(e);}},load:function(){try{if(typeof(USER)=='undefined'){return false;}
if(USER.USER_ID==0||typeof(USER.TOOLBAR)=='undefined'||USER.TOOLBAR.length==0){return false;}
if(OFFLINE){return false;}
if($('#dzt_container').length==0){var dzbar='<div id="dzt_container" class="center floatl" style="background:#f9f9f9;box-shadow:0px -2px 10px #b6b6b6;margin-right:300px"><div id="dztoolbar" class="floatl" style="border:1px solid #d2d2d2;border-width:1px 1px 0 0;background:#f9f9f9;background-image:-moz-linear-gradient(bottom, rgb(249,249,249) 0%, rgb(253,253,253) 100%);background-image:-webkit-linear-gradient(bottom, rgb(249,249,249) 0%, rgb(253,253,253) 100%);"></div></div>';if($('#live_warning').length==1){$('#live_warning').before(dzbar);}else{console.log("#live_warning doesn't exist yet!");}
(function(){var e=document.createElement('script');e.src=document.location.protocol+'//'+SETTING_HOST+'/'+SETTING_LANG+'/toolbar/dztoolbar.php?rand='+STATIC_VERSION;e.async=true;if(document.getElementById('dztoolbar-root')!=null){document.getElementById('dztoolbar-root').appendChild(e);}}());}else{return false;}
return true;}catch(e){console.log(e.message,e.stack);}},addElement:function(name,content){try{if(typeof(name)=='undefined'){return false;}
if(typeof(content)=='undefined'){return false;}
return'<div id="dzt_'+name+'" class="dzt_parent floatl relative" style="border-left:1px solid #d2d2d2;font-size:11px;height:22px;padding:8px 20px 0 10px;text-align:right;">'+content+'</div>';}catch(e){console.log(e);}},createPanel:function(title,name){try{if(typeof(title)=='undefined'){return false;}
if(typeof(name)=='undefined'){return false;}
if(name=='element'){return false}
if(typeof(SETTING_STATIC)=='undefined'){return false;}
return'<div id="dzt_'+name+'_content" class="dzt_element close" style="bottom:0px;right:-1px;border:1px solid silver;position:absolute;text-align:left;display:none;bottom:30px">'+'<div class="dztoolbar_panel_header" style="position:relative;background:#E8E8E8;border-bottom:1px solid #DADADA;width:100%;height:33px;padding-top:8px;color:#606060;font-size:20px;text-shadow:0 1px white;">'+'<strong style="display:block;margin-left:20px;line-height:24px;color: #606060;font-size: 20px;text-shadow: 0 1px white;">'+title+'</strong>'+'<div class="encoche" style="position:absolute;bottom:-1px;left:50px;background:url('+SETTING_STATIC+'/img/premium/encoche-v'+STATIC_VERSION+'.gif) left top no-repeat;width:15px;height:8px;"></div>'+'</div>'+'<div style="padding: 20px 20px 10px;background-color:#FFF;min-width:150px;min-height:100px;" id="dzt_'+name+'_html"></div>'+'</div>'+'</div>';}catch(e){console.log(e);}},open:function(name){try{dztoolbar.close();$(name).addClass('open').removeClass('close').show();return true;}catch(e){console.log(e);}},close:function(){try{$(".dzt_parent .dzt_element").removeClass('open').addClass('close').hide();return true;}catch(e){console.log(e);}}}}
$(document).ready(function(){});;
if(typeof(tracking)=='undefined'){var tracking={init:function(){Events.subscribe(Events.user.addFavorite,function(evt,params){var obj={};obj.type=params.type;switch(params.type){case"album":obj.id=params.ALB_ID;obj.name=params.ART_NAME+" - "+params.ALB_TITLE;break;case"artist":obj.id=params.ART_ID;obj.name=params.ART_NAME;break;case"playlist":obj.id=params.PLAYLIST_ID;obj.name=params.TITLE;break;case"radio":obj.id=params.RADIO_ID;obj.name=params.TITLE;break;default:return;}
tracking.track('music_add_to_favorite',obj);if(typeof(mixpanel)!='undefined')
mixpanel.people.increment("add_favorite");});Events.subscribe(Events.playlist.created,function(evt,params){tracking.track('music_playlist_create',{"id":params.id});if(typeof(mixpanel)!='undefined')
mixpanel.people.increment("playlist_create");});Events.subscribe(Events.user.share,function(evt,params){var obj={};obj.nb_user=params.FRIEND_LIST.length;obj.id=params.ID;obj.fb=params.FACEBOOK;obj.twitter=params.TWITTER;obj.name=params.NAME;switch(params.TYPE){case 0:obj.type="song";break;case 1:obj.type="album";break;case 2:obj.type="profile";break;case 3:obj.type="playlist";break;default:return;}
tracking.track('music_share',obj);});Events.ready(Events.user.loaded,function(evt,params){tracking.register();});Events.subscribe(Events.user.logout,function(evt,params){tracking.unregister();});return true;},track:function(event_name,properties,callback){if(typeof(mixpanel)=='undefined'){return false;}
if(typeof(callback)=='undefined'){callback=function(){};}
mixpanel.track(event_name,properties,callback);return true;},register:function(){if(typeof(mixpanel)=='undefined'){return false;}
var data={};data.USER_ID=USER.USER_ID;data.USER_AGE=USER.USER_AGE;data.USER_GENDER=USER.USER_GENDER;data.FB_USER_ID=USER.FB_USER_ID;data.DZ_COUNTRY=COUNTRY;data.TWITTER=false;if(typeof(USER.TWITTER.TOKEN)!='undefined'){data.TWITTER=true;}
mixpanel.register(data);mixpanel.people.identify(USER.USER_ID.toString());mixpanel.people.set({"$last_login":timestampToDate(SERVER_TIMESTAMP,true),"$created":USER.INSCRIPTION_DATE,"$country_code":COUNTRY,"offer_id":[OFFER_ID],"age":USER.USER_AGE,"gender":USER.USER_GENDER});return true;},unregister:function(){if(typeof(mixpanel)=='undefined'){return false;}
var data=['USER_ID','USER_AGE','USER_GENDER','FB_USER_ID','TWITTER'];for(var i=0;i<data.length;i++){mixpanel.unregister(data[i]);}
return true;},trackCampaign:function(){try{if(location.search.length>0){var query_string=location.search.substr(1);var allowed_tags=['ref','utm_source','utm_medium','utm_term','utm_content','utm_campaign'];var nb_tags=allowed_tags.length;var query_params={};var query_buffer=query_string.split('&');while(typeof(query_buffer[0])!=='undefined'){var param=query_buffer.shift().split('=');query_params[param[0]]=param[1];}
for(var i=0;i<nb_tags;i++){var tag=allowed_tags[i];if(typeof(query_params[tag])!=='undefined'&&query_params[tag]!==''){var tracking_info={'url':location.protocol+'//'+location.hostname+location.pathname,'query_string':query_string};var mixpanel_data={};for(var j=0;j<nb_tags;j++){var _tag=allowed_tags[j];if(typeof(query_params[_tag])!=='undefined'&&query_params[_tag]!==''){mixpanel_data[_tag]=query_params[_tag];}}
if(getObjectSize(mixpanel_data)>0){mixpanel.register(mixpanel_data);tracking.track('display_page',$.extend(tracking_info,mixpanel_data));}
break;}}}}catch(e){console.log(e.message,e.stack);}}};tracking.init();};
if(typeof(im)=='undefined'){var im={isInit:false,loading:false,start:0,nb:10,allLoaded:false,last:false,init:function(){im.isInit=true;im.$modele_message=$('#tpl_instant_messenger');Events.subscribe(Events.live.newMessage,function(evt,params){var data=new Array();data.push({'MESSAGE_ID':params.MESSAGE_ID,'AUTHOR':{'USER_ID':params.USER_ID_FROM,'USER_PICTURE':params.USER_PICTURE_FROM,'BLOG_NAME':params.USER_NAME_FROM},'MESSAGE':params.MESSAGE,'READ':0,'DATE':Math.floor(new Date().getTime()/1000)});if(im.friend_id==params.USER_ID_FROM){im.drawMessage(data,false);}});return true;},chat:function(friend_id){if(USER.USER_ID==0){modal.open('/'+SETTING_LANG+'/login.php',true);}
if(!im.isInit){im.init();}
im.friend_id=friend_id;im.start=0;im.nb=25;im.allLoaded=false;im.last=false;im.$modal=$('#modal_instant_messenger');im.$form=$('#form_instant_messenger');im.$panel=$('.tinyscroll_container',im.$modal);im.$list_messenger=$('.list-messages',im.$modal);im.$input=$('#instant_messenger_input');im.$panel.bind('jsp-scrolling',function(event,pos){if(pos==0&&!im.loading&&!im.allLoaded){im.start+=10;im.loadMessage(im.start,im.nb)}}).tinyscrollbar();im.loadMessage(im.start,im.nb);im.$input.focus();return true;},loadMessage:function(start,nb){im.loading=true;api.call('message.getList',{'friend_id':im.friend_id,'start':start,'nb':nb},function(request){if((im.start+im.nb)>request.results.total){im.allLoaded=true;}
im.drawMessage(request.results.data.reverse(),true);});return true;},drawMessage:function(data,prepend){var $display_line=$('<div></div>');for(var i=0;i<data.length;i++){if((i>0&&(data[i].DATE-data[(i-1)].DATE)<1000&&data[i].AUTHOR.USER_ID==data[(i-1)].AUTHOR.USER_ID)||(!prepend&&(data[i].DATE-im.last.DATE)<1000&&data[i].AUTHOR.USER_ID==im.last.AUTHOR.USER_ID)){if(prepend){$('.message',$display_line).last().html($('.message',$display_line).last().html()+'<br>'+data[i].MESSAGE);}else{$('.message',im.$list_messenger).last().html($('.message',im.$list_messenger).last().html()+'<br>'+data[i].MESSAGE);}}else{$display_line.append(im.appendMessage(data[i]));}
im.last=data[i];}
var $line=$display_line.clone().children();if(prepend){im.$list_messenger.prepend($line);}else{im.$list_messenger.append($line);}
setTimeout(function(){im.$panel.tinyscrollbar_update('bottom');},300);im.loading=false;api.call('message.markAsRead',{'friend_id':im.friend_id});im.$input.focus();return true;},appendMessage:function(message){$item=im.$modele_message.clone().attr('id','im_'+message.MESSAGE_ID).show();if(message.AUTHOR.USER_ID!=USER.USER_ID){$item.removeClass('author').addClass('friend');}
$('img',$item).attr('src',SETTING_DOMAIN_IMG+'/user/'+message.AUTHOR.USER_PICTURE+'/80x80-000000-80-0-0.jpg');$('.message',$item).text(message.MESSAGE);return $item;},post:function(message){if(USER.USER_ID==0){return false;}
if(message==''){return false;}
api.call('message.post',{'friend_id':im.friend_id,'message':message},function(request){var data=new Array();data.push({'MESSAGE_ID':request.results,'AUTHOR':{'USER_ID':USER.USER_ID,'USER_PICTURE':USER.USER_PICTURE,'BLOG_NAME':USER.BLOG_NAME},'MESSAGE':message,'READ':0,'DATE':Math.floor(new Date().getTime()/1000)});im.drawMessage(data,false);});return true;}}};
var header_menu={loadUserMenu:function(){try{$('#header_content_profil_user').attr('onClick','header_menu.clickBody(); return false;').bind("mouseup",header_menu.clickBox).parent().addClass('active');$("#header_content_profil_menu").show();$('body').unbind("mouseup",header_menu.clickBody);$('body').bind("mouseup",header_menu.clickBody);}catch(e){console.log(e);}},loadDiscoveyMenu:function(){try{$('#tab_discover').attr('onClick','header_menu.clickBody(); return false;').bind("mouseup",header_menu.clickBox).parent().addClass('active');$("#tab_menu_discover").show();$('body').unbind("mouseup",header_menu.clickBody);$('body').bind("mouseup",header_menu.clickBody);}catch(e){console.log(e);}},close:function(){try{if($("#header_content_profil_menu").is(':visible')){$("#header_content_profil_user").attr('onClick','header_menu.loadUserMenu(); return false;').unbind("mouseup",header_menu.clickBox).parent().removeClass('active');$("#header_content_profil_menu").hide();}else if($("#tab_menu_discover").is(':visible')){$("#tab_discover").attr('onClick','header_menu.loadDiscoveyMenu(); return false;').unbind("mouseup",header_menu.clickBox).parent().removeClass('active');$("#tab_menu_discover").hide();}}catch(e){console.log(e);}},clickBody:function(){try{header_menu.close();$('body').unbind("mouseup",header_menu.clickBody);}catch(e){console.log(e);}},clickBox:function(){return false;}};
(function($){$.cover=$.cover||{};$.cover.pane={options:{cover_size:null,ratio:1,padding:5,between:10,max_line:null,onresize:function(){}}}
$.fn.coverPane_resize=function(){return $(this).data('cpane').onResize();};$.fn.coverPane_update=function(){return $(this).data('cpane').refresh();};$.fn.coverPane_destroy=function(){return $(this).data('cpane').destroy();}
$.fn.coverPane=function(options){var options=$.extend({},$.cover.pane.options,options);this.each(function(){$(this).data('cpane',new coverPane($(this),options));});return this;}
function coverPane(root,options){var oSelf=this;function init(){oSelf.refresh();Events.subscribe(Events.layout.resize,oSelf.onResize);return true;}
this.onResize=function(){if(!root.is(':visible')){return;}
if(root.closest('body').length==0){Events.unsubscribe(Events.layout.resize,oSelf.onResize);return false;}
var content_w=root.width();nb=Math.ceil(content_w/options.cover_size);if(nb>options.covers.length){nb=options.covers.length;}
size=Math.floor(content_w/nb)-(((nb-1)*options.between)/nb)-((2*options.padding)/nb);if(size>options.cover_size){size=options.cover_size;}
size=Math.floor(size);var size_h=Math.floor(size*options.ratio);options.img.css({'width':size,'height':size_h,'box-sizing':'border-box'});var top=options.padding;var left=options.padding;var line=0;options.covers.each(function(i,item){i=i+1;if(line==options.max_line){$(item).hide();return;}
$(item).css({'top':top,'left':left,'width':size}).show();left+=size+options.between;if(((i)%nb)==0&&i<options.covers.length){line+=1;if(line==options.max_line){return;}
left=options.padding;top+=size_h+options.between+options.label_size;}});root.css('height',top+size_h+options.padding+options.label_size);options.onresize();}
this.refresh=function(){options.covers=$('.block_cover',root);options.img=$('.block_cover .img_main',root);oSelf.onResize();return true;}
this.destroy=function(){Events.unsubscribe(Events.layout.resize,oSelf.onResize);return true;}
return init();}})(jQuery);;
(function($){$.grid=$.grid||{};$.grid.datagrid={template:{option:{},track:{},header:{},colgroup:{}},options:{songs:0,type:"",id:0,checksum:"",skin:{},disk_number:0,selectable:true,playlist_private:false,playlist_personnal:false,art_id:0,externalLoadingDataClass:'',autoplay:false,allowMoveToPlaylist:true,scrollInfinite:true,scrollAutoOnAir:false,main_artist_hash:{},offline_data:{}},skinDefault:{displayLovedColumn:true,displayPlayColumn:true,displaySongColumn:true,displayArtistColumn:true,displayAlbumColumn:true,displayDurationColumn:true,displayNoteColumn:true,displayCheckColumn:true,displayDateColumn:false,displayDownloadColumn:false,displaySongNumber:false,displayCdNumber:false,displayHeader:true,displayFilter:true,displayEdit:false,displayListen:true,displaySyncOffline:true,displayRemove:false,displayOrder:false,displayAdd:true,displayBuy:((typeof(STORE_PLATEFORM)!='undefined')&&(STORE_PLATEFORM.DEEZER!=null)&&(getObjectSize(STORE_PLATEFORM)==1)),displayShare:!((typeof(STORE_PLATEFORM)!='undefined')&&(STORE_PLATEFORM.DEEZER!=null)&&(getObjectSize(STORE_PLATEFORM)==1)),displaySubresult:false,displayDownload:false,displayExtendBackground:true,displaySelectAll:false,displayLoved:true,displayMultiArtistSong:false,displayFallbackIcon:false,backgroundColor:'',displayOptionPosition:'top',displayFanOnly:'hovercard',reverseBackgroundColor:false,reverseColor:false,rightClic:true},skinType:{'playlist':{displayNoteColumn:false,displayDateColumn:true},'loved':{displaySyncOffline:true},'search':{displaySubresult:true,displaySyncOffline:false},'personal_song':{displayEdit:true,displaySyncOffline:false,displayRemove:true,displayBuy:false,displayNoteColumn:false,displayDownloadColumn:false},'downloads':{displayNoteColumn:false,displayDownloadColumn:true,displaySyncOffline:false,displayBuy:false,displayDownload:true},'folder':{displaySyncOffline:false},'album':{displayArtistColumn:false,displayAlbumColumn:false,displaySongNumber:true,displayCdNumber:true,displayHeader:false,displayFilter:false,displayExtendBackground:false,displaySelectAll:true,displayMultiArtistSong:true,displayFallbackIcon:true},'home_tracks':{displaySyncOffline:false},'artist_top':{displaySyncOffline:false,displayHeader:false,displayListen:false,displayFilter:false,displayArtistColumn:false,displayAlbumColumn:false,displaySongNumber:true,displayExtendBackground:false,displayOptionPosition:'hide',displayNoteColumn:false,displayCheckColumn:false,displayFanOnly:'text',reverseBackgroundColor:true},'artist_exclu':{displaySyncOffline:false,displayHeader:false,displayListen:false,displayFilter:false,displayArtistColumn:false,displayAlbumColumn:false,displaySongNumber:true,displayExtendBackground:false,displayOptionPosition:'hide',displayNoteColumn:false,displayCheckColumn:false,displayFanOnly:'text',reverseBackgroundColor:true},'discography_album':{displaySyncOffline:false,displayHeader:false,displayListen:false,displayFilter:false,displayArtistColumn:false,displayAlbumColumn:false,displaySongNumber:true,displayCdNumber:true,displayExtendBackground:false,displayOptionPosition:'bottom',displayMultiArtistSong:true,displayFallbackIcon:true,reverseBackgroundColor:true,backgroundColor:'table-white',},'playlist_profile':{displaySyncOffline:false,displayHeader:false,displayListen:false,displayFilter:false,displaySongNumber:true,displayExtendBackground:false,displayOptionPosition:'bottom',reverseBackgroundColor:true},'toptrack_profile':{displaySyncOffline:false,displayHeader:false,displayListen:false,displayFilter:false,displayArtistColumn:true,displayNoteColumn:false,displayAlbumColumn:false,displayDurationColumn:false,displaySongNumber:true,displayExtendBackground:false,displayOptionPosition:'bottom'},'queue':{displayRemove:true,displayOrder:true,displaySyncOffline:false,displayHeader:false,displayListen:false,displayFilter:false,displayArtistColumn:true,displayNoteColumn:false,displayAlbumColumn:true,displayDurationColumn:false,displaySongNumber:true,displayExtendBackground:false,displayOptionPosition:'top',displaySelectAll:true,reverseColor:true}}};$.fn.createDatagrid=function(options){if(typeof($(this).data('dgd'))=='undefined'){var options=$.extend({},$.grid.datagrid.options,options);this.each(function(){$(this).data('dgd',new Datagrid($(this),options));});return this;}};$.fn.actionDatagrid=function(params){try{if(typeof($(this).data('dgd')[params[0]])=='function'){return $(this).data('dgd')[params[0]].apply(this,Array.prototype.slice.call(params,1));}else{console.log('La method n existe pas:',params[0]);}}catch(e){console.log(e.message,e.stack);}};$.fn.getData=function(param){try{return $(this).data('dgd').getData(param);}catch(e){console.log(e.message,e.stack);}};$.fn.destroy=function(){try{$(this).data('dgd')['unsubscribe']();$(this).empty().removeClass('datagrid_master').removeClass('datagrid_'+$(this).data('dgd').getData('type'));$(this).removeData('dgd');}catch(e){console.log(e.message,e.stack);}};function Datagrid(root,options){var oSelf=this;var oWrapper=root;var oDatagrid=null;var oBody=null;var oTable=null;var oHead=null;var oOption=null;var oColGroup=null;var currentDisk=0;var orderableOrigin=false;var filterInterval=300;var filterId=0;var filterActif=false;var filterResult=[];var unavailableList=[];var waitingAllTrackForDownload=false;var waitingAllTrackForFilter=false;var waitingAllTrackForReplaceProcess=false;var waitingAllTrackForTotalPlay=false;var waitingAllTrackForSort=false;var creationStartIndex=0;var creationEndIndex=0;var creationGroup=40;var creationInterval=100;var loadGroup=0;var removedTrackBeforeLoadComplete=0;var resizeStartIndex=0;var resizeEndIndex=0;var resizeGroup=40;var resizeInterval=50;var replaceTimer=0;var replaceDelay=0;var replaceDelayPerso=5000;var replaceDelayTiers=500;var replaceCheck=(60*60*24*10);var filterLabel='';var resizeMinPercent=8;var orderableBar=null;var cache_dom={};var lastColSort=false;var lastSort={};var artistOnlyEvent=false;var lastOnAirTrack=false;var favoriteSongEvent=false;var progressBar=null;var currentTrackNumber=0;var previousHierarchicalTitle='';var pageContent='';var scrollInterval=0;var contributor_model='';var upload_model='';var artist_model=$('<a href="" class="evt-click"></a>');function create(){try{oWrapper.empty();template.load('naboo/components/datagrid',oWrapper);oSelf.initialize();}catch(e){console.log(e.message,e.stack);}};this.getData=function(param){return options[param];};this.initialize=function(){try{oWrapper.addClass('datagrid_master');oDatagrid=$('.datagrid',oWrapper);oTable=$('.datagrid > table',oWrapper);oBody=$('.datagrid > table > tbody',oWrapper);oHead=$('.datagrid > table > thead',oWrapper);oColGroup=$('.datagrid > table > colgroup',oWrapper);oOption=$('#naboo_datagrid_options',oWrapper);pageContent=$('#page_content');if(options.songs.total==0){options.songs.count=0;options.songs.data=[];}
Events.subscribe(Events.player.onAir,oSelf.displayPlayingTrack);Events.subscribe(Events.player.playing,oSelf.displayPlayingIcon);Events.subscribe(Events.player.finishTrackList,oSelf.displayPlayingIcon);if(USER.USER_ID!=0){Events.ready(Events.user.userReady,function(){Events.subscribe(Events.user.addFavorite,oSelf.displayChangeFavoriteTrack);Events.subscribe(Events.user.deleteFavorite,oSelf.displayChangeFavoriteTrack);});}
if(typeof($.grid.datagrid.skinType[options.type])=='object'){options.skin=$.extend(true,{},$.grid.datagrid.skinDefault,$.grid.datagrid.skinType[options.type]);if(options.type=='playlist'||options.type=='loved'){options.skin.displayRemove=options.skin.displayOrder=options.playlist_personnal;}else if(options.type=='artist_exclu'){oSelf.subscribeEventFanOnly();}}else{options.skin=$.grid.datagrid.skinDefault;console.log('datagrid type unknown :',options.type);}
if(options.skin.reverseColor){oDatagrid.addClass('datagrid-inverse');}
oSelf.templateHeader();oSelf.templateOption();oSelf.templateOtherElements();oSelf.templateLineTrack();if(options.skin.displayHeader){oSelf.setHeaderColumnSize();}
if(options.songs.total==0){options.songs.count=0;options.songs.data=[];}
if(options.playlist_private){$("#naboo_datagrid_private",oWrapper).show();oTable.remove();oOption.remove();options.songs.total=0;options.songs.count=0;options.songs.data=[];}else{$("#naboo_datagrid_private",oWrapper).remove();}
if(replaceTimer>0)clearTimeout(replaceTimer);replaceDelay=(options.playlist_personnal)?replaceDelayPerso:replaceDelayTiers;if(OFFLINE){options.selectable=false;options.skin.displayRemove=false;$('[data-target="checkall"]',oHead).hide();}
if(options.skin.displayHeader){oTable.addClass('table-header');}
if(options.skin.reverseBackgroundColor&&options.disk_number<2){oTable.addClass('table-alt');}
if(options.skin.backgroundColor!=''){oTable.addClass(options.skin.backgroundColor);}
loadGroup=1;creationStartIndex=0;if(options.skin.displayCdNumber){var songsCleaner=[];for(var i in options.songs.data){if(typeof(options.songs.data[i])!='undefined'){songsCleaner.push(options.songs.data[i]);}}
options.songs.data=songsCleaner;options.songs.total=songsCleaner.length;options.songs.count=songsCleaner.length;}
oSelf.createDatagridLines();if(options.skin.displaySyncOffline){oSelf.subscribeOfflineEvents();if(dzoffline.LOADED){oSelf.changeDownloadStatusButton();}else{Events.subscribeOnce(Events.offline.loaded,function(){oSelf.changeDownloadStatusButton();oSelf.refleshAllDownloadStatus();});}}
if(options.skin.rightClic){oDatagrid.bind('contextmenu',function(){return false;});;oSelf.rightClic(oBody);}
if(options.autoplay){Events.ready(Events.player.playerReady,function(){oSelf.play();});}
Events.unsubscribe(Events.playlist.addSong,oSelf.liveAddSong);Events.subscribe(Events.playlist.addSong,oSelf.liveAddSong);Events.trigger(Events.datagrid.displayed,{type:options.type,id:options.id,start:0});return oSelf;}catch(e){console.log(e.message,e.stack);}};this.templateHeader=function(){try{if($.grid.datagrid.template.header[options.type]!=null&&$.grid.datagrid.template.colgroup[options.type]!=null){if(!options.skin.displayHeader){oHead.remove();}else{oHead.empty();oHead.append($.grid.datagrid.template.header[options.type].clone());}
oColGroup.empty();oColGroup.append($.grid.datagrid.template.colgroup[options.type].clone());oSelf.setHeaderLink();return true;}
if(!options.skin.displayLovedColumn){$('.loved',oHead).remove();$('.loved',oColGroup).remove();}
if(!options.skin.displayPlayColumn){$('.position',oHead).remove();$('.position',oColGroup).remove();}
if(!options.skin.displaySongColumn){$('.track',oHead).remove();$('.track',oColGroup).remove();}
if(!options.skin.displayArtistColumn){$('.artist',oHead).remove();$('.artist',oColGroup).remove();}
if(!options.skin.displayAlbumColumn){$('.album',oHead).remove();$('.album',oColGroup).remove();}
if(!options.skin.displayDurationColumn){$('.length',oHead).remove();$('.length',oColGroup).remove();}
if(!options.skin.displayNoteColumn){$('.popularity',oHead).remove();$('.popularity',oColGroup).remove();}
if(!options.skin.displayDateColumn){$('.added',oHead).remove();$('.added',oColGroup).remove();}
if(!options.skin.displayDownloadColumn){$('.download',oHead).remove();$('.download',oColGroup).remove();}
if(!options.skin.displayCheckColumn){$('.check',oHead).remove();$('.check',oColGroup).remove();}
if(!options.skin.displayHeader){oHead.remove();}
$.grid.datagrid.template.header[options.type]=$('tr',oHead).clone();$.grid.datagrid.template.colgroup[options.type]=$('col',oColGroup).clone();oSelf.setHeaderLink();}catch(e){console.log(e.message,e.stack);}};this.templateOption=function(){try{if(($.grid.datagrid.template.option[options.type])!=null){$("#naboo_datagrid_options",oDatagrid).remove();if(options.skin.displayOptionPosition=='bottom'){oDatagrid.append($.grid.datagrid.template.option[options.type].clone());}else if(options.skin.displayOptionPosition=='top'){oDatagrid.prepend($.grid.datagrid.template.option[options.type].clone());}
oOption=$('#naboo_datagrid_options',oDatagrid);oSelf.setOptionLink();return true;}
if(options.skin.displayFilter){$('#naboo_datagrid_filter',oOption).show();oSelf.setFilterLabel();}else{$('#naboo_datagrid_filter',oOption).remove();}
if(options.skin.displayListen){$('#naboo_datagrid_listen',oOption).show();}else{$('#naboo_datagrid_listen',oOption).remove();}
if(options.skin.displaySyncOffline){$('#naboo_datagrid_offline',oOption).show();}else{$('#naboo_datagrid_offline',oOption).remove();}
if(options.skin.displaySelectAll&&!options.skin.displayHeader){$('#naboo_datagrid_select_all',oOption).show();}else{$('#naboo_datagrid_select_all',oOption).remove();}
if(!options.skin.displayBuy){$('#naboo_datagrid_buy',oOption).remove();}
if(!options.skin.displayDownload){$('#naboo_datagrid_download',oOption).remove();}
if(!options.skin.displayAdd){$('#naboo_datagrid_add',oOption).remove();}
if(!options.skin.displayRemove){$('#naboo_datagrid_remove',oOption).remove();}
$.grid.datagrid.template.option[options.type]=$('#naboo_datagrid_options',oDatagrid).clone();$('#naboo_datagrid_options',oDatagrid).remove();if(options.skin.displayOptionPosition=='bottom'){oDatagrid.append($.grid.datagrid.template.option[options.type].clone());}else if(options.skin.displayOptionPosition=='top'){oDatagrid.prepend($.grid.datagrid.template.option[options.type].clone());}
if(options.skin.displayOptionPosition!='hide'){oOption=$('#naboo_datagrid_options',oDatagrid);}
oSelf.setOptionLink();}catch(e){console.log(e.message,e.stack);}};this.templateLineTrack=function(){try{if(($.grid.datagrid.template.track[options.type])!=null){options.$line_model=$.grid.datagrid.template.track[options.type];$("tr",oBody).remove();return true;}
options.$line_model=$(".song",oBody);$(".song",oBody).remove();if(!options.skin.displayLoved){$('.loved',options.$line_model).remove();}
if(!options.skin.displayPlayColumn){$('.position [data-target="play"]',options.$line_model).remove();}
if(!options.skin.displaySongNumber){$('.position [data-target="position"]',options.$line_model).remove();}
if(!options.skin.displaySongColumn){$('.track',options.$line_model).remove();}else{if(!options.skin.displayBuy){$('.track [data-target="icon-buy"]',options.$line_model).remove();$('.track [data-target="icon-download"]',options.$line_model).remove();}
if(!options.skin.displayShare){$('.track [data-target="icon-share"]',options.$line_model).remove();}
if(!options.skin.displayMultiArtistSong){$('.track [data-target="featuring"]',options.$line_model).remove();}
if(!options.skin.displayEdit){$('.track [data-target="icon-edit"]',options.$line_model).remove();}
if(!options.skin.displaySubresult){$('.track [data-target="icon-similar"]',options.$line_model).remove();}}
if(!options.skin.displayArtistColumn){$('.artist',options.$line_model).remove();}
if(!options.skin.displayAlbumColumn){$('.album',options.$line_model).remove();}
if(!options.skin.displayDurationColumn){$('.length',options.$line_model).remove();}
if(!options.skin.displayCheckColumn){$('.check',options.$line_model).css('display','none');}
if(!options.skin.displayNoteColumn){$('.popularity',options.$line_model).remove();}
if(!options.skin.displayDateColumn){$('.added',options.$line_model).remove();}
if(!options.skin.displayDownloadColumn){$('.download',options.$line_model).remove();}
if(OFFLINE){$('.track [data-target="icon-add"]',options.$line_model).remove();}
$.grid.datagrid.template.track[options.type]=options.$line_model.clone();}catch(e){console.log(e.message,e.stack);}};this.templateOtherElements=function(){try{ghost_single_model=$("#naboo_datagrid_ghost_single",oWrapper).clone().removeAttr('id').show();$("#naboo_datagrid_ghost_single",oWrapper).remove();ghost_multi_model=$("#naboo_datagrid_ghost_multi",oWrapper).clone().removeAttr('id').show();$("#naboo_datagrid_ghost_multi",oWrapper).remove();progressBar=$(".progress",oBody).clone().show();$(".progress",oBody).remove();fillerBar=$(".filler",oBody).clone().show();$(".filler",oBody).remove();dividerBar=$(".divider",oBody).clone().show();$(".divider",oBody).remove();if(options.skin.displayCdNumber){$(".caption > td",oBody).attr('colspan',oColGroup.children().length);disk_model=$(".caption",oBody).clone();}
$(".caption",oBody).remove();contributor_model=$(".contributors",oBody).clone();contributor_model=oSelf.addTdInLine(contributor_model,'.track',{before:true});$(".contributors",oBody).remove();if(options.type=='personal_song'){upload_model=$(".upload",oBody).clone();upload_model=oSelf.addTdInLine(upload_model,'.track',{before:true,after:true});}
$(".upload",oBody).remove();}catch(e){console.log(e.message,e.stack);}};this.setHeaderLink=function(){try{$('.sortable > .label',oHead).click(function(){oSelf.sort($(this).parents('th'));});$('.check > input',oHead).click(function(){oSelf.selectAll($(this));});}catch(e){console.log(e.message,e.stack);}};this.setHeaderColumnSize=function(){try{var lineSize=oHead.width();$('.track',oHead).css('width',Math.floor(($('.track',oHead).width()/lineSize)*100)+'%');$('.artist',oHead).css('width',Math.floor(($('.artist',oHead).width()/lineSize)*100)+'%');}catch(e){console.log(e.message,e.stack);}};this.setOptionLink=function(){try{$('#naboo_datagrid_listen',oOption).click(function(){oSelf.play($(this));});$('#naboo_datagrid_select_all > input',oOption).click(function(){oSelf.selectAll($(this));});$('#naboo_datagrid_add',oOption).click(function(){oSelf.addMusicBox($(this));}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$('#naboo_datagrid_download',oOption).click(function(){oSelf.storeAction($(this),'download');}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$('#naboo_datagrid_buy',oOption).click(function(){oSelf.storeAction($(this),'buy');}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$('#naboo_datagrid_remove',oOption).click(function(){oSelf.removeTrack();}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$('#naboo_datagrid_filter_text',oOption).keyup(function(){oSelf.startFilter(this.value);}).focus(function(){oSelf.onFilterFocus();});$('#naboo_datagrid_filter_clear',oOption).click(function(){$(this).prev().val('').focus();oSelf.startFilter('');});$('#naboo_datagrid_offline_local',oOption).click(function(){oSelf.download();});}catch(e){console.log(e.message,e.stack);}};this.setLineLink=function($line){try{$line.dblclick(function(a){if($(a.target).is('i')||$(a.target).is('input')){return false;}
oSelf.play($(this));return false;});$line.find('[data-target="play"]').click(function(){oSelf.play($(this));return false;});$line.find('[data-target="track"]').click(function(){oSelf.play($(this));return false;});$line.find('[data-target="icon-add"]').click(function(){oSelf.addMusicBox($(this));return false;}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('[data-target="icon-contributors"]').click(function(){oSelf.openContributor($(this));return false;}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('[data-target="icon-video"]').mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('[data-target="icon-edit"]').click(function(){modal.open('lightbox/edit_personal_song.php?upload_id='+$(this).parents('tr').data('song').UPLOAD_ID);return false;}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('[data-target="icon-buy"]').click(function(){oSelf.storeAction($(this),'buy');return false;}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('[data-target="icon-download"]').click(function(){oSelf.storeAction($(this),'download');return false;}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('[data-target="icon-share"]').click(function(){oSelf.shareAction($(this));return false;}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('[data-target="download-one"]').click(function(){oSelf.storeAction($(this),'download');return false;}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('[data-target="icon-link"]').mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('[data-target="icon-replace"]').click(function(){hovercard.init($(this),0);return false;});$line.find('[data-target="icon-similar"]').click(function(){oSelf.openSubResult($(this));return false;}).mouseover(function(){oSelf.tipsy($(this),'over')}).mouseout(function(){oSelf.tipsy($(this),'out')});$line.find('.popularity').mouseover(function(){if($(this).attr('data-tooltip')==null){if($(this).parents('tr').data('song').RANK_SNG==null){return false;}
var rank_sng=($(this).parents('tr').data('song').RANK_SNG/100000);$(this).attr('data-tooltip',trad.music.naboo_ranking_track+rank_sng.toFixed(2)+' / 10');}
oSelf.tipsy($(this),'over','e');}).mouseout(function(){if($(this).attr('data-tooltip')!=null){oSelf.tipsy($(this),'out');}});$line.find('[data-target="download-one"]').click(function(){oSelf.storeAction($(this),'download');return false;});$line.find('[data-target="check"]').click(function(){oSelf.selectOne($(this));});}catch(e){console.log(e.message,e.stack);}};this.load=function(status,div,id,nb){try{if(creationEndIndex<options.songs.total){start=(loadGroup*creationGroup)-removedTrackBeforeLoadComplete;switch(options.type){case"playlist":case"loved":var parameters={playlist_id:options.id,lang:SETTING_LANG,start:start,nb:nb,header:false,tags:false};api.call('deezer_pagePlaylist',parameters,oSelf.onLoaded,{nb:nb});break;case"search":var parameters={query:id,filter:'ALL',start:start,nb:nb,suggest:0,artist_suggest:0};api.call('deezer_pageSearch',parameters,oSelf.onLoaded,{nb:nb});break;case"personal_song":var parameters={start:start,nb:nb};api.call('personal_song.getList',parameters,oSelf.onLoaded,{nb:nb});break;case"folder":case"home_tracks":window[options.externalLoadingDataClass].loadElementTracks(oSelf.onLoaded);break;case"downloads":var parameters={start:start,nb:nb,order:7};api.call('store_getList',parameters,oSelf.onLoaded,{nb:nb});break;default:console.log("datagrid.load : unknown type");}}else{if(options.scrollInfinite){infinite_scroll.disable();}}
return true;}catch(e){console.log(e.message,e.stack);}};this.loadAllTracks=function(){try{if(options.songs.count<options.songs.total){showLoading();if(options.scrollInfinite){infinite_scroll.disable();}
oSelf.load(false,"naboo_"+options.type+"_tracks",options.id,creationGroup);}
return true;}catch(e){console.log(e.message,e.stack);}};this.onLoaded=function(request,callbackParameters){try{if(request==false)return false;if(request.error.length==0){loadGroup++;switch(options.type){case"playlist":case"loved":$.merge(options.songs.data,request.results.SONGS.data);var nbNewTrack=request.results.SONGS.count;if(nbNewTrack<callbackParameters.nb)options.songs.total-=(callbackParameters.nb-nbNewTrack);break;case"search":$.merge(options.songs.data,request.results.TRACK.data);var nbNewTrack=request.results.TRACK.count;if(nbNewTrack<callbackParameters.nb)options.songs.total-=(callbackParameters.nb-nbNewTrack);break;case"downloads":case"personal_song":$.merge(options.songs.data,request.results.data);var nbNewTrack=request.results.count;if(nbNewTrack<callbackParameters.nb)options.songs.total-=(callbackParameters.nb-nbNewTrack);break;case"folder":case"home_tracks":$.merge(options.songs.data,request.results.data);window[options.externalLoadingDataClass].current_element++;creationStartIndex=options.songs.count;var nbNewTrack=creationGroup;break;}
options.songs.count=options.songs.data.length;if(options.externalLoadingDataClass!=''){if(window[options.externalLoadingDataClass].isAllElementLoaded())
options.songs.total=options.songs.count;}
var oldStartInsert=creationStartIndex;oSelf.createDatagridLines(nbNewTrack);Events.trigger(Events.datagrid.displayed,{type:options.type,id:options.id,start:oldStartInsert});}
if(!waitingAllTrackForSort){hideLoading();}
return true;}catch(e){console.log(e.message,e.stack);}};this.createDatagridLines=function(addTrack){try{if(creationStartIndex+creationGroup>options.songs.count)creationEndIndex=options.songs.count;else creationEndIndex=creationStartIndex+((typeof(addTrack)=='undefined')?creationGroup:addTrack);$lines=$('<p></p>');for(j=creationStartIndex;j<creationEndIndex;j++){if(typeof(options.songs.data[j].FALLBACK)!='undefined'){options.songs.data[j].SNG_ID_ORIGIN=options.songs.data[j].SNG_ID;delete options.songs.data[j].FALLBACK.TRACK_NUMBER;delete options.songs.data[j].FALLBACK.DISK_NUMBER;options.songs.data[j]=$.extend({},options.songs.data[j],options.songs.data[j].FALLBACK);}
var currentData=options.songs.data[j];if(typeof(currentData)=='undefined')continue;if(typeof(currentData.TYPE)=='undefined'){if(typeof(currentData.UPLOAD_ID)!='undefined'){currentData.TYPE=1;}else{currentData.TYPE=0;}}
if(options.skin.displaySongNumber){currentTrackNumber++;}
if(options.skin.displayCdNumber){if(options.disk_number>1&&currentDisk<currentData.DISK_NUMBER){$disk=disk_model.clone();$('[data-target="cd"]',$disk).text('CD '+currentData.DISK_NUMBER);$lines.append($disk);currentDisk++;}}
var TYPE="";if(options.type!='search'){TYPE="SEARCH_";}
if(currentData.TYPE==1&&cache_dom["UPLOAD_"+currentData.UPLOAD_ID]!=null){$cache_line=$(cache_dom["UPLOAD_"+currentData.UPLOAD_ID]);$cache_line=oSelf.refreshLineOffline($cache_line,currentData);$lines.append($cache_line);continue;}else if(cache_dom[TYPE+"SONG_"+currentData.SNG_ID]!=null){$cache_line=$(cache_dom[TYPE+"SONG_"+currentData.SNG_ID]);$cache_line=oSelf.refreshLineOffline($cache_line,currentData);$lines.append($cache_line);continue;}
$line=options.$line_model.clone();oSelf.setLineLink($line);oSelf.refreshLineContent($line,currentData);if(currentData.TYPE==1){cache_dom["UPLOAD_"+currentData.UPLOAD_ID]=$line.removeClass('active').attr('outerHTML');}else{cache_dom[TYPE+"SONG_"+currentData.SNG_ID]=$line.removeClass('active').attr('outerHTML');}
$lines.append($line);}
oSelf.createDatagridDrag($lines.children('.song'));oBody.append($lines.children());creationStartIndex=creationEndIndex;if(creationEndIndex>=options.songs.count){oSelf.createDatagridResize();oSelf.unAvailableDisplay();oSelf.displayPlayingTrack(null,{SONG_DATA:dzPlayer.currentSongInfo,CONTEXT:dzPlayer.context});if(replaceTimer>0)clearTimeout(replaceTimer);replaceTimer=setTimeout(oSelf.recoverTracks,replaceDelay);if(waitingAllTrackForReplaceProcess)
oSelf.recoverTracksStart();if(waitingAllTrackForDownload)
oSelf.download();if(waitingAllTrackForFilter)
oSelf.onFilterFocus();if(waitingAllTrackForTotalPlay)
oSelf.playAllTracks();if(waitingAllTrackForSort)
oSelf.sort(lastSort.link,lastSort.columnIndex);if(creationStartIndex>=options.songs.total){if(options.scrollInfinite){infinite_scroll.disable();}
Events.trigger(Events.datagrid.allTracksDisplayed,{duration:oSelf.getTotalDuration(),nbSong:options.songs.total});}else{oSelf.activeInfiniteScroll();}
oSelf.extendBackground();}else{setTimeout(oSelf.createDatagridLines,creationInterval);}
if(options.skin.displayDateColumn){calculeTime();}
return true;}catch(e){console.log(e.message,e.stack);}};this.loadNextTrack=function(){try{oSelf.load(false,"naboo_"+options.type+"_tracks",options.id,creationGroup);}catch(e){console.log(e.message,e.stack);}};this.refreshSongNumber=function(){try{$('tr:visible',oBody).each(function(index,item){$('.position [data-target="position"]',$(item)).text(pad(index+1,2));});}catch(e){console.log(e.message,e.stack);}};this.refreshLineContent=function($line,currentData,subResult){try{if(typeof(currentData)=='undefined')return false;if(typeof(currentData.TYPE)=='undefined'){currentData.TYPE=0;}
var isDeezerTrack=oSelf.isDeezerTrack(currentData);var isFallbackTrack=(typeof(currentData.FALLBACK)!='undefined');var sngId=oSelf.getSongId(currentData);var data={id:"naboo_datagrid_track_"+sngId};if(currentData.TYPE==1){data['data-fan-only']=currentData.FAN_ONLY;}
$line.attr(data).removeClass('active');$line.data('song',currentData);var onClikAlbum=(isDeezerTrack&&!OFFLINE)?"/album/"+currentData.ALB_ID:'';var sngTitle=currentData.SNG_TITLE;if(typeof(currentData.VERSION)!='undefined'&&currentData.VERSION!=''){sngTitle+=' '+currentData.VERSION;}
if(options.skin.displayMultiArtistSong){oSelf.displayArtistName($('.track [data-target="featuring"]',$line),currentData,options.main_artist_hash);}else{oSelf.displayArtistName($('.artist > div',$line),currentData);}
oSelf.displaySongTitle($('.track [data-target="track"]',$line),currentData);$('.album [data-target="album"]',$line).attr("href",onClikAlbum).text(currentData.ALB_TITLE);if(options.skin.displaySongNumber){var nb=pad((typeof(currentData.TRACK_NUMBER)!='undefined'&&options.type!='queue')?currentData.TRACK_NUMBER:currentTrackNumber,2);$('.position [data-target="position"]',$line).text(nb);}
if(!(typeof(currentData.VIDEO)=='undefined'||currentData.VIDEO=='false'||currentData.VIDEO==false)){$('.track [data-target="icon-video"]',$line).attr('href','/video/'+currentData.VIDEO).show();}else{$('.track [data-target="icon-video"]',$line).hide();}
if(isDeezerTrack&&options.skin.displayBuy){if(typeof(currentData.ISRC)!='undefined'&&dzPlayer.isStoreTrack(currentData.ISRC)){$('.track [data-target="icon-download"]',$line).show();$('.track [data-target="icon-buy"]',$line).hide();}else{$('.track [data-target="icon-download"]',$line).hide();$('.track [data-target="icon-buy"]',$line).show();}}else{$('.track [data-target="icon-download"]',$line).hide();$('.track [data-target="icon-buy"]',$line).hide();}
if(isDeezerTrack&&options.skin.displayShare){$('.track [data-target="icon-share"]',$line).show();}else{$('.track [data-target="icon-share"]',$line).hide();}
if(currentData.DURATION==undefined)currentData.DURATION=0;$(".length",$line).text(secToMin(currentData.DURATION));if(options.skin.displayNoteColumn){$('.popularity [data-target="note"]',$line).removeClass(function(index,css){return(css.match(/\bnote-[0-9]/g)||[]).join(' ');});if(isDeezerTrack){if(currentData.RANK_SNG==undefined)currentData.RANK_SNG=0;var rank=currentData.RANK_SNG/100000;$('.popularity [data-target="note"]',$line).addClass("note-"+Math.round(rank));}else{$('.popularity [data-target="note"]',$line).addClass("note-0");}}
if(options.skin.displayDateColumn){$('.added [data-target="added"]',$line).attr('data-timestamp',currentData.DATE_ADD);}
if(isFallbackTrack&&options.skin.displayFallbackIcon){$('.track [data-target="icon-link"]',$line).attr('href','/album/'+currentData.FALLBACK.ALB_ID).show();}else{$('.track [data-target="icon-link"]',$line).hide();}
if(options.skin.displaySubresult){if(typeof(subResult)=='object'){$line.addClass("similar").attr("data-parent-id",subResult.parentId).removeClass('song');if(subResult.isLastSubResult)$line.addClass('similar-last');}
if(typeof(currentData.SUB_RESULT)!='undefined'){$('.track [data-target="icon-similar"]',$line).show();}else{$('.track [data-target="icon-similar"]',$line).hide();}}else{$('.track [data-target="icon-similar"]',$line).hide();}
if(options.type!='search'&&options.type!='queue'&&typeof(currentData.SNG_CONTRIBUTORS)!='undefined'&&(oSelf.getContributor(currentData.SNG_CONTRIBUTORS,'author')!=false||oSelf.getContributor(currentData.SNG_CONTRIBUTORS,'composer')!=false||oSelf.getContributor(currentData.SNG_CONTRIBUTORS,'misc')!=false)){$('.track [data-target="icon-contributors"]',$line).show();}else{$('.track [data-target="icon-contributors"]',$line).hide();}
if(options.skin.displayLoved&&!OFFLINE){favorite.display($('.loved [data-target="lovetrack"]',$line),{type:'song',SNG_ID:sngId,TYPE:(isDeezerTrack?0:1),KEY:sngId+'_'+(isDeezerTrack?0:1)});}
if(OFFLINE){$('.track .icons',$line).hide();$('.loved [data-target="lovetrack"]',$line).hide();}
$(".check > input",$line).attr('disabled',!options.selectable);var unavailableType=right.checkSongAvailable(currentData);if(unavailableType==right.NOT_RELEASE_FREE||unavailableType==right.NOT_RELEASE_PREMIUM){oTable.addClass('has-calendar');$line.addClass('soon');var releaseDate=(unavailableType==right.NOT_RELEASE_FREE)?currentData.RIGHTS.STREAM_ADS.split('-'):currentData.RIGHTS.STREAM_SUB.split('-');$('.position [data-target="calendar"] .month',$line).text(getShortMonthName(releaseDate[1]));$('.position [data-target="calendar"] .day',$line).text(releaseDate[2]);}else{$line.removeClass('soon');$('.position [data-target="calendar"] .month',$line).text('');$('.position [data-target="calendar"] .day',$line).text('');}
if(unavailableType!=right.READABLE){$line.addClass('unavailable');$line.attr('data-unavailable',unavailableType);}else{$line.removeClass('unavailable').removeAttr('data-unavailable').removeAttr('data-tooltip').unbind('mouseover mouseout');}
if(options.type=='playlist'&&unavailableType>0)unavailableList.push(oSelf.getSongId(currentData));oSelf.refreshLineOffline($line,currentData);return true;}catch(e){console.log(e.message,e.stack);}};this.unAvailableDisplay=function(){var trackUnavailableList=$(".unavailable",oBody);var globalBlockedType=0;var fanOnlyTrackFound=false;trackUnavailableList.each(function(){var trackUnavailable=parseInt($(this).attr('data-unavailable'));globalBlockedType+=trackUnavailable;if(trackUnavailable==right.FAN_ONLY){fanOnlyTrackFound=true;}
if(trackUnavailable!=right.LOCALITY||!options.playlist_personnal){$(this).find('[data-target="icon-replace"]').hide();}
if(trackUnavailable==right.FAN_ONLY&&options.skin.displayFanOnly=='hovercard'){$(this).attr('data-hovercard',"/ajax/hovercard/page.php?card=artist&art_id="+$(this).data('song').ART_ID).mouseover(function(){hovercard.init($(this));}).mouseout(function(){hovercard.remove();});;}else{$(this).attr('data-tooltip',right.getMessage(trackUnavailable)).mouseover(function(){$(this).find('[data-target="track"]').tipsy({trigger:'manual',gravity:'sw',space:8,fallback:$(this).data('tooltip')}).tipsy('show');}).mouseout(function(){$(this).find('[data-target="track"]').tipsy('hide');});}
if(trackUnavailable==right.FAN_ONLY){oSelf.subscribeEventFanOnly();}
oSelf.replace($(this));});if(options.type=='album'){if(trackUnavailableList.length==options.songs.total&&(globalBlockedType/options.songs.total)==right.LOCALITY){Events.trigger(Events.album.checkReplace,{id:options.id,type:'unavailable'});}else{Events.trigger(Events.album.noReplaceNeed,{id:options.id,type:'unavailable'});}}
if(fanOnlyTrackFound){Events.ready(Events.user.userReady,oSelf.refreshFanOnlyList);}};this.refreshLineOffline=function($line,currentData){try{if(options.skin.displaySyncOffline&&dzoffline.AVAILABLE){if(dzoffline.isSongSyncFinish(options.type,options.id,oSelf.getSongId(currentData))){$line.removeClass('error').addClass('offline');}else if(dzoffline.isSongSyncError(options.type,options.id,oSelf.getSongId(currentData))){$line.addClass('offline').addClass('error');}else{var offlineStatus=dzoffline.getElement(options.type,options.id,oSelf.getSongId(currentData));if(typeof(offlineStatus)!='undefined'&&offlineStatus.STATE==dzoffline.FORBIDDEN&&right.checkSongAvailable(currentData)==right.READABLE){$line.removeClass('error').addClass('offline');}else{$line.removeClass('offline').removeClass('error');}}}
return $line;}catch(e){console.log(e.message,e.stack);}};this.recoverTracks=function(){try{if((options.type=="playlist"||options.type=='loved')&&options.playlist_personnal){var cookie_value='';if(Modernizr.localstorage&&window.localStorage.getItem('playlist_'+options.id)!=null){cookie_value=window.localStorage.getItem('playlist_'+options.id)}
if(cookie_value!=''){var playlist_recover=JSON.parse(cookie_value).last_check;if(typeof(playlist_recover)!='undefined'){if(SERVER_TIMESTAMP-playlist_recover<replaceCheck){return false;}}}
oSelf.recoverTracksStart();}
return true;}catch(e){console.log(e.message,e.stack);}};this.recoverTracksStart=function(){try{if(options.songs.count<options.songs.total&&options.playlist_personnal){waitingAllTrackForReplaceProcess=true;oSelf.loadAllTracks();return false;}else{waitingAllTrackForReplaceProcess=false;}
if((options.type=="playlist"||options.type=='loved')&&unavailableList.length>0){var params={songs:unavailableList,playlist_id:options.id};api.call('playlist_recover',params,oSelf.onReplaceLoaded);unavailableList=[];}else if(Modernizr.localstorage){window.localStorage.setItem('playlist_'+options.id,JSON.stringify({last_check:SERVER_TIMESTAMP}));}
return true;}catch(e){console.log(e.message,e.stack);}};this.onReplaceLoaded=function(request){try{if(request.error.length==0){if(request.results.total>0){for(var name in request.results.data){var replaced_id=name.substring(name.indexOf('_')+1,name.length);oSelf.onReplaced(replaced_id,request.results.data[name]);}}
if(Modernizr.localstorage){window.localStorage.setItem('playlist_'+options.id,JSON.stringify({last_check:SERVER_TIMESTAMP}));}}
return true;}catch(e){console.log(e.message,e.stack);}};this.updatedPersonalSong=function(params){try{$editedLine=$('#naboo_datagrid_track_'+params.upload_id);if($editedLine.length==1){$('[data-target="track"]',$editedLine).text(params.data.SNG_TITLE);$('[data-target="artist"]',$editedLine).text(params.data.ART_NAME);$('[data-target="album"]',$editedLine).text(params.data.ALB_TITLE);$editedLine.data('song').SNG_TITLE=params.data.SNG_TITLE;$editedLine.data('song').ART_NAME=params.data.ART_NAME;$editedLine.data('song').ALB_TITLE=params.data.ALB_TITLE;var renameIndex=$('.song',oBody).index($editedLine);if(renameIndex>-1){options.songs.data[renameIndex]['SNG_TITLE']=params.data.SNG_TITLE;options.songs.data[renameIndex]['ART_NAME']=params.data.ART_NAME;options.songs.data[renameIndex]['ALB_TITLE']=params.data.ALB_TITLE;}}
return true;}catch(e){console.log(e.message,e.stack);}};this.createDatagridDrag=function($lines){try{if(!OFFLINE){var draggableOptions={refreshPositions:true,cursorAt:{top:25,left:0},helper:function(event,ui){try{if($(event.target).is('a')||$(event.target).is('i'))return false;var parent=$(event.target).is('tr')?$(event.target):$(event.target).parents('tr');parent.children(".check").children("input").prop("checked",true);var selectedSongId=oSelf.getSelectedTrackId(true);var selectedSongData=oSelf.getSelectedTrackData();var img=(typeof(selectedSongData[0].ALB_PICTURE)!='undefined')?selectedSongData[0].ALB_PICTURE:'';oSelf.closeAllContributor();if(selectedSongId.length==1){$ghost=ghost_single_model.clone();$('img',$ghost).attr('src',SETTING_DOMAIN_IMG+'/cover/'+img+'/28x28-000000-80-0-0.jpg');$('.cell-track > div:eq(0) > strong',$ghost).text(selectedSongData[0].SNG_TITLE);$('.cell-track > div:eq(1)',$ghost).text(selectedSongData[0].ALB_TITLE);$('.cell-length',$ghost).text(secToMin(selectedSongData[0].DURATION));var rank=(selectedSongData[0].RANK_SNG>0)?((Math.floor((selectedSongData[0].RANK_SNG/100000))*100)/100):'0';$('.cell-popularity > span',$ghost).addClass('note-'+rank);}else{$ghost=ghost_multi_model.clone();$('span > strong',$ghost).text(selectedSongId.length+" "+trad.music.naboo_datagrid_ghost_element);$('.picture > img',$ghost).attr('src',SETTING_DOMAIN_IMG+'/cover/'+img+'/28x28-000000-80-0-0.jpg');}
$ghost.css('top',-24)
$ghost.data('value',selectedSongId);$ghost.data('element-type','0');$ghost.data('allow-move-to-playlist',options.allowMoveToPlaylist);if(options.skin.displayOrder){$(".contributor",oBody).remove();}
return $ghost;}catch(e){console.log(e.message,e.stack);}},stop:oSelf.stopDragTrack,drag:oSelf.dragTrack};$lines.draggable(draggableOptions);}}catch(e){console.log(e.message,e.stack);}};this.dragTrack=function(event,ui){try{menu.autoScroll(event,ui);if(options.skin.displayOrder&&oBody.length>0){if(ui.offset.left>menu.sidebar_width||options.type=='queue'){var rowHeight=30;if(ui.offset.top+ui.helper.height()+25>$(window).height()){if(scrollInterval===0){scrollInterval=setInterval(function(){if($(page_content).children().height()-$(page_content).scrollTop()>$(page_content).height()){$(page_content).scrollTop($(page_content).scrollTop()+rowHeight);oSelf.dragTrack(event,ui);return false}
clearInterval(scrollInterval);scrollInterval=0;},150);}}else if(ui.offset.top<=menu.menu_top){if(scrollInterval===0){scrollInterval=setInterval(function(){if($(page_content).scrollTop()>0){$(page_content).scrollTop($(page_content).scrollTop()-rowHeight);oSelf.dragTrack(event,ui);return false;}
clearInterval(scrollInterval);scrollInterval=0;},150);}}else if(scrollInterval>0){clearInterval(scrollInterval);scrollInterval=0;}
var datagrid_top=oBody.offset().top;var gridPosition=ui.offset.top-datagrid_top+25;gridPosition=(Math.round(gridPosition/rowHeight)*rowHeight);if(gridPosition/rowHeight>options.songs.count){gridPosition=(options.songs.count)*rowHeight;}
options.dropPosition=gridPosition/rowHeight;if(options.dropPosition!=options.dropPositionLast){if(gridPosition>=0){$('.divider',oBody).remove();separator=dividerBar.clone();separator.insertBefore($('tr:eq('+options.dropPosition+')',oBody));options.dropPositionLast=options.dropPosition;}else if(gridPosition<0){options.dropPosition=-1;$('.datagrid > table > tbody > .divider').remove();}}}else{options.dropPosition=-1;$('.datagrid > table > tbody > .divider').remove();}}}catch(e){console.log(e.message,e.stack);}};this.stopDragTrack=function(event,ui){try{if(options.skin.displayOrder&&oBody.length>0){$('.divider',oBody).remove();clearInterval(scrollInterval);scrollInterval=0;if(ui.position.left>0)
oSelf.onDrop(event,ui);}
oSelf.onStopDrag();}catch(e){console.log(e.message,e.stack);}};this.onDrop=function(event,ui){try{var selectedTrack=$(".song > .check > input:checked",oBody);if(selectedTrack.length>0){var moved=false;$destinationItem=$(this);if(options.dropPosition==-1)return false;if(options.type=='queue'){var currentPlayingSong=dzPlayer.getCurrentSongInfo();}
if(selectedTrack.length>1){var orderedSelectedTracks=[];var initialPosition;selectedTrack.each(function(index,item){orderedSelectedTracks.unshift(item);var currentPosition=$(".song:visible",oBody).index($(this).parents('tr'));if(typeof(initialPosition)=='undefined'||currentPosition<initialPosition){initialPosition=currentPosition;}});if(initialPosition>options.dropPosition){selectedTrack=$(orderedSelectedTracks);}}
selectedTrack.each(function(index){$movedItem=$(this).parents('tr');var movedIndex=$(".song:visible",oBody).index($movedItem);var destinationIndex=options.dropPosition;if(movedIndex+1==destinationIndex)destinationIndex=movedIndex;if(movedIndex!=destinationIndex){var movedElement=options.songs.data[movedIndex];options.songs.data.splice(movedIndex,1);if(movedIndex<destinationIndex)options.songs.data.splice(destinationIndex-1,0,movedElement);else options.songs.data.splice(destinationIndex,0,movedElement);if(options.dropPosition==0)
oBody.prepend($movedItem);else
$('tr:eq('+(options.dropPosition-1)+')',oBody).after($movedItem);moved=true;}else{console.log("ERROR : same place");}});if(moved&&options.type!='queue'){if(options.type=='playlist'||options.type=='loved'){var params={playlist_id:options.id,position:'0',order:oSelf.getOrderTrack()};api.call('playlist_updateOrder',params,function(){});}}
if(options.type=='queue'){for(var i=0;i<options.songs.data.length;i++){if(oSelf.getSongId(options.songs.data[i])==oSelf.getSongId(currentPlayingSong)){dzPlayer.trackListIndex=i;break;}}}
if(options.skin.displaySongNumber){oSelf.refreshSongNumber();}}
return true;}catch(e){console.log(e.message,e.stack);}};this.onStopDrag=function(){try{if(options.skin.displayHeader){$("#naboo_datagrid_header_check input",oOption).prop("checked",false);}
if(options.skin.displaySelectAll){$("#naboo_datagrid_select_all input",oOption).prop("checked",false);}
oSelf.unSelectedTrack();return true;}catch(e){console.log(e.message,e.stack);}};this.createDatagridResize=function(){try{if(options.skin.displayHeader){$("tr > .track",oHead).resizable(oSelf.getResizableOption('track'));$("tr > .artist",oHead).resizable(oSelf.getResizableOption('artist'));}
return true;}catch(e){console.log(e.message,e.stack);}};this.getResizableOption=function(columns){try{return{minWidth:110,handles:{'e':$("tr > ."+columns+' > .handler',oHead)},start:function(event,ui){$(this).resizable("option","maxWidth",oBody.width()/3);}};}catch(e){console.log(e.message,e.stack);}};this.startFilter=function(query){try{if(!options.playlist_private){if(query!=""){if(filterId>0)clearTimeout(filterId);filterId=setTimeout(oSelf.filter,filterInterval);}else{$("#naboo_datagrid_filter_text",oOption).removeClass('clear');$(".song",oBody).show();oSelf.closeAllContributor();oSelf.closeAllSubResult();if(orderableOrigin!=options.skin.displayOrder){options.skin.displayOrder=orderableOrigin;}
filterActif=false;}}
return true;}catch(e){console.log(e.message,e.stack);}};this.filter=function(){try{query=rewriting($("#naboo_datagrid_filter_text",oOption).val().toUpperCase());if(query!=""){oSelf.closeAllContributor();oSelf.closeAllSubResult();$("#naboo_datagrid_filter_text",oOption).addClass('clear');$(".song",oBody).hide();filterActif=true;filterResult=[];for(j=0;j<options.songs.count;j++){if(typeof(options.songs.data[j].SEARCH_STR)!="undefined"){search_str=options.songs.data[j].SEARCH_STR;}else{search_str=rewriting(options.songs.data[j].SNG_TITLE.toUpperCase()+" "+options.songs.data[j].ART_NAME.toUpperCase()+" "+options.songs.data[j].ALB_TITLE.toUpperCase());options.songs.data[j].SEARCH_STR=search_str;}
if(search_str.indexOf(query)>-1){filterResult.push(options.songs.data[j]);$("#naboo_datagrid_track_"+oSelf.getSongId(options.songs.data[j]),oBody).show();}}
if(options.skin.displayOrder){options.skin.displayOrder=false;}
oSelf.extendBackground();}
return true;}catch(e){console.log(e.message,e.stack);}};this.setFilterLabel=function(){try{if(typeof(trad.music['naboo_datagrid_filter_'+options.type])!='undefined'){filterLabel=trad.music['naboo_datagrid_filter_'+options.type];}else{filterLabel=trad.music.naboo_datagrid_filter_search;}
$('#naboo_datagrid_filter_text',oOption).attr('placeholder',filterLabel);return true;}catch(e){console.log(e.message,e.stack);}};this.onFilterFocus=function(){try{if(options.songs.count<options.songs.total){waitingAllTrackForFilter=true;oSelf.loadAllTracks();}else{waitingAllTrackForFilter=false;}
return true;}catch(e){console.log(e.message,e.stack);}};this.sort=function($link){try{if(options.songs.count<options.songs.total){lastSort.link=$link;lastSort.columnIndex=columnIndex;showLoading(0);waitingAllTrackForSort=true;oSelf.loadAllTracks();}else{hideLoading();waitingAllTrackForSort=false;}
if(waitingAllTrackForSort){return false;}
$lines=oBody;oSelf.closeAllSubResult();oSelf.closeAllContributor();oSelf.unSelectedTrack();var sortType=(($('.label > .sort',$link).is('.asc'))?"DESC":"ASC");$('.label > .sort',$link).removeClass('asc desc').addClass(sortType.toLowerCase());var columnIndex=($link.is('.track'))?'SNG_TITLE':'';columnIndex=($link.is('.artist'))?'ART_NAME':columnIndex;columnIndex=($link.is('.album'))?'ALB_TITLE':columnIndex;columnIndex=($link.is('.length'))?'DURATION':columnIndex;columnIndex=($link.is('.popularity'))?'RANK_SNG':columnIndex;columnIndex=($link.is('.added'))?'DATE_ADD':columnIndex;options.songs.data.sort(function(a,b){if(typeof(a['ORDER_'+columnIndex])!='undefined'&&typeof(b['ORDER_'+columnIndex])!='undefined'){var compA=a['ORDER_'+columnIndex];var compB=b['ORDER_'+columnIndex];}else{if(columnIndex=="DURATION"||columnIndex=="RANK_SNG"||columnIndex=="DATE_ADD"){var compA=parseInt(a[columnIndex]);var compB=parseInt(b[columnIndex]);}else{var compA=rewriting(a[columnIndex].toLowerCase());var compB=rewriting(b[columnIndex].toLowerCase());}
a['ORDER_'+columnIndex]=compA;b['ORDER_'+columnIndex]=compB;}
if(sortType=="ASC")return(compA<compB)?-1:(compA>compB)?1:0;else return(compA>compB)?-1:(compA<compB)?1:0;});$lines.children('tr').each(function(index){if($(this).attr('unavailable')!=null){$(this).unbind('mouseenter').removeAttr('unavailable');}
oSelf.refreshLineContent($(this),options.songs.data[index]);});if(options.skin.displayDateColumn){calculeTime();}
oSelf.unAvailableDisplay();options.skin.displayOrder=false;if(lastColSort!==false&&lastColSort.attr('class')!=$link.attr('class')){$('.label > .sort',lastColSort).removeClass('asc desc');}
lastColSort=$link;oSelf.displayPlayingTrack(null,{SONG_DATA:dzPlayer.currentSongInfo,CONTEXT:dzPlayer.context});return true;}catch(e){console.log(e.message,e.stack);}};this.play=function($line){try{if(!$line.is('tr')){$line=$line.parents('tr');}
if(typeof($line)!='undefined'&&$line.is('.unavailable')){return false;}
if($line.is('.active')){if(dzPlayer.playing){dzPlayer.pause();}else{dzPlayer.play();}
return false;}
var index=(typeof($line)!='undefined')?$line.parent().children('.song:visible').index($line):-1;var songsList=[];if(!filterActif){songsList=songsList.concat(options.songs.data);}else{songsList=songsList.concat(filterResult);}
if(songsList.length>0){if((typeof($line)!='undefined')&&options.type=="search"){if($line.is('.similar')&&!$line.is('.similar-parent')){index=(typeof($line)!='undefined')?$line.parent().children('.similar').index($line):-1;$parentLine=$('#naboo_datagrid_track_'+$line.attr('data-parent-id'),oBody);var indexParent=(typeof($parentLine)!='undefined')?$parentLine.parent().children('.song:visible').index($parentLine):0;var subTracks=songsList[indexParent].SUB_RESULT;for(var s=0;s<subTracks.length;s++){songsList.splice((indexParent+1)+s,0,songsList[indexParent].SUB_RESULT[s]);}
index+=indexParent;}}
if(options.type=='queue'){dzPlayer.playTrackAtIndex(index);return false;}
var context={TYPE:oSelf.getContextName()};switch(options.type){case"search":context.ID=trim($('#naboo_search_query > strong').text());break;case"playlist":context.ID=options.id
context.NAME=trim($('#naboo_playlist_title').text());oSelf.playAllTracks(true);break;case"personal_song":index=(index==-1)?0:index;context.ID=songsList[index].UPLOAD_ID;break;case"loved":index=(index==-1)?0:index;context.ID=oSelf.getSongId(songsList[index]);break;case"folder":context.ID=options.id;context.NAME=trim($('#naboo_folder_title').text());oSelf.playAllTracks(true);break;case"album":context.ID=options.id;context.ALB_TITLE=trim($('#naboo_album_title').text());break;case"discography_album":context.ID=options.id;dzPlayer.playAlbum(options.id,index,true,context);return true;break;default:context.ID=options.id;break;}
dzPlayer.playTracks(songsList,index,true,context);}
return true;}catch(e){console.log(e.message,e.stack);}};this.playAllTracks=function(init){try{if(typeof(init)!='undefined'&&init){options.startAllLoaded=options.songs.count;}
if(options.songs.count<options.songs.total){waitingAllTrackForTotalPlay=true;oSelf.loadAllTracks();}else{if(waitingAllTrackForTotalPlay){var addedTracks=options.songs.data.slice();dzPlayer.enqueueTracks(addedTracks.splice(options.startAllLoaded,options.songs.total));}
waitingAllTrackForTotalPlay=false;}}catch(e){console.log(e.message,e.stack);}};this.openSubResult=function($icon){try{$line=$icon.parents('tr');if(!$icon.children().is('.opened')){$icon.children().addClass('opened');var currentData=$line.data('song').SUB_RESULT;if(typeof(currentData[0].SNG_TITLE)!='undefined'){oSelf.drawSubResult($line,currentData);return;}
api.call('song.getListData',{'sng_ids':currentData},function(r){if(typeof(r.results.data)!='undefined'){currentData=r.results.data;oSelf.drawSubResult($line,currentData);var indexTrack=$line.parent().children('.song:visible').index($line);if(indexTrack>-1){options.songs.data[indexTrack].SUB_RESULT=currentData;}}});}else{$icon.children().removeClass('opened');$line.removeClass('similar-parent similar');$('[data-parent-id="'+oSelf.getSongId($line.data('song'))+'"]',oBody).remove();}
return true;}catch(e){console.log(e.message,e.stack);}};this.drawSubResult=function($line,currentData,parent_id){try{$blockSub=$('<p></p>');for(var s=0;s<currentData.length;s++){$lineSub=options.$line_model.clone();$lineSub.show();oSelf.refreshLineContent($lineSub,currentData[s],{isLastSubResult:((s)==currentData.length-1),parentId:oSelf.getSongId($line.data('song'))});oSelf.setLineLink($lineSub);$blockSub.append($lineSub);}
$line.addClass('similar-parent similar');$line.after($blockSub.children());oSelf.createDatagridDrag($line.nextAll('.similar'));return true;}catch(e){console.log(e.message,e.stack);}};this.closeAllSubResult=function(){try{if(options.type=="search"){var currentSubResult=$(".similar",oBody);if(currentSubResult.length>0){currentSubResult.each(function(){$(this).prev().find('[data-target="icon-similar"] > i').removeClass('opened');});$('.similar-parent',oBody).removeClass('similar-parent similar');currentSubResult.remove();}}
return false;}catch(e){console.log(e.message,e.stack);}};this.openContributor=function($btn){try{$line=$btn.parents('tr');if(!$btn.children().is('.opened')){var contributorData=$line.data('song').SNG_CONTRIBUTORS;var contributorListing=[];if(oSelf.getContributor(contributorData,'author')!=false){contributorListing.push(trad.music.naboo_datagrid_contributor_author+' '+oSelf.getContributor(contributorData,'author'));}
if(oSelf.getContributor(contributorData,'composer')!=false){contributorListing.push(trad.music.naboo_datagrid_contributor_composer+' '+oSelf.getContributor(contributorData,'composer'));}
if(oSelf.getContributor(contributorData,'misc')!=false){contributorListing.push(trad.music.naboo_datagrid_contributor_misc+' '+oSelf.getContributor(contributorData,'misc'));}
if(contributorData!=''){var line_contributors=contributor_model.clone();$('span',line_contributors).text(contributorListing.join(' / '));$line.after(line_contributors);if(line_contributors.outerHeight()>30){line_contributors.outerHeight(Math.ceil(line_contributors.outerHeight()/30)*30);}}
$btn.children().addClass('opened');}else{$btn.children().removeClass('opened');$line.next('.contributors').remove();}
return true;}catch(e){console.log(e.message,e.stack);}};this.getContributor=function(list,key){try{if(typeof(list[key])!='undefined'){return list[key].join(' - ');}
return false;}catch(e){console.log(e.message,e.stack);}};this.closeAllContributor=function(){try{var currentContributor=$(".contributors",oBody);if(currentContributor.length>0){currentContributor.each(function(){$(this).prev().find('[data-target="icon-contributors"] > i').removeClass('opened');});currentContributor.remove();}
return false;}catch(e){console.log(e.message,e.stack);}};this.addMusicBox=function($add){try{if(options.selectable){var songData=[];if($add.attr("id")=="naboo_datagrid_add"){songData=oSelf.getSelectedTrackData();}else{songData.push($add.parents('tr').data('song'));oSelf.unSelectedTrack();}
if(songData.length>0){musicbox.open($add,songData,{datagridType:options.type,context:(options.type=='queue')?'player':'datagrid',deleteOption:options.skin.displayRemove,datagridContent:oWrapper,position:(options.type=='queue')?'bottom':'left'});}}
return true;}catch(e){console.log(e.message,e.stack);}};this.storeAction=function($btn,action){try{if(options.selectable){var songId=[];if($btn.attr('data-target')=="download-multi"||$btn.attr('data-target')=="buy-multi"){songId=oSelf.getSelectedTrackId(false);}else{songId.push(oSelf.getSongId($btn.parents('tr').data('song')));}
if(songId.length>0){if(action=='download'){storeSongsDownload(songId);}else if(action=='buy'){loadFacebox('store/index.php?product_type=track&product_id='+songId.join('|'));}}}
return true;}catch(e){console.log(e.message,e.stack);}};this.shareAction=function($btn){try{if(options.selectable){sharebox.load(0,oSelf.getSongId($btn.parents('tr').data('song')));}
return true;}catch(e){console.log(e.message,e.stack);}};this.replace=function($replace){try{if(options.playlist_personnal){if($replace.attr('data-unavailable')==right.LOCALITY){sng_id=oSelf.getSongId($replace.data('song'));art_id=$replace.data('song').ART_ID;sng_name=$replace.data('song').SNG_TITLE;art_name=$replace.data('song').ART_NAME;$('.track [data-target="icon-replace"]',$replace).attr({'id':'btn_replace_'+art_id+"_"+sng_id,'data-hovercard':'/ajax/hovercard/page.php?card=replace&art_id='+art_id+'&sng_id='+sng_id+'&playlist_id='+options.id+'&art_name='+escape(art_name)+'&sng_name='+escape(sng_name)+'&div='+oWrapper.attr('id')});}}
return true;}catch(e){console.log(e.message,e.stack);}};this.onReplaced=function(old_id,sng_obj){try{$line=$("#naboo_datagrid_track_"+old_id,oBody);if($line.length==0){return false;}
if($line.attr('data-unavailable')!=null){$line.removeAttr('data-unavailable');$line.unbind('mouseover mouseout');}
if(options.type=='loved'){userData.data.FAVORITES_SONGS_HASH[old_id+'_0']=false;userData.data.FAVORITES_SONGS_HASH[oSelf.getSongId(sng_obj)+'_0']=true;}
oSelf.refreshLineContent($line,sng_obj);var indexData=$(".song:visible",oBody).index($line);options.songs.data[indexData]=sng_obj;if(!OFFLINE&&dzoffline.AVAILABLE){if(dzoffline.isListSync(options.type,options.id)){dzoffline.deleteElement(options.type,options.id,old_id);dzoffline.updateListSync(options.type,options.id,{STATE:dzoffline.SYNC_BROKEN,CHECK_SUM:'changed'});dzoffline.getUpdatedElement([{id:options.id,type:options.type}],0);}}}catch(e){console.log(e.message,e.stack);}};this.removeTrack=function(removeId){try{if(options.skin.displayRemove){var selectedTrackId=(typeof(removeId)=='undefined')?oSelf.getSelectedTrackId(options.type!='personal_song'):removeId;if(options.type=='queue'){for(var t=0;t<selectedTrackId.length;t++){if(oSelf.getSongId(dzPlayer.getCurrentSongInfo())==selectedTrackId[t][0]){selectedTrackId.splice(t,1);}}}
if(selectedTrackId.length==0){return false;}
if(confirm((selectedTrackId.length>1)?trad.music.naboo_datagrid_confirm_delete_multi:trad.music.naboo_datagrid_confirm_delete_single)){switch(options.type){case"loved":case"playlist":if(!OFFLINE&&dzoffline.AVAILABLE&&dzoffline.isListSync(options.type,options.id)){dzoffline.updateListSync(options.type,options.id,{STATE:dzoffline.SYNC_BROKEN});if(!downloader.running)downloader.start();}
var params={playlist_id:options.id,songs:selectedTrackId};api.call('playlist_deleteSongs',params,oSelf.onRemoved,{sng_list:selectedTrackId});break;case"personal_song":for(var i=0;i<selectedTrackId.length;i++){var params={upload_id:selectedTrackId[i]};api.call('personal_song.delete',params,oSelf.onRemoved,{sng_list:[selectedTrackId[i]]});}
break;case"queue":for(var t=0;t<selectedTrackId.length;t++){$line=$("#naboo_datagrid_track_"+selectedTrackId[t][0],oBody);if($line.is('.active')){continue;}
var indexData=$(".song:visible",oBody).index($line);dzPlayer.removeTracks(indexData);$line.remove();}
oSelf.refreshSongNumber();options.songs.count=options.songs.count-selectedTrackId.length;options.songs.total=options.songs.total-selectedTrackId.length;Events.trigger(Events.datagrid.removedTrack,{duration:oSelf.getTotalDuration(),nbSong:options.songs.total});oSelf.visibleActionButton(false);break;}}}
return true;}catch(e){console.log(e.message,e.stack);}};this.onRemoved=function(request,callbackParameters){try{if(request.results==true){var nbSong=callbackParameters.sng_list.length;var duration=0;for(j=0;j<nbSong;j++){var sng_id=((typeof(callbackParameters.sng_list[j])=="object")?callbackParameters.sng_list[j][0]:callbackParameters.sng_list[j]);$line=$("#naboo_datagrid_track_"+sng_id,oBody);$line_contributors=$("#naboo_datagrid_contributors_"+sng_id,oBody);var indexData=$(".song:visible",oBody).index($line);if(typeof(options.songs.data[indexData])!='undefined'){duration+=parseInt(options.songs.data[indexData].DURATION);}
options.songs.data.splice(indexData,1);$line.remove();if($line_contributors.length>0){$line_contributors.remove();}}
if(options.type=='playlist')playlist.updateDurationAndNbSongs(duration,nbSong);options.songs.count=options.songs.count-nbSong;options.songs.total=options.songs.total-nbSong;if(creationEndIndex<options.songs.total){removedTrackBeforeLoadComplete+=nbSong;creationStartIndex-=nbSong;}
if(oBody.length==0){if(options.songs.total>0){options.$line_model.children('.check').children('input').prop('checked',false);creationStartIndex=creationEndIndex=0;oSelf.load(null,null,options.id,creationGroup);}}
$checkAll=$('#naboo_datagrid_header_check > input',oOption);if($checkAll.prop("checked"))$checkAll.prop("checked",false);oSelf.visibleActionButton(false);oSelf.closeAllContributor();dzoffline.elementChanged(options.type,options.id);}else{console.log(request.error.DATA_ERROR);}
return true;}catch(e){console.log(e.message,e.stack);}};this.selectAll=function($check){try{if(!OFFLINE&&options.songs.total>0){$(".song:visible > .check > input",oBody).prop("checked",$check.prop("checked"));oSelf.visibleActionButton($check.prop("checked"));}
return true;}catch(e){console.log(e.message,e.stack);}};this.selectOne=function($check){try{if($check.prop("checked")){oSelf.visibleActionButton(true);}else{oSelf.visibleActionButton($("tr > .check > input:checked",oBody).length>0);}
return false;}catch(e){console.log(e.message,e.stack);}};this.unSelectedTrack=function(){try{var selectedTrack=$("tr input:checked",oBody);selectedTrack.each(function(){$(this).prop("checked",false);});if(options.skin.displaySelectAll){$('[data-target="checkall"]',oOption).prop("checked",false);}else{$('tr [data-target="checkall"]',oHead).prop("checked",false);}
oSelf.visibleActionButton(false);}catch(e){console.log(e.message,e.stack);}};this.visibleActionButton=function(status){try{if(status){oOption.children('.action').show();if(options.skin.displayRemove)
$("#naboo_datagrid_remove",oOption).show();if(options.skin.displayDownload)
$("#naboo_datagrid_download",oOption).show();if(options.skin.displayBuy)
$("#naboo_datagrid_buy",oOption).show();if(options.skin.displayAdd)
$("#naboo_datagrid_add",oOption).show();}else{oOption.children('.action').hide();}
return true;}catch(e){console.log(e.message,e.stack);}};this.insertUploadFile=function(id,fileName){try{$progressBar=progressBar.clone();$progressBar.attr('id','PROGRESS_'+id).show();oBody.prepend($progressBar);$upload=upload_model.clone();$upload.attr('id','UPLOAD_'+id);$upload.children('[data-target="status"]').text(trad.music.naboo_personal_songs_progress);$upload.children('[data-target="filename"]').text(fileName);oBody.prepend($upload);return true;}catch(e){console.log(e.message,e.stack);}};this.updateUploadFile=function(id,fileName,pourcent){try{$("#PROGRESS_"+id,oBody).css('width',pourcent+'%');$('#UPLOAD_'+id,oBody).children('[data-target="status"]').text(trad.music.naboo_personal_songs_progress+' ('+pourcent+'%)');return true;}catch(e){console.log(e.message,e.stack);}};this.finishUploadFile=function(id,fileName,response){try{$('#PROGRESS_'+id,oWrapper).remove();if(response.error.length==0){$('#UPLOAD_'+id,oWrapper).remove();var params={upload_id:response.results,user_id:USER.USER_ID};api.call('personal_song.getData',params,oSelf.finishUploadFileCallback);}else{$('#UPLOAD_'+id,oWrapper).children('[data-target="status"]').text(trad.music.naboo_personal_songs_error);}
return true;}catch(e){console.log(e.message,e.stack);}};this.finishUploadFileCallback=function(request){try{if(request.error.length==0){request.results.FILESIZE=request.results.FILESIZE_MP3_MISC;options.songs.data.push(request.results);options.songs.count=options.songs.data.length;creationStartIndex=options.songs.count-1;oSelf.createDatagridLines();}
return true;}catch(e){console.log(e.message,e.stack);}};this.displayDownloadStatus=function(event,params){try{if(options.id==params.currentTrack.PARENT_ID&&params.currentTrack.PARENT_TYPE==options.type){$('#progress_bar',oBody).remove();if(params.type=="added")
$('#naboo_datagrid_track_'+oSelf.getSongId(params.currentTrack),oBody).removeClass('error').addClass('offline');else if(params.type=="deleted")
$('#naboo_datagrid_track_'+oSelf.getSongId(params.currentTrack),oBody).removeClass('error').removeClass('offline');else if(params.type=="error")
$('#naboo_datagrid_track_'+oSelf.getSongId(params.currentTrack),oBody).addClass('error').addClass('offline');}
return true;}catch(e){console.log(e.message,e.stack);}};this.displayProgressStatus=function(event,params){try{if(options.id==params.currentTrack.PARENT_ID&&params.currentTrack.PARENT_TYPE==options.type){if(progressBar.attr('data-id')!=oSelf.getSongId(params.currentTrack)){progressBar.attr({'data-id':oSelf.getSongId(params.currentTrack),'id':'progress_bar'}).css('width','0px');$('#naboo_datagrid_track_'+oSelf.getSongId(params.currentTrack),oBody).after(progressBar.clone());}
$('#progress_bar',oBody).stop(true).animate({width:params.percent+'%'},300);}
return true;}catch(e){console.log(e.message,e.stack);}};this.changeDownloadStatusButton=function(){try{if(options.skin.displaySyncOffline){$('#naboo_datagrid_offline',oOption).show();}else if(!options.skin.displaySyncOffline){$('#naboo_datagrid_offline',oOption).hide();}}catch(e){console.log(e.message,e.stack);}};this.subscribeOfflineEvents=function(){try{Events.unsubscribe(Events.offline.trackDownloadStatus);Events.subscribe(Events.offline.trackDownloadStatus,oSelf.displayDownloadStatus);Events.unsubscribe(Events.offline.trackDownloadProgress);Events.subscribe(Events.offline.trackDownloadProgress,oSelf.displayProgressStatus);Events.unsubscribe(Events.offline.trackDownloadProgress);Events.subscribe(Events.offline.trackDownloadProgress,oSelf.displayProgressStatus);Events.subscribe(Events.offline.elementDownloadStatus,function(evt,arg){if(arg.type==options.type&&arg.id==options.id){$('#naboo_datagrid_offline_local',oOption).removeClass('syncing synced pending');if(arg.state==0){$('#naboo_datagrid_offline_local',oOption).addClass('pending');}else if(arg.state==1){$('#naboo_datagrid_offline_local',oOption).addClass('syncing');}else if(arg.state==2){$('#naboo_datagrid_offline_local',oOption).addClass('synced');}}});if(dzoffline.isElementSync(options.type,options.id)){$('#naboo_datagrid_offline_local',oOption).addClass('synced');}}catch(e){console.log(e.message,e.stack);}};this.refleshAllDownloadStatus=function(){try{if(dzoffline.AVAILABLE&&!OFFLINE){if(dzoffline.isElementSync(options.type,options.id)){for(var t=0;t<options.songs.count;t++){var sng_id=oSelf.getSongId(options.songs.data[t]);if(dzoffline.isSongSyncFinish(options.type,options.id,sng_id)){$('#naboo_datagrid_track_'+sng_id,oBody).addClass('offline').removeClass('error');}else if(dzoffline.isSongSyncError(options.type,options.id,sng_id)){$('#naboo_datagrid_track_'+sng_id,oBody).addClass('offline').addClass('error');}else{if(dzoffline.getElement(options.type,options.id,sng_id).STATE==dzoffline.FORBIDDEN&&right.checkSongAvailable(options.songs.data[t])==right.READABLE){$('#naboo_datagrid_track_'+sng_id,oBody).addClass('offline').removeClass('error');}}}}}
return true;}catch(e){console.log(e.message,e.stack);}};this.download=function(){try{if(options.songs.count<options.songs.total){waitingAllTrackForDownload=true;oSelf.loadAllTracks();}else{waitingAllTrackForDownload=false;dzoffline.download(options.type,options.id,options.songs,options.offline_data);}}catch(e){console.log(e.message,e.stack);}};this.displayPlayingTrack=function(evt,onair){try{if(lastOnAirTrack!=false){lastOnAirTrack.removeClass('active');oSelf.displayPlayingIcon(null,true);lastOnAirTrack=false;}
if(oSelf.isSameContext(onair)){$('#naboo_datagrid_track_'+oSelf.getSongId(onair.SONG_DATA),oBody).each(function(){if(options.type!='album'&&options.type!='discography'){if(typeof(onair.SONG_DATA.TYPE)=='undefined'){onair.SONG_DATA.TYPE=0;}
if(typeof($(this).data('song'))=='undefined'||$(this).data('song').TYPE!=onair.SONG_DATA.TYPE){return false;}}
$(this).addClass('active');if(options.scrollAutoOnAir){Events.trigger(Events.datagrid.onAirPosition,{top:$(this).position().top,height:$(this).height()});}
lastOnAirTrack=$(this);oSelf.displayPlayingIcon(null,dzPlayer.isPlaying());});}
return true;}catch(e){console.log(e.message,e.stack);}};this.displayPlayingIcon=function(evt,playing){try{if(!dzPlayer.isPaused()&&!dzPlayer.isPlaying()){playing=false;}
if(lastOnAirTrack.length==1){if(playing){$('[data-target="play"] > i',lastOnAirTrack).addClass('icon-play').removeClass('icon-pause');}else{$('[data-target="play"] > i',lastOnAirTrack).removeClass('icon-play').addClass('icon-pause');}}
return true;}catch(e){console.log(e.message,e.stack);}};this.isSameContext=function(onair){try{if(onair.CONTEXT.TYPE==oSelf.getContextName()&&onair.CONTEXT.ID==options.id){return true;}
if(options.type=='queue'){return true;}
if(options.type=='loved'&&onair.CONTEXT.TYPE==oSelf.getContextName()){return true;}
if(options.type=='personal_song'&&onair.CONTEXT.TYPE==oSelf.getContextName()){return true;}
return false;}catch(e){console.log(e.message,e.stack);}};this.subscribeEventFanOnly=function(){try{if(!artistOnlyEvent){Events.subscribe(Events.user.addFavorite,oSelf.addFavoriteArtist);Events.subscribe(Events.user.deleteFavorite,oSelf.deleteFavoriteArtist);artistOnlyEvent=true;}}catch(e){console.log(e.message,e.stack);}};this.refreshFanOnlyList=function(){try{var trackUnavailableList=$(".unavailable",oBody);trackUnavailableList.each(function(){var trackUnavailable=parseInt($(this).attr('data-unavailable'));if(trackUnavailable==right.FAN_ONLY){if(userData.isFavorite('artist',$(this).data('song').ART_ID)){oSelf.addFavoriteArtist(null,{ART_ID:$(this).data('song').ART_ID,type:'artist'});}}});}catch(e){console.log(e.message,e.stack);}}
this.addFavoriteArtist=function(evt,params){try{if(params.type!='artist')return false;$(".unavailable",oBody).each(function(){if(typeof($(this).data('song'))!='undefined'&&right.checkSongAvailable($(this).data('song'))==right.READABLE){$(this).removeClass('unavailable').unbind('mouseover mouseout');;}});}catch(e){console.log(e.message,e.stack);}};this.deleteFavoriteArtist=function(evt,params){try{if(params.type!='artist')return false;$(".song:visible",oBody).each(function(){if(typeof($(this).data('song'))!='undefined'&&right.checkSongAvailable($(this).data('song'))==right.FAN_ONLY){$(this).addClass('unavailable').attr('data-tooltip',right.getMessage(right.FAN_ONLY)).mouseover(function(){$(this).find('[data-target="track"]').tipsy({trigger:'manual',gravity:'sw',space:8,fallback:$(this).data('tooltip')}).tipsy('show');}).mouseout(function(){$(this).find('[data-target="track"]').tipsy('hide');});}});}catch(e){console.log(e.message,e.stack);}};this.displayChangeFavoriteTrack=function(evt,params){try{if(params.type!='song')return false;$targetLine=$('#naboo_datagrid_track_'+oSelf.getSongId(params),oWrapper);if($targetLine.length>0){if(typeof($targetLine.data('song'))!='undefined'&&parseInt($targetLine.data('song').TYPE)==params.TYPE){favorite.display($('.loved [data-target="lovetrack"]',$targetLine),params);return true;}}
if(options.type=='loved'&&$('#naboo_loved_tracks').length==1&&evt.namespace=='USER.addFavorite'){var trackToAdd={};for(var t=0;t<dzPlayer.trackList.length;t++){if(oSelf.getSongId(dzPlayer.trackList[t])==oSelf.getSongId(params)){trackToAdd=dzPlayer.trackList[t];}}
if(options.songs.total==options.songs.count&&countObject(trackToAdd)>0){options.songs.data.push(trackToAdd);options.songs.count=options.songs.data.length;options.songs.total=options.songs.data.length;creationStartIndex=options.songs.count-1;oSelf.createDatagridLines();}}
return true;}catch(e){console.log(e.message,e.stack);}};this.getContextName=function(){try{var contextName={playlist:'playlist_page',search:'search_page',personal_song:'personalsong_page',downloads:'downloads_page',folder:'folder_page',album:'album_page',home_tracks:'collection_track',folder:'folder_page',artist_top:'artist_top',artist_exclu:'artist_exclu',discography_album:'artist_discography',playlist_profile:'profile_playlist',toptrack_profile:'profile_top',loved:'loved_page'};if(typeof(contextName[options.type])!='undefined'){return contextName[options.type];}
return options.type;}catch(e){console.log(e.message,e.stack);}};this.activeInfiniteScroll=function(){try{if(creationStartIndex<options.songs.total&&options.scrollInfinite){Events.subscribeOnce(Events.layout.infiniteScroll,oSelf.loadNextTrack);infinite_scroll.active();}}catch(e){console.log(e.message,e.stack);}};this.extendBackground=function(){try{if(options.skin.displayExtendBackground){$('.filler',oBody).remove();oTable.attr('style','');var diffSize=$(pageContent).height()-$(pageContent).children().height();if(diffSize>0){if(options.songs.count==creationGroup&&options.songs.total>creationGroup){oSelf.loadNextTrack();}else{oBody.append(fillerBar);oTable.height(oTable.height()+diffSize);}}}
return true;}catch(e){console.log(e.message,e.stack);}};this.getSelectedTrackId=function(withType,inputChecked){try{var selectedTrack=(typeof(inputChecked)=='undefined')?$("tr > .check > input:checked",oBody):inputChecked;var selected=[];for(i=0;i<selectedTrack.length;i++){currentData=$(selectedTrack[i]).parents('tr').data('song');if(withType){selected.push([oSelf.getSongId(currentData),currentData.TYPE]);}else{selected.push(oSelf.getSongId(currentData));}}
return selected;}catch(e){console.log(e.message,e.stack);}};this.getSelectedTrackData=function(inputChecked){try{var selectedTrack=(typeof(inputChecked)=='undefined')?$("tr > .check > input:checked",oBody):inputChecked;var song_data=[];for(var s=0;s<selectedTrack.length;s++){$line=$(selectedTrack[s]).parents('tr');if(typeof($line.data('song'))!='undefined'){song_data.push($line.data('song'));}}
return song_data;}catch(e){console.log(e.message,e.stack);}};this.getOrderTrack=function(){try{var order=[];for(i=0;i<options.songs.count;i++){order.push(oSelf.getSongId(options.songs.data[i]));}
return order;}catch(e){console.log(e.message,e.stack);}};this.liveAddSong=function(evt,params){try{if(options.type=='playlist'&&options.id==params.playlist_id){if(creationStartIndex>=options.songs.total){if(typeof(options.song)=='undefined')return false;if(getObjectSize(options.song[0])==2)return false;$.merge(options.songs.data,options.song);options.songs.count=options.songs.data.length;creationStartIndex=options.songs.count-1;oSelf.createDatagridLines();}}}catch(e){console.log(e.message,e.stack);}};this.rightClic=function($line){try{$line.mousedown(function(e){var evt=e;$line.mouseup(function(e){$line.unbind('mouseup');if(e.button==2){oSelf.unSelectedTrack();$target=$(e.target);if($target.is('tr')){$selectedLine=$target;}else{$selectedLine=$target.parents('tr');}
if($selectedLine.data('song')!=null){var top=e.pageY+1;var left=e.pageX+1;musicbox.open($line,[$selectedLine.data('song')],{datagridType:options.type,context:'right_clic',position:'mouse',x:left,y:top,deleteOption:options.skin.displayRemove,datagridContent:oWrapper});}
e.stopPropagation();}});});}catch(e){console.log(e.message,e.stack);}};this.tipsy=function($btn,status,gravity){try{if(status=='over'){if(typeof(gravity)=='undefined'){gravity='s';}
$btn.tipsy({trigger:'manual',force_top:true,gravity:gravity,fallback:$btn.data('tooltip')}).tipsy('show');}else if(status=='out'){$btn.tipsy('hide');}}catch(e){console.log(e.message,e.stack);}}
this.getTotalDuration=function(){try{var duration=0;for(var s=0;s<options.songs.data.length;s++){duration+=parseInt(options.songs.data[s].DURATION);}
return duration;}catch(e){console.log(e.message,e.stack);}};this.displayArtistName=function(container,data,artists){try{if(typeof(data.ARTISTS)!='undefined'&&data.ARTISTS.length>0){var lines=[];container.empty();for(var a=0;a<data.ARTISTS.length;a++){if(typeof(artists)=='undefined'||(typeof(artists)=='object'&&typeof(artists[data.ARTISTS[a].ART_ID])=='undefined')){var line=artist_model.clone();line.attr('href','/artist/'+data.ARTISTS[a].ART_ID).text(data.ARTISTS[a].ART_NAME);lines.push(util.getOuterHTML(line));}}
container.append(lines.join(', '));return true;}
$('[data-target="artist"]',container).text(data.ART_NAME);if(data.ART_ID!=0&&!OFFLINE){$('[data-target="artist"]',container).attr('href','/artist/'+data.ART_ID);}
return true;}catch(e){console.log(e.message,e.stack);}};this.displaySongTitle=function(container,data){try{var sng_title=[];var str_title='';if(typeof(data.SNG_CONTRIBUTORS)!='undefined'&&typeof(data.SNG_CONTRIBUTORS.abbreviated_composer)!='undefined'&&data.SNG_CONTRIBUTORS.abbreviated_composer!=''){sng_title.push(data.SNG_CONTRIBUTORS.abbreviated_composer);}
if(options.type=='album'){sng_title.push(data.SNG_TITLE);str_title=sng_title.join(' | ');if(typeof(data.VERSION)!='undefined'&&data.VERSION!=''){str_title+=' '+data.VERSION;}
$(container).text(str_title);return true;}
sng_title.push(data.SNG_TITLE);str_title=sng_title.join(' | ');if(typeof(data.VERSION)!='undefined'&&data.VERSION!=''){str_title+=' '+data.VERSION;}
$(container).text(str_title);return true;}catch(e){console.log(e.message,e.stack);}};this.isDeezerTrack=function(data){try{return(data.TYPE!=1);}catch(e){console.log(e.message,e.stack);}};this.getSongId=function(data){try{if(!oSelf.isDeezerTrack(data)&&typeof(data.UPLOAD_ID)!='undefined'){return data.UPLOAD_ID;}
if(typeof(data.SNG_ID_ORIGIN)!='undefined'){return data.SNG_ID_ORIGIN;}
return data.SNG_ID;}catch(e){console.log(e.message,e.stack);}};this.unsubscribe=function(){try{Events.unsubscribe(Events.player.onAir,oSelf.displayPlayingTrack);Events.unsubscribe(Events.user.addFavorite,oSelf.displayChangeFavoriteTrack);Events.unsubscribe(Events.user.deleteFavorite,oSelf.displayChangeFavoriteTrack);Events.unsubscribe(Events.playlist.addSong,oSelf.liveAddSong);}catch(e){console.log(e.message,e.stack);}};this.addTdInLine=function($item,selector,position){try{var colgroupTrackPosition=oColGroup.children().index(oColGroup.children(selector));var colgroupLength=oColGroup.children().length-$item.children().length;for(var i=0;i<colgroupLength;i++){var td=$('<td></td>');if(i<colgroupTrackPosition&&position.before){$item.prepend(td);}else if(position.after){$item.append(td);}}
if(position.after==null||position.before==null){$('td:eq('+colgroupTrackPosition+')',$item).attr('colspan',oColGroup.children().length-$item.children().length+1);}
return $item;}catch(e){console.log(e.message,e.stack);}};return create();}})(jQuery);var datagrid={action:function(btn,params){try{if($(btn).is('.datagrid_master')){$datagridInstance=$(btn);}else{$datagridInstance=$(btn).parents('.datagrid_master');}
if($datagridInstance.length>0){$datagridInstance.actionDatagrid(params);}else{console.log('Impossible de trouver l instance');}}catch(e){console.log(e.message,e.stack);}}};;
if(typeof(modal)=='undefined'){var modal={$element:null,$container:null,$overlay:null,opened:false,ready:false,init:function(){try{modal.$element=$('#modal');modal.$container=$('.modal-container',modal.$element);modal.$overlay=$('.overlay',modal.$element).css('opacity','0');modal.$element.on('click',function(e){var target=$(e.target);if(target.attr('id')==='modal'||target.attr('class')==='modal-container'){modal.close();}});modal.ready=true;}catch(e){console.log(e.message,e.stack);}},open:function(page,force,post_data){try{if(modal.ready!==true){modal.init();}
var http_method='GET';var lang_prefix='/'+SETTING_LANG+'/';var lang_regex=new RegExp("^\/([a-z]{2})\/");$.facebox.close();if(typeof(force)==='undefined'){force=false;}
if(typeof(arguments[2])!=='undefined'&&$.isPlainObject(arguments[2])){post_data=arguments[2];http_method='POST';}
if(lang_regex.test(page)!==true){page=lang_prefix+page;}
if(modal.opened===true&&force===false){return false;}
if(modal.opened===true&&force===true){modal.$container.html('');}
modal.opened=true;var id=util.uniqid();if(PLATFORM!=='web'){window.location=page;}else{var request_callback=function request_callback(data){modal.$container.html(data);modal.$element.show();if(modal.$overlay.css('opacity')<0.7){modal.$overlay.fadeTo("fast",0.7);}
var onMouseWheel=function onMouseWheel(e){if(modal.opened===false){$(window).off('DOMMouseScroll mousewheel',onMouseWheel);}else{e.preventDefault();e.stopPropagation();}};$(window).on('DOMMouseScroll mousewheel',onMouseWheel);};if(http_method==='GET'){$.get(page,{'modal':'1'},request_callback);}else{page+=((page.indexOf('?')===-1)?'?':'&')+'modal=1';$.post(page,post_data,request_callback);}}
modal.$element.data('uniqid',id);return id;}catch(e){console.log(e.message,e.stack);}},close:function(){try{if(modal.ready!==true){modal.init();}
if(modal.opened===false&&(PLATFORM==='web')){return false;}
modal.opened=false;modal.$container.html('');modal.$element.hide();modal.$overlay.fadeTo("fast",0);Events.trigger(Events.modal.close,modal.$element.data('uniqid'));return true;}catch(e){console.log(e.message,e.stack);}}};};
if(typeof(hotkeys)=="undefined"){var hotkeys={shortcuts:{},settings:{type:'keydown',propagate:false,disable_input:true,target:document,keycode:false,template:null,dom:{container:'#hotkeys',mapping:'#hotkeys_mapping',template:'#hotkeys_template'}},shift_nums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":"\"",",":"<",".":">","/":"?","\\":"|"},special_keys:{'esc':27,'escape':27,'tab':9,'space':32,'return':13,'enter':13,'backspace':8,'scrolllock':145,'scroll_lock':145,'scroll':145,'capslock':20,'caps_lock':20,'caps':20,'numlock':144,'num_lock':144,'num':144,'pause':19,'break':19,'insert':45,'home':36,'delete':46,'end':35,'pageup':33,'page_up':33,'pu':33,'pagedown':34,'page_down':34,'pd':34,'left':37,'up':38,'right':39,'down':40,'f1':112,'f2':113,'f3':114,'f4':115,'f5':116,'f6':117,'f7':118,'f8':119,'f9':120,'f10':121,'f11':122,'f12':123},icons:{"up":"↑","down":"↓","left":"←","right":"→","shift":"⇧","enter":"⏎"},handleSeekPosition:function(position){if(typeof(inc)!='float'){position=parseFloat(position);}
if(position<=0.0||position>=1.0){return false;}
dzPlayer.seek(position);return true;},init:function(){hotkeys.add("Space",function(){if(dzPlayer.isPlaying()){dzPlayer.pause();}else{dzPlayer.play();}},{label:trad.hotkeys.toggle_play_pause,size:2});hotkeys.add("Enter",function(){if($('#naboo_artist_top_titre .track .text-ellipsis a.evt-click:first').length>0){$('#naboo_artist_top_titre .track .text-ellipsis a.evt-click:first').trigger('click');return true;}
if($('#naboo_playlist_listen').length>0){$('#naboo_playlist_listen').trigger('click');return true;}
if($('#naboo_datagrid_listen').length>0){$('#naboo_datagrid_listen').trigger('click');return true;}
return false;},{label:trad.hotkeys.play_current_page,size:2});hotkeys.add("S",function(){$('#dzSearch input[type=text]').focus();},{label:"Search"});for(var _key=0;_key<=9;_key++){hotkeys.add(_key.toString(),function(e,key){var position=parseFloat(key)/10;if(position==0.0){position=0.00001;}
return hotkeys.handleSeekPosition(position);},{label:trad.hotkeys.seek_position,size:2,shortcut:"0...9"});}
hotkeys.add("Left",function(){if(!dzPlayer.isPlaying()){dzPlayer.play();}
var position=((dzPlayer.getPosition()/dzPlayer.getDuration())-0.05).toFixed(3);hotkeys.handleSeekPosition(position);},{label:trad.hotkeys.seek_backward});hotkeys.add("Right",function(){if(!dzPlayer.isPlaying()){dzPlayer.play();}
var position=((dzPlayer.getPosition()/dzPlayer.getDuration())+0.05).toFixed(3);hotkeys.handleSeekPosition(position);},{label:trad.hotkeys.seek_forward});hotkeys.add("R",function(){hotkeys.handleSeekPosition(0.00001);return true;},{label:trad.hotkeys.replay_playing_song});hotkeys.add("Shift+Left",function(){dzPlayer.prevSong();},{label:trad.hotkeys.play_previous_song});hotkeys.add("Shift+Right",function(){dzPlayer.nextSong();},{label:trad.hotkeys.play_next_song});hotkeys.add("M",function(){dzPlayer.mute();var volume=0.5;if(dzPlayer.isMuted()){volume=0.0;}
dzPlayer.setVolume(volume);Events.trigger(Events.player.refreshSoundBar);},{label:trad.hotkeys.mute_volume});hotkeys.add("Shift+Up",function(){if(dzPlayer.isMuted()){dzPlayer.mute();}
var current_volume=dzPlayer.getVolume();var volume=(parseFloat(dzPlayer.getVolume())+0.1).toFixed(2);if(volume>=1.0){return false;}
dzPlayer.setVolume(volume);Events.trigger(Events.player.refreshSoundBar);},{label:trad.hotkeys.increase_volume});hotkeys.add("Shift+Down",function(){if(dzPlayer.isMuted()){dzPlayer.mute();}
var volume=(parseFloat(dzPlayer.getVolume())-0.1).toFixed(2);if(volume<=0.0){dzPlayer.setVolume(0);dzPlayer.mute();return false;}
dzPlayer.setVolume(volume);Events.trigger(Events.player.refreshSoundBar);},{label:trad.hotkeys.decrease_volume});hotkeys.add("L",function(){if($('#h_love > a').length>0){$('#h_love > a').trigger('click');}
return true;},{label:trad.hotkeys.like_playing_song});hotkeys.add("Shift+R",function(){playercontrol.doAction('repeat');return true;},{label:trad.hotkeys.change_repeat_mode});hotkeys.add("H",function(){hotkeys.buildKeyMapping();},{label:trad.hotkeys.show_keyboard_shortcuts});},add:function(_keys,callback,options){settings=$.extend(hotkeys.settings,options);var target=settings.target;if(typeof settings.target=='string'){target=document.getElementById(settings.target);}
_keys=_keys.toLowerCase();var func=function(e){e=e||window.event;if(settings.disable_input){var element;if(e.target)element=e.target;else if(e.srcElement)element=e.srcElement;if(element.nodeType==3)element=element.parentNode;if(element.tagName=='INPUT'||element.tagName=='TEXTAREA')return;}
if(e.keyCode){code=e.keyCode;}else if(e.which){code=e.which;}
var char=String.fromCharCode(code).toLowerCase();if(code==188)char=",";if(code==190)char=".";var keys=_keys.split("+");var kp=0;var modifiers={shift:{required:false,pressed:false},ctrl:{required:false,pressed:false},alt:{required:false,pressed:false},meta:{required:false,pressed:false}};if(e.ctrlKey)modifiers.ctrl.pressed=true;if(e.shiftKey)modifiers.shift.pressed=true;if(e.altKey)modifiers.alt.pressed=true;if(e.metaKey)modifiers.meta.pressed=true;for(var i=0;k=keys[i],i<keys.length;i++){if(k=='ctrl'||k=='control'){kp++;modifiers.ctrl.required=true;}else if(k=='shift'){kp++;modifiers.shift.required=true;}else if(k=='alt'){kp++;modifiers.alt.required=true;}else if(k=='meta'){kp++;modifiers.meta.required=true;}else if(k.length>1){if(hotkeys.special_keys[k]==code)kp++;}else if(settings.keycode){if(settings.keycode==code)kp++;}else{if(char==k)kp++;else{if(hotkeys.shift_nums[char]&&e.shiftKey){char=hotkeys.shift_nums[char];if(char==k)kp++;}}}}
if(kp==keys.length&&modifiers.ctrl.pressed==modifiers.ctrl.required&&modifiers.shift.pressed==modifiers.shift.required&&modifiers.alt.pressed==modifiers.alt.required&&modifiers.meta.pressed==modifiers.meta.required){callback(e,_keys);if(!settings.propagate){e.cancelBubble=true;e.returnValue=false;if(e.stopPropagation){e.stopPropagation();e.preventDefault();}
return false;}}}
hotkeys.shortcuts[_keys]={keys:_keys,callback:func,target:target,event:settings.type,data:options};if(target.addEventListener)target.addEventListener(settings.type,func,false);else if(target.attachEvent)target.attachEvent('on'+settings.type,func);else target['on'+settings.type]=func;},remove:function(keys){keys=keys.toLowerCase();var binding=hotkeys.shortcuts[keys];delete(hotkeys.shortcuts[keys]);if(!binding)return;var type=binding.event;var target=binding.target;var callback=binding.callback;if(target.detachEvent)target.detachEvent('on'+type,callback);else if(target.removeEventListener)target.removeEventListener(type,callback,false);else target['on'+type]=false;},getKeyIcon:function(key){if(typeof(hotkeys.icons[key])!='undefined'){return hotkeys.icons[key];}
return ucfirst(key);},buildKeyMapping:function(){if(this.settings.template===null){this.settings.template=Handlebars.templates['hotkeys'];}else{hotkeys.showHideKeyMapping();return false;}
var data=[];var numeric_keys=false;for(var hotkey in hotkeys.shortcuts){var shortcut=hotkeys.shortcuts[hotkey];if(parseInt(hotkey)>=0&&parseInt(hotkey)<=9){if(numeric_keys){continue;}
numeric_keys=true;}
var hotkey_shortcut=(typeof(shortcut.data.shortcut)!='undefined'?shortcut.data.shortcut:'');var icon_size=(typeof(shortcut.data.size)!='undefined'?shortcut.data.size:1);var hotkey_shortcut_keys=hotkey.split("+");var shortcut_icon=[];if(hotkey_shortcut_keys.length==1){var shortcut_key=hotkey_shortcut!=''?hotkey_shortcut:hotkey;shortcut_icon.push({'text':hotkeys.getKeyIcon(shortcut_key),'className':icon_size==2?'double':'single'});}else{if(hotkey_shortcut_keys.length>0){for(var shortcut_key in hotkey_shortcut_keys){shortcut_icon.push({'text':hotkeys.getKeyIcon(hotkey_shortcut_keys[shortcut_key]),'className':''});}}}
data.push({'shortcut':hotkey_shortcut,'icon':shortcut_icon,'label':shortcut.data.label});}
var template=hotkeys.settings.template(data);$.when($(this.settings.dom.mapping).append(template)).then(hotkeys.showHideKeyMapping());return true;},showHideKeyMapping:function(){var container=$(this.settings.dom.container);var isOpened=container.hasClass('opened');container.toggleClass('opened',!isOpened);return false;}}};
if(typeof(gigs)=='undefined'){var gigs={init:function(){try{if(USER.USER_ID===0){Events.ready(Events.user.userReady,gigs.init);return false;}
Events.subscribe(Events.player.play,function(){gigs.checkOnTour('player');});Events.subscribe(Events.artist.displayed,function(){gigs.checkOnTour('artist_page');});Events.subscribe(Events.player.changePlayerType,function(){gigs.checkOnTour('player');});Events.ready(Events.user.userReady,function(){if(www.getCurrentPageType()==='artist'){gigs.checkOnTour('artist_page');}});return true;}catch(e){console.log(e.message,e.stack);}},load:function(callback){try{api.call('songkick.getGeoEvents',{USER_ID:USER.USER_ID},function(request){if(typeof(request.results)!=='undefined'){USER.ON_TOUR=request.results;callback();}});}catch(e){console.log(e.message,e.stack);}},checkOnTour:function(context){try{if(typeof(USER.ON_TOUR)==='undefined'){gigs.load(function(){gigs.checkOnTour(context);});return false;}
var art_id;switch(context){case'artist_page':art_id=artist.id;if(typeof(USER.ON_TOUR[art_id])==='undefined'){return false;}
if(artist.displayExtended){$('#naboo_artist_ontour_classic').hide();$('#naboo_artist_ontour_extended').show().find('.ribbon_ontour').attr({'data-artist':art_id,'data-context':context});}else{$('#naboo_artist_ontour_classic').show().find('.ribbon_ontour').attr({'data-artist':art_id,'data-context':context});$('#naboo_artist_ontour_extended').hide();}
break;case'player':var currentSongInfo=dzPlayer.getCurrentSongInfo();if(currentSongInfo===null||typeof(currentSongInfo.ART_ID)==='undefined'||currentSongInfo.ART_ID===0||dzPlayer.getPlayerType()==='ads'||dzPlayer.getPlayerType()==='jingle'){playercontrol.$btnOnTour.attr('data-artist','').fadeOut();return false;}
art_id=currentSongInfo.ART_ID;if(typeof(USER.ON_TOUR[art_id])==='undefined'){playercontrol.$btnOnTour.attr('data-artist','').fadeOut();return false;}
playercontrol.$btnOnTour.attr({'data-artist':art_id,'data-context':context}).fadeIn();break;default:return false;}
return true;}catch(e){console.log(e.message,e.stack);}},goToEvents:function($el){try{var art_id=$el.attr('data-artist');var context=$el.attr('data-context');if(!$el.is(':visible')){return false;}
tracking.track('ontour_click',{'art_id':art_id,'type':context});window.open('/events/'+art_id);return true;}catch(e){console.log(e.message,e.stack);}}};};